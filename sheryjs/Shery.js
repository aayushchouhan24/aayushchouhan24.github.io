/*! For license information please see Shery.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("gsap"),require("tweakpane")):"function"==typeof define&&define.amd?define("Shery",["gsap","tweakpane"],t):"object"==typeof exports?exports.Shery=t(require("gsap"),require("tweakpane")):e.Shery=t(e.gsap,e.tweakpane)}(self,((e,t)=>(()=>{var n={593:e=>{e.exports="uniform sampler2D uTexture[16];\nuniform float uIntercept, displaceAmount, scrollType, time, speed, wobbliness, onMouse, uScroll, uSection;\nuniform bool isMulti, masker, gooeyBackgroundEffect;\nuniform vec2 mousei;\nuniform float maskVal, aspect, gooeySpeed, gooeyBall, discard_threshold, antialias_threshold, gooeyHeight, gooeyScale;\nvarying vec2 vuv;\n#define SNOISEHOLDER \r\n#define SHAPEMODIFIER \r\nvoid main() {\n\tvec2 uv = (vuv / 1.1) + .05;\n\tuv = (uv * 2.) - 1.;\n\tuv = masker ? mix(uv, uv / max(1., maskVal), uIntercept) : uv / max(1., maskVal);\n\tuv = (uv * .5) + .5;\n\tvec3 v = vec3((vuv.x * 1.) + ((time * speed) / 10.), vuv.y, time);\n\tvec2 surface = vec2(snoise(v) * .08, snoise(v) * .01);\n\tsurface = onMouse == 0. ? surface : onMouse == 1. ? mix(vec2(0.), surface, uIntercept) : mix(surface, vec2(0.), uIntercept);\n\tuv += refract(vec2(.0, .0), surface, wobbliness);\n\tgl_FragColor = texture2D(uTexture[0], uv);\n\tvec2 uv2 = gooeyBackgroundEffect ? vuv : uv;\n\t!isMulti;\n\troundedBoxSDF();\n}\n"},919:e=>{e.exports="varying vec2 vuv;\nvoid main() {\n\tgl_Position = ((projectionMatrix * viewMatrix) * modelMatrix) * vec4(position, 1.);\n\tvuv = uv;\n}\n"},86:e=>{e.exports="uniform vec2 mouse;\nuniform float resolutionXY, uIntercept, scrollType, displaceAmount, time, frequency, angle, speed, waveFactor, contrast, pixelStrength, quality, brightness, colorExposer, strength, exposer, uScroll, uSection;\nuniform int blender, onMouse, mousemove, mode, modeA, modeN;\nuniform vec2 mousei;\nuniform float maskVal, aspect, gooeySpeed, gooeyBall, discard_threshold, antialias_threshold, gooeyHeight, gooeyScale;\nuniform bool distortion, gooey, masker, gooeyBackgroundEffect;\nuniform vec3 color;\nvarying vec2 vuv;\nuniform sampler2D uTexture[5];\nuniform sampler2D blendImage;\nfloat mina(vec4 a) {\n\treturn min(min(a.r, a.g), a.b);\n}\nfloat maxa(vec4 a) {\n\treturn max(max(a.r, a.g), a.b);\n}\nvec4 minn(vec4 a, vec4 b) {\n\treturn vec4(min(a.r, b.r), min(a.g, b.g), min(a.b, b.b), 1.);\n}\nvec4 maxx(vec4 a, vec4 b) {\n\treturn vec4(max(a.r, b.r), max(a.g, b.g), max(a.b, b.b), 1.);\n}\nmat2 rotate2D(float r) {\n\treturn mat2(cos(r), sin(r), -sin(r), cos(r));\n}\n#define SNOISEHOLDER \r\n#define SHAPEMODIFIER \r\nvec4 img(vec2 uv, float c) {\n\tuv = (uv * 2.) - 1.;\n\tuv = masker ? mix(uv, uv / max(1., maskVal), uIntercept) : uv / max(1., maskVal);\n\tuv = (uv * .5) + .5;\n\tvec2 pos = vec2(vuv.x, vuv.y / aspect);\n\tvec2 mouse = vec2(mousei.x, mousei.y / aspect);\n\tvec2 interpole = mix(vec2(0), vec2(gooeyBall, gooeyHeight), uIntercept);\n\tfloat noise = (snoise(vec3(pos * gooeyScale, time * gooeySpeed)) + 1.) / 2.;\n\tfloat val = noise * interpole.y;\n\tfloat u = 1. - smoothstep(interpole.x, .0, distance(mouse, pos));\n\tfloat mouseMetaball = clamp(1. - u, 0., 1.);\n\tval += mouseMetaball;\n\tfloat alpha = smoothstep(discard_threshold - antialias_threshold, discard_threshold, val);\n\tfloat blend = uScroll - uSection;\n\tfloat blend2 = 1. - blend;\n\tvec4 imageA = texture2D(uTexture[0], vec2(uv.x, uv.y - (((texture2D(uTexture[0], uv).r * displaceAmount) * blend) * 2.))) * blend2;\n\tvec4 imageB = texture2D(uTexture[1], vec2(uv.x, uv.y + (((texture2D(uTexture[1], uv).r * displaceAmount) * blend2) * 2.))) * blend;\n\tvec2 uv2 = gooeyBackgroundEffect ? vuv : uv;\n\treturn gooey ? vec4(mix(texture2D(uTexture[0], uv), texture2D(uTexture[1], uv2), alpha)) : scrollType == 0. ? mix(texture2D(uTexture[1], uv), texture2D(uTexture[0], uv), step(uScroll - uSection, c + uv.y)) : (((imageA.bbra * blend) + (imageA * blend2)) + (imageB.bbra * blend2)) + (imageB * blend);\n}\nvec3 blendMode(vec3 base, vec3 blend) {\n\tif (mode == 1)\n\t\treturn base + blend;\n\telse if (mode == 2)\n\t\treturn base - blend;\n\telse if (mode == 3)\n\t\treturn base * blend;\n\telse if (mode == 4)\n\t\treturn base / blend;\n\telse if (mode == 5)\n\t\treturn 1. - ((1. - base) * (1. - blend));\n\telse if (mode == 6)\n\t\treturn (base + blend) - ((2. * base) * blend);\n\telse if (mode == 7)\n\t\treturn (base * blend) + ((1. - base) * (base + blend));\n\telse if (mode == 8)\n\t\treturn ((2. * base) * blend) / (base + blend);\n\telse if (mode == 9)\n\t\treturn mix(base, blend, .5);\n\telse if (mode == 10)\n\t\treturn sqrt(base * blend);\n\telse if (mode == 11)\n\t\treturn (base * blend) / (1. - ((1. - base) * (1. - blend)));\n\telse if (mode == 12)\n\t\treturn 1. - ((1. - base) / blend);\n\telse if (mode == 13)\n\t\treturn abs(base - blend);\n\telse if (mode == 14)\n\t\treturn (base + blend) - (2. * min(base, blend));\n\telse if (mode == 15)\n\t\treturn (base + blend) - (2. * max(base, blend));\n\telse if (mode == 16)\n\t\treturn (base + blend) - 1.;\n\telse if (mode == 17)\n\t\treturn min(base, blend);\n\telse if (mode == 18)\n\t\treturn max(base, blend);\n\telse if (mode == 19)\n\t\treturn (base + blend) - vec3(1.);\n\telse if (mode == 20)\n\t\treturn mix(base, blend, .3);\n\telse if (mode == 21)\n\t\treturn mix(base, blend, .15);\n\telse if (mode == 22)\n\t\treturn mix(base, blend, .1);\n\telse if (mode == 23)\n\t\treturn base / (1. - blend);\n\telse if (mode == 24)\n\t\treturn blend / (1. - base);\n\telse if (mode == 25)\n\t\treturn (((2. * base) * blend) - base) - blend;\n\telse if (mode == 26)\n\t\treturn (1. - ((1. - base) / blend)) - (1. - base);\n\telse if (mode == 27)\n\t\treturn mix(base, blend, .7);\n\telse if (mode == 28)\n\t\treturn (abs(base - blend) * 2.) - 1.;\n\telse if (mode == 29)\n\t\treturn 1. - abs((1. - base) - blend);\n\telse if (mode == 30)\n\t\treturn base;\n\telse if (mode == 31)\n\t\treturn mix(base, (((2. * base) * blend) - base) - blend, step(.5, blend));\n\telse if (mode == 32)\n\t\treturn mix(base, 1. - ((2. * (1. - base)) * (1. - blend)), step(.5, blend));\n\telse if (mode == 33)\n\t\treturn mix(base, 1. - ((2. * (1. - base)) * (1. - blend)), step(.5, base));\n\telse if (mode == 34)\n\t\treturn (base * sign(blend - .5)) + .5;\n\telse if (mode == 35)\n\t\treturn mix(base, .5 - (.5 * cos(3.14159265359 * blend)), step(.5, blend));\n\telse if (mode == 36)\n\t\treturn mix(base, pow(base, blend), step(.5, blend));\n\telse if (mode == 37)\n\t\treturn mix(base, log(base + .03) / log(blend + .03), step(.5, blend));\n\telse if (mode == 38)\n\t\treturn mix(base, 1. - abs((1. - base) - blend), step(.5, blend));\n\telse if (mode == 39)\n\t\treturn mix(base, abs(base - blend) / (1. - min(base, blend)), step(.5, blend));\n\telse if (mode == 40)\n\t\treturn mix(base, 1. - (abs((1. - base) - blend) / max(base, blend)), step(.5, blend));\n\telse if (mode == 41)\n\t\treturn mix(base, blend, step(.5, blend));\n\telse if (mode == 42)\n\t\treturn (base + (2. * blend)) - 1.;\n\telse if (mode == 43)\n\t\treturn mix(base, (base + (2. * blend)) - 1., step(.5, blend));\n\telse if (mode == 44)\n\t\treturn 1. - (abs((1. - base) - blend) * 2.);\n\telse if (mode == 45)\n\t\treturn mix(base, (base * blend) / (1. - blend), step(.5, blend));\n\telse if (mode == 46)\n\t\treturn (base + blend) - (base * blend);\n\telse if (mode == 47)\n\t\treturn (base + (2. * blend)) - (base * blend);\n\telse if (mode == 48)\n\t\treturn mix(base, (base + (2. * blend)) - (base * blend), step(.5, blend));\n\telse if (mode == 49)\n\t\treturn 1. - ((abs((1. - base) - blend) * 2.) * (1. - blend));\n\telse if (mode == 50)\n\t\treturn mix(base, (base * blend) / (1. - blend), step(.5, blend));\n\telse\n\t\treturn base;\n}\nvoid main() {\n\tvec2 resolution = vec2(resolutionXY * 20.);\n\tfloat brightness = clamp(brightness, -1., 25.);\n\tfloat frequency = clamp(frequency, -999., 999.);\n\tfloat contrast = clamp(contrast, -50., 50.);\n\tfloat pixelStrength = clamp(pixelStrength, -20., 999.);\n\tfloat strength = clamp(strength, -100., 100.);\n\tfloat colorExposer = clamp(colorExposer, -5., 5.);\n\tvec2 uv = (.5 * (gl_FragCoord.xy - (.5 * resolution.xy))) / resolution.y;\n\tuv = mousemove != 0 ? mix(uv, ((.5 * (gl_FragCoord.xy - (.5 * resolution.xy))) / resolution.y) + (mouse.xy / 300.), uIntercept) : uv;\n\tfloat c = ((sin(((uv.x * 7.) * snoise(vec3(uv, 1.))) + time) / 15.) * snoise(vec3(uv, 1.))) + .01;\n\tvec3 col = vec3(0);\n\tvec2 n, q = vec2(0);\n\tvec2 p = uv + (brightness / 10.);\n\tfloat d = dot(p, p);\n\tfloat a = -(contrast / 100.);\n\tmat2 angle = rotate2D(radians(angle));\n\tfor (float i = 1.; i <= 10.; i++) {\n\t\tif (i > quality)\n\t\t\tbreak;\n\t\tp, n *= angle;\n\t\tif (mousemove == 0)\n\t\t\tq = (((p * frequency) + (time * speed)) + ((sin(time) * .0018) * i)) - (pixelStrength * n);\n\t\tif (mousemove == 1)\n\t\t\tq = ((((p * frequency) + (time * speed)) + ((sin(time) * .0018) * i)) + mouse) - (pixelStrength * n);\n\t\tif (mousemove == 2)\n\t\t\tq = ((((p * frequency) + (time * speed)) + ((sin(time) * .0018) * i)) - pixelStrength) + (mouse * n);\n\t\tif (mousemove == 3)\n\t\t\tq = (((((p * frequency) + (time * speed)) + ((sin(time) * .0018) * i)) + mouse) - pixelStrength) + (mouse * n);\n\t\tif (modeA == 0)\n\t\t\ta += dot(sin(q) / frequency, vec2(strength));\n\t\telse if (modeA == 1)\n\t\t\ta += dot(cos(q) / frequency, vec2(strength));\n\t\telse if (modeA == 2)\n\t\t\ta += dot(tan(q) / frequency, vec2(strength));\n\t\telse if (modeA == 3)\n\t\t\ta += dot(atan(q) / frequency, vec2(strength));\n\t\tif (modeN == 0)\n\t\t\tn -= sin(q);\n\t\telse if (modeN == 1)\n\t\t\tn -= cos(q);\n\t\telse if (modeN == 2)\n\t\t\tn -= tan(q);\n\t\telse if (modeN == 3)\n\t\t\tn -= atan(q);\n\t\tn = mousemove != 0 ? mix(n + mouse, n, uIntercept) : n;\n\t\tfrequency *= waveFactor;\n\t}\n\tcol = ((((color * 4.5) * (a + colorExposer)) + ((exposer * 100.) * a)) + a) + d;\n\tvec4 base = distortion ? img((vuv + a) + (contrast / 100.), c) : img(vuv, c);\n\tbase = onMouse == 0 ? base : onMouse == 1 ? mix(img(vuv, c), base, uIntercept) : mix(base, img(vuv, c), uIntercept);\n\tvec4 blend = blender == 2 ? texture2D(blendImage, vuv) : blender == 1 ? vec4(uv, distance(sin(time / 10.), cos(time / 10.)), 1.) : vec4(col, 1.);\n\tvec4 final = vec4(blendMode(base.rgb, blend.rgb), 1.);\n\tfinal = mix(final * brightness, mix(maxx(final, vec4(1.)), final, contrast), .5);\n\tfinal = onMouse == 0 ? final : onMouse == 1 ? mix(base, final, uIntercept) : mix(final, base, uIntercept);\n\tgl_FragColor = final;\n\troundedBoxSDF();\n}\n"},444:e=>{e.exports="varying vec2 vuv;\nvoid main() {\n\tgl_Position = ((projectionMatrix * viewMatrix) * modelMatrix) * vec4(position, 1.);\n\tvuv = uv;\n}\n"},168:e=>{e.exports="uniform sampler2D uTexture[16];\nuniform float scrollType, displaceAmount, uScroll, uSection, time;\nuniform bool isMulti, masker, gooeyBackgroundEffect;\nuniform vec2 mousei;\nuniform float uIntercept, maskVal, aspect, gooeySpeed, gooeyBall, discard_threshold, antialias_threshold, gooeyHeight, gooeyScale;\nvarying vec2 vuv;\n#define SNOISEHOLDER \r\n#define SHAPEMODIFIER \r\nvoid main() {\n\tvec2 uv = vuv;\n\tuv = (uv * 2.) - 1.;\n\tuv = masker ? mix(uv, uv / max(1., maskVal), uIntercept) : uv / max(1., maskVal);\n\tuv = (uv * .5) + .5;\n\tgl_FragColor = texture2D(uTexture[0], uv);\n\tvec2 uv2 = gooeyBackgroundEffect ? vuv : uv;\n\t!isMulti;\n\troundedBoxSDF();\n}\n"},367:e=>{e.exports="uniform float uFrequencyX, uFrequencyY, uFrequencyZ, time, uIntercept;\nuniform int onMouse;\nvarying vec2 vuv;\nvoid main() {\n\tvec3 uFrequency = vec3(uFrequencyX / 500., uFrequencyY / 500., uFrequencyZ * 10.0);\n\tvec4 modelPosition = modelMatrix * vec4(position, 1.0);\n\tfloat elevation = (sin((modelPosition.x * uFrequency.x) - time) * uFrequency.z) / 1000.0;\n\televation += ((sin((modelPosition.y * uFrequency.y) - time) * uFrequency.z) / 1000.0);\n\tmodelPosition.z += elevation;\n\tmodelPosition = onMouse == 0 ? modelPosition : onMouse == 1 ? mix(modelMatrix * vec4(position, 1.0), modelPosition, uIntercept) : mix(modelPosition, modelMatrix * vec4(position, 1.0), uIntercept);\n\tgl_Position = (projectionMatrix * viewMatrix) * modelPosition;\n\tvuv = uv;\n}\n"},924:e=>{e.exports="uniform sampler2D uTexture[16];\nuniform float scrollType, displaceAmount, uScroll, uSection, time;\nuniform bool isMulti, masker, gooeyBackgroundEffect, uColor;\nuniform vec2 mousei;\nvarying float vWave;\nuniform float uIntercept, maskVal, aspect, gooeySpeed, gooeyBall, discard_threshold, antialias_threshold, gooeyHeight, gooeyScale;\nvarying vec2 vuv;\n#define SNOISEHOLDER \r\n#define SHAPEMODIFIER \r\nvoid main() {\n\tvec2 uv = vuv;\n\tuv = (uv * 2.) - 1.;\n\tuv = masker ? mix(uv, uv / max(1., maskVal), uIntercept) : uv / max(1., maskVal);\n\tuv = (uv * .5) + .5;\n\tgl_FragColor = texture2D(uTexture[0], uv);\n\tvec2 uv2 = gooeyBackgroundEffect ? vuv : uv;\n\t!isMulti;\n\tgl_FragColor = uColor ? mix(gl_FragColor, vec4(1.), vWave) : gl_FragColor;\n\troundedBoxSDF();\n}\n"},850:e=>{e.exports="varying vec2 vuv;\nvarying float vWave;\nuniform float time, uFrequency, uAmplitude, uSpeed, uIntercept, scrollType, onMouse, colorDepthFactor;\n#define SNOISEHOLDER \r\nvoid main() {\n\tvuv = uv;\n\tvec3 pos = position;\n\tfloat noiseFreq = uFrequency;\n\tfloat noiseAmp = uAmplitude / 10.;\n\tvec3 noisePos = vec3((pos.x * noiseFreq) + (time * uSpeed), pos.y, pos.z);\n\tpos.z += (snoise(noisePos) * noiseAmp);\n\tpos = onMouse == 0. ? pos : onMouse == 1. ? mix(position, pos, uIntercept) : mix(pos, position, uIntercept);\n\tvWave = pos.z * colorDepthFactor;\n\tgl_Position = (projectionMatrix * modelViewMatrix) * vec4(pos, 1.);\n}\n"},575:e=>{e.exports="uniform sampler2D uTexture[16];\nuniform float maskVal, uIntercept, displaceAmount, scrollType, time, speed, wobbliness, onMouse, uScroll, uSection;\nuniform bool isMulti, masker, gooeyBackgroundEffect;\nuniform vec2 mousei;\nuniform float aspect, gooeySpeed, gooeyBall, discard_threshold, antialias_threshold, gooeyHeight, gooeyScale;\nuniform vec2 mouse, mousem;\nvarying vec2 vuv;\n#define SNOISEHOLDER \r\n#define SHAPEMODIFIER \r\nfloat cnoise(vec2 P) {\n\treturn snoise(vec3(P, 1.));\n}\nvoid main() {\n\tvec2 uv = (vuv / 1.1) + .05;\n\tuv = (uv * 2.) - 1.;\n\tuv = masker ? mix(uv, uv / max(1., maskVal), uIntercept) : uv / max(1., maskVal);\n\tuv = (uv * .5) + .5;\n\tfloat time = time * speed;\n\tvec2 surface = vec2(cnoise((uv - ((mouse / 2.) / 7.)) + (.2 * time)) * .08, cnoise((uv - ((mouse / 2.) / 7.)) + (.2 * time)) * .08);\n\tsurface = onMouse == 0. ? surface : onMouse == 1. ? mix(vec2(0.), surface, uIntercept) : mix(surface, vec2(0.), uIntercept);\n\tuv += refract(vec2(mousem), surface, wobbliness);\n\tgl_FragColor = texture2D(uTexture[0], uv);\n\tvec2 uv2 = gooeyBackgroundEffect ? vuv : uv;\n\t!isMulti;\n\troundedBoxSDF();\n}\n"},136:e=>{e.exports="varying vec2 vuv;\nvoid main() {\n\tgl_Position = ((projectionMatrix * viewMatrix) * modelMatrix) * vec4(position, 1.);\n\tvuv = uv;\n}\n"},479:e=>{e.exports="precision mediump float;\nuniform sampler2D uTexture[16];\nuniform float maskVal, time, uIntercept, displaceAmount, scrollType, onMouse, uScroll, uSection, aspect, gooeySpeed, gooeyBall, discard_threshold, antialias_threshold, gooeyHeight, gooeyScale;\nuniform bool isMulti, masker, gooeyBackgroundEffect;\nuniform vec2 mousei;\nvarying vec2 vuv;\nuniform float noiseDetail;\nuniform float distortionAmount;\nuniform float scale, speed;\n#define SNOISEHOLDER\n#define SHAPEMODIFIER\nvoid main() {\n\tvec2 uv = vuv;\n\tuv = (uv * 2.) - 1.;\n\tuv = masker ? mix(uv, uv / max(1., maskVal), uIntercept) : uv / max(1., maskVal);\n\tuv = (uv * .5) + .5;\n\tfloat x = ((((uv.x - .5) * scale) * (noiseDetail / 100.)) * sin(time)) * speed;\n\tfloat y = ((((uv.y - .5) * scale) * (noiseDetail / 100.)) * cos(time)) * speed;\n\tfloat temp = snoise(vec3(x, y, 0.)) * (distortionAmount / 100.);\n\tuv += (onMouse == 0. ? temp : onMouse == 1. ? mix(0.0, temp, uIntercept) : mix(temp, 0.0, uIntercept));\n\tgl_FragColor = texture2D(uTexture[0], uv);\n\tvec2 uv2 = gooeyBackgroundEffect ? vuv : uv;\n\t!isMulti;\n\troundedBoxSDF();\n}\n"},908:e=>{e.exports="varying vec2 vuv;\nvoid main() {\n\tvec4 modelPosition = modelMatrix * vec4(position, 1.0);\n\tvec4 viewPosition = viewMatrix * modelPosition;\n\tvec4 projectedPosition = projectionMatrix * viewPosition;\n\tgl_Position = projectedPosition;\n\tvuv = uv;\n}\n"},330:e=>{e.exports="varying vec2 vuv;\nuniform float maskVal, time, uIntercept, displaceAmount, scrollType, onMouse, uScroll, uSection, aspect, gooeySpeed, gooeyBall, discard_threshold, antialias_threshold, gooeyHeight, gooeyScale;\nuniform bool isMulti, masker, gooeyBackgroundEffect;\nuniform vec2 mousei;\nuniform bool invert, isTexture, gooey;\nuniform vec3 color;\nuniform int blender;\nuniform sampler2D uTexture[10];\nuniform sampler2D blendImage;\nvarying float mPosition;\n#define SNOISEHOLDER\n#define SHAPEMODIFIER\nvoid main() {\n\tvec2 uv = vuv;\n\tuv = (uv * 2.) - 1.;\n\tuv = masker ? mix(uv, uv / max(1., maskVal), uIntercept) : uv / max(1., maskVal);\n\tuv = (uv * .5) + .5;\n\tvec2 uvx = uv;\n\tuv -= vec2(.5, .5);\n\tvec4 t = texture2D(uTexture[0], uvx);\n\tvec4 col = blender == 2 ? texture2D(blendImage, vuv) : blender == 1 ? vec4(uv, distance(sin(time / 10.), cos(time / 10.)), 1.) : vec4(color, 1.);\n\tif (isMulti && !gooey) {\n\t\tfloat c = ((sin(((uv.x * 7.) * snoise(vec3(uv, 1.))) + time) / 15.) * snoise(vec3(uv, 1.))) + .01;\n\t\tfloat blend = uScroll - uSection;\n\t\tfloat blend2 = 1. - blend;\n\t\tvec4 imageA = texture2D(uTexture[0], vec2(uvx.x, uvx.y - (((texture2D(uTexture[0], uvx).r * displaceAmount) * blend) * 2.))) * blend2;\n\t\tvec4 imageB = texture2D(uTexture[1], vec2(uvx.x, uvx.y + (((texture2D(uTexture[1], uvx).r * displaceAmount) * blend2) * 2.))) * blend;\n\t\tgl_FragColor = scrollType == 0. ? mix(texture2D(uTexture[1], uvx), texture2D(uTexture[0], uvx), step(uScroll - uSection, sin(c) + uvx.y)) : (((imageA.bbra * blend) + (imageA * blend2)) + (imageB.bbra * blend2)) + (imageB * blend);\n\t\tgl_FragColor = invert ? mix(gl_FragColor, col, mPosition) : mix(col, gl_FragColor, mPosition);\n\t}\n\telse\n\t\tgl_FragColor = invert ? mix(t, col, mPosition) : mix(col, t, mPosition);\n\tif (gooey) {\n\t\tvec2 pos = vec2(vuv.x, vuv.y / aspect);\n\t\tvec2 mouse = vec2(mousei.x, mousei.y / aspect);\n\t\tvec2 interpole = mix(vec2(0), vec2(gooeyBall, gooeyHeight), uIntercept);\n\t\tfloat noise = (snoise(vec3(pos * gooeyScale, time * gooeySpeed)) + 1.) / 2.;\n\t\tfloat val = noise * interpole.y;\n\t\tfloat u = 1. - smoothstep(interpole.x, .0, distance(mouse, pos));\n\t\tfloat mouseMetaball = clamp(1. - u, 0., 1.);\n\t\tval += mouseMetaball;\n\t\tfloat alpha = smoothstep(discard_threshold - antialias_threshold, discard_threshold, val);\n\t\tgl_FragColor = vec4(mix(gl_FragColor, invert ? mix(texture2D(uTexture[1], uvx), col, mPosition) : mix(col, texture2D(uTexture[1], uvx), mPosition), alpha));\n\t}\n\troundedBoxSDF();\n}\n"},102:e=>{e.exports="varying vec2 vuv;\nvarying float mPosition;\nuniform float time, maskVal, uIntercept, displaceAmount, scrollType, onMouse, uScroll, uSection, aspect, gooeySpeed, gooeyBall, discard_threshold, antialias_threshold, gooeyHeight, gooeyScale;\nuniform bool isMulti, masker, gooeyBackgroundEffect, showBump, showColor;\nuniform vec2 mousei;\nuniform float pattern, density, scale, clustering, gapping, smoothness, styling;\nvoid main() {\n\tvuv = uv;\n\tvec4 modelPosition = modelMatrix * vec4(position, 1.);\n\tvec2 pos = vec2(modelPosition.x, modelPosition.y) / 1000.;\n\tvec2 cuv = uv;\n\tcuv = (cuv * 2.) - 1.;\n\tcuv = masker ? mix(cuv, cuv / max(1., maskVal), uIntercept) : cuv / max(1., maskVal);\n\tcuv = (cuv * .5) + .5;\n\tvec2 uvx = cuv;\n\tvec2 scaledSize = vec2(1. - scale, (1. - scale) / aspect);\n\tvec2 offset = vec2(scale / 2., (scale / 2.) / aspect);\n\tvec2 scaled_uv = (vuv * scaledSize) + offset;\n\tvec2 tile = fract(scaled_uv);\n\tfloat tile_dist = min(min(tile.x, 1. - tile.x), min(tile.y, 1. - tile.y));\n\tfloat square_dist = length(floor(scaled_uv));\n\tfloat edge = sin(time - (square_dist * pattern));\n\tedge = mod(edge * edge, edge / edge);\n\tfloat value = mix(tile_dist, 1. - tile_dist, step(density, edge));\n\tedge = pow(abs(1. - edge), clustering) * gapping;\n\tvalue = smoothstep(edge - smoothness, edge, styling * value);\n\tvalue = onMouse == 0. ? -value + 1. : onMouse == 1. ? mix(modelPosition.z, -value + 1., uIntercept) : mix(-value + 1., modelPosition.z, uIntercept);\n\tmodelPosition.z = showBump ? value : modelPosition.z;\n\tvec4 viewPosition = viewMatrix * modelPosition;\n\tvec4 projectedPosition = projectionMatrix * viewPosition;\n\tgl_Position = projectedPosition;\n\tmPosition = showColor ? 1. - value : 1.;\n}\n"},163:t=>{"use strict";t.exports=e},904:e=>{"use strict";e.exports=t}},i={};function s(e){var t=i[e];if(void 0!==t)return t.exports;var r=i[e]={exports:{}};return n[e](r,r.exports,s),r.exports}s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};return(()=>{"use strict";s.r(r),s.d(r,{THREE:()=>e,default:()=>DB,hoverWithMediaCircle:()=>gB,imageEffect:()=>xB,imageMasker:()=>mB,makeMagnet:()=>fB,mouseFollower:()=>pB,smoothScroll:()=>RB,textAnimate:()=>vB,threeDimensional:()=>LB,utils:()=>t});var e={};s.r(e),s.d(e,{ACESFilmicToneMapping:()=>le,AddEquation:()=>R,AddOperation:()=>ie,AdditiveAnimationBlendMode:()=>Ut,AdditiveBlending:()=>T,AlphaFormat:()=>Fe,AlwaysCompare:()=>yn,AlwaysDepth:()=>K,AlwaysStencilFunc:()=>pn,AmbientLight:()=>Vd,AmbientLightProbe:()=>tp,AnimationAction:()=>Ap,AnimationClip:()=>ld,AnimationLoader:()=>gd,AnimationMixer:()=>Rp,AnimationObjectGroup:()=>Pp,AnimationUtils:()=>Yu,ArcCurve:()=>dh,ArrayCamera:()=>kl,ArrowHelper:()=>xm,Audio:()=>pp,AudioAnalyser:()=>wp,AudioContext:()=>Jd,AudioListener:()=>dp,AudioLoader:()=>Qd,AxesHelper:()=>Mm,BackSide:()=>x,BasicDepthPacking:()=>Gt,BasicShadowMap:()=>g,Bone:()=>Cc,BooleanKeyframeTrack:()=>td,Box2:()=>Gp,Box3:()=>Di,Box3Helper:()=>gm,BoxGeometry:()=>Gr,BoxHelper:()=>vm,BufferAttribute:()=>rr,BufferGeometry:()=>Mr,BufferGeometryLoader:()=>Wd,ByteType:()=>Le,Cache:()=>hd,Camera:()=>Yr,CameraHelper:()=>pm,CanvasTexture:()=>ch,CapsuleGeometry:()=>Ih,CatmullRomCurve3:()=>_h,CineonToneMapping:()=>oe,CircleGeometry:()=>kh,ClampToEdgeWrapping:()=>ge,Clock:()=>ap,Color:()=>Ys,ColorKeyframeTrack:()=>nd,ColorManagement:()=>di,CompressedArrayTexture:()=>oh,CompressedCubeTexture:()=>lh,CompressedTexture:()=>ah,CompressedTextureLoader:()=>_d,ConeGeometry:()=>Nh,CubeCamera:()=>Jr,CubeReflectionMapping:()=>ue,CubeRefractionMapping:()=>de,CubeTexture:()=>Qr,CubeTextureLoader:()=>bd,CubeUVReflectionMapping:()=>fe,CubicBezierCurve:()=>xh,CubicBezierCurve3:()=>Mh,CubicInterpolant:()=>Zu,CullFaceBack:()=>m,CullFaceFront:()=>f,CullFaceFrontBack:()=>v,CullFaceNone:()=>p,Curve:()=>hh,CurvePath:()=>Lh,CustomBlending:()=>L,CustomToneMapping:()=>ce,CylinderGeometry:()=>Oh,Cylindrical:()=>zp,Data3DTexture:()=>Si,DataArrayTexture:()=>Mi,DataTexture:()=>Tc,DataTextureLoader:()=>yd,DataUtils:()=>nr,DecrementStencilOp:()=>tn,DecrementWrapStencilOp:()=>sn,DefaultLoadingManager:()=>dd,DepthFormat:()=>je,DepthStencilFormat:()=>We,DepthTexture:()=>Vl,DirectionalLight:()=>Ud,DirectionalLightHelper:()=>hm,DiscreteInterpolant:()=>Qu,DisplayP3ColorSpace:()=>$t,DodecahedronGeometry:()=>Vh,DoubleSide:()=>M,DstAlphaFactor:()=>H,DstColorFactor:()=>j,DynamicCopyUsage:()=>An,DynamicDrawUsage:()=>Mn,DynamicReadUsage:()=>Cn,EdgesGeometry:()=>Gh,EllipseCurve:()=>uh,EqualCompare:()=>vn,EqualDepth:()=>Z,EqualStencilFunc:()=>ln,EquirectangularReflectionMapping:()=>pe,EquirectangularRefractionMapping:()=>me,Euler:()=>fs,EventDispatcher:()=>Nn,ExtrudeGeometry:()=>wu,FileLoader:()=>vd,Float16BufferAttribute:()=>pr,Float32BufferAttribute:()=>mr,Float64BufferAttribute:()=>fr,FloatType:()=>Oe,Fog:()=>ql,FogExp2:()=>Wl,FramebufferTexture:()=>rh,FrontSide:()=>y,Frustum:()=>oa,GLBufferAttribute:()=>Np,GLSL1:()=>Rn,GLSL3:()=>Dn,GreaterCompare:()=>_n,GreaterDepth:()=>Q,GreaterEqualCompare:()=>bn,GreaterEqualDepth:()=>J,GreaterEqualStencilFunc:()=>dn,GreaterStencilFunc:()=>hn,GridHelper:()=>rm,Group:()=>Ol,HalfFloatType:()=>Ne,HemisphereLight:()=>Ed,HemisphereLightHelper:()=>sm,HemisphereLightProbe:()=>ep,IcosahedronGeometry:()=>yu,ImageBitmapLoader:()=>$d,ImageLoader:()=>wd,ImageUtils:()=>mi,IncrementStencilOp:()=>en,IncrementWrapStencilOp:()=>nn,InstancedBufferAttribute:()=>Rc,InstancedBufferGeometry:()=>jd,InstancedInterleavedBuffer:()=>Op,InstancedMesh:()=>Bc,Int16BufferAttribute:()=>cr,Int32BufferAttribute:()=>ur,Int8BufferAttribute:()=>ar,IntType:()=>Ie,InterleavedBuffer:()=>Kl,InterleavedBufferAttribute:()=>$l,Interpolant:()=>$u,InterpolateDiscrete:()=>Lt,InterpolateLinear:()=>Rt,InterpolateSmooth:()=>Dt,InvertStencilOp:()=>rn,KeepStencilOp:()=>Jt,KeyframeTrack:()=>ed,LOD:()=>fc,LatheGeometry:()=>Dh,Layers:()=>vs,LessCompare:()=>fn,LessDepth:()=>Y,LessEqualCompare:()=>gn,LessEqualDepth:()=>$,LessEqualStencilFunc:()=>cn,LessStencilFunc:()=>on,Light:()=>Md,LightProbe:()=>zd,Line:()=>qc,Line3:()=>qp,LineBasicMaterial:()=>Fc,LineCurve:()=>Eh,LineCurve3:()=>Sh,LineDashedMaterial:()=>Hu,LineLoop:()=>$c,LineSegments:()=>Yc,LinearEncoding:()=>zt,LinearFilter:()=>Ee,LinearInterpolant:()=>Ju,LinearMipMapLinearFilter:()=>Pe,LinearMipMapNearestFilter:()=>Ce,LinearMipmapLinearFilter:()=>Te,LinearMipmapNearestFilter:()=>Se,LinearSRGBColorSpace:()=>Yt,LinearToneMapping:()=>re,Loader:()=>pd,LoaderUtils:()=>Gd,LoadingManager:()=>ud,LoopOnce:()=>Tt,LoopPingPong:()=>At,LoopRepeat:()=>Pt,LuminanceAlphaFormat:()=>Ge,LuminanceFormat:()=>He,MOUSE:()=>u,Material:()=>js,MaterialLoader:()=>Hd,MathUtils:()=>$n,Matrix3:()=>Jn,Matrix4:()=>rs,MaxEquation:()=>O,Mesh:()=>zr,MeshBasicMaterial:()=>Zs,MeshDepthMaterial:()=>Pl,MeshDistanceMaterial:()=>Al,MeshLambertMaterial:()=>Fu,MeshMatcapMaterial:()=>zu,MeshNormalMaterial:()=>Bu,MeshPhongMaterial:()=>Uu,MeshPhysicalMaterial:()=>Nu,MeshStandardMaterial:()=>Ou,MeshToonMaterial:()=>Vu,MinEquation:()=>k,MirroredRepeatWrapping:()=>_e,MixOperation:()=>ne,MultiplyBlending:()=>A,MultiplyOperation:()=>te,NearestFilter:()=>we,NearestMipMapLinearFilter:()=>Me,NearestMipMapNearestFilter:()=>ye,NearestMipmapLinearFilter:()=>xe,NearestMipmapNearestFilter:()=>be,NeverCompare:()=>mn,NeverDepth:()=>X,NeverStencilFunc:()=>an,NoBlending:()=>S,NoColorSpace:()=>Xt,NoToneMapping:()=>se,NormalAnimationBlendMode:()=>Nt,NormalBlending:()=>C,NotEqualCompare:()=>wn,NotEqualDepth:()=>ee,NotEqualStencilFunc:()=>un,NumberKeyframeTrack:()=>id,Object3D:()=>Ls,ObjectLoader:()=>qd,ObjectSpaceNormalMap:()=>qt,OctahedronGeometry:()=>xu,OneFactor:()=>U,OneMinusDstAlphaFactor:()=>G,OneMinusDstColorFactor:()=>W,OneMinusSrcAlphaFactor:()=>z,OneMinusSrcColorFactor:()=>B,OrthographicCamera:()=>ya,PCFShadowMap:()=>_,PCFSoftShadowMap:()=>w,PMREMGenerator:()=>La,Path:()=>Rh,PerspectiveCamera:()=>$r,Plane:()=>sa,PlaneGeometry:()=>ha,PlaneHelper:()=>_m,PointLight:()=>Od,PointLightHelper:()=>em,Points:()=>nh,PointsMaterial:()=>Zc,PolarGridHelper:()=>am,PolyhedronGeometry:()=>Uh,PositionalAudio:()=>_p,PropertyBinding:()=>Tp,PropertyMixer:()=>bp,QuadraticBezierCurve:()=>Ch,QuadraticBezierCurve3:()=>Th,Quaternion:()=>Pi,QuaternionKeyframeTrack:()=>rd,QuaternionLinearInterpolant:()=>sd,RED_GREEN_RGTC2_Format:()=>St,RED_RGTC1_Format:()=>Mt,REVISION:()=>h,RGBADepthPacking:()=>jt,RGBAFormat:()=>ze,RGBAIntegerFormat:()=>$e,RGBA_ASTC_10x10_Format:()=>wt,RGBA_ASTC_10x5_Format:()=>vt,RGBA_ASTC_10x6_Format:()=>gt,RGBA_ASTC_10x8_Format:()=>_t,RGBA_ASTC_12x10_Format:()=>bt,RGBA_ASTC_12x12_Format:()=>yt,RGBA_ASTC_4x4_Format:()=>lt,RGBA_ASTC_5x4_Format:()=>ct,RGBA_ASTC_5x5_Format:()=>ht,RGBA_ASTC_6x5_Format:()=>ut,RGBA_ASTC_6x6_Format:()=>dt,RGBA_ASTC_8x5_Format:()=>pt,RGBA_ASTC_8x6_Format:()=>mt,RGBA_ASTC_8x8_Format:()=>ft,RGBA_BPTC_Format:()=>xt,RGBA_ETC2_EAC_Format:()=>ot,RGBA_PVRTC_2BPPV1_Format:()=>st,RGBA_PVRTC_4BPPV1_Format:()=>it,RGBA_S3TC_DXT1_Format:()=>Je,RGBA_S3TC_DXT3_Format:()=>Qe,RGBA_S3TC_DXT5_Format:()=>et,RGB_ETC1_Format:()=>rt,RGB_ETC2_Format:()=>at,RGB_PVRTC_2BPPV1_Format:()=>nt,RGB_PVRTC_4BPPV1_Format:()=>tt,RGB_S3TC_DXT1_Format:()=>Ze,RGFormat:()=>Ke,RGIntegerFormat:()=>Ye,RawShaderMaterial:()=>ku,Ray:()=>ss,Raycaster:()=>Up,RectAreaLight:()=>Bd,RedFormat:()=>qe,RedIntegerFormat:()=>Xe,ReinhardToneMapping:()=>ae,RenderTarget:()=>yi,RepeatWrapping:()=>ve,ReplaceStencilOp:()=>Qt,ReverseSubtractEquation:()=>I,RingGeometry:()=>Mu,SIGNED_RED_GREEN_RGTC2_Format:()=>Ct,SIGNED_RED_RGTC1_Format:()=>Et,SRGBColorSpace:()=>Kt,Scene:()=>Xl,ShaderChunk:()=>ua,ShaderLib:()=>pa,ShaderMaterial:()=>Kr,ShadowMaterial:()=>Iu,Shape:()=>jh,ShapeGeometry:()=>Eu,ShapePath:()=>Em,ShapeUtils:()=>vu,ShortType:()=>Re,Skeleton:()=>Lc,SkeletonHelper:()=>Jp,SkinnedMesh:()=>Sc,Source:()=>vi,Sphere:()=>$i,SphereGeometry:()=>Su,Spherical:()=>Fp,SphericalHarmonics3:()=>Fd,SplineCurve:()=>Ph,SpotLight:()=>Ld,SpotLightHelper:()=>Kp,Sprite:()=>uc,SpriteMaterial:()=>Zl,SrcAlphaFactor:()=>F,SrcAlphaSaturateFactor:()=>q,SrcColorFactor:()=>V,StaticCopyUsage:()=>Pn,StaticDrawUsage:()=>xn,StaticReadUsage:()=>Sn,StereoCamera:()=>rp,StreamCopyUsage:()=>Ln,StreamDrawUsage:()=>En,StreamReadUsage:()=>Tn,StringKeyframeTrack:()=>ad,SubtractEquation:()=>D,SubtractiveBlending:()=>P,TOUCH:()=>d,TangentSpaceNormalMap:()=>Wt,TetrahedronGeometry:()=>Cu,Texture:()=>wi,TextureLoader:()=>xd,TorusGeometry:()=>Tu,TorusKnotGeometry:()=>Pu,Triangle:()=>Hs,TriangleFanDrawMode:()=>Ft,TriangleStripDrawMode:()=>Bt,TrianglesDrawMode:()=>Vt,TubeGeometry:()=>Au,TwoPassDoubleSide:()=>E,UVMapping:()=>he,Uint16BufferAttribute:()=>hr,Uint32BufferAttribute:()=>dr,Uint8BufferAttribute:()=>or,Uint8ClampedBufferAttribute:()=>lr,Uniform:()=>Dp,UniformsGroup:()=>kp,UniformsLib:()=>da,UniformsUtils:()=>Xr,UnsignedByteType:()=>Ae,UnsignedInt248Type:()=>Be,UnsignedIntType:()=>ke,UnsignedShort4444Type:()=>Ue,UnsignedShort5551Type:()=>Ve,UnsignedShortType:()=>De,VSMShadowMap:()=>b,Vector2:()=>Zn,Vector3:()=>Ai,Vector4:()=>bi,VectorKeyframeTrack:()=>od,VideoTexture:()=>sh,WebGL1Renderer:()=>jl,WebGL3DRenderTarget:()=>Ci,WebGLArrayRenderTarget:()=>Ei,WebGLCoordinateSystem:()=>kn,WebGLCubeRenderTarget:()=>ea,WebGLMultipleRenderTargets:()=>Ti,WebGLRenderTarget:()=>xi,WebGLRenderer:()=>Gl,WebGLUtils:()=>Il,WebGPUCoordinateSystem:()=>On,WireframeGeometry:()=>Lu,WrapAroundEnding:()=>Ot,ZeroCurvatureEnding:()=>It,ZeroFactor:()=>N,ZeroSlopeEnding:()=>kt,ZeroStencilOp:()=>Zt,_SRGBAFormat:()=>In,sRGBEncoding:()=>Ht});var t={};s.r(t),s.d(t,{B64ToTexture:()=>lv,clamp:()=>pv,copyToClipboard:()=>ev,damp:()=>mv,degToRad:()=>dv,dragElement:()=>ov,imageLoader:()=>hv,imageToB64:()=>cv,lerp:()=>uv,normalize:()=>bv,px:()=>sv,radToDeg:()=>fv,randFloat:()=>_v,randFloatSpread:()=>wv,randInt:()=>gv,rayCheck:()=>rv,seededRandom:()=>vv,stringify:()=>av,unit:()=>iv,waitUntil:()=>nv});var n={};s.r(n),s.d(n,{ButtonCellApi:()=>PS,ButtonGridApi:()=>LS,ButtonGridController:()=>RS,CubicBezier:()=>US,CubicBezierApi:()=>kS,CubicBezierAssembly:()=>VS,CubicBezierController:()=>eC,CubicBezierGraphController:()=>JS,CubicBezierGraphView:()=>KS,CubicBezierPickerController:()=>QS,CubicBezierPickerView:()=>WS,CubicBezierPreviewView:()=>$S,CubicBezierView:()=>GS,FpsGraphBladeApi:()=>nC,FpsGraphController:()=>aC,FpsView:()=>rC,Fpswatch:()=>iC,Interval:()=>hC,IntervalAssembly:()=>uC,IntervalConstraint:()=>dC,RadioCellApi:()=>xC,RadioController:()=>TC,RadioGridApi:()=>EC,RadioGridController:()=>PC,RadioView:()=>CC,RangeSliderController:()=>gC,RangeSliderTextController:()=>_C,RangeSliderTextView:()=>mC,RangeSliderView:()=>vC,TpRadioGridChangeEvent:()=>MC,css:()=>OC,id:()=>kC,plugins:()=>NC});var i={};s.r(i),s.d(i,{css:()=>_D,id:()=>gD,plugins:()=>wD});var a={};s.r(a),s.d(a,{RotationInputPluginEuler:()=>XV,RotationInputPluginQuaternion:()=>ZV,css:()=>QV,id:()=>JV,plugins:()=>eB});var o={};s.r(o),s.d(o,{THREE:()=>e,hoverWithMediaCircle:()=>gB,imageEffect:()=>xB,imageMasker:()=>mB,makeMagnet:()=>fB,mouseFollower:()=>pB,smoothScroll:()=>RB,textAnimate:()=>vB,threeDimensional:()=>LB,utils:()=>t});var l=s(163),c=s.n(l);const h="155",u={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},d={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},p=0,m=1,f=2,v=3,g=0,_=1,w=2,b=3,y=0,x=1,M=2,E=2,S=0,C=1,T=2,P=3,A=4,L=5,R=100,D=101,I=102,k=103,O=104,N=200,U=201,V=202,B=203,F=204,z=205,H=206,G=207,j=208,W=209,q=210,X=0,K=1,Y=2,$=3,Z=4,J=5,Q=6,ee=7,te=0,ne=1,ie=2,se=0,re=1,ae=2,oe=3,le=4,ce=5,he=300,ue=301,de=302,pe=303,me=304,fe=306,ve=1e3,ge=1001,_e=1002,we=1003,be=1004,ye=1004,xe=1005,Me=1005,Ee=1006,Se=1007,Ce=1007,Te=1008,Pe=1008,Ae=1009,Le=1010,Re=1011,De=1012,Ie=1013,ke=1014,Oe=1015,Ne=1016,Ue=1017,Ve=1018,Be=1020,Fe=1021,ze=1023,He=1024,Ge=1025,je=1026,We=1027,qe=1028,Xe=1029,Ke=1030,Ye=1031,$e=1033,Ze=33776,Je=33777,Qe=33778,et=33779,tt=35840,nt=35841,it=35842,st=35843,rt=36196,at=37492,ot=37496,lt=37808,ct=37809,ht=37810,ut=37811,dt=37812,pt=37813,mt=37814,ft=37815,vt=37816,gt=37817,_t=37818,wt=37819,bt=37820,yt=37821,xt=36492,Mt=36283,Et=36284,St=36285,Ct=36286,Tt=2200,Pt=2201,At=2202,Lt=2300,Rt=2301,Dt=2302,It=2400,kt=2401,Ot=2402,Nt=2500,Ut=2501,Vt=0,Bt=1,Ft=2,zt=3e3,Ht=3001,Gt=3200,jt=3201,Wt=0,qt=1,Xt="",Kt="srgb",Yt="srgb-linear",$t="display-p3",Zt=0,Jt=7680,Qt=7681,en=7682,tn=7683,nn=34055,sn=34056,rn=5386,an=512,on=513,ln=514,cn=515,hn=516,un=517,dn=518,pn=519,mn=512,fn=513,vn=514,gn=515,_n=516,wn=517,bn=518,yn=519,xn=35044,Mn=35048,En=35040,Sn=35045,Cn=35049,Tn=35041,Pn=35046,An=35050,Ln=35042,Rn="100",Dn="300 es",In=1035,kn=2e3,On=2001;class Nn{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const n=this._listeners[e];if(void 0!==n){const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const n=t.slice(0);for(let t=0,i=n.length;t<i;t++)n[t].call(this,e);e.target=null}}}const Un=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let Vn=1234567;const Bn=Math.PI/180,Fn=180/Math.PI;function zn(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(Un[255&e]+Un[e>>8&255]+Un[e>>16&255]+Un[e>>24&255]+"-"+Un[255&t]+Un[t>>8&255]+"-"+Un[t>>16&15|64]+Un[t>>24&255]+"-"+Un[63&n|128]+Un[n>>8&255]+"-"+Un[n>>16&255]+Un[n>>24&255]+Un[255&i]+Un[i>>8&255]+Un[i>>16&255]+Un[i>>24&255]).toLowerCase()}function Hn(e,t,n){return Math.max(t,Math.min(n,e))}function Gn(e,t){return(e%t+t)%t}function jn(e,t,n){return(1-n)*e+n*t}function Wn(e){return 0==(e&e-1)&&0!==e}function qn(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function Xn(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function Kn(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return e/4294967295;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int32Array:return Math.max(e/2147483647,-1);case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function Yn(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return Math.round(4294967295*e);case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int32Array:return Math.round(2147483647*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw new Error("Invalid component type.")}}const $n={DEG2RAD:Bn,RAD2DEG:Fn,generateUUID:zn,clamp:Hn,euclideanModulo:Gn,mapLinear:function(e,t,n,i,s){return i+(e-t)*(s-i)/(n-t)},inverseLerp:function(e,t,n){return e!==t?(n-e)/(t-e):0},lerp:jn,damp:function(e,t,n,i){return jn(e,t,1-Math.exp(-n*i))},pingpong:function(e,t=1){return t-Math.abs(Gn(e,2*t)-t)},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){void 0!==e&&(Vn=e);let t=Vn+=1831565813;return t=Math.imul(t^t>>>15,1|t),t^=t+Math.imul(t^t>>>7,61|t),((t^t>>>14)>>>0)/4294967296},degToRad:function(e){return e*Bn},radToDeg:function(e){return e*Fn},isPowerOfTwo:Wn,ceilPowerOfTwo:qn,floorPowerOfTwo:Xn,setQuaternionFromProperEuler:function(e,t,n,i,s){const r=Math.cos,a=Math.sin,o=r(n/2),l=a(n/2),c=r((t+i)/2),h=a((t+i)/2),u=r((t-i)/2),d=a((t-i)/2),p=r((i-t)/2),m=a((i-t)/2);switch(s){case"XYX":e.set(o*h,l*u,l*d,o*c);break;case"YZY":e.set(l*d,o*h,l*u,o*c);break;case"ZXZ":e.set(l*u,l*d,o*h,o*c);break;case"XZX":e.set(o*h,l*m,l*p,o*c);break;case"YXY":e.set(l*p,o*h,l*m,o*c);break;case"ZYZ":e.set(l*m,l*p,o*h,o*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+s)}},normalize:Yn,denormalize:Kn};class Zn{constructor(e=0,t=0){Zn.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(Hn(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),i=Math.sin(t),s=this.x-e.x,r=this.y-e.y;return this.x=s*n-r*i+e.x,this.y=s*i+r*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Jn{constructor(e,t,n,i,s,r,a,o,l){Jn.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==e&&this.set(e,t,n,i,s,r,a,o,l)}set(e,t,n,i,s,r,a,o,l){const c=this.elements;return c[0]=e,c[1]=i,c[2]=a,c[3]=t,c[4]=s,c[5]=o,c[6]=n,c[7]=r,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,s=this.elements,r=n[0],a=n[3],o=n[6],l=n[1],c=n[4],h=n[7],u=n[2],d=n[5],p=n[8],m=i[0],f=i[3],v=i[6],g=i[1],_=i[4],w=i[7],b=i[2],y=i[5],x=i[8];return s[0]=r*m+a*g+o*b,s[3]=r*f+a*_+o*y,s[6]=r*v+a*w+o*x,s[1]=l*m+c*g+h*b,s[4]=l*f+c*_+h*y,s[7]=l*v+c*w+h*x,s[2]=u*m+d*g+p*b,s[5]=u*f+d*_+p*y,s[8]=u*v+d*w+p*x,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],i=e[2],s=e[3],r=e[4],a=e[5],o=e[6],l=e[7],c=e[8];return t*r*c-t*a*l-n*s*c+n*a*o+i*s*l-i*r*o}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],s=e[3],r=e[4],a=e[5],o=e[6],l=e[7],c=e[8],h=c*r-a*l,u=a*o-c*s,d=l*s-r*o,p=t*h+n*u+i*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const m=1/p;return e[0]=h*m,e[1]=(i*l-c*n)*m,e[2]=(a*n-i*r)*m,e[3]=u*m,e[4]=(c*t-i*o)*m,e[5]=(i*s-a*t)*m,e[6]=d*m,e[7]=(n*o-l*t)*m,e[8]=(r*t-n*s)*m,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,i,s,r,a){const o=Math.cos(s),l=Math.sin(s);return this.set(n*o,n*l,-n*(o*r+l*a)+r+e,-i*l,i*o,-i*(-l*r+o*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(Qn.makeScale(e,t)),this}rotate(e){return this.premultiply(Qn.makeRotation(-e)),this}translate(e,t){return this.premultiply(Qn.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let e=0;e<9;e++)if(t[e]!==n[e])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}const Qn=new Jn;function ei(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}const ti={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function ni(e,t){return new ti[e](t)}function ii(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}const si={};function ri(e){e in si||(si[e]=!0,console.warn(e))}function ai(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function oi(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}const li=(new Jn).fromArray([.8224621,.0331941,.0170827,.177538,.9668058,.0723974,-1e-7,1e-7,.9105199]),ci=(new Jn).fromArray([1.2249401,-.0420569,-.0196376,-.2249404,1.0420571,-.0786361,1e-7,0,1.0982735]);const hi={[Yt]:e=>e,[Kt]:e=>e.convertSRGBToLinear(),[$t]:function(e){return e.convertSRGBToLinear().applyMatrix3(ci)}},ui={[Yt]:e=>e,[Kt]:e=>e.convertLinearToSRGB(),[$t]:function(e){return e.applyMatrix3(li).convertLinearToSRGB()}},di={enabled:!0,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(e){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!e},get workingColorSpace(){return Yt},set workingColorSpace(e){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(e,t,n){if(!1===this.enabled||t===n||!t||!n)return e;const i=hi[t],s=ui[n];if(void 0===i||void 0===s)throw new Error(`Unsupported color space conversion, "${t}" to "${n}".`);return s(i(e))},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)}};let pi;class mi{static getDataURL(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===pi&&(pi=ii("canvas")),pi.width=e.width,pi.height=e.height;const n=pi.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=pi}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const t=ii("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const i=n.getImageData(0,0,e.width,e.height),s=i.data;for(let e=0;e<s.length;e++)s[e]=255*ai(s[e]/255);return n.putImageData(i,0,0),t}if(e.data){const t=e.data.slice(0);for(let e=0;e<t.length;e++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[e]=Math.floor(255*ai(t[e]/255)):t[e]=ai(t[e]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let fi=0;class vi{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:fi++}),this.uuid=zn(),this.data=e,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];const n={uuid:this.uuid,url:""},i=this.data;if(null!==i){let e;if(Array.isArray(i)){e=[];for(let t=0,n=i.length;t<n;t++)i[t].isDataTexture?e.push(gi(i[t].image)):e.push(gi(i[t]))}else e=gi(i);n.url=e}return t||(e.images[this.uuid]=n),n}}function gi(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?mi.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let _i=0;class wi extends Nn{constructor(e=wi.DEFAULT_IMAGE,t=wi.DEFAULT_MAPPING,n=ge,i=ge,s=Ee,r=Te,a=ze,o=Ae,l=wi.DEFAULT_ANISOTROPY,c=Xt){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:_i++}),this.uuid=zn(),this.name="",this.source=new vi(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=i,this.magFilter=s,this.minFilter=r,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=o,this.offset=new Zn(0,0),this.repeat=new Zn(1,1),this.center=new Zn(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Jn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,"string"==typeof c?this.colorSpace=c:(ri("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=c===Ht?Kt:Xt),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==he)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case ve:e.x=e.x-Math.floor(e.x);break;case ge:e.x=e.x<0?0:1;break;case _e:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case ve:e.y=e.y-Math.floor(e.y);break;case ge:e.y=e.y<0?0:1;break;case _e:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}get encoding(){return ri("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===Kt?Ht:zt}set encoding(e){ri("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=e===Ht?Kt:Xt}}wi.DEFAULT_IMAGE=null,wi.DEFAULT_MAPPING=he,wi.DEFAULT_ANISOTROPY=1;class bi{constructor(e=0,t=0,n=0,i=1){bi.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,s=this.w,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*i+r[12]*s,this.y=r[1]*t+r[5]*n+r[9]*i+r[13]*s,this.z=r[2]*t+r[6]*n+r[10]*i+r[14]*s,this.w=r[3]*t+r[7]*n+r[11]*i+r[15]*s,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,i,s;const r=.01,a=.1,o=e.elements,l=o[0],c=o[4],h=o[8],u=o[1],d=o[5],p=o[9],m=o[2],f=o[6],v=o[10];if(Math.abs(c-u)<r&&Math.abs(h-m)<r&&Math.abs(p-f)<r){if(Math.abs(c+u)<a&&Math.abs(h+m)<a&&Math.abs(p+f)<a&&Math.abs(l+d+v-3)<a)return this.set(1,0,0,0),this;t=Math.PI;const e=(l+1)/2,o=(d+1)/2,g=(v+1)/2,_=(c+u)/4,w=(h+m)/4,b=(p+f)/4;return e>o&&e>g?e<r?(n=0,i=.707106781,s=.707106781):(n=Math.sqrt(e),i=_/n,s=w/n):o>g?o<r?(n=.707106781,i=0,s=.707106781):(i=Math.sqrt(o),n=_/i,s=b/i):g<r?(n=.707106781,i=.707106781,s=0):(s=Math.sqrt(g),n=w/s,i=b/s),this.set(n,i,s,t),this}let g=Math.sqrt((f-p)*(f-p)+(h-m)*(h-m)+(u-c)*(u-c));return Math.abs(g)<.001&&(g=1),this.x=(f-p)/g,this.y=(h-m)/g,this.z=(u-c)/g,this.w=Math.acos((l+d+v-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class yi extends Nn{constructor(e=1,t=1,n={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new bi(0,0,e,t),this.scissorTest=!1,this.viewport=new bi(0,0,e,t);const i={width:e,height:t,depth:1};void 0!==n.encoding&&(ri("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),n.colorSpace=n.encoding===Ht?Kt:Xt),this.texture=new wi(i,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,this.texture.internalFormat=void 0!==n.internalFormat?n.internalFormat:null,this.texture.minFilter=void 0!==n.minFilter?n.minFilter:Ee,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0!==n.stencilBuffer&&n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null,this.samples=void 0!==n.samples?n.samples:0}setSize(e,t,n=1){this.width===e&&this.height===t&&this.depth===n||(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new vi(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class xi extends yi{constructor(e=1,t=1,n={}){super(e,t,n),this.isWebGLRenderTarget=!0}}class Mi extends wi{constructor(e=null,t=1,n=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=we,this.minFilter=we,this.wrapR=ge,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Ei extends xi{constructor(e=1,t=1,n=1){super(e,t),this.isWebGLArrayRenderTarget=!0,this.depth=n,this.texture=new Mi(null,e,t,n),this.texture.isRenderTargetTexture=!0}}class Si extends wi{constructor(e=null,t=1,n=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=we,this.minFilter=we,this.wrapR=ge,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Ci extends xi{constructor(e=1,t=1,n=1){super(e,t),this.isWebGL3DRenderTarget=!0,this.depth=n,this.texture=new Si(null,e,t,n),this.texture.isRenderTargetTexture=!0}}class Ti extends xi{constructor(e=1,t=1,n=1,i={}){super(e,t,i),this.isWebGLMultipleRenderTargets=!0;const s=this.texture;this.texture=[];for(let e=0;e<n;e++)this.texture[e]=s.clone(),this.texture[e].isRenderTargetTexture=!0}setSize(e,t,n=1){if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let i=0,s=this.texture.length;i<s;i++)this.texture[i].image.width=e,this.texture[i].image.height=t,this.texture[i].image.depth=n;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.texture.length=0;for(let t=0,n=e.texture.length;t<n;t++)this.texture[t]=e.texture[t].clone(),this.texture[t].isRenderTargetTexture=!0;return this}}class Pi{constructor(e=0,t=0,n=0,i=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=i}static slerpFlat(e,t,n,i,s,r,a){let o=n[i+0],l=n[i+1],c=n[i+2],h=n[i+3];const u=s[r+0],d=s[r+1],p=s[r+2],m=s[r+3];if(0===a)return e[t+0]=o,e[t+1]=l,e[t+2]=c,void(e[t+3]=h);if(1===a)return e[t+0]=u,e[t+1]=d,e[t+2]=p,void(e[t+3]=m);if(h!==m||o!==u||l!==d||c!==p){let e=1-a;const t=o*u+l*d+c*p+h*m,n=t>=0?1:-1,i=1-t*t;if(i>Number.EPSILON){const s=Math.sqrt(i),r=Math.atan2(s,t*n);e=Math.sin(e*r)/s,a=Math.sin(a*r)/s}const s=a*n;if(o=o*e+u*s,l=l*e+d*s,c=c*e+p*s,h=h*e+m*s,e===1-a){const e=1/Math.sqrt(o*o+l*l+c*c+h*h);o*=e,l*=e,c*=e,h*=e}}e[t]=o,e[t+1]=l,e[t+2]=c,e[t+3]=h}static multiplyQuaternionsFlat(e,t,n,i,s,r){const a=n[i],o=n[i+1],l=n[i+2],c=n[i+3],h=s[r],u=s[r+1],d=s[r+2],p=s[r+3];return e[t]=a*p+c*h+o*d-l*u,e[t+1]=o*p+c*u+l*h-a*d,e[t+2]=l*p+c*d+a*u-o*h,e[t+3]=c*p-a*h-o*u-l*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){const n=e._x,i=e._y,s=e._z,r=e._order,a=Math.cos,o=Math.sin,l=a(n/2),c=a(i/2),h=a(s/2),u=o(n/2),d=o(i/2),p=o(s/2);switch(r){case"XYZ":this._x=u*c*h+l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h-u*d*p;break;case"YXZ":this._x=u*c*h+l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h+u*d*p;break;case"ZXY":this._x=u*c*h-l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h-u*d*p;break;case"ZYX":this._x=u*c*h-l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h+u*d*p;break;case"YZX":this._x=u*c*h+l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h-u*d*p;break;case"XZY":this._x=u*c*h-l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h+u*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+r)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],i=t[4],s=t[8],r=t[1],a=t[5],o=t[9],l=t[2],c=t[6],h=t[10],u=n+a+h;if(u>0){const e=.5/Math.sqrt(u+1);this._w=.25/e,this._x=(c-o)*e,this._y=(s-l)*e,this._z=(r-i)*e}else if(n>a&&n>h){const e=2*Math.sqrt(1+n-a-h);this._w=(c-o)/e,this._x=.25*e,this._y=(i+r)/e,this._z=(s+l)/e}else if(a>h){const e=2*Math.sqrt(1+a-n-h);this._w=(s-l)/e,this._x=(i+r)/e,this._y=.25*e,this._z=(o+c)/e}else{const e=2*Math.sqrt(1+h-n-a);this._w=(r-i)/e,this._x=(s+l)/e,this._y=(o+c)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Hn(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(0===n)return this;const i=Math.min(1,t/n);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,i=e._y,s=e._z,r=e._w,a=t._x,o=t._y,l=t._z,c=t._w;return this._x=n*c+r*a+i*l-s*o,this._y=i*c+r*o+s*a-n*l,this._z=s*c+r*l+n*o-i*a,this._w=r*c-n*a-i*o-s*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const n=this._x,i=this._y,s=this._z,r=this._w;let a=r*e._w+n*e._x+i*e._y+s*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=r,this._x=n,this._y=i,this._z=s,this;const o=1-a*a;if(o<=Number.EPSILON){const e=1-t;return this._w=e*r+t*this._w,this._x=e*n+t*this._x,this._y=e*i+t*this._y,this._z=e*s+t*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(o),c=Math.atan2(l,a),h=Math.sin((1-t)*c)/l,u=Math.sin(t*c)/l;return this._w=r*h+this._w*u,this._x=n*h+this._x*u,this._y=i*h+this._y*u,this._z=s*h+this._z*u,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=Math.random(),t=Math.sqrt(1-e),n=Math.sqrt(e),i=2*Math.PI*Math.random(),s=2*Math.PI*Math.random();return this.set(t*Math.cos(i),n*Math.sin(s),n*Math.cos(s),t*Math.sin(i))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Ai{constructor(e=0,t=0,n=0){Ai.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(Ri.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(Ri.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,i=this.z,s=e.elements;return this.x=s[0]*t+s[3]*n+s[6]*i,this.y=s[1]*t+s[4]*n+s[7]*i,this.z=s[2]*t+s[5]*n+s[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,s=e.elements,r=1/(s[3]*t+s[7]*n+s[11]*i+s[15]);return this.x=(s[0]*t+s[4]*n+s[8]*i+s[12])*r,this.y=(s[1]*t+s[5]*n+s[9]*i+s[13])*r,this.z=(s[2]*t+s[6]*n+s[10]*i+s[14])*r,this}applyQuaternion(e){const t=this.x,n=this.y,i=this.z,s=e.x,r=e.y,a=e.z,o=e.w,l=o*t+r*i-a*n,c=o*n+a*t-s*i,h=o*i+s*n-r*t,u=-s*t-r*n-a*i;return this.x=l*o+u*-s+c*-a-h*-r,this.y=c*o+u*-r+h*-s-l*-a,this.z=h*o+u*-a+l*-r-c*-s,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,i=this.z,s=e.elements;return this.x=s[0]*t+s[4]*n+s[8]*i,this.y=s[1]*t+s[5]*n+s[9]*i,this.z=s[2]*t+s[6]*n+s[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,i=e.y,s=e.z,r=t.x,a=t.y,o=t.z;return this.x=i*o-s*a,this.y=s*r-n*o,this.z=n*a-i*r,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return Li.copy(this).projectOnVector(e),this.sub(Li)}reflect(e){return this.sub(Li.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(Hn(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,n=Math.sqrt(1-e**2);return this.x=n*Math.cos(t),this.y=n*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Li=new Ai,Ri=new Pi;class Di{constructor(e=new Ai(1/0,1/0,1/0),t=new Ai(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t+=3)this.expandByPoint(ki.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,n=e.count;t<n;t++)this.expandByPoint(ki.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=ki.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){if(e.updateWorldMatrix(!1,!1),void 0!==e.boundingBox)null===e.boundingBox&&e.computeBoundingBox(),Oi.copy(e.boundingBox),Oi.applyMatrix4(e.matrixWorld),this.union(Oi);else{const n=e.geometry;if(void 0!==n)if(t&&void 0!==n.attributes&&void 0!==n.attributes.position){const t=n.attributes.position;for(let n=0,i=t.count;n<i;n++)ki.fromBufferAttribute(t,n).applyMatrix4(e.matrixWorld),this.expandByPoint(ki)}else null===n.boundingBox&&n.computeBoundingBox(),Oi.copy(n.boundingBox),Oi.applyMatrix4(e.matrixWorld),this.union(Oi)}const n=e.children;for(let e=0,i=n.length;e<i;e++)this.expandByObject(n[e],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,ki),ki.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Hi),Gi.subVectors(this.max,Hi),Ni.subVectors(e.a,Hi),Ui.subVectors(e.b,Hi),Vi.subVectors(e.c,Hi),Bi.subVectors(Ui,Ni),Fi.subVectors(Vi,Ui),zi.subVectors(Ni,Vi);let t=[0,-Bi.z,Bi.y,0,-Fi.z,Fi.y,0,-zi.z,zi.y,Bi.z,0,-Bi.x,Fi.z,0,-Fi.x,zi.z,0,-zi.x,-Bi.y,Bi.x,0,-Fi.y,Fi.x,0,-zi.y,zi.x,0];return!!qi(t,Ni,Ui,Vi,Gi)&&(t=[1,0,0,0,1,0,0,0,1],!!qi(t,Ni,Ui,Vi,Gi)&&(ji.crossVectors(Bi,Fi),t=[ji.x,ji.y,ji.z],qi(t,Ni,Ui,Vi,Gi)))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,ki).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=.5*this.getSize(ki).length()),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(Ii[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Ii[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Ii[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Ii[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Ii[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Ii[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Ii[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Ii[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Ii)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Ii=[new Ai,new Ai,new Ai,new Ai,new Ai,new Ai,new Ai,new Ai],ki=new Ai,Oi=new Di,Ni=new Ai,Ui=new Ai,Vi=new Ai,Bi=new Ai,Fi=new Ai,zi=new Ai,Hi=new Ai,Gi=new Ai,ji=new Ai,Wi=new Ai;function qi(e,t,n,i,s){for(let r=0,a=e.length-3;r<=a;r+=3){Wi.fromArray(e,r);const a=s.x*Math.abs(Wi.x)+s.y*Math.abs(Wi.y)+s.z*Math.abs(Wi.z),o=t.dot(Wi),l=n.dot(Wi),c=i.dot(Wi);if(Math.max(-Math.max(o,l,c),Math.min(o,l,c))>a)return!1}return!0}const Xi=new Di,Ki=new Ai,Yi=new Ai;class $i{constructor(e=new Ai,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;void 0!==t?n.copy(t):Xi.setFromPoints(e).getCenter(n);let i=0;for(let t=0,s=e.length;t<s;t++)i=Math.max(i,n.distanceToSquared(e[t]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Ki.subVectors(e,this.center);const t=Ki.lengthSq();if(t>this.radius*this.radius){const e=Math.sqrt(t),n=.5*(e-this.radius);this.center.addScaledVector(Ki,n/e),this.radius+=n}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(Yi.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Ki.copy(e.center).add(Yi)),this.expandByPoint(Ki.copy(e.center).sub(Yi))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const Zi=new Ai,Ji=new Ai,Qi=new Ai,es=new Ai,ts=new Ai,ns=new Ai,is=new Ai;class ss{constructor(e=new Ai,t=new Ai(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Zi)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Zi.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Zi.copy(this.origin).addScaledVector(this.direction,t),Zi.distanceToSquared(e))}distanceSqToSegment(e,t,n,i){Ji.copy(e).add(t).multiplyScalar(.5),Qi.copy(t).sub(e).normalize(),es.copy(this.origin).sub(Ji);const s=.5*e.distanceTo(t),r=-this.direction.dot(Qi),a=es.dot(this.direction),o=-es.dot(Qi),l=es.lengthSq(),c=Math.abs(1-r*r);let h,u,d,p;if(c>0)if(h=r*o-a,u=r*a-o,p=s*c,h>=0)if(u>=-p)if(u<=p){const e=1/c;h*=e,u*=e,d=h*(h+r*u+2*a)+u*(r*h+u+2*o)+l}else u=s,h=Math.max(0,-(r*u+a)),d=-h*h+u*(u+2*o)+l;else u=-s,h=Math.max(0,-(r*u+a)),d=-h*h+u*(u+2*o)+l;else u<=-p?(h=Math.max(0,-(-r*s+a)),u=h>0?-s:Math.min(Math.max(-s,-o),s),d=-h*h+u*(u+2*o)+l):u<=p?(h=0,u=Math.min(Math.max(-s,-o),s),d=u*(u+2*o)+l):(h=Math.max(0,-(r*s+a)),u=h>0?s:Math.min(Math.max(-s,-o),s),d=-h*h+u*(u+2*o)+l);else u=r>0?-s:s,h=Math.max(0,-(r*u+a)),d=-h*h+u*(u+2*o)+l;return n&&n.copy(this.origin).addScaledVector(this.direction,h),i&&i.copy(Ji).addScaledVector(Qi,u),d}intersectSphere(e,t){Zi.subVectors(e.center,this.origin);const n=Zi.dot(this.direction),i=Zi.dot(Zi)-n*n,s=e.radius*e.radius;if(i>s)return null;const r=Math.sqrt(s-i),a=n-r,o=n+r;return o<0?null:a<0?this.at(o,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);if(0===t)return!0;return e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,i,s,r,a,o;const l=1/this.direction.x,c=1/this.direction.y,h=1/this.direction.z,u=this.origin;return l>=0?(n=(e.min.x-u.x)*l,i=(e.max.x-u.x)*l):(n=(e.max.x-u.x)*l,i=(e.min.x-u.x)*l),c>=0?(s=(e.min.y-u.y)*c,r=(e.max.y-u.y)*c):(s=(e.max.y-u.y)*c,r=(e.min.y-u.y)*c),n>r||s>i?null:((s>n||isNaN(n))&&(n=s),(r<i||isNaN(i))&&(i=r),h>=0?(a=(e.min.z-u.z)*h,o=(e.max.z-u.z)*h):(a=(e.max.z-u.z)*h,o=(e.min.z-u.z)*h),n>o||a>i?null:((a>n||n!=n)&&(n=a),(o<i||i!=i)&&(i=o),i<0?null:this.at(n>=0?n:i,t)))}intersectsBox(e){return null!==this.intersectBox(e,Zi)}intersectTriangle(e,t,n,i,s){ts.subVectors(t,e),ns.subVectors(n,e),is.crossVectors(ts,ns);let r,a=this.direction.dot(is);if(a>0){if(i)return null;r=1}else{if(!(a<0))return null;r=-1,a=-a}es.subVectors(this.origin,e);const o=r*this.direction.dot(ns.crossVectors(es,ns));if(o<0)return null;const l=r*this.direction.dot(ts.cross(es));if(l<0)return null;if(o+l>a)return null;const c=-r*es.dot(is);return c<0?null:this.at(c/a,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class rs{constructor(e,t,n,i,s,r,a,o,l,c,h,u,d,p,m,f){rs.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==e&&this.set(e,t,n,i,s,r,a,o,l,c,h,u,d,p,m,f)}set(e,t,n,i,s,r,a,o,l,c,h,u,d,p,m,f){const v=this.elements;return v[0]=e,v[4]=t,v[8]=n,v[12]=i,v[1]=s,v[5]=r,v[9]=a,v[13]=o,v[2]=l,v[6]=c,v[10]=h,v[14]=u,v[3]=d,v[7]=p,v[11]=m,v[15]=f,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new rs).fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,i=1/as.setFromMatrixColumn(e,0).length(),s=1/as.setFromMatrixColumn(e,1).length(),r=1/as.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*s,t[5]=n[5]*s,t[6]=n[6]*s,t[7]=0,t[8]=n[8]*r,t[9]=n[9]*r,t[10]=n[10]*r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,i=e.y,s=e.z,r=Math.cos(n),a=Math.sin(n),o=Math.cos(i),l=Math.sin(i),c=Math.cos(s),h=Math.sin(s);if("XYZ"===e.order){const e=r*c,n=r*h,i=a*c,s=a*h;t[0]=o*c,t[4]=-o*h,t[8]=l,t[1]=n+i*l,t[5]=e-s*l,t[9]=-a*o,t[2]=s-e*l,t[6]=i+n*l,t[10]=r*o}else if("YXZ"===e.order){const e=o*c,n=o*h,i=l*c,s=l*h;t[0]=e+s*a,t[4]=i*a-n,t[8]=r*l,t[1]=r*h,t[5]=r*c,t[9]=-a,t[2]=n*a-i,t[6]=s+e*a,t[10]=r*o}else if("ZXY"===e.order){const e=o*c,n=o*h,i=l*c,s=l*h;t[0]=e-s*a,t[4]=-r*h,t[8]=i+n*a,t[1]=n+i*a,t[5]=r*c,t[9]=s-e*a,t[2]=-r*l,t[6]=a,t[10]=r*o}else if("ZYX"===e.order){const e=r*c,n=r*h,i=a*c,s=a*h;t[0]=o*c,t[4]=i*l-n,t[8]=e*l+s,t[1]=o*h,t[5]=s*l+e,t[9]=n*l-i,t[2]=-l,t[6]=a*o,t[10]=r*o}else if("YZX"===e.order){const e=r*o,n=r*l,i=a*o,s=a*l;t[0]=o*c,t[4]=s-e*h,t[8]=i*h+n,t[1]=h,t[5]=r*c,t[9]=-a*c,t[2]=-l*c,t[6]=n*h+i,t[10]=e-s*h}else if("XZY"===e.order){const e=r*o,n=r*l,i=a*o,s=a*l;t[0]=o*c,t[4]=-h,t[8]=l*c,t[1]=e*h+s,t[5]=r*c,t[9]=n*h-i,t[2]=i*h-n,t[6]=a*c,t[10]=s*h+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(ls,e,cs)}lookAt(e,t,n){const i=this.elements;return ds.subVectors(e,t),0===ds.lengthSq()&&(ds.z=1),ds.normalize(),hs.crossVectors(n,ds),0===hs.lengthSq()&&(1===Math.abs(n.z)?ds.x+=1e-4:ds.z+=1e-4,ds.normalize(),hs.crossVectors(n,ds)),hs.normalize(),us.crossVectors(ds,hs),i[0]=hs.x,i[4]=us.x,i[8]=ds.x,i[1]=hs.y,i[5]=us.y,i[9]=ds.y,i[2]=hs.z,i[6]=us.z,i[10]=ds.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,s=this.elements,r=n[0],a=n[4],o=n[8],l=n[12],c=n[1],h=n[5],u=n[9],d=n[13],p=n[2],m=n[6],f=n[10],v=n[14],g=n[3],_=n[7],w=n[11],b=n[15],y=i[0],x=i[4],M=i[8],E=i[12],S=i[1],C=i[5],T=i[9],P=i[13],A=i[2],L=i[6],R=i[10],D=i[14],I=i[3],k=i[7],O=i[11],N=i[15];return s[0]=r*y+a*S+o*A+l*I,s[4]=r*x+a*C+o*L+l*k,s[8]=r*M+a*T+o*R+l*O,s[12]=r*E+a*P+o*D+l*N,s[1]=c*y+h*S+u*A+d*I,s[5]=c*x+h*C+u*L+d*k,s[9]=c*M+h*T+u*R+d*O,s[13]=c*E+h*P+u*D+d*N,s[2]=p*y+m*S+f*A+v*I,s[6]=p*x+m*C+f*L+v*k,s[10]=p*M+m*T+f*R+v*O,s[14]=p*E+m*P+f*D+v*N,s[3]=g*y+_*S+w*A+b*I,s[7]=g*x+_*C+w*L+b*k,s[11]=g*M+_*T+w*R+b*O,s[15]=g*E+_*P+w*D+b*N,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],i=e[8],s=e[12],r=e[1],a=e[5],o=e[9],l=e[13],c=e[2],h=e[6],u=e[10],d=e[14];return e[3]*(+s*o*h-i*l*h-s*a*u+n*l*u+i*a*d-n*o*d)+e[7]*(+t*o*d-t*l*u+s*r*u-i*r*d+i*l*c-s*o*c)+e[11]*(+t*l*h-t*a*d-s*r*h+n*r*d+s*a*c-n*l*c)+e[15]*(-i*a*c-t*o*h+t*a*u+i*r*h-n*r*u+n*o*c)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],s=e[3],r=e[4],a=e[5],o=e[6],l=e[7],c=e[8],h=e[9],u=e[10],d=e[11],p=e[12],m=e[13],f=e[14],v=e[15],g=h*f*l-m*u*l+m*o*d-a*f*d-h*o*v+a*u*v,_=p*u*l-c*f*l-p*o*d+r*f*d+c*o*v-r*u*v,w=c*m*l-p*h*l+p*a*d-r*m*d-c*a*v+r*h*v,b=p*h*o-c*m*o-p*a*u+r*m*u+c*a*f-r*h*f,y=t*g+n*_+i*w+s*b;if(0===y)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const x=1/y;return e[0]=g*x,e[1]=(m*u*s-h*f*s-m*i*d+n*f*d+h*i*v-n*u*v)*x,e[2]=(a*f*s-m*o*s+m*i*l-n*f*l-a*i*v+n*o*v)*x,e[3]=(h*o*s-a*u*s-h*i*l+n*u*l+a*i*d-n*o*d)*x,e[4]=_*x,e[5]=(c*f*s-p*u*s+p*i*d-t*f*d-c*i*v+t*u*v)*x,e[6]=(p*o*s-r*f*s-p*i*l+t*f*l+r*i*v-t*o*v)*x,e[7]=(r*u*s-c*o*s+c*i*l-t*u*l-r*i*d+t*o*d)*x,e[8]=w*x,e[9]=(p*h*s-c*m*s-p*n*d+t*m*d+c*n*v-t*h*v)*x,e[10]=(r*m*s-p*a*s+p*n*l-t*m*l-r*n*v+t*a*v)*x,e[11]=(c*a*s-r*h*s-c*n*l+t*h*l+r*n*d-t*a*d)*x,e[12]=b*x,e[13]=(c*m*i-p*h*i+p*n*u-t*m*u-c*n*f+t*h*f)*x,e[14]=(p*a*i-r*m*i-p*n*o+t*m*o+r*n*f-t*a*f)*x,e[15]=(r*h*i-c*a*i+c*n*o-t*h*o-r*n*u+t*a*u)*x,this}scale(e){const t=this.elements,n=e.x,i=e.y,s=e.z;return t[0]*=n,t[4]*=i,t[8]*=s,t[1]*=n,t[5]*=i,t[9]*=s,t[2]*=n,t[6]*=i,t[10]*=s,t[3]*=n,t[7]*=i,t[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))}makeTranslation(e,t,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),i=Math.sin(t),s=1-n,r=e.x,a=e.y,o=e.z,l=s*r,c=s*a;return this.set(l*r+n,l*a-i*o,l*o+i*a,0,l*a+i*o,c*a+n,c*o-i*r,0,l*o-i*a,c*o+i*r,s*o*o+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,i,s,r){return this.set(1,n,s,0,e,1,r,0,t,i,1,0,0,0,0,1),this}compose(e,t,n){const i=this.elements,s=t._x,r=t._y,a=t._z,o=t._w,l=s+s,c=r+r,h=a+a,u=s*l,d=s*c,p=s*h,m=r*c,f=r*h,v=a*h,g=o*l,_=o*c,w=o*h,b=n.x,y=n.y,x=n.z;return i[0]=(1-(m+v))*b,i[1]=(d+w)*b,i[2]=(p-_)*b,i[3]=0,i[4]=(d-w)*y,i[5]=(1-(u+v))*y,i[6]=(f+g)*y,i[7]=0,i[8]=(p+_)*x,i[9]=(f-g)*x,i[10]=(1-(u+m))*x,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,n){const i=this.elements;let s=as.set(i[0],i[1],i[2]).length();const r=as.set(i[4],i[5],i[6]).length(),a=as.set(i[8],i[9],i[10]).length();this.determinant()<0&&(s=-s),e.x=i[12],e.y=i[13],e.z=i[14],os.copy(this);const o=1/s,l=1/r,c=1/a;return os.elements[0]*=o,os.elements[1]*=o,os.elements[2]*=o,os.elements[4]*=l,os.elements[5]*=l,os.elements[6]*=l,os.elements[8]*=c,os.elements[9]*=c,os.elements[10]*=c,t.setFromRotationMatrix(os),n.x=s,n.y=r,n.z=a,this}makePerspective(e,t,n,i,s,r,a=kn){const o=this.elements,l=2*s/(t-e),c=2*s/(n-i),h=(t+e)/(t-e),u=(n+i)/(n-i);let d,p;if(a===kn)d=-(r+s)/(r-s),p=-2*r*s/(r-s);else{if(a!==On)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);d=-r/(r-s),p=-r*s/(r-s)}return o[0]=l,o[4]=0,o[8]=h,o[12]=0,o[1]=0,o[5]=c,o[9]=u,o[13]=0,o[2]=0,o[6]=0,o[10]=d,o[14]=p,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(e,t,n,i,s,r,a=kn){const o=this.elements,l=1/(t-e),c=1/(n-i),h=1/(r-s),u=(t+e)*l,d=(n+i)*c;let p,m;if(a===kn)p=(r+s)*h,m=-2*h;else{if(a!==On)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);p=s*h,m=-1*h}return o[0]=2*l,o[4]=0,o[8]=0,o[12]=-u,o[1]=0,o[5]=2*c,o[9]=0,o[13]=-d,o[2]=0,o[6]=0,o[10]=m,o[14]=-p,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let e=0;e<16;e++)if(t[e]!==n[e])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const as=new Ai,os=new rs,ls=new Ai(0,0,0),cs=new Ai(1,1,1),hs=new Ai,us=new Ai,ds=new Ai,ps=new rs,ms=new Pi;class fs{constructor(e=0,t=0,n=0,i=fs.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,i=this._order){return this._x=e,this._y=t,this._z=n,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const i=e.elements,s=i[0],r=i[4],a=i[8],o=i[1],l=i[5],c=i[9],h=i[2],u=i[6],d=i[10];switch(t){case"XYZ":this._y=Math.asin(Hn(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-r,s)):(this._x=Math.atan2(u,l),this._z=0);break;case"YXZ":this._x=Math.asin(-Hn(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(a,d),this._z=Math.atan2(o,l)):(this._y=Math.atan2(-h,s),this._z=0);break;case"ZXY":this._x=Math.asin(Hn(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-h,d),this._z=Math.atan2(-r,l)):(this._y=0,this._z=Math.atan2(o,s));break;case"ZYX":this._y=Math.asin(-Hn(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(u,d),this._z=Math.atan2(o,s)):(this._x=0,this._z=Math.atan2(-r,l));break;case"YZX":this._z=Math.asin(Hn(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-h,s)):(this._x=0,this._y=Math.atan2(a,d));break;case"XZY":this._z=Math.asin(-Hn(r,-1,1)),Math.abs(r)<.9999999?(this._x=Math.atan2(u,l),this._y=Math.atan2(a,s)):(this._x=Math.atan2(-c,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===n&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return ps.makeRotationFromQuaternion(e),this.setFromRotationMatrix(ps,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return ms.setFromEuler(this),this.setFromQuaternion(ms,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}fs.DEFAULT_ORDER="XYZ";class vs{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return 0!=(this.mask&e.mask)}isEnabled(e){return 0!=(this.mask&(1<<e|0))}}let gs=0;const _s=new Ai,ws=new Pi,bs=new rs,ys=new Ai,xs=new Ai,Ms=new Ai,Es=new Pi,Ss=new Ai(1,0,0),Cs=new Ai(0,1,0),Ts=new Ai(0,0,1),Ps={type:"added"},As={type:"removed"};class Ls extends Nn{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:gs++}),this.uuid=zn(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Ls.DEFAULT_UP.clone();const e=new Ai,t=new fs,n=new Pi,i=new Ai(1,1,1);t._onChange((function(){n.setFromEuler(t,!1)})),n._onChange((function(){t.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new rs},normalMatrix:{value:new Jn}}),this.matrix=new rs,this.matrixWorld=new rs,this.matrixAutoUpdate=Ls.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=Ls.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new vs,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return ws.setFromAxisAngle(e,t),this.quaternion.multiply(ws),this}rotateOnWorldAxis(e,t){return ws.setFromAxisAngle(e,t),this.quaternion.premultiply(ws),this}rotateX(e){return this.rotateOnAxis(Ss,e)}rotateY(e){return this.rotateOnAxis(Cs,e)}rotateZ(e){return this.rotateOnAxis(Ts,e)}translateOnAxis(e,t){return _s.copy(e).applyQuaternion(this.quaternion),this.position.add(_s.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(Ss,e)}translateY(e){return this.translateOnAxis(Cs,e)}translateZ(e){return this.translateOnAxis(Ts,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(bs.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?ys.copy(e):ys.set(e,t,n);const i=this.parent;this.updateWorldMatrix(!0,!1),xs.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?bs.lookAt(xs,ys,this.up):bs.lookAt(ys,xs,this.up),this.quaternion.setFromRotationMatrix(bs),i&&(bs.extractRotation(i.matrixWorld),ws.setFromRotationMatrix(bs),this.quaternion.premultiply(ws.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(Ps)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(As)),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(As)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),bs.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),bs.multiply(e.parent.matrixWorld)),e.applyMatrix4(bs),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,i=this.children.length;n<i;n++){const i=this.children[n].getObjectByProperty(e,t);if(void 0!==i)return i}}getObjectsByProperty(e,t){let n=[];this[e]===t&&n.push(this);for(let i=0,s=this.children.length;i<s;i++){const s=this.children[i].getObjectsByProperty(e,t);s.length>0&&(n=n.concat(s))}return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(xs,e,Ms),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(xs,Es,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,i=t.length;n<i;n++){const i=t[n];!0!==i.matrixWorldAutoUpdate&&!0!==e||i.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const n=this.parent;if(!0===e&&null!==n&&!0===n.matrixWorldAutoUpdate&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){const e=this.children;for(let t=0,n=e.length;t<n;t++){const n=e[t];!0===n.matrixWorldAutoUpdate&&n.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=void 0===e||"string"==typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const i={};function s(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(i.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=s(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const n=t.shapes;if(Array.isArray(n))for(let t=0,i=n.length;t<i;t++){const i=n[t];s(e.shapes,i)}else s(e.shapes,n)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(s(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let n=0,i=this.material.length;n<i;n++)t.push(s(e.materials,this.material[n]));i.material=t}else i.material=s(e.materials,this.material);if(this.children.length>0){i.children=[];for(let t=0;t<this.children.length;t++)i.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let t=0;t<this.animations.length;t++){const n=this.animations[t];i.animations.push(s(e.animations,n))}}if(t){const t=r(e.geometries),i=r(e.materials),s=r(e.textures),a=r(e.images),o=r(e.shapes),l=r(e.skeletons),c=r(e.animations),h=r(e.nodes);t.length>0&&(n.geometries=t),i.length>0&&(n.materials=i),s.length>0&&(n.textures=s),a.length>0&&(n.images=a),o.length>0&&(n.shapes=o),l.length>0&&(n.skeletons=l),c.length>0&&(n.animations=c),h.length>0&&(n.nodes=h)}return n.object=i,n;function r(e){const t=[];for(const n in e){const i=e[n];delete i.metadata,t.push(i)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let t=0;t<e.children.length;t++){const n=e.children[t];this.add(n.clone())}return this}}Ls.DEFAULT_UP=new Ai(0,1,0),Ls.DEFAULT_MATRIX_AUTO_UPDATE=!0,Ls.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Rs=new Ai,Ds=new Ai,Is=new Ai,ks=new Ai,Os=new Ai,Ns=new Ai,Us=new Ai,Vs=new Ai,Bs=new Ai,Fs=new Ai;let zs=!1;class Hs{constructor(e=new Ai,t=new Ai,n=new Ai){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,i){i.subVectors(n,t),Rs.subVectors(e,t),i.cross(Rs);const s=i.lengthSq();return s>0?i.multiplyScalar(1/Math.sqrt(s)):i.set(0,0,0)}static getBarycoord(e,t,n,i,s){Rs.subVectors(i,t),Ds.subVectors(n,t),Is.subVectors(e,t);const r=Rs.dot(Rs),a=Rs.dot(Ds),o=Rs.dot(Is),l=Ds.dot(Ds),c=Ds.dot(Is),h=r*l-a*a;if(0===h)return s.set(-2,-1,-1);const u=1/h,d=(l*o-a*c)*u,p=(r*c-a*o)*u;return s.set(1-d-p,p,d)}static containsPoint(e,t,n,i){return this.getBarycoord(e,t,n,i,ks),ks.x>=0&&ks.y>=0&&ks.x+ks.y<=1}static getUV(e,t,n,i,s,r,a,o){return!1===zs&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),zs=!0),this.getInterpolation(e,t,n,i,s,r,a,o)}static getInterpolation(e,t,n,i,s,r,a,o){return this.getBarycoord(e,t,n,i,ks),o.setScalar(0),o.addScaledVector(s,ks.x),o.addScaledVector(r,ks.y),o.addScaledVector(a,ks.z),o}static isFrontFacing(e,t,n,i){return Rs.subVectors(n,t),Ds.subVectors(e,t),Rs.cross(Ds).dot(i)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,t,n,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,i),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Rs.subVectors(this.c,this.b),Ds.subVectors(this.a,this.b),.5*Rs.cross(Ds).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Hs.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Hs.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,n,i,s){return!1===zs&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),zs=!0),Hs.getInterpolation(e,this.a,this.b,this.c,t,n,i,s)}getInterpolation(e,t,n,i,s){return Hs.getInterpolation(e,this.a,this.b,this.c,t,n,i,s)}containsPoint(e){return Hs.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Hs.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,i=this.b,s=this.c;let r,a;Os.subVectors(i,n),Ns.subVectors(s,n),Vs.subVectors(e,n);const o=Os.dot(Vs),l=Ns.dot(Vs);if(o<=0&&l<=0)return t.copy(n);Bs.subVectors(e,i);const c=Os.dot(Bs),h=Ns.dot(Bs);if(c>=0&&h<=c)return t.copy(i);const u=o*h-c*l;if(u<=0&&o>=0&&c<=0)return r=o/(o-c),t.copy(n).addScaledVector(Os,r);Fs.subVectors(e,s);const d=Os.dot(Fs),p=Ns.dot(Fs);if(p>=0&&d<=p)return t.copy(s);const m=d*l-o*p;if(m<=0&&l>=0&&p<=0)return a=l/(l-p),t.copy(n).addScaledVector(Ns,a);const f=c*p-d*h;if(f<=0&&h-c>=0&&d-p>=0)return Us.subVectors(s,i),a=(h-c)/(h-c+(d-p)),t.copy(i).addScaledVector(Us,a);const v=1/(f+m+u);return r=m*v,a=u*v,t.copy(n).addScaledVector(Os,r).addScaledVector(Ns,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let Gs=0;class js extends Nn{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Gs++}),this.uuid=zn(),this.name="",this.type="Material",this.blending=C,this.side=y,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=F,this.blendDst=z,this.blendEquation=R,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=$,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=pn,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Jt,this.stencilZFail=Jt,this.stencilZPass=Jt,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const n=e[t];if(void 0===n){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const i=this[t];void 0!==i?i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[t]=n:console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`)}}toJSON(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const n={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function i(e){const t=[];for(const n in e){const i=e[n];delete i.metadata,t.push(i)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.iridescence&&(n.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),void 0!==this.anisotropy&&(n.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==C&&(n.blending=this.blending),this.side!==y&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaHash&&(n.alphaHash=this.alphaHash),!0===this.alphaToCoverage&&(n.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.forceSinglePass&&(n.forceSinglePass=this.forceSinglePass),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=this.flatShading),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData),t){const t=i(e.textures),s=i(e.images);t.length>0&&(n.textures=t),s.length>0&&(n.images=s)}return n}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(null!==t){const e=t.length;n=new Array(e);for(let i=0;i!==e;++i)n[i]=t[i].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}const Ws={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},qs={h:0,s:0,l:0},Xs={h:0,s:0,l:0};function Ks(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}class Ys{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,n)}set(e,t,n){if(void 0===t&&void 0===n){const t=e;t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t)}else this.setRGB(e,t,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=Kt){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,di.toWorkingColorSpace(this,t),this}setRGB(e,t,n,i=di.workingColorSpace){return this.r=e,this.g=t,this.b=n,di.toWorkingColorSpace(this,i),this}setHSL(e,t,n,i=di.workingColorSpace){if(e=Gn(e,1),t=Hn(t,0,1),n=Hn(n,0,1),0===t)this.r=this.g=this.b=n;else{const i=n<=.5?n*(1+t):n+t-n*t,s=2*n-i;this.r=Ks(s,i,e+1/3),this.g=Ks(s,i,e),this.b=Ks(s,i,e-1/3)}return di.toWorkingColorSpace(this,i),this}setStyle(e,t=Kt){function n(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const r=i[1],a=i[2];switch(r){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,t);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,t);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const n=i[1],s=n.length;if(3===s)return this.setRGB(parseInt(n.charAt(0),16)/15,parseInt(n.charAt(1),16)/15,parseInt(n.charAt(2),16)/15,t);if(6===s)return this.setHex(parseInt(n,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=Kt){const n=Ws[e.toLowerCase()];return void 0!==n?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=ai(e.r),this.g=ai(e.g),this.b=ai(e.b),this}copyLinearToSRGB(e){return this.r=oi(e.r),this.g=oi(e.g),this.b=oi(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Kt){return di.fromWorkingColorSpace($s.copy(this),e),65536*Math.round(Hn(255*$s.r,0,255))+256*Math.round(Hn(255*$s.g,0,255))+Math.round(Hn(255*$s.b,0,255))}getHexString(e=Kt){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=di.workingColorSpace){di.fromWorkingColorSpace($s.copy(this),t);const n=$s.r,i=$s.g,s=$s.b,r=Math.max(n,i,s),a=Math.min(n,i,s);let o,l;const c=(a+r)/2;if(a===r)o=0,l=0;else{const e=r-a;switch(l=c<=.5?e/(r+a):e/(2-r-a),r){case n:o=(i-s)/e+(i<s?6:0);break;case i:o=(s-n)/e+2;break;case s:o=(n-i)/e+4}o/=6}return e.h=o,e.s=l,e.l=c,e}getRGB(e,t=di.workingColorSpace){return di.fromWorkingColorSpace($s.copy(this),t),e.r=$s.r,e.g=$s.g,e.b=$s.b,e}getStyle(e=Kt){di.fromWorkingColorSpace($s.copy(this),e);const t=$s.r,n=$s.g,i=$s.b;return e!==Kt?`color(${e} ${t.toFixed(3)} ${n.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(255*t)},${Math.round(255*n)},${Math.round(255*i)})`}offsetHSL(e,t,n){return this.getHSL(qs),qs.h+=e,qs.s+=t,qs.l+=n,this.setHSL(qs.h,qs.s,qs.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(qs),e.getHSL(Xs);const n=jn(qs.h,Xs.h,t),i=jn(qs.s,Xs.s,t),s=jn(qs.l,Xs.l,t);return this.setHSL(n,i,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,i=this.b,s=e.elements;return this.r=s[0]*t+s[3]*n+s[6]*i,this.g=s[1]*t+s[4]*n+s[7]*i,this.b=s[2]*t+s[5]*n+s[8]*i,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const $s=new Ys;Ys.NAMES=Ws;class Zs extends js{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Ys(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=te,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Js=Qs();function Qs(){const e=new ArrayBuffer(4),t=new Float32Array(e),n=new Uint32Array(e),i=new Uint32Array(512),s=new Uint32Array(512);for(let e=0;e<256;++e){const t=e-127;t<-27?(i[e]=0,i[256|e]=32768,s[e]=24,s[256|e]=24):t<-14?(i[e]=1024>>-t-14,i[256|e]=1024>>-t-14|32768,s[e]=-t-1,s[256|e]=-t-1):t<=15?(i[e]=t+15<<10,i[256|e]=t+15<<10|32768,s[e]=13,s[256|e]=13):t<128?(i[e]=31744,i[256|e]=64512,s[e]=24,s[256|e]=24):(i[e]=31744,i[256|e]=64512,s[e]=13,s[256|e]=13)}const r=new Uint32Array(2048),a=new Uint32Array(64),o=new Uint32Array(64);for(let e=1;e<1024;++e){let t=e<<13,n=0;for(;0==(8388608&t);)t<<=1,n-=8388608;t&=-8388609,n+=947912704,r[e]=t|n}for(let e=1024;e<2048;++e)r[e]=939524096+(e-1024<<13);for(let e=1;e<31;++e)a[e]=e<<23;a[31]=1199570944,a[32]=2147483648;for(let e=33;e<63;++e)a[e]=2147483648+(e-32<<23);a[63]=3347054592;for(let e=1;e<64;++e)32!==e&&(o[e]=1024);return{floatView:t,uint32View:n,baseTable:i,shiftTable:s,mantissaTable:r,exponentTable:a,offsetTable:o}}function er(e){Math.abs(e)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),e=Hn(e,-65504,65504),Js.floatView[0]=e;const t=Js.uint32View[0],n=t>>23&511;return Js.baseTable[n]+((8388607&t)>>Js.shiftTable[n])}function tr(e){const t=e>>10;return Js.uint32View[0]=Js.mantissaTable[Js.offsetTable[t]+(1023&e)]+Js.exponentTable[t],Js.floatView[0]}const nr={toHalfFloat:er,fromHalfFloat:tr},ir=new Ai,sr=new Zn;class rr{constructor(e,t,n=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=n,this.usage=xn,this.updateRange={offset:0,count:-1},this.gpuType=Oe,this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let i=0,s=this.itemSize;i<s;i++)this.array[e+i]=t.array[n+i];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,n=this.count;t<n;t++)sr.fromBufferAttribute(this,t),sr.applyMatrix3(e),this.setXY(t,sr.x,sr.y);else if(3===this.itemSize)for(let t=0,n=this.count;t<n;t++)ir.fromBufferAttribute(this,t),ir.applyMatrix3(e),this.setXYZ(t,ir.x,ir.y,ir.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)ir.fromBufferAttribute(this,t),ir.applyMatrix4(e),this.setXYZ(t,ir.x,ir.y,ir.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)ir.fromBufferAttribute(this,t),ir.applyNormalMatrix(e),this.setXYZ(t,ir.x,ir.y,ir.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)ir.fromBufferAttribute(this,t),ir.transformDirection(e),this.setXYZ(t,ir.x,ir.y,ir.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let n=this.array[e*this.itemSize+t];return this.normalized&&(n=Kn(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=Yn(n,this.array)),this.array[e*this.itemSize+t]=n,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Kn(t,this.array)),t}setX(e,t){return this.normalized&&(t=Yn(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Kn(t,this.array)),t}setY(e,t){return this.normalized&&(t=Yn(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Kn(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Yn(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=Kn(t,this.array)),t}setW(e,t){return this.normalized&&(t=Yn(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=Yn(t,this.array),n=Yn(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,i){return e*=this.itemSize,this.normalized&&(t=Yn(t,this.array),n=Yn(n,this.array),i=Yn(i,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this}setXYZW(e,t,n,i,s){return e*=this.itemSize,this.normalized&&(t=Yn(t,this.array),n=Yn(n,this.array),i=Yn(i,this.array),s=Yn(s,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==xn&&(e.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(e.updateRange=this.updateRange),e}}class ar extends rr{constructor(e,t,n){super(new Int8Array(e),t,n)}}class or extends rr{constructor(e,t,n){super(new Uint8Array(e),t,n)}}class lr extends rr{constructor(e,t,n){super(new Uint8ClampedArray(e),t,n)}}class cr extends rr{constructor(e,t,n){super(new Int16Array(e),t,n)}}class hr extends rr{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class ur extends rr{constructor(e,t,n){super(new Int32Array(e),t,n)}}class dr extends rr{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class pr extends rr{constructor(e,t,n){super(new Uint16Array(e),t,n),this.isFloat16BufferAttribute=!0}getX(e){let t=tr(this.array[e*this.itemSize]);return this.normalized&&(t=Kn(t,this.array)),t}setX(e,t){return this.normalized&&(t=Yn(t,this.array)),this.array[e*this.itemSize]=er(t),this}getY(e){let t=tr(this.array[e*this.itemSize+1]);return this.normalized&&(t=Kn(t,this.array)),t}setY(e,t){return this.normalized&&(t=Yn(t,this.array)),this.array[e*this.itemSize+1]=er(t),this}getZ(e){let t=tr(this.array[e*this.itemSize+2]);return this.normalized&&(t=Kn(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Yn(t,this.array)),this.array[e*this.itemSize+2]=er(t),this}getW(e){let t=tr(this.array[e*this.itemSize+3]);return this.normalized&&(t=Kn(t,this.array)),t}setW(e,t){return this.normalized&&(t=Yn(t,this.array)),this.array[e*this.itemSize+3]=er(t),this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=Yn(t,this.array),n=Yn(n,this.array)),this.array[e+0]=er(t),this.array[e+1]=er(n),this}setXYZ(e,t,n,i){return e*=this.itemSize,this.normalized&&(t=Yn(t,this.array),n=Yn(n,this.array),i=Yn(i,this.array)),this.array[e+0]=er(t),this.array[e+1]=er(n),this.array[e+2]=er(i),this}setXYZW(e,t,n,i,s){return e*=this.itemSize,this.normalized&&(t=Yn(t,this.array),n=Yn(n,this.array),i=Yn(i,this.array),s=Yn(s,this.array)),this.array[e+0]=er(t),this.array[e+1]=er(n),this.array[e+2]=er(i),this.array[e+3]=er(s),this}}class mr extends rr{constructor(e,t,n){super(new Float32Array(e),t,n)}}class fr extends rr{constructor(e,t,n){super(new Float64Array(e),t,n)}}let vr=0;const gr=new rs,_r=new Ls,wr=new Ai,br=new Di,yr=new Di,xr=new Ai;class Mr extends Nn{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:vr++}),this.uuid=zn(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(ei(e)?dr:hr)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const t=(new Jn).getNormalMatrix(e);n.applyNormalMatrix(t),n.needsUpdate=!0}const i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(e),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return gr.makeRotationFromQuaternion(e),this.applyMatrix4(gr),this}rotateX(e){return gr.makeRotationX(e),this.applyMatrix4(gr),this}rotateY(e){return gr.makeRotationY(e),this.applyMatrix4(gr),this}rotateZ(e){return gr.makeRotationZ(e),this.applyMatrix4(gr),this}translate(e,t,n){return gr.makeTranslation(e,t,n),this.applyMatrix4(gr),this}scale(e,t,n){return gr.makeScale(e,t,n),this.applyMatrix4(gr),this}lookAt(e){return _r.lookAt(e),_r.updateMatrix(),this.applyMatrix4(_r.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(wr).negate(),this.translate(wr.x,wr.y,wr.z),this}setFromPoints(e){const t=[];for(let n=0,i=e.length;n<i;n++){const i=e[n];t.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new mr(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Di);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new Ai(-1/0,-1/0,-1/0),new Ai(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const n=t[e];br.setFromBufferAttribute(n),this.morphTargetsRelative?(xr.addVectors(this.boundingBox.min,br.min),this.boundingBox.expandByPoint(xr),xr.addVectors(this.boundingBox.max,br.max),this.boundingBox.expandByPoint(xr)):(this.boundingBox.expandByPoint(br.min),this.boundingBox.expandByPoint(br.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new $i);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new Ai,1/0);if(e){const n=this.boundingSphere.center;if(br.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const n=t[e];yr.setFromBufferAttribute(n),this.morphTargetsRelative?(xr.addVectors(br.min,yr.min),br.expandByPoint(xr),xr.addVectors(br.max,yr.max),br.expandByPoint(xr)):(br.expandByPoint(yr.min),br.expandByPoint(yr.max))}br.getCenter(n);let i=0;for(let t=0,s=e.count;t<s;t++)xr.fromBufferAttribute(e,t),i=Math.max(i,n.distanceToSquared(xr));if(t)for(let s=0,r=t.length;s<r;s++){const r=t[s],a=this.morphTargetsRelative;for(let t=0,s=r.count;t<s;t++)xr.fromBufferAttribute(r,t),a&&(wr.fromBufferAttribute(e,t),xr.add(wr)),i=Math.max(i,n.distanceToSquared(xr))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=e.array,i=t.position.array,s=t.normal.array,r=t.uv.array,a=i.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new rr(new Float32Array(4*a),4));const o=this.getAttribute("tangent").array,l=[],c=[];for(let e=0;e<a;e++)l[e]=new Ai,c[e]=new Ai;const h=new Ai,u=new Ai,d=new Ai,p=new Zn,m=new Zn,f=new Zn,v=new Ai,g=new Ai;function _(e,t,n){h.fromArray(i,3*e),u.fromArray(i,3*t),d.fromArray(i,3*n),p.fromArray(r,2*e),m.fromArray(r,2*t),f.fromArray(r,2*n),u.sub(h),d.sub(h),m.sub(p),f.sub(p);const s=1/(m.x*f.y-f.x*m.y);isFinite(s)&&(v.copy(u).multiplyScalar(f.y).addScaledVector(d,-m.y).multiplyScalar(s),g.copy(d).multiplyScalar(m.x).addScaledVector(u,-f.x).multiplyScalar(s),l[e].add(v),l[t].add(v),l[n].add(v),c[e].add(g),c[t].add(g),c[n].add(g))}let w=this.groups;0===w.length&&(w=[{start:0,count:n.length}]);for(let e=0,t=w.length;e<t;++e){const t=w[e],i=t.start;for(let e=i,s=i+t.count;e<s;e+=3)_(n[e+0],n[e+1],n[e+2])}const b=new Ai,y=new Ai,x=new Ai,M=new Ai;function E(e){x.fromArray(s,3*e),M.copy(x);const t=l[e];b.copy(t),b.sub(x.multiplyScalar(x.dot(t))).normalize(),y.crossVectors(M,t);const n=y.dot(c[e])<0?-1:1;o[4*e]=b.x,o[4*e+1]=b.y,o[4*e+2]=b.z,o[4*e+3]=n}for(let e=0,t=w.length;e<t;++e){const t=w[e],i=t.start;for(let e=i,s=i+t.count;e<s;e+=3)E(n[e+0]),E(n[e+1]),E(n[e+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let n=this.getAttribute("normal");if(void 0===n)n=new rr(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(let e=0,t=n.count;e<t;e++)n.setXYZ(e,0,0,0);const i=new Ai,s=new Ai,r=new Ai,a=new Ai,o=new Ai,l=new Ai,c=new Ai,h=new Ai;if(e)for(let u=0,d=e.count;u<d;u+=3){const d=e.getX(u+0),p=e.getX(u+1),m=e.getX(u+2);i.fromBufferAttribute(t,d),s.fromBufferAttribute(t,p),r.fromBufferAttribute(t,m),c.subVectors(r,s),h.subVectors(i,s),c.cross(h),a.fromBufferAttribute(n,d),o.fromBufferAttribute(n,p),l.fromBufferAttribute(n,m),a.add(c),o.add(c),l.add(c),n.setXYZ(d,a.x,a.y,a.z),n.setXYZ(p,o.x,o.y,o.z),n.setXYZ(m,l.x,l.y,l.z)}else for(let e=0,a=t.count;e<a;e+=3)i.fromBufferAttribute(t,e+0),s.fromBufferAttribute(t,e+1),r.fromBufferAttribute(t,e+2),c.subVectors(r,s),h.subVectors(i,s),c.cross(h),n.setXYZ(e+0,c.x,c.y,c.z),n.setXYZ(e+1,c.x,c.y,c.z),n.setXYZ(e+2,c.x,c.y,c.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)xr.fromBufferAttribute(e,t),xr.normalize(),e.setXYZ(t,xr.x,xr.y,xr.z)}toNonIndexed(){function e(e,t){const n=e.array,i=e.itemSize,s=e.normalized,r=new n.constructor(t.length*i);let a=0,o=0;for(let s=0,l=t.length;s<l;s++){a=e.isInterleavedBufferAttribute?t[s]*e.data.stride+e.offset:t[s]*i;for(let e=0;e<i;e++)r[o++]=n[a++]}return new rr(r,i,s)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new Mr,n=this.index.array,i=this.attributes;for(const s in i){const r=e(i[s],n);t.setAttribute(s,r)}const s=this.morphAttributes;for(const i in s){const r=[],a=s[i];for(let t=0,i=a.length;t<i;t++){const i=e(a[t],n);r.push(i)}t.morphAttributes[i]=r}t.morphTargetsRelative=this.morphTargetsRelative;const r=this.groups;for(let e=0,n=r.length;e<n;e++){const n=r[e];t.addGroup(n.start,n.count,n.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const t in n){const i=n[t];e.data.attributes[t]=i.toJSON(e.data)}const i={};let s=!1;for(const t in this.morphAttributes){const n=this.morphAttributes[t],r=[];for(let t=0,i=n.length;t<i;t++){const i=n[t];r.push(i.toJSON(e.data))}r.length>0&&(i[t]=r,s=!0)}s&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const r=this.groups;r.length>0&&(e.data.groups=JSON.parse(JSON.stringify(r)));const a=this.boundingSphere;return null!==a&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;null!==n&&this.setIndex(n.clone(t));const i=e.attributes;for(const e in i){const n=i[e];this.setAttribute(e,n.clone(t))}const s=e.morphAttributes;for(const e in s){const n=[],i=s[e];for(let e=0,s=i.length;e<s;e++)n.push(i[e].clone(t));this.morphAttributes[e]=n}this.morphTargetsRelative=e.morphTargetsRelative;const r=e.groups;for(let e=0,t=r.length;e<t;e++){const t=r[e];this.addGroup(t.start,t.count,t.materialIndex)}const a=e.boundingBox;null!==a&&(this.boundingBox=a.clone());const o=e.boundingSphere;return null!==o&&(this.boundingSphere=o.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const Er=new rs,Sr=new ss,Cr=new $i,Tr=new Ai,Pr=new Ai,Ar=new Ai,Lr=new Ai,Rr=new Ai,Dr=new Ai,Ir=new Zn,kr=new Zn,Or=new Zn,Nr=new Ai,Ur=new Ai,Vr=new Ai,Br=new Ai,Fr=new Ai;class zr extends Ls{constructor(e=new Mr,t=new Zs){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}getVertexPosition(e,t){const n=this.geometry,i=n.attributes.position,s=n.morphAttributes.position,r=n.morphTargetsRelative;t.fromBufferAttribute(i,e);const a=this.morphTargetInfluences;if(s&&a){Dr.set(0,0,0);for(let n=0,i=s.length;n<i;n++){const i=a[n],o=s[n];0!==i&&(Rr.fromBufferAttribute(o,e),r?Dr.addScaledVector(Rr,i):Dr.addScaledVector(Rr.sub(t),i))}t.add(Dr)}return t}raycast(e,t){const n=this.geometry,i=this.material,s=this.matrixWorld;if(void 0!==i){if(null===n.boundingSphere&&n.computeBoundingSphere(),Cr.copy(n.boundingSphere),Cr.applyMatrix4(s),Sr.copy(e.ray).recast(e.near),!1===Cr.containsPoint(Sr.origin)){if(null===Sr.intersectSphere(Cr,Tr))return;if(Sr.origin.distanceToSquared(Tr)>(e.far-e.near)**2)return}Er.copy(s).invert(),Sr.copy(e.ray).applyMatrix4(Er),null!==n.boundingBox&&!1===Sr.intersectsBox(n.boundingBox)||this._computeIntersections(e,t,Sr)}}_computeIntersections(e,t,n){let i;const s=this.geometry,r=this.material,a=s.index,o=s.attributes.position,l=s.attributes.uv,c=s.attributes.uv1,h=s.attributes.normal,u=s.groups,d=s.drawRange;if(null!==a)if(Array.isArray(r))for(let s=0,o=u.length;s<o;s++){const o=u[s],p=r[o.materialIndex];for(let s=Math.max(o.start,d.start),r=Math.min(a.count,Math.min(o.start+o.count,d.start+d.count));s<r;s+=3){i=Hr(this,p,e,n,l,c,h,a.getX(s),a.getX(s+1),a.getX(s+2)),i&&(i.faceIndex=Math.floor(s/3),i.face.materialIndex=o.materialIndex,t.push(i))}}else{for(let s=Math.max(0,d.start),o=Math.min(a.count,d.start+d.count);s<o;s+=3){i=Hr(this,r,e,n,l,c,h,a.getX(s),a.getX(s+1),a.getX(s+2)),i&&(i.faceIndex=Math.floor(s/3),t.push(i))}}else if(void 0!==o)if(Array.isArray(r))for(let s=0,a=u.length;s<a;s++){const a=u[s],p=r[a.materialIndex];for(let s=Math.max(a.start,d.start),r=Math.min(o.count,Math.min(a.start+a.count,d.start+d.count));s<r;s+=3){i=Hr(this,p,e,n,l,c,h,s,s+1,s+2),i&&(i.faceIndex=Math.floor(s/3),i.face.materialIndex=a.materialIndex,t.push(i))}}else{for(let s=Math.max(0,d.start),a=Math.min(o.count,d.start+d.count);s<a;s+=3){i=Hr(this,r,e,n,l,c,h,s,s+1,s+2),i&&(i.faceIndex=Math.floor(s/3),t.push(i))}}}}function Hr(e,t,n,i,s,r,a,o,l,c){e.getVertexPosition(o,Pr),e.getVertexPosition(l,Ar),e.getVertexPosition(c,Lr);const h=function(e,t,n,i,s,r,a,o){let l;if(l=t.side===x?i.intersectTriangle(a,r,s,!0,o):i.intersectTriangle(s,r,a,t.side===y,o),null===l)return null;Fr.copy(o),Fr.applyMatrix4(e.matrixWorld);const c=n.ray.origin.distanceTo(Fr);return c<n.near||c>n.far?null:{distance:c,point:Fr.clone(),object:e}}(e,t,n,i,Pr,Ar,Lr,Br);if(h){s&&(Ir.fromBufferAttribute(s,o),kr.fromBufferAttribute(s,l),Or.fromBufferAttribute(s,c),h.uv=Hs.getInterpolation(Br,Pr,Ar,Lr,Ir,kr,Or,new Zn)),r&&(Ir.fromBufferAttribute(r,o),kr.fromBufferAttribute(r,l),Or.fromBufferAttribute(r,c),h.uv1=Hs.getInterpolation(Br,Pr,Ar,Lr,Ir,kr,Or,new Zn),h.uv2=h.uv1),a&&(Nr.fromBufferAttribute(a,o),Ur.fromBufferAttribute(a,l),Vr.fromBufferAttribute(a,c),h.normal=Hs.getInterpolation(Br,Pr,Ar,Lr,Nr,Ur,Vr,new Ai),h.normal.dot(i.direction)>0&&h.normal.multiplyScalar(-1));const e={a:o,b:l,c,normal:new Ai,materialIndex:0};Hs.getNormal(Pr,Ar,Lr,e.normal),h.face=e}return h}class Gr extends Mr{constructor(e=1,t=1,n=1,i=1,s=1,r=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:i,heightSegments:s,depthSegments:r};const a=this;i=Math.floor(i),s=Math.floor(s),r=Math.floor(r);const o=[],l=[],c=[],h=[];let u=0,d=0;function p(e,t,n,i,s,r,p,m,f,v,g){const _=r/f,w=p/v,b=r/2,y=p/2,x=m/2,M=f+1,E=v+1;let S=0,C=0;const T=new Ai;for(let r=0;r<E;r++){const a=r*w-y;for(let o=0;o<M;o++){const u=o*_-b;T[e]=u*i,T[t]=a*s,T[n]=x,l.push(T.x,T.y,T.z),T[e]=0,T[t]=0,T[n]=m>0?1:-1,c.push(T.x,T.y,T.z),h.push(o/f),h.push(1-r/v),S+=1}}for(let e=0;e<v;e++)for(let t=0;t<f;t++){const n=u+t+M*e,i=u+t+M*(e+1),s=u+(t+1)+M*(e+1),r=u+(t+1)+M*e;o.push(n,i,r),o.push(i,s,r),C+=6}a.addGroup(d,C,g),d+=C,u+=S}p("z","y","x",-1,-1,n,t,e,r,s,0),p("z","y","x",1,-1,n,t,-e,r,s,1),p("x","z","y",1,1,e,n,t,i,r,2),p("x","z","y",1,-1,e,n,-t,i,r,3),p("x","y","z",1,-1,e,t,n,i,s,4),p("x","y","z",-1,-1,e,t,-n,i,s,5),this.setIndex(o),this.setAttribute("position",new mr(l,3)),this.setAttribute("normal",new mr(c,3)),this.setAttribute("uv",new mr(h,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Gr(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function jr(e){const t={};for(const n in e){t[n]={};for(const i in e[n]){const s=e[n][i];s&&(s.isColor||s.isMatrix3||s.isMatrix4||s.isVector2||s.isVector3||s.isVector4||s.isTexture||s.isQuaternion)?s.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),t[n][i]=null):t[n][i]=s.clone():Array.isArray(s)?t[n][i]=s.slice():t[n][i]=s}}return t}function Wr(e){const t={};for(let n=0;n<e.length;n++){const i=jr(e[n]);for(const e in i)t[e]=i[e]}return t}function qr(e){return null===e.getRenderTarget()?e.outputColorSpace:Yt}const Xr={clone:jr,merge:Wr};class Kr extends js{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=jr(e.uniforms),this.uniformsGroups=function(e){const t=[];for(let n=0;n<e.length;n++)t.push(e[n].clone());return t}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const n in this.uniforms){const i=this.uniforms[n].value;i&&i.isTexture?t.uniforms[n]={type:"t",value:i.toJSON(e).uuid}:i&&i.isColor?t.uniforms[n]={type:"c",value:i.getHex()}:i&&i.isVector2?t.uniforms[n]={type:"v2",value:i.toArray()}:i&&i.isVector3?t.uniforms[n]={type:"v3",value:i.toArray()}:i&&i.isVector4?t.uniforms[n]={type:"v4",value:i.toArray()}:i&&i.isMatrix3?t.uniforms[n]={type:"m3",value:i.toArray()}:i&&i.isMatrix4?t.uniforms[n]={type:"m4",value:i.toArray()}:t.uniforms[n]={value:i}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const n={};for(const e in this.extensions)!0===this.extensions[e]&&(n[e]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}class Yr extends Ls{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new rs,this.projectionMatrix=new rs,this.projectionMatrixInverse=new rs,this.coordinateSystem=kn}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}class $r extends Yr{constructor(e=50,t=1,n=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*Fn*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*Bn*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*Fn*Math.atan(Math.tan(.5*Bn*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,n,i,s,r){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=s,this.view.height=r,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*Bn*this.fov)/this.zoom,n=2*t,i=this.aspect*n,s=-.5*i;const r=this.view;if(null!==this.view&&this.view.enabled){const e=r.fullWidth,a=r.fullHeight;s+=r.offsetX*i/e,t-=r.offsetY*n/a,i*=r.width/e,n*=r.height/a}const a=this.filmOffset;0!==a&&(s+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+i,t,t-n,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const Zr=-90;class Jr extends Ls{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null;const i=new $r(Zr,1,e,t);i.layers=this.layers,this.add(i);const s=new $r(Zr,1,e,t);s.layers=this.layers,this.add(s);const r=new $r(Zr,1,e,t);r.layers=this.layers,this.add(r);const a=new $r(Zr,1,e,t);a.layers=this.layers,this.add(a);const o=new $r(Zr,1,e,t);o.layers=this.layers,this.add(o);const l=new $r(Zr,1,e,t);l.layers=this.layers,this.add(l)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[n,i,s,r,a,o]=t;for(const e of t)this.remove(e);if(e===kn)n.up.set(0,1,0),n.lookAt(1,0,0),i.up.set(0,1,0),i.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),r.up.set(0,0,1),r.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),o.up.set(0,1,0),o.lookAt(0,0,-1);else{if(e!==On)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);n.up.set(0,-1,0),n.lookAt(-1,0,0),i.up.set(0,-1,0),i.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),r.up.set(0,0,-1),r.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),o.up.set(0,-1,0),o.lookAt(0,0,-1)}for(const e of t)this.add(e),e.updateMatrixWorld()}update(e,t){null===this.parent&&this.updateMatrixWorld();const n=this.renderTarget;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[i,s,r,a,o,l]=this.children,c=e.getRenderTarget(),h=e.xr.enabled;e.xr.enabled=!1;const u=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,i),e.setRenderTarget(n,1),e.render(t,s),e.setRenderTarget(n,2),e.render(t,r),e.setRenderTarget(n,3),e.render(t,a),e.setRenderTarget(n,4),e.render(t,o),n.texture.generateMipmaps=u,e.setRenderTarget(n,5),e.render(t,l),e.setRenderTarget(c),e.xr.enabled=h,n.texture.needsPMREMUpdate=!0}}class Qr extends wi{constructor(e,t,n,i,s,r,a,o,l,c){super(e=void 0!==e?e:[],t=void 0!==t?t:ue,n,i,s,r,a,o,l,c),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class ea extends xi{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},i=[n,n,n,n,n,n];void 0!==t.encoding&&(ri("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),t.colorSpace=t.encoding===Ht?Kt:Xt),this.texture=new Qr(i,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:Ee}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"},i=new Gr(5,5,5),s=new Kr({name:"CubemapFromEquirect",uniforms:jr(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:x,blending:S});s.uniforms.tEquirect.value=t;const r=new zr(i,s),a=t.minFilter;t.minFilter===Te&&(t.minFilter=Ee);return new Jr(1,10,this).update(e,r),t.minFilter=a,r.geometry.dispose(),r.material.dispose(),this}clear(e,t,n,i){const s=e.getRenderTarget();for(let s=0;s<6;s++)e.setRenderTarget(this,s),e.clear(t,n,i);e.setRenderTarget(s)}}const ta=new Ai,na=new Ai,ia=new Jn;class sa{constructor(e=new Ai(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const i=ta.subVectors(n,t).cross(na.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const n=e.delta(ta),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/i;return s<0||s>1?null:t.copy(e.start).addScaledVector(n,s)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||ia.getNormalMatrix(e),i=this.coplanarPoint(ta).applyMatrix4(e),s=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const ra=new $i,aa=new Ai;class oa{constructor(e=new sa,t=new sa,n=new sa,i=new sa,s=new sa,r=new sa){this.planes=[e,t,n,i,s,r]}set(e,t,n,i,s,r){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(n),a[3].copy(i),a[4].copy(s),a[5].copy(r),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e,t=kn){const n=this.planes,i=e.elements,s=i[0],r=i[1],a=i[2],o=i[3],l=i[4],c=i[5],h=i[6],u=i[7],d=i[8],p=i[9],m=i[10],f=i[11],v=i[12],g=i[13],_=i[14],w=i[15];if(n[0].setComponents(o-s,u-l,f-d,w-v).normalize(),n[1].setComponents(o+s,u+l,f+d,w+v).normalize(),n[2].setComponents(o+r,u+c,f+p,w+g).normalize(),n[3].setComponents(o-r,u-c,f-p,w-g).normalize(),n[4].setComponents(o-a,u-h,f-m,w-_).normalize(),t===kn)n[5].setComponents(o+a,u+h,f+m,w+_).normalize();else{if(t!==On)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);n[5].setComponents(a,h,m,_).normalize()}return this}intersectsObject(e){if(void 0!==e.boundingSphere)null===e.boundingSphere&&e.computeBoundingSphere(),ra.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;null===t.boundingSphere&&t.computeBoundingSphere(),ra.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(ra)}intersectsSprite(e){return ra.center.set(0,0,0),ra.radius=.7071067811865476,ra.applyMatrix4(e.matrixWorld),this.intersectsSphere(ra)}intersectsSphere(e){const t=this.planes,n=e.center,i=-e.radius;for(let e=0;e<6;e++){if(t[e].distanceToPoint(n)<i)return!1}return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const i=t[n];if(aa.x=i.normal.x>0?e.max.x:e.min.x,aa.y=i.normal.y>0?e.max.y:e.min.y,aa.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(aa)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function la(){let e=null,t=!1,n=null,i=null;function s(t,r){n(t,r),i=e.requestAnimationFrame(s)}return{start:function(){!0!==t&&null!==n&&(i=e.requestAnimationFrame(s),t=!0)},stop:function(){e.cancelAnimationFrame(i),t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function ca(e,t){const n=t.isWebGL2,i=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),i.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);const n=i.get(t);n&&(e.deleteBuffer(n.buffer),i.delete(t))},update:function(t,s){if(t.isGLBufferAttribute){const e=i.get(t);return void((!e||e.version<t.version)&&i.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version}))}t.isInterleavedBufferAttribute&&(t=t.data);const r=i.get(t);void 0===r?i.set(t,function(t,i){const s=t.array,r=t.usage,a=e.createBuffer();let o;if(e.bindBuffer(i,a),e.bufferData(i,s,r),t.onUploadCallback(),s instanceof Float32Array)o=e.FLOAT;else if(s instanceof Uint16Array)if(t.isFloat16BufferAttribute){if(!n)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");o=e.HALF_FLOAT}else o=e.UNSIGNED_SHORT;else if(s instanceof Int16Array)o=e.SHORT;else if(s instanceof Uint32Array)o=e.UNSIGNED_INT;else if(s instanceof Int32Array)o=e.INT;else if(s instanceof Int8Array)o=e.BYTE;else if(s instanceof Uint8Array)o=e.UNSIGNED_BYTE;else{if(!(s instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+s);o=e.UNSIGNED_BYTE}return{buffer:a,type:o,bytesPerElement:s.BYTES_PER_ELEMENT,version:t.version}}(t,s)):r.version<t.version&&(!function(t,i,s){const r=i.array,a=i.updateRange;e.bindBuffer(s,t),-1===a.count?e.bufferSubData(s,0,r):(n?e.bufferSubData(s,a.offset*r.BYTES_PER_ELEMENT,r,a.offset,a.count):e.bufferSubData(s,a.offset*r.BYTES_PER_ELEMENT,r.subarray(a.offset,a.offset+a.count)),a.count=-1),i.onUploadCallback()}(r.buffer,t,s),r.version=t.version)}}}class ha extends Mr{constructor(e=1,t=1,n=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i};const s=e/2,r=t/2,a=Math.floor(n),o=Math.floor(i),l=a+1,c=o+1,h=e/a,u=t/o,d=[],p=[],m=[],f=[];for(let e=0;e<c;e++){const t=e*u-r;for(let n=0;n<l;n++){const i=n*h-s;p.push(i,-t,0),m.push(0,0,1),f.push(n/a),f.push(1-e/o)}}for(let e=0;e<o;e++)for(let t=0;t<a;t++){const n=t+l*e,i=t+l*(e+1),s=t+1+l*(e+1),r=t+1+l*e;d.push(n,i,r),d.push(i,s,r)}this.setIndex(d),this.setAttribute("position",new mr(p,3)),this.setAttribute("normal",new mr(m,3)),this.setAttribute("uv",new mr(f,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new ha(e.width,e.height,e.widthSegments,e.heightSegments)}}const ua={alphahash_fragment:"#ifdef USE_ALPHAHASH\n\tif ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n#endif",alphahash_pars_fragment:"#ifdef USE_ALPHAHASH\n\tconst float ALPHA_HASH_SCALE = 0.05;\n\tfloat hash2D( vec2 value ) {\n\t\treturn fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n\t}\n\tfloat hash3D( vec3 value ) {\n\t\treturn hash2D( vec2( hash2D( value.xy ), value.z ) );\n\t}\n\tfloat getAlphaHashThreshold( vec3 position ) {\n\t\tfloat maxDeriv = max(\n\t\t\tlength( dFdx( position.xyz ) ),\n\t\t\tlength( dFdy( position.xyz ) )\n\t\t);\n\t\tfloat pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n\t\tvec2 pixScales = vec2(\n\t\t\texp2( floor( log2( pixScale ) ) ),\n\t\t\texp2( ceil( log2( pixScale ) ) )\n\t\t);\n\t\tvec2 alpha = vec2(\n\t\t\thash3D( floor( pixScales.x * position.xyz ) ),\n\t\t\thash3D( floor( pixScales.y * position.xyz ) )\n\t\t);\n\t\tfloat lerpFactor = fract( log2( pixScale ) );\n\t\tfloat x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n\t\tfloat a = min( lerpFactor, 1.0 - lerpFactor );\n\t\tvec3 cases = vec3(\n\t\t\tx * x / ( 2.0 * a * ( 1.0 - a ) ),\n\t\t\t( x - 0.5 * a ) / ( 1.0 - a ),\n\t\t\t1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n\t\t);\n\t\tfloat threshold = ( x < ( 1.0 - a ) )\n\t\t\t? ( ( x < a ) ? cases.x : cases.y )\n\t\t\t: cases.z;\n\t\treturn clamp( threshold , 1.0e-6, 1.0 );\n\t}\n#endif",alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n\tvPosition = vec3( position );\n#endif",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\treturn vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = dFdx( surf_pos.xyz );\n\t\tvec3 vSigmaY = dFdy( surf_pos.xyz );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\n#ifdef USE_ALPHAHASH\n\tvarying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n\tconst vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n\treturn dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_v0 0.339\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_v1 0.276\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_v4 0.046\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_v5 0.016\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_v6 0.0038\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment:"vec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#ifdef USE_ENVMAP\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\t#ifdef USE_ANISOTROPY\n\t\tvec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n\t\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\t\tvec3 bentNormal = cross( bitangent, viewDir );\n\t\t\t\tbentNormal = normalize( cross( bentNormal, bitangent ) );\n\t\t\t\tbentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n\t\t\t\treturn getIBLRadiance( viewDir, bentNormal, roughness );\n\t\t\t#else\n\t\t\t\treturn vec3( 0.0 );\n\t\t\t#endif\n\t\t}\n\t#endif\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( LEGACY_LIGHTS )\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#else\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\t#ifdef USE_ANISOTROPYMAP\n\t\tmat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n\t\tvec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n\t\tvec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n\t#else\n\t\tvec2 anisotropyV = anisotropyVector;\n\t#endif\n\tmaterial.anisotropy = length( anisotropyV );\n\tanisotropyV /= material.anisotropy;\n\tmaterial.anisotropy = saturate( material.anisotropy );\n\tmaterial.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n\tmaterial.anisotropyT = tbn[ 0 ] * anisotropyV.x - tbn[ 1 ] * anisotropyV.y;\n\tmaterial.anisotropyB = tbn[ 1 ] * anisotropyV.x + tbn[ 0 ] * anisotropyV.y;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat anisotropy;\n\t\tfloat alphaT;\n\t\tvec3 anisotropyT;\n\t\tvec3 anisotropyB;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n\tfloat V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n\t\tfloat gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n\t\tfloat gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n\t\tfloat v = 0.5 / ( gv + gl );\n\t\treturn saturate(v);\n\t}\n\tfloat D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n\t\tfloat a2 = alphaT * alphaB;\n\t\thighp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n\t\thighp float v2 = dot( v, v );\n\t\tfloat w2 = a2 / v2;\n\t\treturn RECIPROCAL_PI * a2 * pow2 ( w2 );\n\t}\n#endif\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat dotTL = dot( material.anisotropyT, lightDir );\n\t\tfloat dotTV = dot( material.anisotropyT, viewDir );\n\t\tfloat dotTH = dot( material.anisotropyT, halfDir );\n\t\tfloat dotBL = dot( material.anisotropyB, lightDir );\n\t\tfloat dotBV = dot( material.anisotropyB, viewDir );\n\t\tfloat dotBH = dot( material.anisotropyB, halfDir );\n\t\tfloat V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n\t\tfloat D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n\t#else\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t#endif\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometry.viewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\t#ifdef USE_ANISOTROPY\n\t\tradiance += getIBLAnisotropyRadiance( geometry.viewDir, geometry.normal, material.roughness, material.anisotropyB, material.anisotropy );\n\t#else\n\t\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, vMapUv );\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv = vUv;\n\t#else\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *= faceDirection;\n\t#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal,\n\t\t#if defined( USE_NORMALMAP )\n\t\t\tvNormalMapUv\n\t\t#elif defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tvClearcoatNormalMapUv\n\t\t#else\n\t\t\tvUv\n\t\t#endif\n\t\t);\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\tnormal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",opaque_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec2 packDepthToRG( in highp float v ) {\n\treturn packDepthToRGBA( v ).yx;\n}\nfloat unpackRGToDepth( const in highp vec2 v ) {\n\treturn unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tuniform int boneTextureSize;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tfloat j = i * 4.0;\n\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\ty = dy * ( y + 0.5 );\n\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\treturn bone;\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmitted = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn vec3( 1.0 );\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 attenuatedColor = transmittance * transmittedLight.rgb;\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\tfloat transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n\t}\n#endif",uv_pars_fragment:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}"},da={common:{diffuse:{value:new Ys(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Jn},alphaMap:{value:null},alphaMapTransform:{value:new Jn},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Jn}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Jn}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Jn}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Jn},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Jn},normalScale:{value:new Zn(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Jn},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Jn}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Jn}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Jn}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Ys(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Ys(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Jn},alphaTest:{value:0},uvTransform:{value:new Jn}},sprite:{diffuse:{value:new Ys(16777215)},opacity:{value:1},center:{value:new Zn(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Jn},alphaMap:{value:null},alphaMapTransform:{value:new Jn},alphaTest:{value:0}}},pa={basic:{uniforms:Wr([da.common,da.specularmap,da.envmap,da.aomap,da.lightmap,da.fog]),vertexShader:ua.meshbasic_vert,fragmentShader:ua.meshbasic_frag},lambert:{uniforms:Wr([da.common,da.specularmap,da.envmap,da.aomap,da.lightmap,da.emissivemap,da.bumpmap,da.normalmap,da.displacementmap,da.fog,da.lights,{emissive:{value:new Ys(0)}}]),vertexShader:ua.meshlambert_vert,fragmentShader:ua.meshlambert_frag},phong:{uniforms:Wr([da.common,da.specularmap,da.envmap,da.aomap,da.lightmap,da.emissivemap,da.bumpmap,da.normalmap,da.displacementmap,da.fog,da.lights,{emissive:{value:new Ys(0)},specular:{value:new Ys(1118481)},shininess:{value:30}}]),vertexShader:ua.meshphong_vert,fragmentShader:ua.meshphong_frag},standard:{uniforms:Wr([da.common,da.envmap,da.aomap,da.lightmap,da.emissivemap,da.bumpmap,da.normalmap,da.displacementmap,da.roughnessmap,da.metalnessmap,da.fog,da.lights,{emissive:{value:new Ys(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ua.meshphysical_vert,fragmentShader:ua.meshphysical_frag},toon:{uniforms:Wr([da.common,da.aomap,da.lightmap,da.emissivemap,da.bumpmap,da.normalmap,da.displacementmap,da.gradientmap,da.fog,da.lights,{emissive:{value:new Ys(0)}}]),vertexShader:ua.meshtoon_vert,fragmentShader:ua.meshtoon_frag},matcap:{uniforms:Wr([da.common,da.bumpmap,da.normalmap,da.displacementmap,da.fog,{matcap:{value:null}}]),vertexShader:ua.meshmatcap_vert,fragmentShader:ua.meshmatcap_frag},points:{uniforms:Wr([da.points,da.fog]),vertexShader:ua.points_vert,fragmentShader:ua.points_frag},dashed:{uniforms:Wr([da.common,da.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ua.linedashed_vert,fragmentShader:ua.linedashed_frag},depth:{uniforms:Wr([da.common,da.displacementmap]),vertexShader:ua.depth_vert,fragmentShader:ua.depth_frag},normal:{uniforms:Wr([da.common,da.bumpmap,da.normalmap,da.displacementmap,{opacity:{value:1}}]),vertexShader:ua.meshnormal_vert,fragmentShader:ua.meshnormal_frag},sprite:{uniforms:Wr([da.sprite,da.fog]),vertexShader:ua.sprite_vert,fragmentShader:ua.sprite_frag},background:{uniforms:{uvTransform:{value:new Jn},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:ua.background_vert,fragmentShader:ua.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:ua.backgroundCube_vert,fragmentShader:ua.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:ua.cube_vert,fragmentShader:ua.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ua.equirect_vert,fragmentShader:ua.equirect_frag},distanceRGBA:{uniforms:Wr([da.common,da.displacementmap,{referencePosition:{value:new Ai},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ua.distanceRGBA_vert,fragmentShader:ua.distanceRGBA_frag},shadow:{uniforms:Wr([da.lights,da.fog,{color:{value:new Ys(0)},opacity:{value:1}}]),vertexShader:ua.shadow_vert,fragmentShader:ua.shadow_frag}};pa.physical={uniforms:Wr([pa.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Jn},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Jn},clearcoatNormalScale:{value:new Zn(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Jn},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Jn},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Jn},sheen:{value:0},sheenColor:{value:new Ys(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Jn},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Jn},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Jn},transmissionSamplerSize:{value:new Zn},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Jn},attenuationDistance:{value:0},attenuationColor:{value:new Ys(0)},specularColor:{value:new Ys(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Jn},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Jn},anisotropyVector:{value:new Zn},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Jn}}]),vertexShader:ua.meshphysical_vert,fragmentShader:ua.meshphysical_frag};const ma={r:0,b:0,g:0};function fa(e,t,n,i,s,r,a){const o=new Ys(0);let l,c,h=!0===r?0:1,u=null,d=0,p=null;function m(t,n){t.getRGB(ma,qr(e)),i.buffers.color.setClear(ma.r,ma.g,ma.b,n,a)}return{getClearColor:function(){return o},setClearColor:function(e,t=1){o.set(e),h=t,m(o,h)},getClearAlpha:function(){return h},setClearAlpha:function(e){h=e,m(o,h)},render:function(r,f){let v=!1,g=!0===f.isScene?f.background:null;if(g&&g.isTexture){g=(f.backgroundBlurriness>0?n:t).get(g)}switch(null===g?m(o,h):g&&g.isColor&&(m(g,1),v=!0),e.xr.getEnvironmentBlendMode()){case"opaque":v=!0;break;case"additive":i.buffers.color.setClear(0,0,0,1,a),v=!0;break;case"alpha-blend":i.buffers.color.setClear(0,0,0,0,a),v=!0}(e.autoClear||v)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),g&&(g.isCubeTexture||g.mapping===fe)?(void 0===c&&(c=new zr(new Gr(1,1,1),new Kr({name:"BackgroundCubeMaterial",uniforms:jr(pa.backgroundCube.uniforms),vertexShader:pa.backgroundCube.vertexShader,fragmentShader:pa.backgroundCube.fragmentShader,side:x,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),s.update(c)),c.material.uniforms.envMap.value=g,c.material.uniforms.flipEnvMap.value=g.isCubeTexture&&!1===g.isRenderTargetTexture?-1:1,c.material.uniforms.backgroundBlurriness.value=f.backgroundBlurriness,c.material.uniforms.backgroundIntensity.value=f.backgroundIntensity,c.material.toneMapped=g.colorSpace!==Kt,u===g&&d===g.version&&p===e.toneMapping||(c.material.needsUpdate=!0,u=g,d=g.version,p=e.toneMapping),c.layers.enableAll(),r.unshift(c,c.geometry,c.material,0,0,null)):g&&g.isTexture&&(void 0===l&&(l=new zr(new ha(2,2),new Kr({name:"BackgroundMaterial",uniforms:jr(pa.background.uniforms),vertexShader:pa.background.vertexShader,fragmentShader:pa.background.fragmentShader,side:y,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),s.update(l)),l.material.uniforms.t2D.value=g,l.material.uniforms.backgroundIntensity.value=f.backgroundIntensity,l.material.toneMapped=g.colorSpace!==Kt,!0===g.matrixAutoUpdate&&g.updateMatrix(),l.material.uniforms.uvTransform.value.copy(g.matrix),u===g&&d===g.version&&p===e.toneMapping||(l.material.needsUpdate=!0,u=g,d=g.version,p=e.toneMapping),l.layers.enableAll(),r.unshift(l,l.geometry,l.material,0,0,null))}}}function va(e,t,n,i){const s=e.getParameter(e.MAX_VERTEX_ATTRIBS),r=i.isWebGL2?null:t.get("OES_vertex_array_object"),a=i.isWebGL2||null!==r,o={},l=p(null);let c=l,h=!1;function u(t){return i.isWebGL2?e.bindVertexArray(t):r.bindVertexArrayOES(t)}function d(t){return i.isWebGL2?e.deleteVertexArray(t):r.deleteVertexArrayOES(t)}function p(e){const t=[],n=[],i=[];for(let e=0;e<s;e++)t[e]=0,n[e]=0,i[e]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:n,attributeDivisors:i,object:e,attributes:{},index:null}}function m(){const e=c.newAttributes;for(let t=0,n=e.length;t<n;t++)e[t]=0}function f(e){v(e,0)}function v(n,s){const r=c.newAttributes,a=c.enabledAttributes,o=c.attributeDivisors;if(r[n]=1,0===a[n]&&(e.enableVertexAttribArray(n),a[n]=1),o[n]!==s){(i.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,s),o[n]=s}}function g(){const t=c.newAttributes,n=c.enabledAttributes;for(let i=0,s=n.length;i<s;i++)n[i]!==t[i]&&(e.disableVertexAttribArray(i),n[i]=0)}function _(t,n,i,s,r,a,o){!0===o?e.vertexAttribIPointer(t,n,i,r,a):e.vertexAttribPointer(t,n,i,s,r,a)}function w(){b(),h=!0,c!==l&&(c=l,u(c.object))}function b(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(s,l,d,w,b){let y=!1;if(a){const t=function(t,n,s){const a=!0===s.wireframe;let l=o[t.id];void 0===l&&(l={},o[t.id]=l);let c=l[n.id];void 0===c&&(c={},l[n.id]=c);let h=c[a];void 0===h&&(h=p(i.isWebGL2?e.createVertexArray():r.createVertexArrayOES()),c[a]=h);return h}(w,d,l);c!==t&&(c=t,u(c.object)),y=function(e,t,n,i){const s=c.attributes,r=t.attributes;let a=0;const o=n.getAttributes();for(const t in o){if(o[t].location>=0){const n=s[t];let i=r[t];if(void 0===i&&("instanceMatrix"===t&&e.instanceMatrix&&(i=e.instanceMatrix),"instanceColor"===t&&e.instanceColor&&(i=e.instanceColor)),void 0===n)return!0;if(n.attribute!==i)return!0;if(i&&n.data!==i.data)return!0;a++}}return c.attributesNum!==a||c.index!==i}(s,w,d,b),y&&function(e,t,n,i){const s={},r=t.attributes;let a=0;const o=n.getAttributes();for(const t in o){if(o[t].location>=0){let n=r[t];void 0===n&&("instanceMatrix"===t&&e.instanceMatrix&&(n=e.instanceMatrix),"instanceColor"===t&&e.instanceColor&&(n=e.instanceColor));const i={};i.attribute=n,n&&n.data&&(i.data=n.data),s[t]=i,a++}}c.attributes=s,c.attributesNum=a,c.index=i}(s,w,d,b)}else{const e=!0===l.wireframe;c.geometry===w.id&&c.program===d.id&&c.wireframe===e||(c.geometry=w.id,c.program=d.id,c.wireframe=e,y=!0)}null!==b&&n.update(b,e.ELEMENT_ARRAY_BUFFER),(y||h)&&(h=!1,function(s,r,a,o){if(!1===i.isWebGL2&&(s.isInstancedMesh||o.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;m();const l=o.attributes,c=a.getAttributes(),h=r.defaultAttributeValues;for(const t in c){const r=c[t];if(r.location>=0){let a=l[t];if(void 0===a&&("instanceMatrix"===t&&s.instanceMatrix&&(a=s.instanceMatrix),"instanceColor"===t&&s.instanceColor&&(a=s.instanceColor)),void 0!==a){const t=a.normalized,l=a.itemSize,c=n.get(a);if(void 0===c)continue;const h=c.buffer,u=c.type,d=c.bytesPerElement,p=!0===i.isWebGL2&&(u===e.INT||u===e.UNSIGNED_INT||a.gpuType===Ie);if(a.isInterleavedBufferAttribute){const n=a.data,i=n.stride,c=a.offset;if(n.isInstancedInterleavedBuffer){for(let e=0;e<r.locationSize;e++)v(r.location+e,n.meshPerAttribute);!0!==s.isInstancedMesh&&void 0===o._maxInstanceCount&&(o._maxInstanceCount=n.meshPerAttribute*n.count)}else for(let e=0;e<r.locationSize;e++)f(r.location+e);e.bindBuffer(e.ARRAY_BUFFER,h);for(let e=0;e<r.locationSize;e++)_(r.location+e,l/r.locationSize,u,t,i*d,(c+l/r.locationSize*e)*d,p)}else{if(a.isInstancedBufferAttribute){for(let e=0;e<r.locationSize;e++)v(r.location+e,a.meshPerAttribute);!0!==s.isInstancedMesh&&void 0===o._maxInstanceCount&&(o._maxInstanceCount=a.meshPerAttribute*a.count)}else for(let e=0;e<r.locationSize;e++)f(r.location+e);e.bindBuffer(e.ARRAY_BUFFER,h);for(let e=0;e<r.locationSize;e++)_(r.location+e,l/r.locationSize,u,t,l*d,l/r.locationSize*e*d,p)}}else if(void 0!==h){const n=h[t];if(void 0!==n)switch(n.length){case 2:e.vertexAttrib2fv(r.location,n);break;case 3:e.vertexAttrib3fv(r.location,n);break;case 4:e.vertexAttrib4fv(r.location,n);break;default:e.vertexAttrib1fv(r.location,n)}}}}g()}(s,l,d,w),null!==b&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n.get(b).buffer))},reset:w,resetDefaultState:b,dispose:function(){w();for(const e in o){const t=o[e];for(const e in t){const n=t[e];for(const e in n)d(n[e].object),delete n[e];delete t[e]}delete o[e]}},releaseStatesOfGeometry:function(e){if(void 0===o[e.id])return;const t=o[e.id];for(const e in t){const n=t[e];for(const e in n)d(n[e].object),delete n[e];delete t[e]}delete o[e.id]},releaseStatesOfProgram:function(e){for(const t in o){const n=o[t];if(void 0===n[e.id])continue;const i=n[e.id];for(const e in i)d(i[e].object),delete i[e];delete n[e.id]}},initAttributes:m,enableAttribute:f,disableUnusedAttributes:g}}function ga(e,t,n,i){const s=i.isWebGL2;let r;this.setMode=function(e){r=e},this.render=function(t,i){e.drawArrays(r,t,i),n.update(i,r,1)},this.renderInstances=function(i,a,o){if(0===o)return;let l,c;if(s)l=e,c="drawArraysInstanced";else if(l=t.get("ANGLE_instanced_arrays"),c="drawArraysInstancedANGLE",null===l)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[c](r,i,a,o),n.update(a,r,o)}}function _a(e,t,n){let i;function s(t){if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const r="undefined"!=typeof WebGL2RenderingContext&&"WebGL2RenderingContext"===e.constructor.name;let a=void 0!==n.precision?n.precision:"highp";const o=s(a);o!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",o,"instead."),a=o);const l=r||t.has("WEBGL_draw_buffers"),c=!0===n.logarithmicDepthBuffer,h=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),u=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),d=e.getParameter(e.MAX_TEXTURE_SIZE),p=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),m=e.getParameter(e.MAX_VERTEX_ATTRIBS),f=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),v=e.getParameter(e.MAX_VARYING_VECTORS),g=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),_=u>0,w=r||t.has("OES_texture_float");return{isWebGL2:r,drawBuffers:l,getMaxAnisotropy:function(){if(void 0!==i)return i;if(!0===t.has("EXT_texture_filter_anisotropic")){const n=t.get("EXT_texture_filter_anisotropic");i=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i},getMaxPrecision:s,precision:a,logarithmicDepthBuffer:c,maxTextures:h,maxVertexTextures:u,maxTextureSize:d,maxCubemapSize:p,maxAttributes:m,maxVertexUniforms:f,maxVaryings:v,maxFragmentUniforms:g,vertexTextures:_,floatFragmentTextures:w,floatVertexTextures:_&&w,maxSamples:r?e.getParameter(e.MAX_SAMPLES):0}}function wa(e){const t=this;let n=null,i=0,s=!1,r=!1;const a=new sa,o=new Jn,l={value:null,needsUpdate:!1};function c(e,n,i,s){const r=null!==e?e.length:0;let c=null;if(0!==r){if(c=l.value,!0!==s||null===c){const t=i+4*r,s=n.matrixWorldInverse;o.getNormalMatrix(s),(null===c||c.length<t)&&(c=new Float32Array(t));for(let t=0,n=i;t!==r;++t,n+=4)a.copy(e[t]).applyMatrix4(s,o),a.normal.toArray(c,n),c[n+3]=a.constant}l.value=c,l.needsUpdate=!0}return t.numPlanes=r,t.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t){const n=0!==e.length||t||0!==i||s;return s=t,i=e.length,n},this.beginShadows=function(){r=!0,c(null)},this.endShadows=function(){r=!1},this.setGlobalState=function(e,t){n=c(e,t,0)},this.setState=function(a,o,h){const u=a.clippingPlanes,d=a.clipIntersection,p=a.clipShadows,m=e.get(a);if(!s||null===u||0===u.length||r&&!p)r?c(null):function(){l.value!==n&&(l.value=n,l.needsUpdate=i>0);t.numPlanes=i,t.numIntersection=0}();else{const e=r?0:i,t=4*e;let s=m.clippingState||null;l.value=s,s=c(u,o,t,h);for(let e=0;e!==t;++e)s[e]=n[e];m.clippingState=s,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=e}}}function ba(e){let t=new WeakMap;function n(e,t){return t===pe?e.mapping=ue:t===me&&(e.mapping=de),e}function i(e){const n=e.target;n.removeEventListener("dispose",i);const s=t.get(n);void 0!==s&&(t.delete(n),s.dispose())}return{get:function(s){if(s&&s.isTexture&&!1===s.isRenderTargetTexture){const r=s.mapping;if(r===pe||r===me){if(t.has(s)){return n(t.get(s).texture,s.mapping)}{const r=s.image;if(r&&r.height>0){const a=new ea(r.height/2);return a.fromEquirectangularTexture(e,s),t.set(s,a),s.addEventListener("dispose",i),n(a.texture,s.mapping)}return null}}}return s},dispose:function(){t=new WeakMap}}}class ya extends Yr{constructor(e=-1,t=1,n=1,i=-1,s=.1,r=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=i,this.near=s,this.far=r,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,n,i,s,r){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=s,this.view.height=r,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let s=n-e,r=n+e,a=i+t,o=i-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=e*this.view.offsetX,r=s+e*this.view.width,a-=t*this.view.offsetY,o=a-t*this.view.height}this.projectionMatrix.makeOrthographic(s,r,a,o,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}const xa=[.125,.215,.35,.446,.526,.582],Ma=20,Ea=new ya,Sa=new Ys;let Ca=null;const Ta=(1+Math.sqrt(5))/2,Pa=1/Ta,Aa=[new Ai(1,1,1),new Ai(-1,1,1),new Ai(1,1,-1),new Ai(-1,1,-1),new Ai(0,Ta,Pa),new Ai(0,Ta,-Pa),new Ai(Pa,0,Ta),new Ai(-Pa,0,Ta),new Ai(Ta,Pa,0),new Ai(-Ta,Pa,0)];class La{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,i=100){Ca=this._renderer.getRenderTarget(),this._setSize(256);const s=this._allocateTargets();return s.depthBuffer=!0,this._sceneToCubeUV(e,n,i,s),t>0&&this._blur(s,0,0,t),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=ka(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=Ia(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(Ca),e.scissorTest=!1,Da(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===ue||e.mapping===de?this._setSize(0===e.image.length?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),Ca=this._renderer.getRenderTarget();const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:Ee,minFilter:Ee,generateMipmaps:!1,type:Ne,format:ze,colorSpace:Yt,depthBuffer:!1},i=Ra(e,t,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=Ra(e,t,n);const{_lodMax:i}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(e){const t=[],n=[],i=[];let s=e;const r=e-4+1+xa.length;for(let a=0;a<r;a++){const r=Math.pow(2,s);n.push(r);let o=1/r;a>e-4?o=xa[a-e+4-1]:0===a&&(o=0),i.push(o);const l=1/(r-2),c=-l,h=1+l,u=[c,c,h,c,h,h,c,c,h,h,c,h],d=6,p=6,m=3,f=2,v=1,g=new Float32Array(m*p*d),_=new Float32Array(f*p*d),w=new Float32Array(v*p*d);for(let e=0;e<d;e++){const t=e%3*2/3-1,n=e>2?0:-1,i=[t,n,0,t+2/3,n,0,t+2/3,n+1,0,t,n,0,t+2/3,n+1,0,t,n+1,0];g.set(i,m*p*e),_.set(u,f*p*e);const s=[e,e,e,e,e,e];w.set(s,v*p*e)}const b=new Mr;b.setAttribute("position",new rr(g,m)),b.setAttribute("uv",new rr(_,f)),b.setAttribute("faceIndex",new rr(w,v)),t.push(b),s>4&&s--}return{lodPlanes:t,sizeLods:n,sigmas:i}}(i)),this._blurMaterial=function(e,t,n){const i=new Float32Array(Ma),s=new Ai(0,1,0),r=new Kr({name:"SphericalGaussianBlur",defines:{n:Ma,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:`${e}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:s}},vertexShader:Oa(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:S,depthTest:!1,depthWrite:!1});return r}(i,e,t)}return i}_compileMaterial(e){const t=new zr(this._lodPlanes[0],e);this._renderer.compile(t,Ea)}_sceneToCubeUV(e,t,n,i){const s=new $r(90,1,t,n),r=[1,-1,1,1,1,1],a=[1,1,1,-1,-1,-1],o=this._renderer,l=o.autoClear,c=o.toneMapping;o.getClearColor(Sa),o.toneMapping=se,o.autoClear=!1;const h=new Zs({name:"PMREM.Background",side:x,depthWrite:!1,depthTest:!1}),u=new zr(new Gr,h);let d=!1;const p=e.background;p?p.isColor&&(h.color.copy(p),e.background=null,d=!0):(h.color.copy(Sa),d=!0);for(let t=0;t<6;t++){const n=t%3;0===n?(s.up.set(0,r[t],0),s.lookAt(a[t],0,0)):1===n?(s.up.set(0,0,r[t]),s.lookAt(0,a[t],0)):(s.up.set(0,r[t],0),s.lookAt(0,0,a[t]));const l=this._cubeSize;Da(i,n*l,t>2?l:0,l,l),o.setRenderTarget(i),d&&o.render(u,s),o.render(e,s)}u.geometry.dispose(),u.material.dispose(),o.toneMapping=c,o.autoClear=l,e.background=p}_textureToCubeUV(e,t){const n=this._renderer,i=e.mapping===ue||e.mapping===de;i?(null===this._cubemapMaterial&&(this._cubemapMaterial=ka()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=Ia());const s=i?this._cubemapMaterial:this._equirectMaterial,r=new zr(this._lodPlanes[0],s);s.uniforms.envMap.value=e;const a=this._cubeSize;Da(t,0,0,3*a,2*a),n.setRenderTarget(t),n.render(r,Ea)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;for(let t=1;t<this._lodPlanes.length;t++){const n=Math.sqrt(this._sigmas[t]*this._sigmas[t]-this._sigmas[t-1]*this._sigmas[t-1]),i=Aa[(t-1)%Aa.length];this._blur(e,t-1,t,n,i)}t.autoClear=n}_blur(e,t,n,i,s){const r=this._pingPongRenderTarget;this._halfBlur(e,r,t,n,i,"latitudinal",s),this._halfBlur(r,e,n,n,i,"longitudinal",s)}_halfBlur(e,t,n,i,s,r,a){const o=this._renderer,l=this._blurMaterial;"latitudinal"!==r&&"longitudinal"!==r&&console.error("blur direction must be either latitudinal or longitudinal!");const c=new zr(this._lodPlanes[i],l),h=l.uniforms,u=this._sizeLods[n]-1,d=isFinite(s)?Math.PI/(2*u):2*Math.PI/39,p=s/d,m=isFinite(s)?1+Math.floor(3*p):Ma;m>Ma&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${m} samples when the maximum is set to 20`);const f=[];let v=0;for(let e=0;e<Ma;++e){const t=e/p,n=Math.exp(-t*t/2);f.push(n),0===e?v+=n:e<m&&(v+=2*n)}for(let e=0;e<f.length;e++)f[e]=f[e]/v;h.envMap.value=e.texture,h.samples.value=m,h.weights.value=f,h.latitudinal.value="latitudinal"===r,a&&(h.poleAxis.value=a);const{_lodMax:g}=this;h.dTheta.value=d,h.mipInt.value=g-n;const _=this._sizeLods[i];Da(t,3*_*(i>g-4?i-g+4:0),4*(this._cubeSize-_),3*_,2*_),o.setRenderTarget(t),o.render(c,Ea)}}function Ra(e,t,n){const i=new xi(e,t,n);return i.texture.mapping=fe,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function Da(e,t,n,i,s){e.viewport.set(t,n,i,s),e.scissor.set(t,n,i,s)}function Ia(){return new Kr({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:Oa(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:S,depthTest:!1,depthWrite:!1})}function ka(){return new Kr({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:Oa(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:S,depthTest:!1,depthWrite:!1})}function Oa(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function Na(e){let t=new WeakMap,n=null;function i(e){const n=e.target;n.removeEventListener("dispose",i);const s=t.get(n);void 0!==s&&(t.delete(n),s.dispose())}return{get:function(s){if(s&&s.isTexture){const r=s.mapping,a=r===pe||r===me,o=r===ue||r===de;if(a||o){if(s.isRenderTargetTexture&&!0===s.needsPMREMUpdate){s.needsPMREMUpdate=!1;let i=t.get(s);return null===n&&(n=new La(e)),i=a?n.fromEquirectangular(s,i):n.fromCubemap(s,i),t.set(s,i),i.texture}if(t.has(s))return t.get(s).texture;{const r=s.image;if(a&&r&&r.height>0||o&&r&&function(e){let t=0;const n=6;for(let i=0;i<n;i++)void 0!==e[i]&&t++;return t===n}(r)){null===n&&(n=new La(e));const r=a?n.fromEquirectangular(s):n.fromCubemap(s);return t.set(s,r),s.addEventListener("dispose",i),r.texture}return null}}}return s},dispose:function(){t=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function Ua(e){const t={};function n(n){if(void 0!==t[n])return t[n];let i;switch(n){case"WEBGL_depth_texture":i=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=e.getExtension(n)}return t[n]=i,i}return{has:function(e){return null!==n(e)},init:function(e){e.isWebGL2?n("EXT_color_buffer_float"):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture")},get:function(e){const t=n(e);return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function Va(e,t,n,i){const s={},r=new WeakMap;function a(e){const o=e.target;null!==o.index&&t.remove(o.index);for(const e in o.attributes)t.remove(o.attributes[e]);for(const e in o.morphAttributes){const n=o.morphAttributes[e];for(let e=0,i=n.length;e<i;e++)t.remove(n[e])}o.removeEventListener("dispose",a),delete s[o.id];const l=r.get(o);l&&(t.remove(l),r.delete(o)),i.releaseStatesOfGeometry(o),!0===o.isInstancedBufferGeometry&&delete o._maxInstanceCount,n.memory.geometries--}function o(e){const n=[],i=e.index,s=e.attributes.position;let a=0;if(null!==i){const e=i.array;a=i.version;for(let t=0,i=e.length;t<i;t+=3){const i=e[t+0],s=e[t+1],r=e[t+2];n.push(i,s,s,r,r,i)}}else{if(void 0===s)return;{const e=s.array;a=s.version;for(let t=0,i=e.length/3-1;t<i;t+=3){const e=t+0,i=t+1,s=t+2;n.push(e,i,i,s,s,e)}}}const o=new(ei(n)?dr:hr)(n,1);o.version=a;const l=r.get(e);l&&t.remove(l),r.set(e,o)}return{get:function(e,t){return!0===s[t.id]||(t.addEventListener("dispose",a),s[t.id]=!0,n.memory.geometries++),t},update:function(n){const i=n.attributes;for(const n in i)t.update(i[n],e.ARRAY_BUFFER);const s=n.morphAttributes;for(const n in s){const i=s[n];for(let n=0,s=i.length;n<s;n++)t.update(i[n],e.ARRAY_BUFFER)}},getWireframeAttribute:function(e){const t=r.get(e);if(t){const n=e.index;null!==n&&t.version<n.version&&o(e)}else o(e);return r.get(e)}}}function Ba(e,t,n,i){const s=i.isWebGL2;let r,a,o;this.setMode=function(e){r=e},this.setIndex=function(e){a=e.type,o=e.bytesPerElement},this.render=function(t,i){e.drawElements(r,i,a,t*o),n.update(i,r,1)},this.renderInstances=function(i,l,c){if(0===c)return;let h,u;if(s)h=e,u="drawElementsInstanced";else if(h=t.get("ANGLE_instanced_arrays"),u="drawElementsInstancedANGLE",null===h)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");h[u](r,l,a,i*o,c),n.update(l,r,c)}}function Fa(e){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(n,i,s){switch(t.calls++,i){case e.TRIANGLES:t.triangles+=s*(n/3);break;case e.LINES:t.lines+=s*(n/2);break;case e.LINE_STRIP:t.lines+=s*(n-1);break;case e.LINE_LOOP:t.lines+=s*n;break;case e.POINTS:t.points+=s*n;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",i)}}}}function za(e,t){return e[0]-t[0]}function Ha(e,t){return Math.abs(t[1])-Math.abs(e[1])}function Ga(e,t,n){const i={},s=new Float32Array(8),r=new WeakMap,a=new bi,o=[];for(let e=0;e<8;e++)o[e]=[e,0];return{update:function(l,c,h){const u=l.morphTargetInfluences;if(!0===t.isWebGL2){const d=c.morphAttributes.position||c.morphAttributes.normal||c.morphAttributes.color,p=void 0!==d?d.length:0;let m=r.get(c);if(void 0===m||m.count!==p){void 0!==m&&m.texture.dispose();const g=void 0!==c.morphAttributes.position,_=void 0!==c.morphAttributes.normal,w=void 0!==c.morphAttributes.color,b=c.morphAttributes.position||[],y=c.morphAttributes.normal||[],x=c.morphAttributes.color||[];let M=0;!0===g&&(M=1),!0===_&&(M=2),!0===w&&(M=3);let E=c.attributes.position.count*M,S=1;E>t.maxTextureSize&&(S=Math.ceil(E/t.maxTextureSize),E=t.maxTextureSize);const C=new Float32Array(E*S*4*p),T=new Mi(C,E,S,p);T.type=Oe,T.needsUpdate=!0;const P=4*M;for(let L=0;L<p;L++){const R=b[L],D=y[L],I=x[L],k=E*S*4*L;for(let O=0;O<R.count;O++){const N=O*P;!0===g&&(a.fromBufferAttribute(R,O),C[k+N+0]=a.x,C[k+N+1]=a.y,C[k+N+2]=a.z,C[k+N+3]=0),!0===_&&(a.fromBufferAttribute(D,O),C[k+N+4]=a.x,C[k+N+5]=a.y,C[k+N+6]=a.z,C[k+N+7]=0),!0===w&&(a.fromBufferAttribute(I,O),C[k+N+8]=a.x,C[k+N+9]=a.y,C[k+N+10]=a.z,C[k+N+11]=4===I.itemSize?a.w:1)}}function A(){T.dispose(),r.delete(c),c.removeEventListener("dispose",A)}m={count:p,texture:T,size:new Zn(E,S)},r.set(c,m),c.addEventListener("dispose",A)}let f=0;for(let U=0;U<u.length;U++)f+=u[U];const v=c.morphTargetsRelative?1:1-f;h.getUniforms().setValue(e,"morphTargetBaseInfluence",v),h.getUniforms().setValue(e,"morphTargetInfluences",u),h.getUniforms().setValue(e,"morphTargetsTexture",m.texture,n),h.getUniforms().setValue(e,"morphTargetsTextureSize",m.size)}else{const V=void 0===u?0:u.length;let B=i[c.id];if(void 0===B||B.length!==V){B=[];for(let j=0;j<V;j++)B[j]=[j,0];i[c.id]=B}for(let W=0;W<V;W++){const q=B[W];q[0]=W,q[1]=u[W]}B.sort(Ha);for(let X=0;X<8;X++)X<V&&B[X][1]?(o[X][0]=B[X][0],o[X][1]=B[X][1]):(o[X][0]=Number.MAX_SAFE_INTEGER,o[X][1]=0);o.sort(za);const F=c.morphAttributes.position,z=c.morphAttributes.normal;let H=0;for(let K=0;K<8;K++){const Y=o[K],$=Y[0],Z=Y[1];$!==Number.MAX_SAFE_INTEGER&&Z?(F&&c.getAttribute("morphTarget"+K)!==F[$]&&c.setAttribute("morphTarget"+K,F[$]),z&&c.getAttribute("morphNormal"+K)!==z[$]&&c.setAttribute("morphNormal"+K,z[$]),s[K]=Z,H+=Z):(F&&!0===c.hasAttribute("morphTarget"+K)&&c.deleteAttribute("morphTarget"+K),z&&!0===c.hasAttribute("morphNormal"+K)&&c.deleteAttribute("morphNormal"+K),s[K]=0)}const G=c.morphTargetsRelative?1:1-H;h.getUniforms().setValue(e,"morphTargetBaseInfluence",G),h.getUniforms().setValue(e,"morphTargetInfluences",s)}}}}function ja(e,t,n,i){let s=new WeakMap;function r(e){const t=e.target;t.removeEventListener("dispose",r),n.remove(t.instanceMatrix),null!==t.instanceColor&&n.remove(t.instanceColor)}return{update:function(a){const o=i.render.frame,l=a.geometry,c=t.get(a,l);if(s.get(c)!==o&&(t.update(c),s.set(c,o)),a.isInstancedMesh&&(!1===a.hasEventListener("dispose",r)&&a.addEventListener("dispose",r),s.get(a)!==o&&(n.update(a.instanceMatrix,e.ARRAY_BUFFER),null!==a.instanceColor&&n.update(a.instanceColor,e.ARRAY_BUFFER),s.set(a,o))),a.isSkinnedMesh){const e=a.skeleton;s.get(e)!==o&&(e.update(),s.set(e,o))}return c},dispose:function(){s=new WeakMap}}}const Wa=new wi,qa=new Mi,Xa=new Si,Ka=new Qr,Ya=[],$a=[],Za=new Float32Array(16),Ja=new Float32Array(9),Qa=new Float32Array(4);function eo(e,t,n){const i=e[0];if(i<=0||i>0)return e;const s=t*n;let r=Ya[s];if(void 0===r&&(r=new Float32Array(s),Ya[s]=r),0!==t){i.toArray(r,0);for(let i=1,s=0;i!==t;++i)s+=n,e[i].toArray(r,s)}return r}function to(e,t){if(e.length!==t.length)return!1;for(let n=0,i=e.length;n<i;n++)if(e[n]!==t[n])return!1;return!0}function no(e,t){for(let n=0,i=t.length;n<i;n++)e[n]=t[n]}function io(e,t){let n=$a[t];void 0===n&&(n=new Int32Array(t),$a[t]=n);for(let i=0;i!==t;++i)n[i]=e.allocateTextureUnit();return n}function so(e,t){const n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function ro(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(to(n,t))return;e.uniform2fv(this.addr,t),no(n,t)}}function ao(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(to(n,t))return;e.uniform3fv(this.addr,t),no(n,t)}}function oo(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(to(n,t))return;e.uniform4fv(this.addr,t),no(n,t)}}function lo(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(to(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),no(n,t)}else{if(to(n,i))return;Qa.set(i),e.uniformMatrix2fv(this.addr,!1,Qa),no(n,i)}}function co(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(to(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),no(n,t)}else{if(to(n,i))return;Ja.set(i),e.uniformMatrix3fv(this.addr,!1,Ja),no(n,i)}}function ho(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(to(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),no(n,t)}else{if(to(n,i))return;Za.set(i),e.uniformMatrix4fv(this.addr,!1,Za),no(n,i)}}function uo(e,t){const n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function po(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2i(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(to(n,t))return;e.uniform2iv(this.addr,t),no(n,t)}}function mo(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3i(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(to(n,t))return;e.uniform3iv(this.addr,t),no(n,t)}}function fo(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(to(n,t))return;e.uniform4iv(this.addr,t),no(n,t)}}function vo(e,t){const n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function go(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2ui(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(to(n,t))return;e.uniform2uiv(this.addr,t),no(n,t)}}function _o(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3ui(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(to(n,t))return;e.uniform3uiv(this.addr,t),no(n,t)}}function wo(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(to(n,t))return;e.uniform4uiv(this.addr,t),no(n,t)}}function bo(e,t,n){const i=this.cache,s=n.allocateTextureUnit();i[0]!==s&&(e.uniform1i(this.addr,s),i[0]=s),n.setTexture2D(t||Wa,s)}function yo(e,t,n){const i=this.cache,s=n.allocateTextureUnit();i[0]!==s&&(e.uniform1i(this.addr,s),i[0]=s),n.setTexture3D(t||Xa,s)}function xo(e,t,n){const i=this.cache,s=n.allocateTextureUnit();i[0]!==s&&(e.uniform1i(this.addr,s),i[0]=s),n.setTextureCube(t||Ka,s)}function Mo(e,t,n){const i=this.cache,s=n.allocateTextureUnit();i[0]!==s&&(e.uniform1i(this.addr,s),i[0]=s),n.setTexture2DArray(t||qa,s)}function Eo(e,t){e.uniform1fv(this.addr,t)}function So(e,t){const n=eo(t,this.size,2);e.uniform2fv(this.addr,n)}function Co(e,t){const n=eo(t,this.size,3);e.uniform3fv(this.addr,n)}function To(e,t){const n=eo(t,this.size,4);e.uniform4fv(this.addr,n)}function Po(e,t){const n=eo(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function Ao(e,t){const n=eo(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function Lo(e,t){const n=eo(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function Ro(e,t){e.uniform1iv(this.addr,t)}function Do(e,t){e.uniform2iv(this.addr,t)}function Io(e,t){e.uniform3iv(this.addr,t)}function ko(e,t){e.uniform4iv(this.addr,t)}function Oo(e,t){e.uniform1uiv(this.addr,t)}function No(e,t){e.uniform2uiv(this.addr,t)}function Uo(e,t){e.uniform3uiv(this.addr,t)}function Vo(e,t){e.uniform4uiv(this.addr,t)}function Bo(e,t,n){const i=this.cache,s=t.length,r=io(n,s);to(i,r)||(e.uniform1iv(this.addr,r),no(i,r));for(let e=0;e!==s;++e)n.setTexture2D(t[e]||Wa,r[e])}function Fo(e,t,n){const i=this.cache,s=t.length,r=io(n,s);to(i,r)||(e.uniform1iv(this.addr,r),no(i,r));for(let e=0;e!==s;++e)n.setTexture3D(t[e]||Xa,r[e])}function zo(e,t,n){const i=this.cache,s=t.length,r=io(n,s);to(i,r)||(e.uniform1iv(this.addr,r),no(i,r));for(let e=0;e!==s;++e)n.setTextureCube(t[e]||Ka,r[e])}function Ho(e,t,n){const i=this.cache,s=t.length,r=io(n,s);to(i,r)||(e.uniform1iv(this.addr,r),no(i,r));for(let e=0;e!==s;++e)n.setTexture2DArray(t[e]||qa,r[e])}class Go{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=function(e){switch(e){case 5126:return so;case 35664:return ro;case 35665:return ao;case 35666:return oo;case 35674:return lo;case 35675:return co;case 35676:return ho;case 5124:case 35670:return uo;case 35667:case 35671:return po;case 35668:case 35672:return mo;case 35669:case 35673:return fo;case 5125:return vo;case 36294:return go;case 36295:return _o;case 36296:return wo;case 35678:case 36198:case 36298:case 36306:case 35682:return bo;case 35679:case 36299:case 36307:return yo;case 35680:case 36300:case 36308:case 36293:return xo;case 36289:case 36303:case 36311:case 36292:return Mo}}(t.type)}}class jo{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return Eo;case 35664:return So;case 35665:return Co;case 35666:return To;case 35674:return Po;case 35675:return Ao;case 35676:return Lo;case 5124:case 35670:return Ro;case 35667:case 35671:return Do;case 35668:case 35672:return Io;case 35669:case 35673:return ko;case 5125:return Oo;case 36294:return No;case 36295:return Uo;case 36296:return Vo;case 35678:case 36198:case 36298:case 36306:case 35682:return Bo;case 35679:case 36299:case 36307:return Fo;case 35680:case 36300:case 36308:case 36293:return zo;case 36289:case 36303:case 36311:case 36292:return Ho}}(t.type)}}class Wo{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const i=this.seq;for(let s=0,r=i.length;s!==r;++s){const r=i[s];r.setValue(e,t[r.id],n)}}}const qo=/(\w+)(\])?(\[|\.)?/g;function Xo(e,t){e.seq.push(t),e.map[t.id]=t}function Ko(e,t,n){const i=e.name,s=i.length;for(qo.lastIndex=0;;){const r=qo.exec(i),a=qo.lastIndex;let o=r[1];const l="]"===r[2],c=r[3];if(l&&(o|=0),void 0===c||"["===c&&a+2===s){Xo(n,void 0===c?new Go(o,e,t):new jo(o,e,t));break}{let e=n.map[o];void 0===e&&(e=new Wo(o),Xo(n,e)),n=e}}}class Yo{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let i=0;i<n;++i){const n=e.getActiveUniform(t,i);Ko(n,e.getUniformLocation(t,n.name),this)}}setValue(e,t,n,i){const s=this.map[t];void 0!==s&&s.setValue(e,n,i)}setOptional(e,t,n){const i=t[n];void 0!==i&&this.setValue(e,n,i)}static upload(e,t,n,i){for(let s=0,r=t.length;s!==r;++s){const r=t[s],a=n[r.id];!1!==a.needsUpdate&&r.setValue(e,a.value,i)}}static seqWithValue(e,t){const n=[];for(let i=0,s=e.length;i!==s;++i){const s=e[i];s.id in t&&n.push(s)}return n}}function $o(e,t,n){const i=e.createShader(t);return e.shaderSource(i,n),e.compileShader(i),i}let Zo=0;function Jo(e,t,n){const i=e.getShaderParameter(t,e.COMPILE_STATUS),s=e.getShaderInfoLog(t).trim();if(i&&""===s)return"";const r=/ERROR: 0:(\d+)/.exec(s);if(r){const i=parseInt(r[1]);return n.toUpperCase()+"\n\n"+s+"\n\n"+function(e,t){const n=e.split("\n"),i=[],s=Math.max(t-6,0),r=Math.min(t+6,n.length);for(let e=s;e<r;e++){const s=e+1;i.push(`${s===t?">":" "} ${s}: ${n[e]}`)}return i.join("\n")}(e.getShaderSource(t),i)}return s}function Qo(e,t){const n=function(e){switch(e){case Yt:return["Linear","( value )"];case Kt:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",e),["Linear","( value )"]}}(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function el(e,t){let n;switch(t){case re:n="Linear";break;case ae:n="Reinhard";break;case oe:n="OptimizedCineon";break;case le:n="ACESFilmic";break;case ce:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),n="Linear"}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function tl(e){return""!==e}function nl(e,t){const n=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function il(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const sl=/^[ \t]*#include +<([\w\d./]+)>/gm;function rl(e){return e.replace(sl,ol)}const al=new Map([["encodings_fragment","colorspace_fragment"],["encodings_pars_fragment","colorspace_pars_fragment"],["output_fragment","opaque_fragment"]]);function ol(e,t){let n=ua[t];if(void 0===n){const e=al.get(t);if(void 0===e)throw new Error("Can not resolve #include <"+t+">");n=ua[e],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',t,e)}return rl(n)}const ll=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function cl(e){return e.replace(ll,hl)}function hl(e,t,n,i){let s="";for(let e=parseInt(t);e<parseInt(n);e++)s+=i.replace(/\[\s*i\s*\]/g,"[ "+e+" ]").replace(/UNROLLED_LOOP_INDEX/g,e);return s}function ul(e){let t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function dl(e,t,n,i){const s=e.getContext(),r=n.defines;let a=n.vertexShader,o=n.fragmentShader;const l=function(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===_?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===w?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===b&&(t="SHADOWMAP_TYPE_VSM"),t}(n),c=function(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case ue:case de:t="ENVMAP_TYPE_CUBE";break;case fe:t="ENVMAP_TYPE_CUBE_UV"}return t}(n),h=function(e){let t="ENVMAP_MODE_REFLECTION";e.envMap&&e.envMapMode===de&&(t="ENVMAP_MODE_REFRACTION");return t}(n),u=function(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case te:t="ENVMAP_BLENDING_MULTIPLY";break;case ne:t="ENVMAP_BLENDING_MIX";break;case ie:t="ENVMAP_BLENDING_ADD"}return t}(n),d=function(e){const t=e.envMapCubeUVHeight;if(null===t)return null;const n=Math.log2(t)-2,i=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,n),112)),texelHeight:i,maxMip:n}}(n),p=n.isWebGL2?"":function(e){return[e.extensionDerivatives||e.envMapCubeUVHeight||e.bumpMap||e.normalMapTangentSpace||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(tl).join("\n")}(n),m=function(e){const t=[];for(const n in e){const i=e[n];!1!==i&&t.push("#define "+n+" "+i)}return t.join("\n")}(r),f=s.createProgram();let v,g,y=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(v=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,m].filter(tl).join("\n"),v.length>0&&(v+="\n"),g=[p,"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,m].filter(tl).join("\n"),g.length>0&&(g+="\n")):(v=[ul(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,m,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+h:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.displacementMap?"#define USE_DISPLACEMENTMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.mapUv?"#define MAP_UV "+n.mapUv:"",n.alphaMapUv?"#define ALPHAMAP_UV "+n.alphaMapUv:"",n.lightMapUv?"#define LIGHTMAP_UV "+n.lightMapUv:"",n.aoMapUv?"#define AOMAP_UV "+n.aoMapUv:"",n.emissiveMapUv?"#define EMISSIVEMAP_UV "+n.emissiveMapUv:"",n.bumpMapUv?"#define BUMPMAP_UV "+n.bumpMapUv:"",n.normalMapUv?"#define NORMALMAP_UV "+n.normalMapUv:"",n.displacementMapUv?"#define DISPLACEMENTMAP_UV "+n.displacementMapUv:"",n.metalnessMapUv?"#define METALNESSMAP_UV "+n.metalnessMapUv:"",n.roughnessMapUv?"#define ROUGHNESSMAP_UV "+n.roughnessMapUv:"",n.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+n.anisotropyMapUv:"",n.clearcoatMapUv?"#define CLEARCOATMAP_UV "+n.clearcoatMapUv:"",n.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+n.clearcoatNormalMapUv:"",n.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+n.clearcoatRoughnessMapUv:"",n.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+n.iridescenceMapUv:"",n.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+n.iridescenceThicknessMapUv:"",n.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+n.sheenColorMapUv:"",n.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+n.sheenRoughnessMapUv:"",n.specularMapUv?"#define SPECULARMAP_UV "+n.specularMapUv:"",n.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+n.specularColorMapUv:"",n.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+n.specularIntensityMapUv:"",n.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+n.transmissionMapUv:"",n.thicknessMapUv?"#define THICKNESSMAP_UV "+n.thicknessMapUv:"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphColors&&n.isWebGL2?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.useLegacyLights?"#define LEGACY_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","\tattribute vec2 uv1;","#endif","#ifdef USE_UV2","\tattribute vec2 uv2;","#endif","#ifdef USE_UV3","\tattribute vec2 uv3;","#endif","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(tl).join("\n"),g=[p,ul(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,m,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+c:"",n.envMap?"#define "+h:"",n.envMap?"#define "+u:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.useLegacyLights?"#define LEGACY_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==se?"#define TONE_MAPPING":"",n.toneMapping!==se?ua.tonemapping_pars_fragment:"",n.toneMapping!==se?el("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",ua.colorspace_pars_fragment,Qo("linearToOutputTexel",n.outputColorSpace),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(tl).join("\n")),a=rl(a),a=nl(a,n),a=il(a,n),o=rl(o),o=nl(o,n),o=il(o,n),a=cl(a),o=cl(o),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(y="#version 300 es\n",v=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+v,g=["#define varying in",n.glslVersion===Dn?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===Dn?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+g);const x=y+v+a,M=y+g+o,E=$o(s,s.VERTEX_SHADER,x),S=$o(s,s.FRAGMENT_SHADER,M);if(s.attachShader(f,E),s.attachShader(f,S),void 0!==n.index0AttributeName?s.bindAttribLocation(f,0,n.index0AttributeName):!0===n.morphTargets&&s.bindAttribLocation(f,0,"position"),s.linkProgram(f),e.debug.checkShaderErrors){const t=s.getProgramInfoLog(f).trim(),n=s.getShaderInfoLog(E).trim(),i=s.getShaderInfoLog(S).trim();let r=!0,a=!0;if(!1===s.getProgramParameter(f,s.LINK_STATUS))if(r=!1,"function"==typeof e.debug.onShaderError)e.debug.onShaderError(s,f,E,S);else{const e=Jo(s,E,"vertex"),n=Jo(s,S,"fragment");console.error("THREE.WebGLProgram: Shader Error "+s.getError()+" - VALIDATE_STATUS "+s.getProgramParameter(f,s.VALIDATE_STATUS)+"\n\nProgram Info Log: "+t+"\n"+e+"\n"+n)}else""!==t?console.warn("THREE.WebGLProgram: Program Info Log:",t):""!==n&&""!==i||(a=!1);a&&(this.diagnostics={runnable:r,programLog:t,vertexShader:{log:n,prefix:v},fragmentShader:{log:i,prefix:g}})}let C,T;return s.deleteShader(E),s.deleteShader(S),this.getUniforms=function(){return void 0===C&&(C=new Yo(s,f)),C},this.getAttributes=function(){return void 0===T&&(T=function(e,t){const n={},i=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let s=0;s<i;s++){const i=e.getActiveAttrib(t,s),r=i.name;let a=1;i.type===e.FLOAT_MAT2&&(a=2),i.type===e.FLOAT_MAT3&&(a=3),i.type===e.FLOAT_MAT4&&(a=4),n[r]={type:i.type,location:e.getAttribLocation(t,r),locationSize:a}}return n}(s,f)),T},this.destroy=function(){i.releaseStatesOfProgram(this),s.deleteProgram(f),this.program=void 0},this.type=n.shaderType,this.name=n.shaderName,this.id=Zo++,this.cacheKey=t,this.usedTimes=1,this.program=f,this.vertexShader=E,this.fragmentShader=S,this}let pl=0;class ml{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,i=this._getShaderStage(t),s=this._getShaderStage(n),r=this._getShaderCacheForMaterial(e);return!1===r.has(i)&&(r.add(i),i.usedTimes++),!1===r.has(s)&&(r.add(s),s.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const e of t)e.usedTimes--,0===e.usedTimes&&this.shaderCache.delete(e.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return void 0===n&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){const t=this.shaderCache;let n=t.get(e);return void 0===n&&(n=new fl(e),t.set(e,n)),n}}class fl{constructor(e){this.id=pl++,this.code=e,this.usedTimes=0}}function vl(e,t,n,i,s,r,a){const o=new vs,l=new ml,c=[],h=s.isWebGL2,u=s.logarithmicDepthBuffer,d=s.vertexTextures;let p=s.precision;const m={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function f(e){return 0===e?"uv":`uv${e}`}return{getParameters:function(r,o,c,v,g){const _=v.fog,w=g.geometry,b=r.isMeshStandardMaterial?v.environment:null,y=(r.isMeshStandardMaterial?n:t).get(r.envMap||b),E=y&&y.mapping===fe?y.image.height:null,S=m[r.type];null!==r.precision&&(p=s.getMaxPrecision(r.precision),p!==r.precision&&console.warn("THREE.WebGLProgram.getParameters:",r.precision,"not supported, using",p,"instead."));const T=w.morphAttributes.position||w.morphAttributes.normal||w.morphAttributes.color,P=void 0!==T?T.length:0;let A,L,R,D,I=0;if(void 0!==w.morphAttributes.position&&(I=1),void 0!==w.morphAttributes.normal&&(I=2),void 0!==w.morphAttributes.color&&(I=3),S){const e=pa[S];A=e.vertexShader,L=e.fragmentShader}else A=r.vertexShader,L=r.fragmentShader,l.update(r),R=l.getVertexShaderID(r),D=l.getFragmentShaderID(r);const k=e.getRenderTarget(),O=!0===g.isInstancedMesh,N=!!r.map,U=!!r.matcap,V=!!y,B=!!r.aoMap,F=!!r.lightMap,z=!!r.bumpMap,H=!!r.normalMap,G=!!r.displacementMap,j=!!r.emissiveMap,W=!!r.metalnessMap,q=!!r.roughnessMap,X=r.anisotropy>0,K=r.clearcoat>0,Y=r.iridescence>0,$=r.sheen>0,Z=r.transmission>0,J=X&&!!r.anisotropyMap,Q=K&&!!r.clearcoatMap,ee=K&&!!r.clearcoatNormalMap,te=K&&!!r.clearcoatRoughnessMap,ne=Y&&!!r.iridescenceMap,ie=Y&&!!r.iridescenceThicknessMap,re=$&&!!r.sheenColorMap,ae=$&&!!r.sheenRoughnessMap,oe=!!r.specularMap,le=!!r.specularColorMap,ce=!!r.specularIntensityMap,he=Z&&!!r.transmissionMap,ue=Z&&!!r.thicknessMap,de=!!r.gradientMap,pe=!!r.alphaMap,me=r.alphaTest>0,ve=!!r.alphaHash,ge=!!r.extensions,_e=!!w.attributes.uv1,we=!!w.attributes.uv2,be=!!w.attributes.uv3;let ye=se;return r.toneMapped&&(null!==k&&!0!==k.isXRRenderTarget||(ye=e.toneMapping)),{isWebGL2:h,shaderID:S,shaderType:r.type,shaderName:r.name,vertexShader:A,fragmentShader:L,defines:r.defines,customVertexShaderID:R,customFragmentShaderID:D,isRawShaderMaterial:!0===r.isRawShaderMaterial,glslVersion:r.glslVersion,precision:p,instancing:O,instancingColor:O&&null!==g.instanceColor,supportsVertexTextures:d,outputColorSpace:null===k?e.outputColorSpace:!0===k.isXRRenderTarget?k.texture.colorSpace:Yt,map:N,matcap:U,envMap:V,envMapMode:V&&y.mapping,envMapCubeUVHeight:E,aoMap:B,lightMap:F,bumpMap:z,normalMap:H,displacementMap:d&&G,emissiveMap:j,normalMapObjectSpace:H&&r.normalMapType===qt,normalMapTangentSpace:H&&r.normalMapType===Wt,metalnessMap:W,roughnessMap:q,anisotropy:X,anisotropyMap:J,clearcoat:K,clearcoatMap:Q,clearcoatNormalMap:ee,clearcoatRoughnessMap:te,iridescence:Y,iridescenceMap:ne,iridescenceThicknessMap:ie,sheen:$,sheenColorMap:re,sheenRoughnessMap:ae,specularMap:oe,specularColorMap:le,specularIntensityMap:ce,transmission:Z,transmissionMap:he,thicknessMap:ue,gradientMap:de,opaque:!1===r.transparent&&r.blending===C,alphaMap:pe,alphaTest:me,alphaHash:ve,combine:r.combine,mapUv:N&&f(r.map.channel),aoMapUv:B&&f(r.aoMap.channel),lightMapUv:F&&f(r.lightMap.channel),bumpMapUv:z&&f(r.bumpMap.channel),normalMapUv:H&&f(r.normalMap.channel),displacementMapUv:G&&f(r.displacementMap.channel),emissiveMapUv:j&&f(r.emissiveMap.channel),metalnessMapUv:W&&f(r.metalnessMap.channel),roughnessMapUv:q&&f(r.roughnessMap.channel),anisotropyMapUv:J&&f(r.anisotropyMap.channel),clearcoatMapUv:Q&&f(r.clearcoatMap.channel),clearcoatNormalMapUv:ee&&f(r.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:te&&f(r.clearcoatRoughnessMap.channel),iridescenceMapUv:ne&&f(r.iridescenceMap.channel),iridescenceThicknessMapUv:ie&&f(r.iridescenceThicknessMap.channel),sheenColorMapUv:re&&f(r.sheenColorMap.channel),sheenRoughnessMapUv:ae&&f(r.sheenRoughnessMap.channel),specularMapUv:oe&&f(r.specularMap.channel),specularColorMapUv:le&&f(r.specularColorMap.channel),specularIntensityMapUv:ce&&f(r.specularIntensityMap.channel),transmissionMapUv:he&&f(r.transmissionMap.channel),thicknessMapUv:ue&&f(r.thicknessMap.channel),alphaMapUv:pe&&f(r.alphaMap.channel),vertexTangents:!!w.attributes.tangent&&(H||X),vertexColors:r.vertexColors,vertexAlphas:!0===r.vertexColors&&!!w.attributes.color&&4===w.attributes.color.itemSize,vertexUv1s:_e,vertexUv2s:we,vertexUv3s:be,pointsUvs:!0===g.isPoints&&!!w.attributes.uv&&(N||pe),fog:!!_,useFog:!0===r.fog,fogExp2:_&&_.isFogExp2,flatShading:!0===r.flatShading,sizeAttenuation:!0===r.sizeAttenuation,logarithmicDepthBuffer:u,skinning:!0===g.isSkinnedMesh,morphTargets:void 0!==w.morphAttributes.position,morphNormals:void 0!==w.morphAttributes.normal,morphColors:void 0!==w.morphAttributes.color,morphTargetsCount:P,morphTextureStride:I,numDirLights:o.directional.length,numPointLights:o.point.length,numSpotLights:o.spot.length,numSpotLightMaps:o.spotLightMap.length,numRectAreaLights:o.rectArea.length,numHemiLights:o.hemi.length,numDirLightShadows:o.directionalShadowMap.length,numPointLightShadows:o.pointShadowMap.length,numSpotLightShadows:o.spotShadowMap.length,numSpotLightShadowsWithMaps:o.numSpotLightShadowsWithMaps,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:r.dithering,shadowMapEnabled:e.shadowMap.enabled&&c.length>0,shadowMapType:e.shadowMap.type,toneMapping:ye,useLegacyLights:e._useLegacyLights,premultipliedAlpha:r.premultipliedAlpha,doubleSided:r.side===M,flipSided:r.side===x,useDepthPacking:r.depthPacking>=0,depthPacking:r.depthPacking||0,index0AttributeName:r.index0AttributeName,extensionDerivatives:ge&&!0===r.extensions.derivatives,extensionFragDepth:ge&&!0===r.extensions.fragDepth,extensionDrawBuffers:ge&&!0===r.extensions.drawBuffers,extensionShaderTextureLOD:ge&&!0===r.extensions.shaderTextureLOD,rendererExtensionFragDepth:h||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:h||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:h||i.has("EXT_shader_texture_lod"),customProgramCacheKey:r.customProgramCacheKey()}},getProgramCacheKey:function(t){const n=[];if(t.shaderID?n.push(t.shaderID):(n.push(t.customVertexShaderID),n.push(t.customFragmentShaderID)),void 0!==t.defines)for(const e in t.defines)n.push(e),n.push(t.defines[e]);return!1===t.isRawShaderMaterial&&(!function(e,t){e.push(t.precision),e.push(t.outputColorSpace),e.push(t.envMapMode),e.push(t.envMapCubeUVHeight),e.push(t.mapUv),e.push(t.alphaMapUv),e.push(t.lightMapUv),e.push(t.aoMapUv),e.push(t.bumpMapUv),e.push(t.normalMapUv),e.push(t.displacementMapUv),e.push(t.emissiveMapUv),e.push(t.metalnessMapUv),e.push(t.roughnessMapUv),e.push(t.anisotropyMapUv),e.push(t.clearcoatMapUv),e.push(t.clearcoatNormalMapUv),e.push(t.clearcoatRoughnessMapUv),e.push(t.iridescenceMapUv),e.push(t.iridescenceThicknessMapUv),e.push(t.sheenColorMapUv),e.push(t.sheenRoughnessMapUv),e.push(t.specularMapUv),e.push(t.specularColorMapUv),e.push(t.specularIntensityMapUv),e.push(t.transmissionMapUv),e.push(t.thicknessMapUv),e.push(t.combine),e.push(t.fogExp2),e.push(t.sizeAttenuation),e.push(t.morphTargetsCount),e.push(t.morphAttributeCount),e.push(t.numDirLights),e.push(t.numPointLights),e.push(t.numSpotLights),e.push(t.numSpotLightMaps),e.push(t.numHemiLights),e.push(t.numRectAreaLights),e.push(t.numDirLightShadows),e.push(t.numPointLightShadows),e.push(t.numSpotLightShadows),e.push(t.numSpotLightShadowsWithMaps),e.push(t.shadowMapType),e.push(t.toneMapping),e.push(t.numClippingPlanes),e.push(t.numClipIntersection),e.push(t.depthPacking)}(n,t),function(e,t){o.disableAll(),t.isWebGL2&&o.enable(0);t.supportsVertexTextures&&o.enable(1);t.instancing&&o.enable(2);t.instancingColor&&o.enable(3);t.matcap&&o.enable(4);t.envMap&&o.enable(5);t.normalMapObjectSpace&&o.enable(6);t.normalMapTangentSpace&&o.enable(7);t.clearcoat&&o.enable(8);t.iridescence&&o.enable(9);t.alphaTest&&o.enable(10);t.vertexColors&&o.enable(11);t.vertexAlphas&&o.enable(12);t.vertexUv1s&&o.enable(13);t.vertexUv2s&&o.enable(14);t.vertexUv3s&&o.enable(15);t.vertexTangents&&o.enable(16);t.anisotropy&&o.enable(17);e.push(o.mask),o.disableAll(),t.fog&&o.enable(0);t.useFog&&o.enable(1);t.flatShading&&o.enable(2);t.logarithmicDepthBuffer&&o.enable(3);t.skinning&&o.enable(4);t.morphTargets&&o.enable(5);t.morphNormals&&o.enable(6);t.morphColors&&o.enable(7);t.premultipliedAlpha&&o.enable(8);t.shadowMapEnabled&&o.enable(9);t.useLegacyLights&&o.enable(10);t.doubleSided&&o.enable(11);t.flipSided&&o.enable(12);t.useDepthPacking&&o.enable(13);t.dithering&&o.enable(14);t.transmission&&o.enable(15);t.sheen&&o.enable(16);t.opaque&&o.enable(17);t.pointsUvs&&o.enable(18);e.push(o.mask)}(n,t),n.push(e.outputColorSpace)),n.push(t.customProgramCacheKey),n.join()},getUniforms:function(e){const t=m[e.type];let n;if(t){const e=pa[t];n=Xr.clone(e.uniforms)}else n=e.uniforms;return n},acquireProgram:function(t,n){let i;for(let e=0,t=c.length;e<t;e++){const t=c[e];if(t.cacheKey===n){i=t,++i.usedTimes;break}}return void 0===i&&(i=new dl(e,n,t,r),c.push(i)),i},releaseProgram:function(e){if(0==--e.usedTimes){const t=c.indexOf(e);c[t]=c[c.length-1],c.pop(),e.destroy()}},releaseShaderCache:function(e){l.remove(e)},programs:c,dispose:function(){l.dispose()}}}function gl(){let e=new WeakMap;return{get:function(t){let n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,i){e.get(t)[n]=i},dispose:function(){e=new WeakMap}}}function _l(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function wl(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function bl(){const e=[];let t=0;const n=[],i=[],s=[];function r(n,i,s,r,a,o){let l=e[t];return void 0===l?(l={id:n.id,object:n,geometry:i,material:s,groupOrder:r,renderOrder:n.renderOrder,z:a,group:o},e[t]=l):(l.id=n.id,l.object=n,l.geometry=i,l.material=s,l.groupOrder=r,l.renderOrder=n.renderOrder,l.z=a,l.group=o),t++,l}return{opaque:n,transmissive:i,transparent:s,init:function(){t=0,n.length=0,i.length=0,s.length=0},push:function(e,t,a,o,l,c){const h=r(e,t,a,o,l,c);a.transmission>0?i.push(h):!0===a.transparent?s.push(h):n.push(h)},unshift:function(e,t,a,o,l,c){const h=r(e,t,a,o,l,c);a.transmission>0?i.unshift(h):!0===a.transparent?s.unshift(h):n.unshift(h)},finish:function(){for(let n=t,i=e.length;n<i;n++){const t=e[n];if(null===t.id)break;t.id=null,t.object=null,t.geometry=null,t.material=null,t.group=null}},sort:function(e,t){n.length>1&&n.sort(e||_l),i.length>1&&i.sort(t||wl),s.length>1&&s.sort(t||wl)}}}function yl(){let e=new WeakMap;return{get:function(t,n){const i=e.get(t);let s;return void 0===i?(s=new bl,e.set(t,[s])):n>=i.length?(s=new bl,i.push(s)):s=i[n],s},dispose:function(){e=new WeakMap}}}function xl(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":n={direction:new Ai,color:new Ys};break;case"SpotLight":n={position:new Ai,direction:new Ai,color:new Ys,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new Ai,color:new Ys,distance:0,decay:0};break;case"HemisphereLight":n={direction:new Ai,skyColor:new Ys,groundColor:new Ys};break;case"RectAreaLight":n={color:new Ys,position:new Ai,halfWidth:new Ai,halfHeight:new Ai}}return e[t.id]=n,n}}}let Ml=0;function El(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function Sl(e,t){const n=new xl,i=function(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Zn};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Zn,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=n,n}}}(),s={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let e=0;e<9;e++)s.probe.push(new Ai);const r=new Ai,a=new rs,o=new rs;return{setup:function(r,a){let o=0,l=0,c=0;for(let e=0;e<9;e++)s.probe[e].set(0,0,0);let h=0,u=0,d=0,p=0,m=0,f=0,v=0,g=0,_=0,w=0;r.sort(El);const b=!0===a?Math.PI:1;for(let e=0,t=r.length;e<t;e++){const t=r[e],a=t.color,y=t.intensity,x=t.distance,M=t.shadow&&t.shadow.map?t.shadow.map.texture:null;if(t.isAmbientLight)o+=a.r*y*b,l+=a.g*y*b,c+=a.b*y*b;else if(t.isLightProbe)for(let e=0;e<9;e++)s.probe[e].addScaledVector(t.sh.coefficients[e],y);else if(t.isDirectionalLight){const e=n.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*b),t.castShadow){const e=t.shadow,n=i.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,s.directionalShadow[h]=n,s.directionalShadowMap[h]=M,s.directionalShadowMatrix[h]=t.shadow.matrix,f++}s.directional[h]=e,h++}else if(t.isSpotLight){const e=n.get(t);e.position.setFromMatrixPosition(t.matrixWorld),e.color.copy(a).multiplyScalar(y*b),e.distance=x,e.coneCos=Math.cos(t.angle),e.penumbraCos=Math.cos(t.angle*(1-t.penumbra)),e.decay=t.decay,s.spot[d]=e;const r=t.shadow;if(t.map&&(s.spotLightMap[_]=t.map,_++,r.updateMatrices(t),t.castShadow&&w++),s.spotLightMatrix[d]=r.matrix,t.castShadow){const e=i.get(t);e.shadowBias=r.bias,e.shadowNormalBias=r.normalBias,e.shadowRadius=r.radius,e.shadowMapSize=r.mapSize,s.spotShadow[d]=e,s.spotShadowMap[d]=M,g++}d++}else if(t.isRectAreaLight){const e=n.get(t);e.color.copy(a).multiplyScalar(y),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),s.rectArea[p]=e,p++}else if(t.isPointLight){const e=n.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*b),e.distance=t.distance,e.decay=t.decay,t.castShadow){const e=t.shadow,n=i.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,n.shadowCameraNear=e.camera.near,n.shadowCameraFar=e.camera.far,s.pointShadow[u]=n,s.pointShadowMap[u]=M,s.pointShadowMatrix[u]=t.shadow.matrix,v++}s.point[u]=e,u++}else if(t.isHemisphereLight){const e=n.get(t);e.skyColor.copy(t.color).multiplyScalar(y*b),e.groundColor.copy(t.groundColor).multiplyScalar(y*b),s.hemi[m]=e,m++}}p>0&&(t.isWebGL2||!0===e.has("OES_texture_float_linear")?(s.rectAreaLTC1=da.LTC_FLOAT_1,s.rectAreaLTC2=da.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")?(s.rectAreaLTC1=da.LTC_HALF_1,s.rectAreaLTC2=da.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),s.ambient[0]=o,s.ambient[1]=l,s.ambient[2]=c;const y=s.hash;y.directionalLength===h&&y.pointLength===u&&y.spotLength===d&&y.rectAreaLength===p&&y.hemiLength===m&&y.numDirectionalShadows===f&&y.numPointShadows===v&&y.numSpotShadows===g&&y.numSpotMaps===_||(s.directional.length=h,s.spot.length=d,s.rectArea.length=p,s.point.length=u,s.hemi.length=m,s.directionalShadow.length=f,s.directionalShadowMap.length=f,s.pointShadow.length=v,s.pointShadowMap.length=v,s.spotShadow.length=g,s.spotShadowMap.length=g,s.directionalShadowMatrix.length=f,s.pointShadowMatrix.length=v,s.spotLightMatrix.length=g+_-w,s.spotLightMap.length=_,s.numSpotLightShadowsWithMaps=w,y.directionalLength=h,y.pointLength=u,y.spotLength=d,y.rectAreaLength=p,y.hemiLength=m,y.numDirectionalShadows=f,y.numPointShadows=v,y.numSpotShadows=g,y.numSpotMaps=_,s.version=Ml++)},setupView:function(e,t){let n=0,i=0,l=0,c=0,h=0;const u=t.matrixWorldInverse;for(let t=0,d=e.length;t<d;t++){const d=e[t];if(d.isDirectionalLight){const e=s.directional[n];e.direction.setFromMatrixPosition(d.matrixWorld),r.setFromMatrixPosition(d.target.matrixWorld),e.direction.sub(r),e.direction.transformDirection(u),n++}else if(d.isSpotLight){const e=s.spot[l];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(u),e.direction.setFromMatrixPosition(d.matrixWorld),r.setFromMatrixPosition(d.target.matrixWorld),e.direction.sub(r),e.direction.transformDirection(u),l++}else if(d.isRectAreaLight){const e=s.rectArea[c];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(u),o.identity(),a.copy(d.matrixWorld),a.premultiply(u),o.extractRotation(a),e.halfWidth.set(.5*d.width,0,0),e.halfHeight.set(0,.5*d.height,0),e.halfWidth.applyMatrix4(o),e.halfHeight.applyMatrix4(o),c++}else if(d.isPointLight){const e=s.point[i];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(u),i++}else if(d.isHemisphereLight){const e=s.hemi[h];e.direction.setFromMatrixPosition(d.matrixWorld),e.direction.transformDirection(u),h++}}},state:s}}function Cl(e,t){const n=new Sl(e,t),i=[],s=[];return{init:function(){i.length=0,s.length=0},state:{lightsArray:i,shadowsArray:s,lights:n},setupLights:function(e){n.setup(i,e)},setupLightsView:function(e){n.setupView(i,e)},pushLight:function(e){i.push(e)},pushShadow:function(e){s.push(e)}}}function Tl(e,t){let n=new WeakMap;return{get:function(i,s=0){const r=n.get(i);let a;return void 0===r?(a=new Cl(e,t),n.set(i,[a])):s>=r.length?(a=new Cl(e,t),r.push(a)):a=r[s],a},dispose:function(){n=new WeakMap}}}class Pl extends js{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=Gt,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class Al extends js{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}function Ll(e,t,n){let i=new oa;const s=new Zn,r=new Zn,a=new bi,o=new Pl({depthPacking:jt}),l=new Al,c={},h=n.maxTextureSize,u={[y]:x,[x]:y,[M]:M},d=new Kr({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Zn},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),p=d.clone();p.defines.HORIZONTAL_PASS=1;const m=new Mr;m.setAttribute("position",new rr(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const f=new zr(m,d),v=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=_;let g=this.type;function w(n,i){const r=t.update(f);d.defines.VSM_SAMPLES!==n.blurSamples&&(d.defines.VSM_SAMPLES=n.blurSamples,p.defines.VSM_SAMPLES=n.blurSamples,d.needsUpdate=!0,p.needsUpdate=!0),null===n.mapPass&&(n.mapPass=new xi(s.x,s.y)),d.uniforms.shadow_pass.value=n.map.texture,d.uniforms.resolution.value=n.mapSize,d.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(i,null,r,d,f,null),p.uniforms.shadow_pass.value=n.mapPass.texture,p.uniforms.resolution.value=n.mapSize,p.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(i,null,r,p,f,null)}function E(t,n,i,s){let r=null;const a=!0===i.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(void 0!==a)r=a;else if(r=!0===i.isPointLight?l:o,e.localClippingEnabled&&!0===n.clipShadows&&Array.isArray(n.clippingPlanes)&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0||n.map&&n.alphaTest>0){const e=r.uuid,t=n.uuid;let i=c[e];void 0===i&&(i={},c[e]=i);let s=i[t];void 0===s&&(s=r.clone(),i[t]=s),r=s}if(r.visible=n.visible,r.wireframe=n.wireframe,r.side=s===b?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:u[n.side],r.alphaMap=n.alphaMap,r.alphaTest=n.alphaTest,r.map=n.map,r.clipShadows=n.clipShadows,r.clippingPlanes=n.clippingPlanes,r.clipIntersection=n.clipIntersection,r.displacementMap=n.displacementMap,r.displacementScale=n.displacementScale,r.displacementBias=n.displacementBias,r.wireframeLinewidth=n.wireframeLinewidth,r.linewidth=n.linewidth,!0===i.isPointLight&&!0===r.isMeshDistanceMaterial){e.properties.get(r).light=i}return r}function C(n,s,r,a,o){if(!1===n.visible)return;if(n.layers.test(s.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&o===b)&&(!n.frustumCulled||i.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,n.matrixWorld);const i=t.update(n),s=n.material;if(Array.isArray(s)){const t=i.groups;for(let l=0,c=t.length;l<c;l++){const c=t[l],h=s[c.materialIndex];if(h&&h.visible){const t=E(n,h,a,o);e.renderBufferDirect(r,null,i,t,n,c)}}}else if(s.visible){const t=E(n,s,a,o);e.renderBufferDirect(r,null,i,t,n,null)}}const l=n.children;for(let e=0,t=l.length;e<t;e++)C(l[e],s,r,a,o)}this.render=function(t,n,o){if(!1===v.enabled)return;if(!1===v.autoUpdate&&!1===v.needsUpdate)return;if(0===t.length)return;const l=e.getRenderTarget(),c=e.getActiveCubeFace(),u=e.getActiveMipmapLevel(),d=e.state;d.setBlending(S),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);const p=g!==b&&this.type===b,m=g===b&&this.type!==b;for(let l=0,c=t.length;l<c;l++){const c=t[l],u=c.shadow;if(void 0===u){console.warn("THREE.WebGLShadowMap:",c,"has no shadow.");continue}if(!1===u.autoUpdate&&!1===u.needsUpdate)continue;s.copy(u.mapSize);const f=u.getFrameExtents();if(s.multiply(f),r.copy(u.mapSize),(s.x>h||s.y>h)&&(s.x>h&&(r.x=Math.floor(h/f.x),s.x=r.x*f.x,u.mapSize.x=r.x),s.y>h&&(r.y=Math.floor(h/f.y),s.y=r.y*f.y,u.mapSize.y=r.y)),null===u.map||!0===p||!0===m){const e=this.type!==b?{minFilter:we,magFilter:we}:{};null!==u.map&&u.map.dispose(),u.map=new xi(s.x,s.y,e),u.map.texture.name=c.name+".shadowMap",u.camera.updateProjectionMatrix()}e.setRenderTarget(u.map),e.clear();const v=u.getViewportCount();for(let e=0;e<v;e++){const t=u.getViewport(e);a.set(r.x*t.x,r.y*t.y,r.x*t.z,r.y*t.w),d.viewport(a),u.updateMatrices(c,e),i=u.getFrustum(),C(n,o,u.camera,c,this.type)}!0!==u.isPointLightShadow&&this.type===b&&w(u,o),u.needsUpdate=!1}g=this.type,v.needsUpdate=!1,e.setRenderTarget(l,c,u)}}function Rl(e,t,n){const i=n.isWebGL2;const s=new function(){let t=!1;const n=new bi;let i=null;const s=new bi(0,0,0,0);return{setMask:function(n){i===n||t||(e.colorMask(n,n,n,n),i=n)},setLocked:function(e){t=e},setClear:function(t,i,r,a,o){!0===o&&(t*=a,i*=a,r*=a),n.set(t,i,r,a),!1===s.equals(n)&&(e.clearColor(t,i,r,a),s.copy(n))},reset:function(){t=!1,i=null,s.set(-1,0,0,0)}}},r=new function(){let t=!1,n=null,i=null,s=null;return{setTest:function(t){t?ye(e.DEPTH_TEST):xe(e.DEPTH_TEST)},setMask:function(i){n===i||t||(e.depthMask(i),n=i)},setFunc:function(t){if(i!==t){switch(t){case X:e.depthFunc(e.NEVER);break;case K:e.depthFunc(e.ALWAYS);break;case Y:e.depthFunc(e.LESS);break;case $:e.depthFunc(e.LEQUAL);break;case Z:e.depthFunc(e.EQUAL);break;case J:e.depthFunc(e.GEQUAL);break;case Q:e.depthFunc(e.GREATER);break;case ee:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.LEQUAL)}i=t}},setLocked:function(e){t=e},setClear:function(t){s!==t&&(e.clearDepth(t),s=t)},reset:function(){t=!1,n=null,i=null,s=null}}},a=new function(){let t=!1,n=null,i=null,s=null,r=null,a=null,o=null,l=null,c=null;return{setTest:function(n){t||(n?ye(e.STENCIL_TEST):xe(e.STENCIL_TEST))},setMask:function(i){n===i||t||(e.stencilMask(i),n=i)},setFunc:function(t,n,a){i===t&&s===n&&r===a||(e.stencilFunc(t,n,a),i=t,s=n,r=a)},setOp:function(t,n,i){a===t&&o===n&&l===i||(e.stencilOp(t,n,i),a=t,o=n,l=i)},setLocked:function(e){t=e},setClear:function(t){c!==t&&(e.clearStencil(t),c=t)},reset:function(){t=!1,n=null,i=null,s=null,r=null,a=null,o=null,l=null,c=null}}},o=new WeakMap,l=new WeakMap;let c={},h={},u=new WeakMap,d=[],v=null,g=!1,_=null,w=null,b=null,y=null,E=null,te=null,ne=null,ie=!1,se=null,re=null,ae=null,oe=null,le=null;const ce=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let he=!1,ue=0;const de=e.getParameter(e.VERSION);-1!==de.indexOf("WebGL")?(ue=parseFloat(/^WebGL (\d)/.exec(de)[1]),he=ue>=1):-1!==de.indexOf("OpenGL ES")&&(ue=parseFloat(/^OpenGL ES (\d)/.exec(de)[1]),he=ue>=2);let pe=null,me={};const fe=e.getParameter(e.SCISSOR_BOX),ve=e.getParameter(e.VIEWPORT),ge=(new bi).fromArray(fe),_e=(new bi).fromArray(ve);function we(t,n,s,r){const a=new Uint8Array(4),o=e.createTexture();e.bindTexture(t,o),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.NEAREST);for(let o=0;o<s;o++)!i||t!==e.TEXTURE_3D&&t!==e.TEXTURE_2D_ARRAY?e.texImage2D(n+o,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,a):e.texImage3D(n,0,e.RGBA,1,1,r,0,e.RGBA,e.UNSIGNED_BYTE,a);return o}const be={};function ye(t){!0!==c[t]&&(e.enable(t),c[t]=!0)}function xe(t){!1!==c[t]&&(e.disable(t),c[t]=!1)}be[e.TEXTURE_2D]=we(e.TEXTURE_2D,e.TEXTURE_2D,1),be[e.TEXTURE_CUBE_MAP]=we(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),i&&(be[e.TEXTURE_2D_ARRAY]=we(e.TEXTURE_2D_ARRAY,e.TEXTURE_2D_ARRAY,1,1),be[e.TEXTURE_3D]=we(e.TEXTURE_3D,e.TEXTURE_3D,1,1)),s.setClear(0,0,0,1),r.setClear(1),a.setClear(0),ye(e.DEPTH_TEST),r.setFunc($),Ce(!1),Te(m),ye(e.CULL_FACE),Se(S);const Me={[R]:e.FUNC_ADD,[D]:e.FUNC_SUBTRACT,[I]:e.FUNC_REVERSE_SUBTRACT};if(i)Me[k]=e.MIN,Me[O]=e.MAX;else{const e=t.get("EXT_blend_minmax");null!==e&&(Me[k]=e.MIN_EXT,Me[O]=e.MAX_EXT)}const Ee={[N]:e.ZERO,[U]:e.ONE,[V]:e.SRC_COLOR,[F]:e.SRC_ALPHA,[q]:e.SRC_ALPHA_SATURATE,[j]:e.DST_COLOR,[H]:e.DST_ALPHA,[B]:e.ONE_MINUS_SRC_COLOR,[z]:e.ONE_MINUS_SRC_ALPHA,[W]:e.ONE_MINUS_DST_COLOR,[G]:e.ONE_MINUS_DST_ALPHA};function Se(t,n,i,s,r,a,o,l){if(t!==S){if(!1===g&&(ye(e.BLEND),g=!0),t===L)r=r||n,a=a||i,o=o||s,n===w&&r===E||(e.blendEquationSeparate(Me[n],Me[r]),w=n,E=r),i===b&&s===y&&a===te&&o===ne||(e.blendFuncSeparate(Ee[i],Ee[s],Ee[a],Ee[o]),b=i,y=s,te=a,ne=o),_=t,ie=!1;else if(t!==_||l!==ie){if(w===R&&E===R||(e.blendEquation(e.FUNC_ADD),w=R,E=R),l)switch(t){case C:e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case T:e.blendFunc(e.ONE,e.ONE);break;case P:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case A:e.blendFuncSeparate(e.ZERO,e.SRC_COLOR,e.ZERO,e.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case C:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case T:e.blendFunc(e.SRC_ALPHA,e.ONE);break;case P:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case A:e.blendFunc(e.ZERO,e.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}b=null,y=null,te=null,ne=null,_=t,ie=l}}else!0===g&&(xe(e.BLEND),g=!1)}function Ce(t){se!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),se=t)}function Te(t){t!==p?(ye(e.CULL_FACE),t!==re&&(t===m?e.cullFace(e.BACK):t===f?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):xe(e.CULL_FACE),re=t}function Pe(t,n,i){t?(ye(e.POLYGON_OFFSET_FILL),oe===n&&le===i||(e.polygonOffset(n,i),oe=n,le=i)):xe(e.POLYGON_OFFSET_FILL)}return{buffers:{color:s,depth:r,stencil:a},enable:ye,disable:xe,bindFramebuffer:function(t,n){return h[t]!==n&&(e.bindFramebuffer(t,n),h[t]=n,i&&(t===e.DRAW_FRAMEBUFFER&&(h[e.FRAMEBUFFER]=n),t===e.FRAMEBUFFER&&(h[e.DRAW_FRAMEBUFFER]=n)),!0)},drawBuffers:function(i,s){let r=d,a=!1;if(i)if(r=u.get(s),void 0===r&&(r=[],u.set(s,r)),i.isWebGLMultipleRenderTargets){const t=i.texture;if(r.length!==t.length||r[0]!==e.COLOR_ATTACHMENT0){for(let n=0,i=t.length;n<i;n++)r[n]=e.COLOR_ATTACHMENT0+n;r.length=t.length,a=!0}}else r[0]!==e.COLOR_ATTACHMENT0&&(r[0]=e.COLOR_ATTACHMENT0,a=!0);else r[0]!==e.BACK&&(r[0]=e.BACK,a=!0);a&&(n.isWebGL2?e.drawBuffers(r):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(r))},useProgram:function(t){return v!==t&&(e.useProgram(t),v=t,!0)},setBlending:Se,setMaterial:function(t,n){t.side===M?xe(e.CULL_FACE):ye(e.CULL_FACE);let i=t.side===x;n&&(i=!i),Ce(i),t.blending===C&&!1===t.transparent?Se(S):Se(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),r.setFunc(t.depthFunc),r.setTest(t.depthTest),r.setMask(t.depthWrite),s.setMask(t.colorWrite);const o=t.stencilWrite;a.setTest(o),o&&(a.setMask(t.stencilWriteMask),a.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),a.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),Pe(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),!0===t.alphaToCoverage?ye(e.SAMPLE_ALPHA_TO_COVERAGE):xe(e.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:Ce,setCullFace:Te,setLineWidth:function(t){t!==ae&&(he&&e.lineWidth(t),ae=t)},setPolygonOffset:Pe,setScissorTest:function(t){t?ye(e.SCISSOR_TEST):xe(e.SCISSOR_TEST)},activeTexture:function(t){void 0===t&&(t=e.TEXTURE0+ce-1),pe!==t&&(e.activeTexture(t),pe=t)},bindTexture:function(t,n,i){void 0===i&&(i=null===pe?e.TEXTURE0+ce-1:pe);let s=me[i];void 0===s&&(s={type:void 0,texture:void 0},me[i]=s),s.type===t&&s.texture===n||(pe!==i&&(e.activeTexture(i),pe=i),e.bindTexture(t,n||be[t]),s.type=t,s.texture=n)},unbindTexture:function(){const t=me[pe];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexImage3D:function(){try{e.compressedTexImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},updateUBOMapping:function(t,n){let i=l.get(n);void 0===i&&(i=new WeakMap,l.set(n,i));let s=i.get(t);void 0===s&&(s=e.getUniformBlockIndex(n,t.name),i.set(t,s))},uniformBlockBinding:function(t,n){const i=l.get(n).get(t);o.get(n)!==i&&(e.uniformBlockBinding(n,i,t.__bindingPointIndex),o.set(n,i))},texStorage2D:function(){try{e.texStorage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texStorage3D:function(){try{e.texStorage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage2D:function(){try{e.texSubImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage3D:function(){try{e.texSubImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexSubImage2D:function(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexSubImage3D:function(){try{e.compressedTexSubImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===ge.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),ge.copy(t))},viewport:function(t){!1===_e.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),_e.copy(t))},reset:function(){e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SCISSOR_TEST),e.disable(e.STENCIL_TEST),e.disable(e.SAMPLE_ALPHA_TO_COVERAGE),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.blendFuncSeparate(e.ONE,e.ZERO,e.ONE,e.ZERO),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(e.LESS),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.clearStencil(0),e.cullFace(e.BACK),e.frontFace(e.CCW),e.polygonOffset(0,0),e.activeTexture(e.TEXTURE0),e.bindFramebuffer(e.FRAMEBUFFER,null),!0===i&&(e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),e.bindFramebuffer(e.READ_FRAMEBUFFER,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),c={},pe=null,me={},h={},u=new WeakMap,d=[],v=null,g=!1,_=null,w=null,b=null,y=null,E=null,te=null,ne=null,ie=!1,se=null,re=null,ae=null,oe=null,le=null,ge.set(0,0,e.canvas.width,e.canvas.height),_e.set(0,0,e.canvas.width,e.canvas.height),s.reset(),r.reset(),a.reset()}}}function Dl(e,t,n,i,s,r,a){const o=s.isWebGL2,l=s.maxTextures,c=s.maxCubemapSize,h=s.maxTextureSize,u=s.maxSamples,d=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,p="undefined"!=typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),m=new WeakMap;let f;const v=new WeakMap;let g=!1;try{g="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function _(e,t){return g?new OffscreenCanvas(e,t):ii("canvas")}function w(e,t,n,i){let s=1;if((e.width>i||e.height>i)&&(s=i/Math.max(e.width,e.height)),s<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const i=t?Xn:Math.floor,r=i(s*e.width),a=i(s*e.height);void 0===f&&(f=_(r,a));const o=n?_(r,a):f;o.width=r,o.height=a;return o.getContext("2d").drawImage(e,0,0,r,a),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+r+"x"+a+")."),o}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function b(e){return Wn(e.width)&&Wn(e.height)}function y(e,t){return e.generateMipmaps&&t&&e.minFilter!==we&&e.minFilter!==Ee}function x(t){e.generateMipmap(t)}function M(n,i,s,r,a=!1){if(!1===o)return i;if(null!==n){if(void 0!==e[n])return e[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let l=i;return i===e.RED&&(s===e.FLOAT&&(l=e.R32F),s===e.HALF_FLOAT&&(l=e.R16F),s===e.UNSIGNED_BYTE&&(l=e.R8)),i===e.RED_INTEGER&&(s===e.UNSIGNED_BYTE&&(l=e.R8UI),s===e.UNSIGNED_SHORT&&(l=e.R16UI),s===e.UNSIGNED_INT&&(l=e.R32UI),s===e.BYTE&&(l=e.R8I),s===e.SHORT&&(l=e.R16I),s===e.INT&&(l=e.R32I)),i===e.RG&&(s===e.FLOAT&&(l=e.RG32F),s===e.HALF_FLOAT&&(l=e.RG16F),s===e.UNSIGNED_BYTE&&(l=e.RG8)),i===e.RGBA&&(s===e.FLOAT&&(l=e.RGBA32F),s===e.HALF_FLOAT&&(l=e.RGBA16F),s===e.UNSIGNED_BYTE&&(l=r===Kt&&!1===a?e.SRGB8_ALPHA8:e.RGBA8),s===e.UNSIGNED_SHORT_4_4_4_4&&(l=e.RGBA4),s===e.UNSIGNED_SHORT_5_5_5_1&&(l=e.RGB5_A1)),l!==e.R16F&&l!==e.R32F&&l!==e.RG16F&&l!==e.RG32F&&l!==e.RGBA16F&&l!==e.RGBA32F||t.get("EXT_color_buffer_float"),l}function E(e,t,n){return!0===y(e,n)||e.isFramebufferTexture&&e.minFilter!==we&&e.minFilter!==Ee?Math.log2(Math.max(t.width,t.height))+1:void 0!==e.mipmaps&&e.mipmaps.length>0?e.mipmaps.length:e.isCompressedTexture&&Array.isArray(e.image)?t.mipmaps.length:1}function S(t){return t===we||t===be||t===xe?e.NEAREST:e.LINEAR}function C(e){const t=e.target;t.removeEventListener("dispose",C),function(e){const t=i.get(e);if(void 0===t.__webglInit)return;const n=e.source,s=v.get(n);if(s){const i=s[t.__cacheKey];i.usedTimes--,0===i.usedTimes&&P(e),0===Object.keys(s).length&&v.delete(n)}i.remove(e)}(t),t.isVideoTexture&&m.delete(t)}function T(t){const n=t.target;n.removeEventListener("dispose",T),function(t){const n=t.texture,s=i.get(t),r=i.get(n);void 0!==r.__webglTexture&&(e.deleteTexture(r.__webglTexture),a.memory.textures--);t.depthTexture&&t.depthTexture.dispose();if(t.isWebGLCubeRenderTarget)for(let t=0;t<6;t++){if(Array.isArray(s.__webglFramebuffer[t]))for(let n=0;n<s.__webglFramebuffer[t].length;n++)e.deleteFramebuffer(s.__webglFramebuffer[t][n]);else e.deleteFramebuffer(s.__webglFramebuffer[t]);s.__webglDepthbuffer&&e.deleteRenderbuffer(s.__webglDepthbuffer[t])}else{if(Array.isArray(s.__webglFramebuffer))for(let t=0;t<s.__webglFramebuffer.length;t++)e.deleteFramebuffer(s.__webglFramebuffer[t]);else e.deleteFramebuffer(s.__webglFramebuffer);if(s.__webglDepthbuffer&&e.deleteRenderbuffer(s.__webglDepthbuffer),s.__webglMultisampledFramebuffer&&e.deleteFramebuffer(s.__webglMultisampledFramebuffer),s.__webglColorRenderbuffer)for(let t=0;t<s.__webglColorRenderbuffer.length;t++)s.__webglColorRenderbuffer[t]&&e.deleteRenderbuffer(s.__webglColorRenderbuffer[t]);s.__webglDepthRenderbuffer&&e.deleteRenderbuffer(s.__webglDepthRenderbuffer)}if(t.isWebGLMultipleRenderTargets)for(let t=0,s=n.length;t<s;t++){const s=i.get(n[t]);s.__webglTexture&&(e.deleteTexture(s.__webglTexture),a.memory.textures--),i.remove(n[t])}i.remove(n),i.remove(t)}(n)}function P(t){const n=i.get(t);e.deleteTexture(n.__webglTexture);const s=t.source;delete v.get(s)[n.__cacheKey],a.memory.textures--}let A=0;function L(t,s){const r=i.get(t);if(t.isVideoTexture&&function(e){const t=a.render.frame;m.get(e)!==t&&(m.set(e,t),e.update())}(t),!1===t.isRenderTargetTexture&&t.version>0&&r.__version!==t.version){const e=t.image;if(null===e)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==e.complete)return void N(r,t,s);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.bindTexture(e.TEXTURE_2D,r.__webglTexture,e.TEXTURE0+s)}const R={[ve]:e.REPEAT,[ge]:e.CLAMP_TO_EDGE,[_e]:e.MIRRORED_REPEAT},D={[we]:e.NEAREST,[be]:e.NEAREST_MIPMAP_NEAREST,[xe]:e.NEAREST_MIPMAP_LINEAR,[Ee]:e.LINEAR,[Se]:e.LINEAR_MIPMAP_NEAREST,[Te]:e.LINEAR_MIPMAP_LINEAR},I={[mn]:e.NEVER,[yn]:e.ALWAYS,[fn]:e.LESS,[gn]:e.LEQUAL,[vn]:e.EQUAL,[bn]:e.GEQUAL,[_n]:e.GREATER,[wn]:e.NOTEQUAL};function k(n,r,a){if(a?(e.texParameteri(n,e.TEXTURE_WRAP_S,R[r.wrapS]),e.texParameteri(n,e.TEXTURE_WRAP_T,R[r.wrapT]),n!==e.TEXTURE_3D&&n!==e.TEXTURE_2D_ARRAY||e.texParameteri(n,e.TEXTURE_WRAP_R,R[r.wrapR]),e.texParameteri(n,e.TEXTURE_MAG_FILTER,D[r.magFilter]),e.texParameteri(n,e.TEXTURE_MIN_FILTER,D[r.minFilter])):(e.texParameteri(n,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(n,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),n!==e.TEXTURE_3D&&n!==e.TEXTURE_2D_ARRAY||e.texParameteri(n,e.TEXTURE_WRAP_R,e.CLAMP_TO_EDGE),r.wrapS===ge&&r.wrapT===ge||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(n,e.TEXTURE_MAG_FILTER,S(r.magFilter)),e.texParameteri(n,e.TEXTURE_MIN_FILTER,S(r.minFilter)),r.minFilter!==we&&r.minFilter!==Ee&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),r.compareFunction&&(e.texParameteri(n,e.TEXTURE_COMPARE_MODE,e.COMPARE_REF_TO_TEXTURE),e.texParameteri(n,e.TEXTURE_COMPARE_FUNC,I[r.compareFunction])),!0===t.has("EXT_texture_filter_anisotropic")){const a=t.get("EXT_texture_filter_anisotropic");if(r.magFilter===we)return;if(r.minFilter!==xe&&r.minFilter!==Te)return;if(r.type===Oe&&!1===t.has("OES_texture_float_linear"))return;if(!1===o&&r.type===Ne&&!1===t.has("OES_texture_half_float_linear"))return;(r.anisotropy>1||i.get(r).__currentAnisotropy)&&(e.texParameterf(n,a.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(r.anisotropy,s.getMaxAnisotropy())),i.get(r).__currentAnisotropy=r.anisotropy)}}function O(t,n){let i=!1;void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",C));const s=n.source;let r=v.get(s);void 0===r&&(r={},v.set(s,r));const o=function(e){const t=[];return t.push(e.wrapS),t.push(e.wrapT),t.push(e.wrapR||0),t.push(e.magFilter),t.push(e.minFilter),t.push(e.anisotropy),t.push(e.internalFormat),t.push(e.format),t.push(e.type),t.push(e.generateMipmaps),t.push(e.premultiplyAlpha),t.push(e.flipY),t.push(e.unpackAlignment),t.push(e.colorSpace),t.join()}(n);if(o!==t.__cacheKey){void 0===r[o]&&(r[o]={texture:e.createTexture(),usedTimes:0},a.memory.textures++,i=!0),r[o].usedTimes++;const s=r[t.__cacheKey];void 0!==s&&(r[t.__cacheKey].usedTimes--,0===s.usedTimes&&P(n)),t.__cacheKey=o,t.__webglTexture=r[o].texture}return i}function N(t,s,a){let l=e.TEXTURE_2D;(s.isDataArrayTexture||s.isCompressedArrayTexture)&&(l=e.TEXTURE_2D_ARRAY),s.isData3DTexture&&(l=e.TEXTURE_3D);const c=O(t,s),u=s.source;n.bindTexture(l,t.__webglTexture,e.TEXTURE0+a);const d=i.get(u);if(u.version!==d.__version||!0===c){n.activeTexture(e.TEXTURE0+a),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,s.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,s.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE);const t=function(e){return!o&&(e.wrapS!==ge||e.wrapT!==ge||e.minFilter!==we&&e.minFilter!==Ee)}(s)&&!1===b(s.image);let i=w(s.image,t,!1,h);i=H(s,i);const p=b(i)||o,m=r.convert(s.format,s.colorSpace);let f,v=r.convert(s.type),g=M(s.internalFormat,m,v,s.colorSpace);k(l,s,p);const _=s.mipmaps,S=o&&!0!==s.isVideoTexture,C=void 0===d.__version||!0===c,T=E(s,i,p);if(s.isDepthTexture)g=e.DEPTH_COMPONENT,o?g=s.type===Oe?e.DEPTH_COMPONENT32F:s.type===ke?e.DEPTH_COMPONENT24:s.type===Be?e.DEPTH24_STENCIL8:e.DEPTH_COMPONENT16:s.type===Oe&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),s.format===je&&g===e.DEPTH_COMPONENT&&s.type!==De&&s.type!==ke&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),s.type=ke,v=r.convert(s.type)),s.format===We&&g===e.DEPTH_COMPONENT&&(g=e.DEPTH_STENCIL,s.type!==Be&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),s.type=Be,v=r.convert(s.type))),C&&(S?n.texStorage2D(e.TEXTURE_2D,1,g,i.width,i.height):n.texImage2D(e.TEXTURE_2D,0,g,i.width,i.height,0,m,v,null));else if(s.isDataTexture)if(_.length>0&&p){S&&C&&n.texStorage2D(e.TEXTURE_2D,T,g,_[0].width,_[0].height);for(let t=0,i=_.length;t<i;t++)f=_[t],S?n.texSubImage2D(e.TEXTURE_2D,t,0,0,f.width,f.height,m,v,f.data):n.texImage2D(e.TEXTURE_2D,t,g,f.width,f.height,0,m,v,f.data);s.generateMipmaps=!1}else S?(C&&n.texStorage2D(e.TEXTURE_2D,T,g,i.width,i.height),n.texSubImage2D(e.TEXTURE_2D,0,0,0,i.width,i.height,m,v,i.data)):n.texImage2D(e.TEXTURE_2D,0,g,i.width,i.height,0,m,v,i.data);else if(s.isCompressedTexture)if(s.isCompressedArrayTexture){S&&C&&n.texStorage3D(e.TEXTURE_2D_ARRAY,T,g,_[0].width,_[0].height,i.depth);for(let t=0,r=_.length;t<r;t++)f=_[t],s.format!==ze?null!==m?S?n.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,0,f.width,f.height,i.depth,m,f.data,0,0):n.compressedTexImage3D(e.TEXTURE_2D_ARRAY,t,g,f.width,f.height,i.depth,0,f.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):S?n.texSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,0,f.width,f.height,i.depth,m,v,f.data):n.texImage3D(e.TEXTURE_2D_ARRAY,t,g,f.width,f.height,i.depth,0,m,v,f.data)}else{S&&C&&n.texStorage2D(e.TEXTURE_2D,T,g,_[0].width,_[0].height);for(let t=0,i=_.length;t<i;t++)f=_[t],s.format!==ze?null!==m?S?n.compressedTexSubImage2D(e.TEXTURE_2D,t,0,0,f.width,f.height,m,f.data):n.compressedTexImage2D(e.TEXTURE_2D,t,g,f.width,f.height,0,f.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):S?n.texSubImage2D(e.TEXTURE_2D,t,0,0,f.width,f.height,m,v,f.data):n.texImage2D(e.TEXTURE_2D,t,g,f.width,f.height,0,m,v,f.data)}else if(s.isDataArrayTexture)S?(C&&n.texStorage3D(e.TEXTURE_2D_ARRAY,T,g,i.width,i.height,i.depth),n.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,0,i.width,i.height,i.depth,m,v,i.data)):n.texImage3D(e.TEXTURE_2D_ARRAY,0,g,i.width,i.height,i.depth,0,m,v,i.data);else if(s.isData3DTexture)S?(C&&n.texStorage3D(e.TEXTURE_3D,T,g,i.width,i.height,i.depth),n.texSubImage3D(e.TEXTURE_3D,0,0,0,0,i.width,i.height,i.depth,m,v,i.data)):n.texImage3D(e.TEXTURE_3D,0,g,i.width,i.height,i.depth,0,m,v,i.data);else if(s.isFramebufferTexture){if(C)if(S)n.texStorage2D(e.TEXTURE_2D,T,g,i.width,i.height);else{let t=i.width,s=i.height;for(let i=0;i<T;i++)n.texImage2D(e.TEXTURE_2D,i,g,t,s,0,m,v,null),t>>=1,s>>=1}}else if(_.length>0&&p){S&&C&&n.texStorage2D(e.TEXTURE_2D,T,g,_[0].width,_[0].height);for(let t=0,i=_.length;t<i;t++)f=_[t],S?n.texSubImage2D(e.TEXTURE_2D,t,0,0,m,v,f):n.texImage2D(e.TEXTURE_2D,t,g,m,v,f);s.generateMipmaps=!1}else S?(C&&n.texStorage2D(e.TEXTURE_2D,T,g,i.width,i.height),n.texSubImage2D(e.TEXTURE_2D,0,0,0,m,v,i)):n.texImage2D(e.TEXTURE_2D,0,g,m,v,i);y(s,p)&&x(l),d.__version=u.version,s.onUpdate&&s.onUpdate(s)}t.__version=s.version}function U(t,s,a,o,l,c){const h=r.convert(a.format,a.colorSpace),u=r.convert(a.type),p=M(a.internalFormat,h,u,a.colorSpace);if(!i.get(s).__hasExternalTextures){const t=Math.max(1,s.width>>c),i=Math.max(1,s.height>>c);l===e.TEXTURE_3D||l===e.TEXTURE_2D_ARRAY?n.texImage3D(l,c,p,t,i,s.depth,0,h,u,null):n.texImage2D(l,c,p,t,i,0,h,u,null)}n.bindFramebuffer(e.FRAMEBUFFER,t),z(s)?d.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,o,l,i.get(a).__webglTexture,0,F(s)):(l===e.TEXTURE_2D||l>=e.TEXTURE_CUBE_MAP_POSITIVE_X&&l<=e.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&e.framebufferTexture2D(e.FRAMEBUFFER,o,l,i.get(a).__webglTexture,c),n.bindFramebuffer(e.FRAMEBUFFER,null)}function V(t,n,i){if(e.bindRenderbuffer(e.RENDERBUFFER,t),n.depthBuffer&&!n.stencilBuffer){let s=e.DEPTH_COMPONENT16;if(i||z(n)){const t=n.depthTexture;t&&t.isDepthTexture&&(t.type===Oe?s=e.DEPTH_COMPONENT32F:t.type===ke&&(s=e.DEPTH_COMPONENT24));const i=F(n);z(n)?d.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,i,s,n.width,n.height):e.renderbufferStorageMultisample(e.RENDERBUFFER,i,s,n.width,n.height)}else e.renderbufferStorage(e.RENDERBUFFER,s,n.width,n.height);e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t)}else if(n.depthBuffer&&n.stencilBuffer){const s=F(n);i&&!1===z(n)?e.renderbufferStorageMultisample(e.RENDERBUFFER,s,e.DEPTH24_STENCIL8,n.width,n.height):z(n)?d.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,s,e.DEPTH24_STENCIL8,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,n.width,n.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,t)}else{const t=!0===n.isWebGLMultipleRenderTargets?n.texture:[n.texture];for(let s=0;s<t.length;s++){const a=t[s],o=r.convert(a.format,a.colorSpace),l=r.convert(a.type),c=M(a.internalFormat,o,l,a.colorSpace),h=F(n);i&&!1===z(n)?e.renderbufferStorageMultisample(e.RENDERBUFFER,h,c,n.width,n.height):z(n)?d.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,h,c,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,c,n.width,n.height)}}e.bindRenderbuffer(e.RENDERBUFFER,null)}function B(t){const s=i.get(t),r=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture&&!s.__autoAllocateDepthBuffer){if(r)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,s){if(s&&s.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(e.FRAMEBUFFER,t),!s.depthTexture||!s.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");i.get(s.depthTexture).__webglTexture&&s.depthTexture.image.width===s.width&&s.depthTexture.image.height===s.height||(s.depthTexture.image.width=s.width,s.depthTexture.image.height=s.height,s.depthTexture.needsUpdate=!0),L(s.depthTexture,0);const r=i.get(s.depthTexture).__webglTexture,a=F(s);if(s.depthTexture.format===je)z(s)?d.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,r,0,a):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,r,0);else{if(s.depthTexture.format!==We)throw new Error("Unknown depthTexture format");z(s)?d.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,r,0,a):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,r,0)}}(s.__webglFramebuffer,t)}else if(r){s.__webglDepthbuffer=[];for(let i=0;i<6;i++)n.bindFramebuffer(e.FRAMEBUFFER,s.__webglFramebuffer[i]),s.__webglDepthbuffer[i]=e.createRenderbuffer(),V(s.__webglDepthbuffer[i],t,!1)}else n.bindFramebuffer(e.FRAMEBUFFER,s.__webglFramebuffer),s.__webglDepthbuffer=e.createRenderbuffer(),V(s.__webglDepthbuffer,t,!1);n.bindFramebuffer(e.FRAMEBUFFER,null)}function F(e){return Math.min(u,e.samples)}function z(e){const n=i.get(e);return o&&e.samples>0&&!0===t.has("WEBGL_multisampled_render_to_texture")&&!1!==n.__useRenderToTexture}function H(e,n){const i=e.colorSpace,s=e.format,r=e.type;return!0===e.isCompressedTexture||e.format===In||i!==Yt&&i!==Xt&&(i===Kt?!1===o?!0===t.has("EXT_sRGB")&&s===ze?(e.format=In,e.minFilter=Ee,e.generateMipmaps=!1):n=mi.sRGBToLinear(n):s===ze&&r===Ae||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",i)),n}this.allocateTextureUnit=function(){const e=A;return e>=l&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+l),A+=1,e},this.resetTextureUnits=function(){A=0},this.setTexture2D=L,this.setTexture2DArray=function(t,s){const r=i.get(t);t.version>0&&r.__version!==t.version?N(r,t,s):n.bindTexture(e.TEXTURE_2D_ARRAY,r.__webglTexture,e.TEXTURE0+s)},this.setTexture3D=function(t,s){const r=i.get(t);t.version>0&&r.__version!==t.version?N(r,t,s):n.bindTexture(e.TEXTURE_3D,r.__webglTexture,e.TEXTURE0+s)},this.setTextureCube=function(t,s){const a=i.get(t);t.version>0&&a.__version!==t.version?function(t,s,a){if(6!==s.image.length)return;const l=O(t,s),h=s.source;n.bindTexture(e.TEXTURE_CUBE_MAP,t.__webglTexture,e.TEXTURE0+a);const u=i.get(h);if(h.version!==u.__version||!0===l){n.activeTexture(e.TEXTURE0+a),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,s.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,s.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE);const t=s.isCompressedTexture||s.image[0].isCompressedTexture,i=s.image[0]&&s.image[0].isDataTexture,d=[];for(let e=0;e<6;e++)d[e]=t||i?i?s.image[e].image:s.image[e]:w(s.image[e],!1,!0,c),d[e]=H(s,d[e]);const p=d[0],m=b(p)||o,f=r.convert(s.format,s.colorSpace),v=r.convert(s.type),g=M(s.internalFormat,f,v,s.colorSpace),_=o&&!0!==s.isVideoTexture,S=void 0===u.__version||!0===l;let C,T=E(s,p,m);if(k(e.TEXTURE_CUBE_MAP,s,m),t){_&&S&&n.texStorage2D(e.TEXTURE_CUBE_MAP,T,g,p.width,p.height);for(let t=0;t<6;t++){C=d[t].mipmaps;for(let i=0;i<C.length;i++){const r=C[i];s.format!==ze?null!==f?_?n.compressedTexSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i,0,0,r.width,r.height,f,r.data):n.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i,g,r.width,r.height,0,r.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):_?n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i,0,0,r.width,r.height,f,v,r.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i,g,r.width,r.height,0,f,v,r.data)}}}else{C=s.mipmaps,_&&S&&(C.length>0&&T++,n.texStorage2D(e.TEXTURE_CUBE_MAP,T,g,d[0].width,d[0].height));for(let t=0;t<6;t++)if(i){_?n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,d[t].width,d[t].height,f,v,d[t].data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,g,d[t].width,d[t].height,0,f,v,d[t].data);for(let i=0;i<C.length;i++){const s=C[i].image[t].image;_?n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i+1,0,0,s.width,s.height,f,v,s.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i+1,g,s.width,s.height,0,f,v,s.data)}}else{_?n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,f,v,d[t]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,g,f,v,d[t]);for(let i=0;i<C.length;i++){const s=C[i];_?n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i+1,0,0,f,v,s.image[t]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i+1,g,f,v,s.image[t])}}}y(s,m)&&x(e.TEXTURE_CUBE_MAP),u.__version=h.version,s.onUpdate&&s.onUpdate(s)}t.__version=s.version}(a,t,s):n.bindTexture(e.TEXTURE_CUBE_MAP,a.__webglTexture,e.TEXTURE0+s)},this.rebindTextures=function(t,n,s){const r=i.get(t);void 0!==n&&U(r.__webglFramebuffer,t,t.texture,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,0),void 0!==s&&B(t)},this.setupRenderTarget=function(t){const l=t.texture,c=i.get(t),h=i.get(l);t.addEventListener("dispose",T),!0!==t.isWebGLMultipleRenderTargets&&(void 0===h.__webglTexture&&(h.__webglTexture=e.createTexture()),h.__version=l.version,a.memory.textures++);const u=!0===t.isWebGLCubeRenderTarget,d=!0===t.isWebGLMultipleRenderTargets,p=b(t)||o;if(u){c.__webglFramebuffer=[];for(let t=0;t<6;t++)if(o&&l.mipmaps&&l.mipmaps.length>0){c.__webglFramebuffer[t]=[];for(let n=0;n<l.mipmaps.length;n++)c.__webglFramebuffer[t][n]=e.createFramebuffer()}else c.__webglFramebuffer[t]=e.createFramebuffer()}else{if(o&&l.mipmaps&&l.mipmaps.length>0){c.__webglFramebuffer=[];for(let t=0;t<l.mipmaps.length;t++)c.__webglFramebuffer[t]=e.createFramebuffer()}else c.__webglFramebuffer=e.createFramebuffer();if(d)if(s.drawBuffers){const n=t.texture;for(let t=0,s=n.length;t<s;t++){const s=i.get(n[t]);void 0===s.__webglTexture&&(s.__webglTexture=e.createTexture(),a.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(o&&t.samples>0&&!1===z(t)){const i=d?l:[l];c.__webglMultisampledFramebuffer=e.createFramebuffer(),c.__webglColorRenderbuffer=[],n.bindFramebuffer(e.FRAMEBUFFER,c.__webglMultisampledFramebuffer);for(let n=0;n<i.length;n++){const s=i[n];c.__webglColorRenderbuffer[n]=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,c.__webglColorRenderbuffer[n]);const a=r.convert(s.format,s.colorSpace),o=r.convert(s.type),l=M(s.internalFormat,a,o,s.colorSpace,!0===t.isXRRenderTarget),h=F(t);e.renderbufferStorageMultisample(e.RENDERBUFFER,h,l,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+n,e.RENDERBUFFER,c.__webglColorRenderbuffer[n])}e.bindRenderbuffer(e.RENDERBUFFER,null),t.depthBuffer&&(c.__webglDepthRenderbuffer=e.createRenderbuffer(),V(c.__webglDepthRenderbuffer,t,!0)),n.bindFramebuffer(e.FRAMEBUFFER,null)}}if(u){n.bindTexture(e.TEXTURE_CUBE_MAP,h.__webglTexture),k(e.TEXTURE_CUBE_MAP,l,p);for(let n=0;n<6;n++)if(o&&l.mipmaps&&l.mipmaps.length>0)for(let i=0;i<l.mipmaps.length;i++)U(c.__webglFramebuffer[n][i],t,l,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+n,i);else U(c.__webglFramebuffer[n],t,l,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+n,0);y(l,p)&&x(e.TEXTURE_CUBE_MAP),n.unbindTexture()}else if(d){const s=t.texture;for(let r=0,a=s.length;r<a;r++){const a=s[r],o=i.get(a);n.bindTexture(e.TEXTURE_2D,o.__webglTexture),k(e.TEXTURE_2D,a,p),U(c.__webglFramebuffer,t,a,e.COLOR_ATTACHMENT0+r,e.TEXTURE_2D,0),y(a,p)&&x(e.TEXTURE_2D)}n.unbindTexture()}else{let i=e.TEXTURE_2D;if((t.isWebGL3DRenderTarget||t.isWebGLArrayRenderTarget)&&(o?i=t.isWebGL3DRenderTarget?e.TEXTURE_3D:e.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),n.bindTexture(i,h.__webglTexture),k(i,l,p),o&&l.mipmaps&&l.mipmaps.length>0)for(let n=0;n<l.mipmaps.length;n++)U(c.__webglFramebuffer[n],t,l,e.COLOR_ATTACHMENT0,i,n);else U(c.__webglFramebuffer,t,l,e.COLOR_ATTACHMENT0,i,0);y(l,p)&&x(i),n.unbindTexture()}t.depthBuffer&&B(t)},this.updateRenderTargetMipmap=function(t){const s=b(t)||o,r=!0===t.isWebGLMultipleRenderTargets?t.texture:[t.texture];for(let a=0,o=r.length;a<o;a++){const o=r[a];if(y(o,s)){const s=t.isWebGLCubeRenderTarget?e.TEXTURE_CUBE_MAP:e.TEXTURE_2D,r=i.get(o).__webglTexture;n.bindTexture(s,r),x(s),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(t){if(o&&t.samples>0&&!1===z(t)){const s=t.isWebGLMultipleRenderTargets?t.texture:[t.texture],r=t.width,a=t.height;let o=e.COLOR_BUFFER_BIT;const l=[],c=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,h=i.get(t),u=!0===t.isWebGLMultipleRenderTargets;if(u)for(let t=0;t<s.length;t++)n.bindFramebuffer(e.FRAMEBUFFER,h.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,null),n.bindFramebuffer(e.FRAMEBUFFER,h.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,null,0);n.bindFramebuffer(e.READ_FRAMEBUFFER,h.__webglMultisampledFramebuffer),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,h.__webglFramebuffer);for(let n=0;n<s.length;n++){l.push(e.COLOR_ATTACHMENT0+n),t.depthBuffer&&l.push(c);const d=void 0!==h.__ignoreDepthValues&&h.__ignoreDepthValues;if(!1===d&&(t.depthBuffer&&(o|=e.DEPTH_BUFFER_BIT),t.stencilBuffer&&(o|=e.STENCIL_BUFFER_BIT)),u&&e.framebufferRenderbuffer(e.READ_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,h.__webglColorRenderbuffer[n]),!0===d&&(e.invalidateFramebuffer(e.READ_FRAMEBUFFER,[c]),e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,[c])),u){const t=i.get(s[n]).__webglTexture;e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)}e.blitFramebuffer(0,0,r,a,0,0,r,a,o,e.NEAREST),p&&e.invalidateFramebuffer(e.READ_FRAMEBUFFER,l)}if(n.bindFramebuffer(e.READ_FRAMEBUFFER,null),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),u)for(let t=0;t<s.length;t++){n.bindFramebuffer(e.FRAMEBUFFER,h.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,h.__webglColorRenderbuffer[t]);const r=i.get(s[t]).__webglTexture;n.bindFramebuffer(e.FRAMEBUFFER,h.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,r,0)}n.bindFramebuffer(e.DRAW_FRAMEBUFFER,h.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=B,this.setupFrameBufferTexture=U,this.useMultisampledRTT=z}function Il(e,t,n){const i=n.isWebGL2;return{convert:function(n,s=Xt){let r;if(n===Ae)return e.UNSIGNED_BYTE;if(n===Ue)return e.UNSIGNED_SHORT_4_4_4_4;if(n===Ve)return e.UNSIGNED_SHORT_5_5_5_1;if(n===Le)return e.BYTE;if(n===Re)return e.SHORT;if(n===De)return e.UNSIGNED_SHORT;if(n===Ie)return e.INT;if(n===ke)return e.UNSIGNED_INT;if(n===Oe)return e.FLOAT;if(n===Ne)return i?e.HALF_FLOAT:(r=t.get("OES_texture_half_float"),null!==r?r.HALF_FLOAT_OES:null);if(n===Fe)return e.ALPHA;if(n===ze)return e.RGBA;if(n===He)return e.LUMINANCE;if(n===Ge)return e.LUMINANCE_ALPHA;if(n===je)return e.DEPTH_COMPONENT;if(n===We)return e.DEPTH_STENCIL;if(n===In)return r=t.get("EXT_sRGB"),null!==r?r.SRGB_ALPHA_EXT:null;if(n===qe)return e.RED;if(n===Xe)return e.RED_INTEGER;if(n===Ke)return e.RG;if(n===Ye)return e.RG_INTEGER;if(n===$e)return e.RGBA_INTEGER;if(n===Ze||n===Je||n===Qe||n===et)if(s===Kt){if(r=t.get("WEBGL_compressed_texture_s3tc_srgb"),null===r)return null;if(n===Ze)return r.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===Je)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===Qe)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===et)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(r=t.get("WEBGL_compressed_texture_s3tc"),null===r)return null;if(n===Ze)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===Je)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===Qe)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===et)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(n===tt||n===nt||n===it||n===st){if(r=t.get("WEBGL_compressed_texture_pvrtc"),null===r)return null;if(n===tt)return r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===nt)return r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===it)return r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===st)return r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(n===rt)return r=t.get("WEBGL_compressed_texture_etc1"),null!==r?r.COMPRESSED_RGB_ETC1_WEBGL:null;if(n===at||n===ot){if(r=t.get("WEBGL_compressed_texture_etc"),null===r)return null;if(n===at)return s===Kt?r.COMPRESSED_SRGB8_ETC2:r.COMPRESSED_RGB8_ETC2;if(n===ot)return s===Kt?r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC}if(n===lt||n===ct||n===ht||n===ut||n===dt||n===pt||n===mt||n===ft||n===vt||n===gt||n===_t||n===wt||n===bt||n===yt){if(r=t.get("WEBGL_compressed_texture_astc"),null===r)return null;if(n===lt)return s===Kt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:r.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===ct)return s===Kt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:r.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===ht)return s===Kt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:r.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===ut)return s===Kt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:r.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===dt)return s===Kt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:r.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===pt)return s===Kt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:r.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===mt)return s===Kt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:r.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===ft)return s===Kt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:r.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===vt)return s===Kt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:r.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===gt)return s===Kt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:r.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===_t)return s===Kt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:r.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===wt)return s===Kt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:r.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===bt)return s===Kt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:r.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===yt)return s===Kt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:r.COMPRESSED_RGBA_ASTC_12x12_KHR}if(n===xt){if(r=t.get("EXT_texture_compression_bptc"),null===r)return null;if(n===xt)return s===Kt?r.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:r.COMPRESSED_RGBA_BPTC_UNORM_EXT}if(n===Mt||n===Et||n===St||n===Ct){if(r=t.get("EXT_texture_compression_rgtc"),null===r)return null;if(n===xt)return r.COMPRESSED_RED_RGTC1_EXT;if(n===Et)return r.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(n===St)return r.COMPRESSED_RED_GREEN_RGTC2_EXT;if(n===Ct)return r.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return n===Be?i?e.UNSIGNED_INT_24_8:(r=t.get("WEBGL_depth_texture"),null!==r?r.UNSIGNED_INT_24_8_WEBGL:null):void 0!==e[n]?e[n]:null}}}class kl extends $r{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class Ol extends Ls{constructor(){super(),this.isGroup=!0,this.type="Group"}}const Nl={type:"move"};class Ul{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Ol,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Ol,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Ai,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Ai),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Ol,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Ai,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Ai),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,n){let i=null,s=null,r=null;const a=this._targetRay,o=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(l&&e.hand){r=!0;for(const i of e.hand.values()){const e=t.getJointPose(i,n),s=this._getHandJoint(l,i);null!==e&&(s.matrix.fromArray(e.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),s.matrixWorldNeedsUpdate=!0,s.jointRadius=e.radius),s.visible=null!==e}const i=l.joints["index-finger-tip"],s=l.joints["thumb-tip"],a=i.position.distanceTo(s.position),o=.02,c=.005;l.inputState.pinching&&a>o+c?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&a<=o-c&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==o&&e.gripSpace&&(s=t.getPose(e.gripSpace,n),null!==s&&(o.matrix.fromArray(s.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,s.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(s.linearVelocity)):o.hasLinearVelocity=!1,s.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(s.angularVelocity)):o.hasAngularVelocity=!1));null!==a&&(i=t.getPose(e.targetRaySpace,n),null===i&&null!==s&&(i=s),null!==i&&(a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,i.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(i.linearVelocity)):a.hasLinearVelocity=!1,i.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(i.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(Nl)))}return null!==a&&(a.visible=null!==i),null!==o&&(o.visible=null!==s),null!==l&&(l.visible=null!==r),this}_getHandJoint(e,t){if(void 0===e.joints[t.jointName]){const n=new Ol;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}}class Vl extends wi{constructor(e,t,n,i,s,r,a,o,l,c){if((c=void 0!==c?c:je)!==je&&c!==We)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&c===je&&(n=ke),void 0===n&&c===We&&(n=Be),super(null,i,s,r,a,o,c,n,l),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=void 0!==a?a:we,this.minFilter=void 0!==o?o:we,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return null!==this.compareFunction&&(t.compareFunction=this.compareFunction),t}}class Bl extends Nn{constructor(e,t){super();const n=this;let i=null,s=1,r=null,a="local-floor",o=1,l=null,c=null,h=null,u=null,d=null,p=null;const m=t.getContextAttributes();let f=null,v=null;const g=[],_=[],w=new $r;w.layers.enable(1),w.viewport=new bi;const b=new $r;b.layers.enable(2),b.viewport=new bi;const y=[w,b],x=new kl;x.layers.enable(1),x.layers.enable(2);let M=null,E=null;function S(e){const t=_.indexOf(e.inputSource);if(-1===t)return;const n=g[t];void 0!==n&&(n.update(e.inputSource,e.frame,l||r),n.dispatchEvent({type:e.type,data:e.inputSource}))}function C(){i.removeEventListener("select",S),i.removeEventListener("selectstart",S),i.removeEventListener("selectend",S),i.removeEventListener("squeeze",S),i.removeEventListener("squeezestart",S),i.removeEventListener("squeezeend",S),i.removeEventListener("end",C),i.removeEventListener("inputsourceschange",T);for(let e=0;e<g.length;e++){const t=_[e];null!==t&&(_[e]=null,g[e].disconnect(t))}M=null,E=null,e.setRenderTarget(f),d=null,u=null,h=null,i=null,v=null,D.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}function T(e){for(let t=0;t<e.removed.length;t++){const n=e.removed[t],i=_.indexOf(n);i>=0&&(_[i]=null,g[i].disconnect(n))}for(let t=0;t<e.added.length;t++){const n=e.added[t];let i=_.indexOf(n);if(-1===i){for(let e=0;e<g.length;e++){if(e>=_.length){_.push(n),i=e;break}if(null===_[e]){_[e]=n,i=e;break}}if(-1===i)break}const s=g[i];s&&s.connect(n)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=g[e];return void 0===t&&(t=new Ul,g[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=g[e];return void 0===t&&(t=new Ul,g[e]=t),t.getGripSpace()},this.getHand=function(e){let t=g[e];return void 0===t&&(t=new Ul,g[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){s=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){a=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||r},this.setReferenceSpace=function(e){l=e},this.getBaseLayer=function(){return null!==u?u:d},this.getBinding=function(){return h},this.getFrame=function(){return p},this.getSession=function(){return i},this.setSession=async function(c){if(i=c,null!==i){if(f=e.getRenderTarget(),i.addEventListener("select",S),i.addEventListener("selectstart",S),i.addEventListener("selectend",S),i.addEventListener("squeeze",S),i.addEventListener("squeezestart",S),i.addEventListener("squeezeend",S),i.addEventListener("end",C),i.addEventListener("inputsourceschange",T),!0!==m.xrCompatible&&await t.makeXRCompatible(),void 0===i.renderState.layers||!1===e.capabilities.isWebGL2){const n={antialias:void 0!==i.renderState.layers||m.antialias,alpha:!0,depth:m.depth,stencil:m.stencil,framebufferScaleFactor:s};d=new XRWebGLLayer(i,t,n),i.updateRenderState({baseLayer:d}),v=new xi(d.framebufferWidth,d.framebufferHeight,{format:ze,type:Ae,colorSpace:e.outputColorSpace,stencilBuffer:m.stencil})}else{let n=null,r=null,a=null;m.depth&&(a=m.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,n=m.stencil?We:je,r=m.stencil?Be:ke);const o={colorFormat:t.RGBA8,depthFormat:a,scaleFactor:s};h=new XRWebGLBinding(i,t),u=h.createProjectionLayer(o),i.updateRenderState({layers:[u]}),v=new xi(u.textureWidth,u.textureHeight,{format:ze,type:Ae,depthTexture:new Vl(u.textureWidth,u.textureHeight,r,void 0,void 0,void 0,void 0,void 0,void 0,n),stencilBuffer:m.stencil,colorSpace:e.outputColorSpace,samples:m.antialias?4:0});e.properties.get(v).__ignoreDepthValues=u.ignoreDepthValues}v.isXRRenderTarget=!0,this.setFoveation(o),l=null,r=await i.requestReferenceSpace(a),D.setContext(i),D.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(null!==i)return i.environmentBlendMode};const P=new Ai,A=new Ai;function L(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.updateCamera=function(e){if(null===i)return;x.near=b.near=w.near=e.near,x.far=b.far=w.far=e.far,M===x.near&&E===x.far||(i.updateRenderState({depthNear:x.near,depthFar:x.far}),M=x.near,E=x.far);const t=e.parent,n=x.cameras;L(x,t);for(let e=0;e<n.length;e++)L(n[e],t);2===n.length?function(e,t,n){P.setFromMatrixPosition(t.matrixWorld),A.setFromMatrixPosition(n.matrixWorld);const i=P.distanceTo(A),s=t.projectionMatrix.elements,r=n.projectionMatrix.elements,a=s[14]/(s[10]-1),o=s[14]/(s[10]+1),l=(s[9]+1)/s[5],c=(s[9]-1)/s[5],h=(s[8]-1)/s[0],u=(r[8]+1)/r[0],d=a*h,p=a*u,m=i/(-h+u),f=m*-h;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(f),e.translateZ(m),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();const v=a+m,g=o+m,_=d-f,w=p+(i-f),b=l*o/g*v,y=c*o/g*v;e.projectionMatrix.makePerspective(_,w,b,y,v,g),e.projectionMatrixInverse.copy(e.projectionMatrix).invert()}(x,w,b):x.projectionMatrix.copy(w.projectionMatrix),function(e,t,n){null===n?e.matrix.copy(t.matrixWorld):(e.matrix.copy(n.matrixWorld),e.matrix.invert(),e.matrix.multiply(t.matrixWorld));e.matrix.decompose(e.position,e.quaternion,e.scale),e.updateMatrixWorld(!0);const i=e.children;for(let e=0,t=i.length;e<t;e++)i[e].updateMatrixWorld(!0);e.projectionMatrix.copy(t.projectionMatrix),e.projectionMatrixInverse.copy(t.projectionMatrixInverse),e.isPerspectiveCamera&&(e.fov=2*Fn*Math.atan(1/e.projectionMatrix.elements[5]),e.zoom=1)}(e,x,t)},this.getCamera=function(){return x},this.getFoveation=function(){if(null!==u||null!==d)return o},this.setFoveation=function(e){o=e,null!==u&&(u.fixedFoveation=e),null!==d&&void 0!==d.fixedFoveation&&(d.fixedFoveation=e)};let R=null;const D=new la;D.setAnimationLoop((function(t,i){if(c=i.getViewerPose(l||r),p=i,null!==c){const t=c.views;null!==d&&(e.setRenderTargetFramebuffer(v,d.framebuffer),e.setRenderTarget(v));let n=!1;t.length!==x.cameras.length&&(x.cameras.length=0,n=!0);for(let i=0;i<t.length;i++){const s=t[i];let r=null;if(null!==d)r=d.getViewport(s);else{const t=h.getViewSubImage(u,s);r=t.viewport,0===i&&(e.setRenderTargetTextures(v,t.colorTexture,u.ignoreDepthValues?void 0:t.depthStencilTexture),e.setRenderTarget(v))}let a=y[i];void 0===a&&(a=new $r,a.layers.enable(i),a.viewport=new bi,y[i]=a),a.matrix.fromArray(s.transform.matrix),a.matrix.decompose(a.position,a.quaternion,a.scale),a.projectionMatrix.fromArray(s.projectionMatrix),a.projectionMatrixInverse.copy(a.projectionMatrix).invert(),a.viewport.set(r.x,r.y,r.width,r.height),0===i&&(x.matrix.copy(a.matrix),x.matrix.decompose(x.position,x.quaternion,x.scale)),!0===n&&x.cameras.push(a)}}for(let e=0;e<g.length;e++){const t=_[e],n=g[e];null!==t&&void 0!==n&&n.update(t,i,l||r)}R&&R(t,i),i.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:i}),p=null})),this.setAnimationLoop=function(e){R=e},this.dispose=function(){}}}function Fl(e,t){function n(e,t){!0===e.matrixAutoUpdate&&e.updateMatrix(),t.value.copy(e.matrix)}function i(i,s){i.opacity.value=s.opacity,s.color&&i.diffuse.value.copy(s.color),s.emissive&&i.emissive.value.copy(s.emissive).multiplyScalar(s.emissiveIntensity),s.map&&(i.map.value=s.map,n(s.map,i.mapTransform)),s.alphaMap&&(i.alphaMap.value=s.alphaMap,n(s.alphaMap,i.alphaMapTransform)),s.bumpMap&&(i.bumpMap.value=s.bumpMap,n(s.bumpMap,i.bumpMapTransform),i.bumpScale.value=s.bumpScale,s.side===x&&(i.bumpScale.value*=-1)),s.normalMap&&(i.normalMap.value=s.normalMap,n(s.normalMap,i.normalMapTransform),i.normalScale.value.copy(s.normalScale),s.side===x&&i.normalScale.value.negate()),s.displacementMap&&(i.displacementMap.value=s.displacementMap,n(s.displacementMap,i.displacementMapTransform),i.displacementScale.value=s.displacementScale,i.displacementBias.value=s.displacementBias),s.emissiveMap&&(i.emissiveMap.value=s.emissiveMap,n(s.emissiveMap,i.emissiveMapTransform)),s.specularMap&&(i.specularMap.value=s.specularMap,n(s.specularMap,i.specularMapTransform)),s.alphaTest>0&&(i.alphaTest.value=s.alphaTest);const r=t.get(s).envMap;if(r&&(i.envMap.value=r,i.flipEnvMap.value=r.isCubeTexture&&!1===r.isRenderTargetTexture?-1:1,i.reflectivity.value=s.reflectivity,i.ior.value=s.ior,i.refractionRatio.value=s.refractionRatio),s.lightMap){i.lightMap.value=s.lightMap;const t=!0===e._useLegacyLights?Math.PI:1;i.lightMapIntensity.value=s.lightMapIntensity*t,n(s.lightMap,i.lightMapTransform)}s.aoMap&&(i.aoMap.value=s.aoMap,i.aoMapIntensity.value=s.aoMapIntensity,n(s.aoMap,i.aoMapTransform))}return{refreshFogUniforms:function(t,n){n.color.getRGB(t.fogColor.value,qr(e)),n.isFog?(t.fogNear.value=n.near,t.fogFar.value=n.far):n.isFogExp2&&(t.fogDensity.value=n.density)},refreshMaterialUniforms:function(e,s,r,a,o){s.isMeshBasicMaterial||s.isMeshLambertMaterial?i(e,s):s.isMeshToonMaterial?(i(e,s),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(e,s)):s.isMeshPhongMaterial?(i(e,s),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4)}(e,s)):s.isMeshStandardMaterial?(i(e,s),function(e,i){e.metalness.value=i.metalness,i.metalnessMap&&(e.metalnessMap.value=i.metalnessMap,n(i.metalnessMap,e.metalnessMapTransform));e.roughness.value=i.roughness,i.roughnessMap&&(e.roughnessMap.value=i.roughnessMap,n(i.roughnessMap,e.roughnessMapTransform));const s=t.get(i).envMap;s&&(e.envMapIntensity.value=i.envMapIntensity)}(e,s),s.isMeshPhysicalMaterial&&function(e,t,i){e.ior.value=t.ior,t.sheen>0&&(e.sheenColor.value.copy(t.sheenColor).multiplyScalar(t.sheen),e.sheenRoughness.value=t.sheenRoughness,t.sheenColorMap&&(e.sheenColorMap.value=t.sheenColorMap,n(t.sheenColorMap,e.sheenColorMapTransform)),t.sheenRoughnessMap&&(e.sheenRoughnessMap.value=t.sheenRoughnessMap,n(t.sheenRoughnessMap,e.sheenRoughnessMapTransform)));t.clearcoat>0&&(e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap,n(t.clearcoatMap,e.clearcoatMapTransform)),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap,n(t.clearcoatRoughnessMap,e.clearcoatRoughnessMapTransform)),t.clearcoatNormalMap&&(e.clearcoatNormalMap.value=t.clearcoatNormalMap,n(t.clearcoatNormalMap,e.clearcoatNormalMapTransform),e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),t.side===x&&e.clearcoatNormalScale.value.negate()));t.iridescence>0&&(e.iridescence.value=t.iridescence,e.iridescenceIOR.value=t.iridescenceIOR,e.iridescenceThicknessMinimum.value=t.iridescenceThicknessRange[0],e.iridescenceThicknessMaximum.value=t.iridescenceThicknessRange[1],t.iridescenceMap&&(e.iridescenceMap.value=t.iridescenceMap,n(t.iridescenceMap,e.iridescenceMapTransform)),t.iridescenceThicknessMap&&(e.iridescenceThicknessMap.value=t.iridescenceThicknessMap,n(t.iridescenceThicknessMap,e.iridescenceThicknessMapTransform)));t.transmission>0&&(e.transmission.value=t.transmission,e.transmissionSamplerMap.value=i.texture,e.transmissionSamplerSize.value.set(i.width,i.height),t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap,n(t.transmissionMap,e.transmissionMapTransform)),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap,n(t.thicknessMap,e.thicknessMapTransform)),e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor));t.anisotropy>0&&(e.anisotropyVector.value.set(t.anisotropy*Math.cos(t.anisotropyRotation),t.anisotropy*Math.sin(t.anisotropyRotation)),t.anisotropyMap&&(e.anisotropyMap.value=t.anisotropyMap,n(t.anisotropyMap,e.anisotropyMapTransform)));e.specularIntensity.value=t.specularIntensity,e.specularColor.value.copy(t.specularColor),t.specularColorMap&&(e.specularColorMap.value=t.specularColorMap,n(t.specularColorMap,e.specularColorMapTransform));t.specularIntensityMap&&(e.specularIntensityMap.value=t.specularIntensityMap,n(t.specularIntensityMap,e.specularIntensityMapTransform))}(e,s,o)):s.isMeshMatcapMaterial?(i(e,s),function(e,t){t.matcap&&(e.matcap.value=t.matcap)}(e,s)):s.isMeshDepthMaterial?i(e,s):s.isMeshDistanceMaterial?(i(e,s),function(e,n){const i=t.get(n).light;e.referencePosition.value.setFromMatrixPosition(i.matrixWorld),e.nearDistance.value=i.shadow.camera.near,e.farDistance.value=i.shadow.camera.far}(e,s)):s.isMeshNormalMaterial?i(e,s):s.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,t.map&&(e.map.value=t.map,n(t.map,e.mapTransform))}(e,s),s.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,s)):s.isPointsMaterial?function(e,t,i,s){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*i,e.scale.value=.5*s,t.map&&(e.map.value=t.map,n(t.map,e.uvTransform));t.alphaMap&&(e.alphaMap.value=t.alphaMap,n(t.alphaMap,e.alphaMapTransform));t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,s,r,a):s.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map,n(t.map,e.mapTransform));t.alphaMap&&(e.alphaMap.value=t.alphaMap,n(t.alphaMap,e.alphaMapTransform));t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,s):s.isShadowMaterial?(e.color.value.copy(s.color),e.opacity.value=s.opacity):s.isShaderMaterial&&(s.uniformsNeedUpdate=!1)}}}function zl(e,t,n,i){let s={},r={},a=[];const o=n.isWebGL2?e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS):0;function l(e,t,n){const i=e.value;if(void 0===n[t]){if("number"==typeof i)n[t]=i;else{const e=Array.isArray(i)?i:[i],s=[];for(let t=0;t<e.length;t++)s.push(e[t].clone());n[t]=s}return!0}if("number"==typeof i){if(n[t]!==i)return n[t]=i,!0}else{const e=Array.isArray(n[t])?n[t]:[n[t]],s=Array.isArray(i)?i:[i];for(let t=0;t<e.length;t++){const n=e[t];if(!1===n.equals(s[t]))return n.copy(s[t]),!0}}return!1}function c(e){const t={boundary:0,storage:0};return"number"==typeof e?(t.boundary=4,t.storage=4):e.isVector2?(t.boundary=8,t.storage=8):e.isVector3||e.isColor?(t.boundary=16,t.storage=12):e.isVector4?(t.boundary=16,t.storage=16):e.isMatrix3?(t.boundary=48,t.storage=48):e.isMatrix4?(t.boundary=64,t.storage=64):e.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",e),t}function h(t){const n=t.target;n.removeEventListener("dispose",h);const i=a.indexOf(n.__bindingPointIndex);a.splice(i,1),e.deleteBuffer(s[n.id]),delete s[n.id],delete r[n.id]}return{bind:function(e,t){const n=t.program;i.uniformBlockBinding(e,n)},update:function(n,u){let d=s[n.id];void 0===d&&(!function(e){const t=e.uniforms;let n=0;const i=16;let s=0;for(let e=0,r=t.length;e<r;e++){const r=t[e],a={boundary:0,storage:0},o=Array.isArray(r.value)?r.value:[r.value];for(let e=0,t=o.length;e<t;e++){const t=c(o[e]);a.boundary+=t.boundary,a.storage+=t.storage}if(r.__data=new Float32Array(a.storage/Float32Array.BYTES_PER_ELEMENT),r.__offset=n,e>0){s=n%i;0!==s&&i-s-a.boundary<0&&(n+=i-s,r.__offset=n)}n+=a.storage}s=n%i,s>0&&(n+=i-s);e.__size=n,e.__cache={}}(n),d=function(t){const n=function(){for(let e=0;e<o;e++)if(-1===a.indexOf(e))return a.push(e),e;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();t.__bindingPointIndex=n;const i=e.createBuffer(),s=t.__size,r=t.usage;return e.bindBuffer(e.UNIFORM_BUFFER,i),e.bufferData(e.UNIFORM_BUFFER,s,r),e.bindBuffer(e.UNIFORM_BUFFER,null),e.bindBufferBase(e.UNIFORM_BUFFER,n,i),i}(n),s[n.id]=d,n.addEventListener("dispose",h));const p=u.program;i.updateUBOMapping(n,p);const m=t.render.frame;r[n.id]!==m&&(!function(t){const n=s[t.id],i=t.uniforms,r=t.__cache;e.bindBuffer(e.UNIFORM_BUFFER,n);for(let t=0,n=i.length;t<n;t++){const n=i[t];if(!0===l(n,t,r)){const t=n.__offset,i=Array.isArray(n.value)?n.value:[n.value];let s=0;for(let r=0;r<i.length;r++){const a=i[r],o=c(a);"number"==typeof a?(n.__data[0]=a,e.bufferSubData(e.UNIFORM_BUFFER,t+s,n.__data)):a.isMatrix3?(n.__data[0]=a.elements[0],n.__data[1]=a.elements[1],n.__data[2]=a.elements[2],n.__data[3]=a.elements[0],n.__data[4]=a.elements[3],n.__data[5]=a.elements[4],n.__data[6]=a.elements[5],n.__data[7]=a.elements[0],n.__data[8]=a.elements[6],n.__data[9]=a.elements[7],n.__data[10]=a.elements[8],n.__data[11]=a.elements[0]):(a.toArray(n.__data,s),s+=o.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(e.UNIFORM_BUFFER,t,n.__data)}}e.bindBuffer(e.UNIFORM_BUFFER,null)}(n),r[n.id]=m)},dispose:function(){for(const t in s)e.deleteBuffer(s[t]);a=[],s={},r={}}}}function Hl(){const e=ii("canvas");return e.style.display="block",e}class Gl{constructor(e={}){const{canvas:t=Hl(),context:n=null,depth:i=!0,stencil:s=!0,alpha:r=!1,antialias:a=!1,premultipliedAlpha:o=!0,preserveDrawingBuffer:l=!1,powerPreference:c="default",failIfMajorPerformanceCaveat:u=!1}=e;let d;this.isWebGLRenderer=!0,d=null!==n?n.getContextAttributes().alpha:r;const p=new Uint32Array(4),m=new Int32Array(4);let f=null,v=null;const g=[],_=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputColorSpace=Kt,this._useLegacyLights=!1,this.toneMapping=se,this.toneMappingExposure=1;const w=this;let b=!1,E=0,S=0,C=null,T=-1,P=null;const A=new bi,L=new bi;let R=null;const D=new Ys(0);let I=0,k=t.width,O=t.height,N=1,U=null,V=null;const B=new bi(0,0,k,O),F=new bi(0,0,k,O);let z=!1;const H=new oa;let G=!1,j=!1,W=null;const q=new rs,X=new Zn,K=new Ai,Y={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function $(){return null===C?N:1}let Z,J,Q,ee,te,ne,ie,re,ae,oe,le,ce,he,ue,de,pe,me,fe,ve,ge,_e,we,be,ye,xe=n;function Me(e,n){for(let i=0;i<e.length;i++){const s=e[i],r=t.getContext(s,n);if(null!==r)return r}return null}try{const e={alpha:!0,depth:i,stencil:s,antialias:a,premultipliedAlpha:o,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:u};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${h}`),t.addEventListener("webglcontextlost",Ce,!1),t.addEventListener("webglcontextrestored",Pe,!1),t.addEventListener("webglcontextcreationerror",Le,!1),null===xe){const t=["webgl2","webgl","experimental-webgl"];if(!0===w.isWebGL1Renderer&&t.shift(),xe=Me(t,e),null===xe)throw Me(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}"undefined"!=typeof WebGLRenderingContext&&xe instanceof WebGLRenderingContext&&console.warn("THREE.WebGLRenderer: WebGL 1 support was deprecated in r153 and will be removed in r163."),void 0===xe.getShaderPrecisionFormat&&(xe.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function Ee(){Z=new Ua(xe),J=new _a(xe,Z,e),Z.init(J),we=new Il(xe,Z,J),Q=new Rl(xe,Z,J),ee=new Fa(xe),te=new gl,ne=new Dl(xe,Z,Q,te,J,we,ee),ie=new ba(w),re=new Na(w),ae=new ca(xe,J),be=new va(xe,Z,ae,J),oe=new Va(xe,ae,ee,be),le=new ja(xe,oe,ae,ee),ve=new Ga(xe,J,ne),pe=new wa(te),ce=new vl(w,ie,re,Z,J,be,pe),he=new Fl(w,te),ue=new yl,de=new Tl(Z,J),fe=new fa(w,ie,re,Q,le,d,o),me=new Ll(w,le,J),ye=new zl(xe,ee,J,Q),ge=new ga(xe,Z,ee,J),_e=new Ba(xe,Z,ee,J),ee.programs=ce.programs,w.capabilities=J,w.extensions=Z,w.properties=te,w.renderLists=ue,w.shadowMap=me,w.state=Q,w.info=ee}Ee();const Se=new Bl(w,xe);function Ce(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),b=!0}function Pe(){console.log("THREE.WebGLRenderer: Context Restored."),b=!1;const e=ee.autoReset,t=me.enabled,n=me.autoUpdate,i=me.needsUpdate,s=me.type;Ee(),ee.autoReset=e,me.enabled=t,me.autoUpdate=n,me.needsUpdate=i,me.type=s}function Le(e){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",e.statusMessage)}function Re(e){const t=e.target;t.removeEventListener("dispose",Re),function(e){(function(e){const t=te.get(e).programs;void 0!==t&&(t.forEach((function(e){ce.releaseProgram(e)})),e.isShaderMaterial&&ce.releaseShaderCache(e))})(e),te.remove(e)}(t)}this.xr=Se,this.getContext=function(){return xe},this.getContextAttributes=function(){return xe.getContextAttributes()},this.forceContextLoss=function(){const e=Z.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){const e=Z.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return N},this.setPixelRatio=function(e){void 0!==e&&(N=e,this.setSize(k,O,!1))},this.getSize=function(e){return e.set(k,O)},this.setSize=function(e,n,i=!0){Se.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(k=e,O=n,t.width=Math.floor(e*N),t.height=Math.floor(n*N),!0===i&&(t.style.width=e+"px",t.style.height=n+"px"),this.setViewport(0,0,e,n))},this.getDrawingBufferSize=function(e){return e.set(k*N,O*N).floor()},this.setDrawingBufferSize=function(e,n,i){k=e,O=n,N=i,t.width=Math.floor(e*i),t.height=Math.floor(n*i),this.setViewport(0,0,e,n)},this.getCurrentViewport=function(e){return e.copy(A)},this.getViewport=function(e){return e.copy(B)},this.setViewport=function(e,t,n,i){e.isVector4?B.set(e.x,e.y,e.z,e.w):B.set(e,t,n,i),Q.viewport(A.copy(B).multiplyScalar(N).floor())},this.getScissor=function(e){return e.copy(F)},this.setScissor=function(e,t,n,i){e.isVector4?F.set(e.x,e.y,e.z,e.w):F.set(e,t,n,i),Q.scissor(L.copy(F).multiplyScalar(N).floor())},this.getScissorTest=function(){return z},this.setScissorTest=function(e){Q.setScissorTest(z=e)},this.setOpaqueSort=function(e){U=e},this.setTransparentSort=function(e){V=e},this.getClearColor=function(e){return e.copy(fe.getClearColor())},this.setClearColor=function(){fe.setClearColor.apply(fe,arguments)},this.getClearAlpha=function(){return fe.getClearAlpha()},this.setClearAlpha=function(){fe.setClearAlpha.apply(fe,arguments)},this.clear=function(e=!0,t=!0,n=!0){let i=0;if(e){let e=!1;if(null!==C){const t=C.texture.format;e=t===$e||t===Ye||t===Xe}if(e){const e=C.texture.type,t=e===Ae||e===ke||e===De||e===Be||e===Ue||e===Ve,n=fe.getClearColor(),i=fe.getClearAlpha(),s=n.r,r=n.g,a=n.b;t?(p[0]=s,p[1]=r,p[2]=a,p[3]=i,xe.clearBufferuiv(xe.COLOR,0,p)):(m[0]=s,m[1]=r,m[2]=a,m[3]=i,xe.clearBufferiv(xe.COLOR,0,m))}else i|=xe.COLOR_BUFFER_BIT}t&&(i|=xe.DEPTH_BUFFER_BIT),n&&(i|=xe.STENCIL_BUFFER_BIT),xe.clear(i)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Ce,!1),t.removeEventListener("webglcontextrestored",Pe,!1),t.removeEventListener("webglcontextcreationerror",Le,!1),ue.dispose(),de.dispose(),te.dispose(),ie.dispose(),re.dispose(),le.dispose(),be.dispose(),ye.dispose(),ce.dispose(),Se.dispose(),Se.removeEventListener("sessionstart",Fe),Se.removeEventListener("sessionend",He),W&&(W.dispose(),W=null),Ge.stop()},this.renderBufferDirect=function(e,t,n,i,s,r){null===t&&(t=Y);const a=s.isMesh&&s.matrixWorld.determinant()<0,o=function(e,t,n,i,s){!0!==t.isScene&&(t=Y);ne.resetTextureUnits();const r=t.fog,a=i.isMeshStandardMaterial?t.environment:null,o=null===C?w.outputColorSpace:!0===C.isXRRenderTarget?C.texture.colorSpace:Yt,l=(i.isMeshStandardMaterial?re:ie).get(i.envMap||a),c=!0===i.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,h=!!n.attributes.tangent&&(!!i.normalMap||i.anisotropy>0),u=!!n.morphAttributes.position,d=!!n.morphAttributes.normal,p=!!n.morphAttributes.color;let m=se;i.toneMapped&&(null!==C&&!0!==C.isXRRenderTarget||(m=w.toneMapping));const f=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,g=void 0!==f?f.length:0,_=te.get(i),b=v.state.lights;if(!0===G&&(!0===j||e!==P)){const t=e===P&&i.id===T;pe.setState(i,e,t)}let y=!1;i.version===_.__version?_.needsLights&&_.lightsStateVersion!==b.state.version||_.outputColorSpace!==o||s.isInstancedMesh&&!1===_.instancing?y=!0:s.isInstancedMesh||!0!==_.instancing?s.isSkinnedMesh&&!1===_.skinning?y=!0:s.isSkinnedMesh||!0!==_.skinning?s.isInstancedMesh&&!0===_.instancingColor&&null===s.instanceColor||s.isInstancedMesh&&!1===_.instancingColor&&null!==s.instanceColor||_.envMap!==l||!0===i.fog&&_.fog!==r?y=!0:void 0===_.numClippingPlanes||_.numClippingPlanes===pe.numPlanes&&_.numIntersection===pe.numIntersection?(_.vertexAlphas!==c||_.vertexTangents!==h||_.morphTargets!==u||_.morphNormals!==d||_.morphColors!==p||_.toneMapping!==m||!0===J.isWebGL2&&_.morphTargetsCount!==g)&&(y=!0):y=!0:y=!0:y=!0:(y=!0,_.__version=i.version);let x=_.currentProgram;!0===y&&(x=Ze(i,t,s));let M=!1,E=!1,S=!1;const A=x.getUniforms(),L=_.uniforms;Q.useProgram(x.program)&&(M=!0,E=!0,S=!0);i.id!==T&&(T=i.id,E=!0);if(M||P!==e){if(A.setValue(xe,"projectionMatrix",e.projectionMatrix),J.logarithmicDepthBuffer&&A.setValue(xe,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),P!==e&&(P=e,E=!0,S=!0),i.isShaderMaterial||i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshStandardMaterial||i.envMap){const t=A.map.cameraPosition;void 0!==t&&t.setValue(xe,K.setFromMatrixPosition(e.matrixWorld))}(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial)&&A.setValue(xe,"isOrthographic",!0===e.isOrthographicCamera),(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial||i.isShadowMaterial||s.isSkinnedMesh)&&A.setValue(xe,"viewMatrix",e.matrixWorldInverse)}if(s.isSkinnedMesh){A.setOptional(xe,s,"bindMatrix"),A.setOptional(xe,s,"bindMatrixInverse");const e=s.skeleton;e&&(J.floatVertexTextures?(null===e.boneTexture&&e.computeBoneTexture(),A.setValue(xe,"boneTexture",e.boneTexture,ne),A.setValue(xe,"boneTextureSize",e.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const R=n.morphAttributes;(void 0!==R.position||void 0!==R.normal||void 0!==R.color&&!0===J.isWebGL2)&&ve.update(s,n,x);(E||_.receiveShadow!==s.receiveShadow)&&(_.receiveShadow=s.receiveShadow,A.setValue(xe,"receiveShadow",s.receiveShadow));i.isMeshGouraudMaterial&&null!==i.envMap&&(L.envMap.value=l,L.flipEnvMap.value=l.isCubeTexture&&!1===l.isRenderTargetTexture?-1:1);E&&(A.setValue(xe,"toneMappingExposure",w.toneMappingExposure),_.needsLights&&(I=S,(D=L).ambientLightColor.needsUpdate=I,D.lightProbe.needsUpdate=I,D.directionalLights.needsUpdate=I,D.directionalLightShadows.needsUpdate=I,D.pointLights.needsUpdate=I,D.pointLightShadows.needsUpdate=I,D.spotLights.needsUpdate=I,D.spotLightShadows.needsUpdate=I,D.rectAreaLights.needsUpdate=I,D.hemisphereLights.needsUpdate=I),r&&!0===i.fog&&he.refreshFogUniforms(L,r),he.refreshMaterialUniforms(L,i,N,O,W),Yo.upload(xe,_.uniformsList,L,ne));var D,I;i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(Yo.upload(xe,_.uniformsList,L,ne),i.uniformsNeedUpdate=!1);i.isSpriteMaterial&&A.setValue(xe,"center",s.center);if(A.setValue(xe,"modelViewMatrix",s.modelViewMatrix),A.setValue(xe,"normalMatrix",s.normalMatrix),A.setValue(xe,"modelMatrix",s.matrixWorld),i.isShaderMaterial||i.isRawShaderMaterial){const e=i.uniformsGroups;for(let t=0,n=e.length;t<n;t++)if(J.isWebGL2){const n=e[t];ye.update(n,x),ye.bind(n,x)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return x}(e,t,n,i,s);Q.setMaterial(i,a);let l=n.index,c=1;if(!0===i.wireframe){if(l=oe.getWireframeAttribute(n),void 0===l)return;c=2}const h=n.drawRange,u=n.attributes.position;let d=h.start*c,p=(h.start+h.count)*c;null!==r&&(d=Math.max(d,r.start*c),p=Math.min(p,(r.start+r.count)*c)),null!==l?(d=Math.max(d,0),p=Math.min(p,l.count)):null!=u&&(d=Math.max(d,0),p=Math.min(p,u.count));const m=p-d;if(m<0||m===1/0)return;let f;be.setup(s,i,o,n,l);let g=ge;if(null!==l&&(f=ae.get(l),g=_e,g.setIndex(f)),s.isMesh)!0===i.wireframe?(Q.setLineWidth(i.wireframeLinewidth*$()),g.setMode(xe.LINES)):g.setMode(xe.TRIANGLES);else if(s.isLine){let e=i.linewidth;void 0===e&&(e=1),Q.setLineWidth(e*$()),s.isLineSegments?g.setMode(xe.LINES):s.isLineLoop?g.setMode(xe.LINE_LOOP):g.setMode(xe.LINE_STRIP)}else s.isPoints?g.setMode(xe.POINTS):s.isSprite&&g.setMode(xe.TRIANGLES);if(s.isInstancedMesh)g.renderInstances(d,m,s.count);else if(n.isInstancedBufferGeometry){const e=void 0!==n._maxInstanceCount?n._maxInstanceCount:1/0,t=Math.min(n.instanceCount,e);g.renderInstances(d,m,t)}else g.render(d,m)},this.compile=function(e,t){function n(e,t,n){!0===e.transparent&&e.side===M&&!1===e.forceSinglePass?(e.side=x,e.needsUpdate=!0,Ze(e,t,n),e.side=y,e.needsUpdate=!0,Ze(e,t,n),e.side=M):Ze(e,t,n)}v=de.get(e),v.init(),_.push(v),e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(v.pushLight(e),e.castShadow&&v.pushShadow(e))})),v.setupLights(w._useLegacyLights),e.traverse((function(t){const i=t.material;if(i)if(Array.isArray(i))for(let s=0;s<i.length;s++){n(i[s],e,t)}else n(i,e,t)})),_.pop(),v=null};let Ie=null;function Fe(){Ge.stop()}function He(){Ge.start()}const Ge=new la;function je(e,t,n,i){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)v.pushLight(e),e.castShadow&&v.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||H.intersectsSprite(e)){i&&K.setFromMatrixPosition(e.matrixWorld).applyMatrix4(q);const t=le.update(e),s=e.material;s.visible&&f.push(e,t,s,n,K.z,null)}}else if((e.isMesh||e.isLine||e.isPoints)&&(!e.frustumCulled||H.intersectsObject(e))){const t=le.update(e),s=e.material;if(i&&(void 0!==e.boundingSphere?(null===e.boundingSphere&&e.computeBoundingSphere(),K.copy(e.boundingSphere.center)):(null===t.boundingSphere&&t.computeBoundingSphere(),K.copy(t.boundingSphere.center)),K.applyMatrix4(e.matrixWorld).applyMatrix4(q)),Array.isArray(s)){const i=t.groups;for(let r=0,a=i.length;r<a;r++){const a=i[r],o=s[a.materialIndex];o&&o.visible&&f.push(e,t,o,n,K.z,a)}}else s.visible&&f.push(e,t,s,n,K.z,null)}const s=e.children;for(let e=0,r=s.length;e<r;e++)je(s[e],t,n,i)}function We(e,t,n,i){const s=e.opaque,r=e.transmissive,a=e.transparent;v.setupLightsView(n),!0===G&&pe.setGlobalState(w.clippingPlanes,n),r.length>0&&function(e,t,n,i){const s=J.isWebGL2;null===W&&(W=new xi(1,1,{generateMipmaps:!0,type:Z.has("EXT_color_buffer_half_float")?Ne:Ae,minFilter:Te,samples:s?4:0}));w.getDrawingBufferSize(X),s?W.setSize(X.x,X.y):W.setSize(Xn(X.x),Xn(X.y));const r=w.getRenderTarget();w.setRenderTarget(W),w.getClearColor(D),I=w.getClearAlpha(),I<1&&w.setClearColor(16777215,.5);w.clear();const a=w.toneMapping;w.toneMapping=se,qe(e,n,i),ne.updateMultisampleRenderTarget(W),ne.updateRenderTargetMipmap(W);let o=!1;for(let e=0,s=t.length;e<s;e++){const s=t[e],r=s.object,a=s.geometry,l=s.material,c=s.group;if(l.side===M&&r.layers.test(i.layers)){const e=l.side;l.side=x,l.needsUpdate=!0,Ke(r,n,i,a,l,c),l.side=e,l.needsUpdate=!0,o=!0}}!0===o&&(ne.updateMultisampleRenderTarget(W),ne.updateRenderTargetMipmap(W));w.setRenderTarget(r),w.setClearColor(D,I),w.toneMapping=a}(s,r,t,n),i&&Q.viewport(A.copy(i)),s.length>0&&qe(s,t,n),r.length>0&&qe(r,t,n),a.length>0&&qe(a,t,n),Q.buffers.depth.setTest(!0),Q.buffers.depth.setMask(!0),Q.buffers.color.setMask(!0),Q.setPolygonOffset(!1)}function qe(e,t,n){const i=!0===t.isScene?t.overrideMaterial:null;for(let s=0,r=e.length;s<r;s++){const r=e[s],a=r.object,o=r.geometry,l=null===i?r.material:i,c=r.group;a.layers.test(n.layers)&&Ke(a,t,n,o,l,c)}}function Ke(e,t,n,i,s,r){e.onBeforeRender(w,t,n,i,s,r),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),s.onBeforeRender(w,t,n,i,e,r),!0===s.transparent&&s.side===M&&!1===s.forceSinglePass?(s.side=x,s.needsUpdate=!0,w.renderBufferDirect(n,t,i,s,e,r),s.side=y,s.needsUpdate=!0,w.renderBufferDirect(n,t,i,s,e,r),s.side=M):w.renderBufferDirect(n,t,i,s,e,r),e.onAfterRender(w,t,n,i,s,r)}function Ze(e,t,n){!0!==t.isScene&&(t=Y);const i=te.get(e),s=v.state.lights,r=v.state.shadowsArray,a=s.state.version,o=ce.getParameters(e,s.state,r,t,n),l=ce.getProgramCacheKey(o);let c=i.programs;i.environment=e.isMeshStandardMaterial?t.environment:null,i.fog=t.fog,i.envMap=(e.isMeshStandardMaterial?re:ie).get(e.envMap||i.environment),void 0===c&&(e.addEventListener("dispose",Re),c=new Map,i.programs=c);let h=c.get(l);if(void 0!==h){if(i.currentProgram===h&&i.lightsStateVersion===a)return Je(e,o),h}else o.uniforms=ce.getUniforms(e),e.onBuild(n,o,w),e.onBeforeCompile(o,w),h=ce.acquireProgram(o,l),c.set(l,h),i.uniforms=o.uniforms;const u=i.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(u.clippingPlanes=pe.uniform),Je(e,o),i.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),i.lightsStateVersion=a,i.needsLights&&(u.ambientLightColor.value=s.state.ambient,u.lightProbe.value=s.state.probe,u.directionalLights.value=s.state.directional,u.directionalLightShadows.value=s.state.directionalShadow,u.spotLights.value=s.state.spot,u.spotLightShadows.value=s.state.spotShadow,u.rectAreaLights.value=s.state.rectArea,u.ltc_1.value=s.state.rectAreaLTC1,u.ltc_2.value=s.state.rectAreaLTC2,u.pointLights.value=s.state.point,u.pointLightShadows.value=s.state.pointShadow,u.hemisphereLights.value=s.state.hemi,u.directionalShadowMap.value=s.state.directionalShadowMap,u.directionalShadowMatrix.value=s.state.directionalShadowMatrix,u.spotShadowMap.value=s.state.spotShadowMap,u.spotLightMatrix.value=s.state.spotLightMatrix,u.spotLightMap.value=s.state.spotLightMap,u.pointShadowMap.value=s.state.pointShadowMap,u.pointShadowMatrix.value=s.state.pointShadowMatrix);const d=h.getUniforms(),p=Yo.seqWithValue(d.seq,u);return i.currentProgram=h,i.uniformsList=p,h}function Je(e,t){const n=te.get(e);n.outputColorSpace=t.outputColorSpace,n.instancing=t.instancing,n.instancingColor=t.instancingColor,n.skinning=t.skinning,n.morphTargets=t.morphTargets,n.morphNormals=t.morphNormals,n.morphColors=t.morphColors,n.morphTargetsCount=t.morphTargetsCount,n.numClippingPlanes=t.numClippingPlanes,n.numIntersection=t.numClipIntersection,n.vertexAlphas=t.vertexAlphas,n.vertexTangents=t.vertexTangents,n.toneMapping=t.toneMapping}Ge.setAnimationLoop((function(e){Ie&&Ie(e)})),"undefined"!=typeof self&&Ge.setContext(self),this.setAnimationLoop=function(e){Ie=e,Se.setAnimationLoop(e),null===e?Ge.stop():Ge.start()},Se.addEventListener("sessionstart",Fe),Se.addEventListener("sessionend",He),this.render=function(e,t){if(void 0!==t&&!0!==t.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===b)return;!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),!0===Se.enabled&&!0===Se.isPresenting&&(!0===Se.cameraAutoUpdate&&Se.updateCamera(t),t=Se.getCamera()),!0===e.isScene&&e.onBeforeRender(w,e,t,C),v=de.get(e,_.length),v.init(),_.push(v),q.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),H.setFromProjectionMatrix(q),j=this.localClippingEnabled,G=pe.init(this.clippingPlanes,j),f=ue.get(e,g.length),f.init(),g.push(f),je(e,t,0,w.sortObjects),f.finish(),!0===w.sortObjects&&f.sort(U,V),this.info.render.frame++,!0===G&&pe.beginShadows();const n=v.state.shadowsArray;if(me.render(n,e,t),!0===G&&pe.endShadows(),!0===this.info.autoReset&&this.info.reset(),fe.render(f,e),v.setupLights(w._useLegacyLights),t.isArrayCamera){const n=t.cameras;for(let t=0,i=n.length;t<i;t++){const i=n[t];We(f,e,i,i.viewport)}}else We(f,e,t);null!==C&&(ne.updateMultisampleRenderTarget(C),ne.updateRenderTargetMipmap(C)),!0===e.isScene&&e.onAfterRender(w,e,t),be.resetDefaultState(),T=-1,P=null,_.pop(),v=_.length>0?_[_.length-1]:null,g.pop(),f=g.length>0?g[g.length-1]:null},this.getActiveCubeFace=function(){return E},this.getActiveMipmapLevel=function(){return S},this.getRenderTarget=function(){return C},this.setRenderTargetTextures=function(e,t,n){te.get(e.texture).__webglTexture=t,te.get(e.depthTexture).__webglTexture=n;const i=te.get(e);i.__hasExternalTextures=!0,i.__hasExternalTextures&&(i.__autoAllocateDepthBuffer=void 0===n,i.__autoAllocateDepthBuffer||!0===Z.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),i.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(e,t){const n=te.get(e);n.__webglFramebuffer=t,n.__useDefaultFramebuffer=void 0===t},this.setRenderTarget=function(e,t=0,n=0){C=e,E=t,S=n;let i=!0,s=null,r=!1,a=!1;if(e){const o=te.get(e);void 0!==o.__useDefaultFramebuffer?(Q.bindFramebuffer(xe.FRAMEBUFFER,null),i=!1):void 0===o.__webglFramebuffer?ne.setupRenderTarget(e):o.__hasExternalTextures&&ne.rebindTextures(e,te.get(e.texture).__webglTexture,te.get(e.depthTexture).__webglTexture);const l=e.texture;(l.isData3DTexture||l.isDataArrayTexture||l.isCompressedArrayTexture)&&(a=!0);const c=te.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(s=Array.isArray(c[t])?c[t][n]:c[t],r=!0):s=J.isWebGL2&&e.samples>0&&!1===ne.useMultisampledRTT(e)?te.get(e).__webglMultisampledFramebuffer:Array.isArray(c)?c[n]:c,A.copy(e.viewport),L.copy(e.scissor),R=e.scissorTest}else A.copy(B).multiplyScalar(N).floor(),L.copy(F).multiplyScalar(N).floor(),R=z;if(Q.bindFramebuffer(xe.FRAMEBUFFER,s)&&J.drawBuffers&&i&&Q.drawBuffers(e,s),Q.viewport(A),Q.scissor(L),Q.setScissorTest(R),r){const i=te.get(e.texture);xe.framebufferTexture2D(xe.FRAMEBUFFER,xe.COLOR_ATTACHMENT0,xe.TEXTURE_CUBE_MAP_POSITIVE_X+t,i.__webglTexture,n)}else if(a){const i=te.get(e.texture),s=t||0;xe.framebufferTextureLayer(xe.FRAMEBUFFER,xe.COLOR_ATTACHMENT0,i.__webglTexture,n||0,s)}T=-1},this.readRenderTargetPixels=function(e,t,n,i,s,r,a){if(!e||!e.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let o=te.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==a&&(o=o[a]),o){Q.bindFramebuffer(xe.FRAMEBUFFER,o);try{const a=e.texture,o=a.format,l=a.type;if(o!==ze&&we.convert(o)!==xe.getParameter(xe.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const c=l===Ne&&(Z.has("EXT_color_buffer_half_float")||J.isWebGL2&&Z.has("EXT_color_buffer_float"));if(!(l===Ae||we.convert(l)===xe.getParameter(xe.IMPLEMENTATION_COLOR_READ_TYPE)||l===Oe&&(J.isWebGL2||Z.has("OES_texture_float")||Z.has("WEBGL_color_buffer_float"))||c))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");t>=0&&t<=e.width-i&&n>=0&&n<=e.height-s&&xe.readPixels(t,n,i,s,we.convert(o),we.convert(l),r)}finally{const e=null!==C?te.get(C).__webglFramebuffer:null;Q.bindFramebuffer(xe.FRAMEBUFFER,e)}}},this.copyFramebufferToTexture=function(e,t,n=0){const i=Math.pow(2,-n),s=Math.floor(t.image.width*i),r=Math.floor(t.image.height*i);ne.setTexture2D(t,0),xe.copyTexSubImage2D(xe.TEXTURE_2D,n,0,0,e.x,e.y,s,r),Q.unbindTexture()},this.copyTextureToTexture=function(e,t,n,i=0){const s=t.image.width,r=t.image.height,a=we.convert(n.format),o=we.convert(n.type);ne.setTexture2D(n,0),xe.pixelStorei(xe.UNPACK_FLIP_Y_WEBGL,n.flipY),xe.pixelStorei(xe.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultiplyAlpha),xe.pixelStorei(xe.UNPACK_ALIGNMENT,n.unpackAlignment),t.isDataTexture?xe.texSubImage2D(xe.TEXTURE_2D,i,e.x,e.y,s,r,a,o,t.image.data):t.isCompressedTexture?xe.compressedTexSubImage2D(xe.TEXTURE_2D,i,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,a,t.mipmaps[0].data):xe.texSubImage2D(xe.TEXTURE_2D,i,e.x,e.y,a,o,t.image),0===i&&n.generateMipmaps&&xe.generateMipmap(xe.TEXTURE_2D),Q.unbindTexture()},this.copyTextureToTexture3D=function(e,t,n,i,s=0){if(w.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const r=e.max.x-e.min.x+1,a=e.max.y-e.min.y+1,o=e.max.z-e.min.z+1,l=we.convert(i.format),c=we.convert(i.type);let h;if(i.isData3DTexture)ne.setTexture3D(i,0),h=xe.TEXTURE_3D;else{if(!i.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");ne.setTexture2DArray(i,0),h=xe.TEXTURE_2D_ARRAY}xe.pixelStorei(xe.UNPACK_FLIP_Y_WEBGL,i.flipY),xe.pixelStorei(xe.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.premultiplyAlpha),xe.pixelStorei(xe.UNPACK_ALIGNMENT,i.unpackAlignment);const u=xe.getParameter(xe.UNPACK_ROW_LENGTH),d=xe.getParameter(xe.UNPACK_IMAGE_HEIGHT),p=xe.getParameter(xe.UNPACK_SKIP_PIXELS),m=xe.getParameter(xe.UNPACK_SKIP_ROWS),f=xe.getParameter(xe.UNPACK_SKIP_IMAGES),v=n.isCompressedTexture?n.mipmaps[0]:n.image;xe.pixelStorei(xe.UNPACK_ROW_LENGTH,v.width),xe.pixelStorei(xe.UNPACK_IMAGE_HEIGHT,v.height),xe.pixelStorei(xe.UNPACK_SKIP_PIXELS,e.min.x),xe.pixelStorei(xe.UNPACK_SKIP_ROWS,e.min.y),xe.pixelStorei(xe.UNPACK_SKIP_IMAGES,e.min.z),n.isDataTexture||n.isData3DTexture?xe.texSubImage3D(h,s,t.x,t.y,t.z,r,a,o,l,c,v.data):n.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),xe.compressedTexSubImage3D(h,s,t.x,t.y,t.z,r,a,o,l,v.data)):xe.texSubImage3D(h,s,t.x,t.y,t.z,r,a,o,l,c,v),xe.pixelStorei(xe.UNPACK_ROW_LENGTH,u),xe.pixelStorei(xe.UNPACK_IMAGE_HEIGHT,d),xe.pixelStorei(xe.UNPACK_SKIP_PIXELS,p),xe.pixelStorei(xe.UNPACK_SKIP_ROWS,m),xe.pixelStorei(xe.UNPACK_SKIP_IMAGES,f),0===s&&i.generateMipmaps&&xe.generateMipmap(h),Q.unbindTexture()},this.initTexture=function(e){e.isCubeTexture?ne.setTextureCube(e,0):e.isData3DTexture?ne.setTexture3D(e,0):e.isDataArrayTexture||e.isCompressedArrayTexture?ne.setTexture2DArray(e,0):ne.setTexture2D(e,0),Q.unbindTexture()},this.resetState=function(){E=0,S=0,C=null,Q.reset(),be.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return kn}get physicallyCorrectLights(){return console.warn("THREE.WebGLRenderer: The property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),!this.useLegacyLights}set physicallyCorrectLights(e){console.warn("THREE.WebGLRenderer: The property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),this.useLegacyLights=!e}get outputEncoding(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===Kt?Ht:zt}set outputEncoding(e){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=e===Ht?Kt:Yt}get useLegacyLights(){return console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights}set useLegacyLights(e){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights=e}}class jl extends Gl{}jl.prototype.isWebGL1Renderer=!0;class Wl{constructor(e,t=25e-5){this.isFogExp2=!0,this.name="",this.color=new Ys(e),this.density=t}clone(){return new Wl(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}class ql{constructor(e,t=1,n=1e3){this.isFog=!0,this.name="",this.color=new Ys(e),this.near=t,this.far=n}clone(){return new ql(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}class Xl extends Ls{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(t.object.backgroundIntensity=this.backgroundIntensity),t}}class Kl{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=xn,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=zn()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let i=0,s=this.stride;i<s;i++)this.array[e+i]=t.array[n+i];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=zn()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=zn()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Yl=new Ai;class $l{constructor(e,t,n,i=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)Yl.fromBufferAttribute(this,t),Yl.applyMatrix4(e),this.setXYZ(t,Yl.x,Yl.y,Yl.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Yl.fromBufferAttribute(this,t),Yl.applyNormalMatrix(e),this.setXYZ(t,Yl.x,Yl.y,Yl.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Yl.fromBufferAttribute(this,t),Yl.transformDirection(e),this.setXYZ(t,Yl.x,Yl.y,Yl.z);return this}setX(e,t){return this.normalized&&(t=Yn(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=Yn(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=Yn(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=Yn(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=Kn(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=Kn(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=Kn(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=Kn(t,this.array)),t}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=Yn(t,this.array),n=Yn(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=Yn(t,this.array),n=Yn(n,this.array),i=Yn(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this}setXYZW(e,t,n,i,s){return e=e*this.data.stride+this.offset,this.normalized&&(t=Yn(t,this.array),n=Yn(n,this.array),i=Yn(i,this.array),s=Yn(s,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this.data.array[e+3]=s,this}clone(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return new rr(new this.array.constructor(e),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new $l(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class Zl extends js{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new Ys(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let Jl;const Ql=new Ai,ec=new Ai,tc=new Ai,nc=new Zn,ic=new Zn,sc=new rs,rc=new Ai,ac=new Ai,oc=new Ai,lc=new Zn,cc=new Zn,hc=new Zn;class uc extends Ls{constructor(e){if(super(),this.isSprite=!0,this.type="Sprite",void 0===Jl){Jl=new Mr;const e=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),t=new Kl(e,5);Jl.setIndex([0,1,2,0,2,3]),Jl.setAttribute("position",new $l(t,3,0,!1)),Jl.setAttribute("uv",new $l(t,2,3,!1))}this.geometry=Jl,this.material=void 0!==e?e:new Zl,this.center=new Zn(.5,.5)}raycast(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),ec.setFromMatrixScale(this.matrixWorld),sc.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),tc.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&ec.multiplyScalar(-tc.z);const n=this.material.rotation;let i,s;0!==n&&(s=Math.cos(n),i=Math.sin(n));const r=this.center;dc(rc.set(-.5,-.5,0),tc,r,ec,i,s),dc(ac.set(.5,-.5,0),tc,r,ec,i,s),dc(oc.set(.5,.5,0),tc,r,ec,i,s),lc.set(0,0),cc.set(1,0),hc.set(1,1);let a=e.ray.intersectTriangle(rc,ac,oc,!1,Ql);if(null===a&&(dc(ac.set(-.5,.5,0),tc,r,ec,i,s),cc.set(0,1),a=e.ray.intersectTriangle(rc,oc,ac,!1,Ql),null===a))return;const o=e.ray.origin.distanceTo(Ql);o<e.near||o>e.far||t.push({distance:o,point:Ql.clone(),uv:Hs.getInterpolation(Ql,rc,ac,oc,lc,cc,hc,new Zn),face:null,object:this})}copy(e,t){return super.copy(e,t),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}}function dc(e,t,n,i,s,r){nc.subVectors(e,n).addScalar(.5).multiply(i),void 0!==s?(ic.x=r*nc.x-s*nc.y,ic.y=s*nc.x+r*nc.y):ic.copy(nc),e.copy(t),e.x+=ic.x,e.y+=ic.y,e.applyMatrix4(sc)}const pc=new Ai,mc=new Ai;class fc extends Ls{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let e=0,n=t.length;e<n;e++){const n=t[e];this.addLevel(n.object.clone(),n.distance,n.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0,n=0){t=Math.abs(t);const i=this.levels;let s;for(s=0;s<i.length&&!(t<i[s].distance);s++);return i.splice(s,0,{distance:t,hysteresis:n,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let n,i;for(n=1,i=t.length;n<i;n++){let i=t[n].distance;if(t[n].object.visible&&(i-=i*t[n].hysteresis),e<i)break}return t[n-1].object}return null}raycast(e,t){if(this.levels.length>0){pc.setFromMatrixPosition(this.matrixWorld);const n=e.ray.origin.distanceTo(pc);this.getObjectForDistance(n).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){pc.setFromMatrixPosition(e.matrixWorld),mc.setFromMatrixPosition(this.matrixWorld);const n=pc.distanceTo(mc)/e.zoom;let i,s;for(t[0].object.visible=!0,i=1,s=t.length;i<s;i++){let e=t[i].distance;if(t[i].object.visible&&(e-=e*t[i].hysteresis),!(n>=e))break;t[i-1].object.visible=!1,t[i].object.visible=!0}for(this._currentLevel=i-1;i<s;i++)t[i].object.visible=!1}}toJSON(e){const t=super.toJSON(e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];const n=this.levels;for(let e=0,i=n.length;e<i;e++){const i=n[e];t.object.levels.push({object:i.object.uuid,distance:i.distance,hysteresis:i.hysteresis})}return t}}const vc=new Ai,gc=new bi,_c=new bi,wc=new Ai,bc=new rs,yc=new Ai,xc=new $i,Mc=new rs,Ec=new ss;class Sc extends zr{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new rs,this.bindMatrixInverse=new rs,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;null===this.boundingBox&&(this.boundingBox=new Di),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let e=0;e<t.count;e++)yc.fromBufferAttribute(t,e),this.applyBoneTransform(e,yc),this.boundingBox.expandByPoint(yc)}computeBoundingSphere(){const e=this.geometry;null===this.boundingSphere&&(this.boundingSphere=new $i),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let e=0;e<t.count;e++)yc.fromBufferAttribute(t,e),this.applyBoneTransform(e,yc),this.boundingSphere.expandByPoint(yc)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const n=this.material,i=this.matrixWorld;void 0!==n&&(null===this.boundingSphere&&this.computeBoundingSphere(),xc.copy(this.boundingSphere),xc.applyMatrix4(i),!1!==e.ray.intersectsSphere(xc)&&(Mc.copy(i).invert(),Ec.copy(e.ray).applyMatrix4(Mc),null!==this.boundingBox&&!1===Ec.intersectsBox(this.boundingBox)||this._computeIntersections(e,t,Ec)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new bi,t=this.geometry.attributes.skinWeight;for(let n=0,i=t.count;n<i;n++){e.fromBufferAttribute(t,n);const i=1/e.manhattanLength();i!==1/0?e.multiplyScalar(i):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const n=this.skeleton,i=this.geometry;gc.fromBufferAttribute(i.attributes.skinIndex,e),_c.fromBufferAttribute(i.attributes.skinWeight,e),vc.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let e=0;e<4;e++){const i=_c.getComponent(e);if(0!==i){const s=gc.getComponent(e);bc.multiplyMatrices(n.bones[s].matrixWorld,n.boneInverses[s]),t.addScaledVector(wc.copy(vc).applyMatrix4(bc),i)}}return t.applyMatrix4(this.bindMatrixInverse)}boneTransform(e,t){return console.warn("THREE.SkinnedMesh: .boneTransform() was renamed to .applyBoneTransform() in r151."),this.applyBoneTransform(e,t)}}class Cc extends Ls{constructor(){super(),this.isBone=!0,this.type="Bone"}}class Tc extends wi{constructor(e=null,t=1,n=1,i,s,r,a,o,l=we,c=we,h,u){super(null,r,a,o,l,c,i,s,h,u),this.isDataTexture=!0,this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const Pc=new rs,Ac=new rs;class Lc{constructor(e=[],t=[]){this.uuid=zn(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new rs)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const t=new rs;this.bones[e]&&t.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(t)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&t.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&(t.parent&&t.parent.isBone?(t.matrix.copy(t.parent.matrixWorld).invert(),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))}}update(){const e=this.bones,t=this.boneInverses,n=this.boneMatrices,i=this.boneTexture;for(let i=0,s=e.length;i<s;i++){const s=e[i]?e[i].matrixWorld:Ac;Pc.multiplyMatrices(s,t[i]),Pc.toArray(n,16*i)}null!==i&&(i.needsUpdate=!0)}clone(){return new Lc(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length);e=qn(e),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const n=new Tc(t,e,e,ze,Oe);return n.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=n,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,n=this.bones.length;t<n;t++){const n=this.bones[t];if(n.name===e)return n}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let n=0,i=e.bones.length;n<i;n++){const i=e.bones[n];let s=t[i];void 0===s&&(console.warn("THREE.Skeleton: No bone found with UUID:",i),s=new Cc),this.bones.push(s),this.boneInverses.push((new rs).fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,n=this.boneInverses;for(let i=0,s=t.length;i<s;i++){const s=t[i];e.bones.push(s.uuid);const r=n[i];e.boneInverses.push(r.toArray())}return e}}class Rc extends rr{constructor(e,t,n,i=1){super(e,t,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const Dc=new rs,Ic=new rs,kc=[],Oc=new Di,Nc=new rs,Uc=new zr,Vc=new $i;class Bc extends zr{constructor(e,t,n){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new Rc(new Float32Array(16*n),16),this.instanceColor=null,this.count=n,this.boundingBox=null,this.boundingSphere=null;for(let e=0;e<n;e++)this.setMatrixAt(e,Nc)}computeBoundingBox(){const e=this.geometry,t=this.count;null===this.boundingBox&&(this.boundingBox=new Di),null===e.boundingBox&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,Dc),Oc.copy(e.boundingBox).applyMatrix4(Dc),this.boundingBox.union(Oc)}computeBoundingSphere(){const e=this.geometry,t=this.count;null===this.boundingSphere&&(this.boundingSphere=new $i),null===e.boundingSphere&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,Dc),Vc.copy(e.boundingSphere).applyMatrix4(Dc),this.boundingSphere.union(Vc)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}raycast(e,t){const n=this.matrixWorld,i=this.count;if(Uc.geometry=this.geometry,Uc.material=this.material,void 0!==Uc.material&&(null===this.boundingSphere&&this.computeBoundingSphere(),Vc.copy(this.boundingSphere),Vc.applyMatrix4(n),!1!==e.ray.intersectsSphere(Vc)))for(let s=0;s<i;s++){this.getMatrixAt(s,Dc),Ic.multiplyMatrices(n,Dc),Uc.matrixWorld=Ic,Uc.raycast(e,kc);for(let e=0,n=kc.length;e<n;e++){const n=kc[e];n.instanceId=s,n.object=this,t.push(n)}kc.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new Rc(new Float32Array(3*this.instanceMatrix.count),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class Fc extends js{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Ys(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const zc=new Ai,Hc=new Ai,Gc=new rs,jc=new ss,Wc=new $i;class qc extends Ls{constructor(e=new Mr,t=new Fc){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,n=[0];for(let e=1,i=t.count;e<i;e++)zc.fromBufferAttribute(t,e-1),Hc.fromBufferAttribute(t,e),n[e]=n[e-1],n[e]+=zc.distanceTo(Hc);e.setAttribute("lineDistance",new mr(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,s=e.params.Line.threshold,r=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Wc.copy(n.boundingSphere),Wc.applyMatrix4(i),Wc.radius+=s,!1===e.ray.intersectsSphere(Wc))return;Gc.copy(i).invert(),jc.copy(e.ray).applyMatrix4(Gc);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a,l=new Ai,c=new Ai,h=new Ai,u=new Ai,d=this.isLineSegments?2:1,p=n.index,m=n.attributes.position;if(null!==p){for(let n=Math.max(0,r.start),i=Math.min(p.count,r.start+r.count)-1;n<i;n+=d){const i=p.getX(n),s=p.getX(n+1);l.fromBufferAttribute(m,i),c.fromBufferAttribute(m,s);if(jc.distanceSqToSegment(l,c,u,h)>o)continue;u.applyMatrix4(this.matrixWorld);const r=e.ray.origin.distanceTo(u);r<e.near||r>e.far||t.push({distance:r,point:h.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}else{for(let n=Math.max(0,r.start),i=Math.min(m.count,r.start+r.count)-1;n<i;n+=d){l.fromBufferAttribute(m,n),c.fromBufferAttribute(m,n+1);if(jc.distanceSqToSegment(l,c,u,h)>o)continue;u.applyMatrix4(this.matrixWorld);const i=e.ray.origin.distanceTo(u);i<e.near||i>e.far||t.push({distance:i,point:h.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}const Xc=new Ai,Kc=new Ai;class Yc extends qc{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,n=[];for(let e=0,i=t.count;e<i;e+=2)Xc.fromBufferAttribute(t,e),Kc.fromBufferAttribute(t,e+1),n[e]=0===e?0:n[e-1],n[e+1]=n[e]+Xc.distanceTo(Kc);e.setAttribute("lineDistance",new mr(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class $c extends qc{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class Zc extends js{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Ys(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const Jc=new rs,Qc=new ss,eh=new $i,th=new Ai;class nh extends Ls{constructor(e=new Mr,t=new Zc){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,s=e.params.Points.threshold,r=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),eh.copy(n.boundingSphere),eh.applyMatrix4(i),eh.radius+=s,!1===e.ray.intersectsSphere(eh))return;Jc.copy(i).invert(),Qc.copy(e.ray).applyMatrix4(Jc);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a,l=n.index,c=n.attributes.position;if(null!==l){for(let n=Math.max(0,r.start),s=Math.min(l.count,r.start+r.count);n<s;n++){const s=l.getX(n);th.fromBufferAttribute(c,s),ih(th,s,o,i,e,t,this)}}else{for(let n=Math.max(0,r.start),s=Math.min(c.count,r.start+r.count);n<s;n++)th.fromBufferAttribute(c,n),ih(th,n,o,i,e,t,this)}}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}function ih(e,t,n,i,s,r,a){const o=Qc.distanceSqToPoint(e);if(o<n){const n=new Ai;Qc.closestPointToPoint(e,n),n.applyMatrix4(i);const l=s.ray.origin.distanceTo(n);if(l<s.near||l>s.far)return;r.push({distance:l,distanceToRay:Math.sqrt(o),point:n,index:t,face:null,object:a})}}class sh extends wi{constructor(e,t,n,i,s,r,a,o,l){super(e,t,n,i,s,r,a,o,l),this.isVideoTexture=!0,this.minFilter=void 0!==r?r:Ee,this.magFilter=void 0!==s?s:Ee,this.generateMipmaps=!1;const c=this;"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback((function t(){c.needsUpdate=!0,e.requestVideoFrameCallback(t)}))}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;!1==="requestVideoFrameCallback"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class rh extends wi{constructor(e,t){super({width:e,height:t}),this.isFramebufferTexture=!0,this.magFilter=we,this.minFilter=we,this.generateMipmaps=!1,this.needsUpdate=!0}}class ah extends wi{constructor(e,t,n,i,s,r,a,o,l,c,h,u){super(null,r,a,o,l,c,i,s,h,u),this.isCompressedTexture=!0,this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class oh extends ah{constructor(e,t,n,i,s,r){super(e,t,n,s,r),this.isCompressedArrayTexture=!0,this.image.depth=i,this.wrapR=ge}}class lh extends ah{constructor(e,t,n){super(void 0,e[0].width,e[0].height,t,n,ue),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}}class ch extends wi{constructor(e,t,n,i,s,r,a,o,l){super(e,t,n,i,s,r,a,o,l),this.isCanvasTexture=!0,this.needsUpdate=!0}}class hh{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,i=this.getPoint(0),s=0;t.push(0);for(let r=1;r<=e;r++)n=this.getPoint(r/e),s+=n.distanceTo(i),t.push(s),i=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const n=this.getLengths();let i=0;const s=n.length;let r;r=t||e*n[s-1];let a,o=0,l=s-1;for(;o<=l;)if(i=Math.floor(o+(l-o)/2),a=n[i]-r,a<0)o=i+1;else{if(!(a>0)){l=i;break}l=i-1}if(i=l,n[i]===r)return i/(s-1);const c=n[i];return(i+(r-c)/(n[i+1]-c))/(s-1)}getTangent(e,t){const n=1e-4;let i=e-n,s=e+n;i<0&&(i=0),s>1&&(s=1);const r=this.getPoint(i),a=this.getPoint(s),o=t||(r.isVector2?new Zn:new Ai);return o.copy(a).sub(r).normalize(),o}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t){const n=new Ai,i=[],s=[],r=[],a=new Ai,o=new rs;for(let t=0;t<=e;t++){const n=t/e;i[t]=this.getTangentAt(n,new Ai)}s[0]=new Ai,r[0]=new Ai;let l=Number.MAX_VALUE;const c=Math.abs(i[0].x),h=Math.abs(i[0].y),u=Math.abs(i[0].z);c<=l&&(l=c,n.set(1,0,0)),h<=l&&(l=h,n.set(0,1,0)),u<=l&&n.set(0,0,1),a.crossVectors(i[0],n).normalize(),s[0].crossVectors(i[0],a),r[0].crossVectors(i[0],s[0]);for(let t=1;t<=e;t++){if(s[t]=s[t-1].clone(),r[t]=r[t-1].clone(),a.crossVectors(i[t-1],i[t]),a.length()>Number.EPSILON){a.normalize();const e=Math.acos(Hn(i[t-1].dot(i[t]),-1,1));s[t].applyMatrix4(o.makeRotationAxis(a,e))}r[t].crossVectors(i[t],s[t])}if(!0===t){let t=Math.acos(Hn(s[0].dot(s[e]),-1,1));t/=e,i[0].dot(a.crossVectors(s[0],s[e]))>0&&(t=-t);for(let n=1;n<=e;n++)s[n].applyMatrix4(o.makeRotationAxis(i[n],t*n)),r[n].crossVectors(i[n],s[n])}return{tangents:i,normals:s,binormals:r}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class uh extends hh{constructor(e=0,t=0,n=1,i=1,s=0,r=2*Math.PI,a=!1,o=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=i,this.aStartAngle=s,this.aEndAngle=r,this.aClockwise=a,this.aRotation=o}getPoint(e,t){const n=t||new Zn,i=2*Math.PI;let s=this.aEndAngle-this.aStartAngle;const r=Math.abs(s)<Number.EPSILON;for(;s<0;)s+=i;for(;s>i;)s-=i;s<Number.EPSILON&&(s=r?0:i),!0!==this.aClockwise||r||(s===i?s=-i:s-=i);const a=this.aStartAngle+e*s;let o=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){const e=Math.cos(this.aRotation),t=Math.sin(this.aRotation),n=o-this.aX,i=l-this.aY;o=n*e-i*t+this.aX,l=n*t+i*e+this.aY}return n.set(o,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class dh extends uh{constructor(e,t,n,i,s,r){super(e,t,n,n,i,s,r),this.isArcCurve=!0,this.type="ArcCurve"}}function ph(){let e=0,t=0,n=0,i=0;function s(s,r,a,o){e=s,t=a,n=-3*s+3*r-2*a-o,i=2*s-2*r+a+o}return{initCatmullRom:function(e,t,n,i,r){s(t,n,r*(n-e),r*(i-t))},initNonuniformCatmullRom:function(e,t,n,i,r,a,o){let l=(t-e)/r-(n-e)/(r+a)+(n-t)/a,c=(n-t)/a-(i-t)/(a+o)+(i-n)/o;l*=a,c*=a,s(t,n,l,c)},calc:function(s){const r=s*s;return e+t*s+n*r+i*(r*s)}}}const mh=new Ai,fh=new ph,vh=new ph,gh=new ph;class _h extends hh{constructor(e=[],t=!1,n="centripetal",i=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=i}getPoint(e,t=new Ai){const n=t,i=this.points,s=i.length,r=(s-(this.closed?0:1))*e;let a,o,l=Math.floor(r),c=r-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/s)+1)*s:0===c&&l===s-1&&(l=s-2,c=1),this.closed||l>0?a=i[(l-1)%s]:(mh.subVectors(i[0],i[1]).add(i[0]),a=mh);const h=i[l%s],u=i[(l+1)%s];if(this.closed||l+2<s?o=i[(l+2)%s]:(mh.subVectors(i[s-1],i[s-2]).add(i[s-1]),o=mh),"centripetal"===this.curveType||"chordal"===this.curveType){const e="chordal"===this.curveType?.5:.25;let t=Math.pow(a.distanceToSquared(h),e),n=Math.pow(h.distanceToSquared(u),e),i=Math.pow(u.distanceToSquared(o),e);n<1e-4&&(n=1),t<1e-4&&(t=n),i<1e-4&&(i=n),fh.initNonuniformCatmullRom(a.x,h.x,u.x,o.x,t,n,i),vh.initNonuniformCatmullRom(a.y,h.y,u.y,o.y,t,n,i),gh.initNonuniformCatmullRom(a.z,h.z,u.z,o.z,t,n,i)}else"catmullrom"===this.curveType&&(fh.initCatmullRom(a.x,h.x,u.x,o.x,this.tension),vh.initCatmullRom(a.y,h.y,u.y,o.y,this.tension),gh.initCatmullRom(a.z,h.z,u.z,o.z,this.tension));return n.set(fh.calc(c),vh.calc(c),gh.calc(c)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new Ai).fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function wh(e,t,n,i,s){const r=.5*(i-t),a=.5*(s-n),o=e*e;return(2*n-2*i+r+a)*(e*o)+(-3*n+3*i-2*r-a)*o+r*e+n}function bh(e,t,n,i){return function(e,t){const n=1-e;return n*n*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,n)+function(e,t){return e*e*t}(e,i)}function yh(e,t,n,i,s){return function(e,t){const n=1-e;return n*n*n*t}(e,t)+function(e,t){const n=1-e;return 3*n*n*e*t}(e,n)+function(e,t){return 3*(1-e)*e*e*t}(e,i)+function(e,t){return e*e*e*t}(e,s)}class xh extends hh{constructor(e=new Zn,t=new Zn,n=new Zn,i=new Zn){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e,t=new Zn){const n=t,i=this.v0,s=this.v1,r=this.v2,a=this.v3;return n.set(yh(e,i.x,s.x,r.x,a.x),yh(e,i.y,s.y,r.y,a.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class Mh extends hh{constructor(e=new Ai,t=new Ai,n=new Ai,i=new Ai){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e,t=new Ai){const n=t,i=this.v0,s=this.v1,r=this.v2,a=this.v3;return n.set(yh(e,i.x,s.x,r.x,a.x),yh(e,i.y,s.y,r.y,a.y),yh(e,i.z,s.z,r.z,a.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class Eh extends hh{constructor(e=new Zn,t=new Zn){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new Zn){const n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new Zn){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Sh extends hh{constructor(e=new Ai,t=new Ai){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new Ai){const n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new Ai){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Ch extends hh{constructor(e=new Zn,t=new Zn,n=new Zn){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new Zn){const n=t,i=this.v0,s=this.v1,r=this.v2;return n.set(bh(e,i.x,s.x,r.x),bh(e,i.y,s.y,r.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Th extends hh{constructor(e=new Ai,t=new Ai,n=new Ai){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new Ai){const n=t,i=this.v0,s=this.v1,r=this.v2;return n.set(bh(e,i.x,s.x,r.x),bh(e,i.y,s.y,r.y),bh(e,i.z,s.z,r.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Ph extends hh{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new Zn){const n=t,i=this.points,s=(i.length-1)*e,r=Math.floor(s),a=s-r,o=i[0===r?r:r-1],l=i[r],c=i[r>i.length-2?i.length-1:r+1],h=i[r>i.length-3?i.length-1:r+2];return n.set(wh(a,o.x,l.x,c.x,h.x),wh(a,o.y,l.y,c.y,h.y)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new Zn).fromArray(n))}return this}}var Ah=Object.freeze({__proto__:null,ArcCurve:dh,CatmullRomCurve3:_h,CubicBezierCurve:xh,CubicBezierCurve3:Mh,EllipseCurve:uh,LineCurve:Eh,LineCurve3:Sh,QuadraticBezierCurve:Ch,QuadraticBezierCurve3:Th,SplineCurve:Ph});class Lh extends hh{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Eh(t,e))}getPoint(e,t){const n=e*this.getLength(),i=this.getCurveLengths();let s=0;for(;s<i.length;){if(i[s]>=n){const e=i[s]-n,r=this.curves[s],a=r.getLength(),o=0===a?0:1-e/a;return r.getPointAt(o,t)}s++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let n=0,i=this.curves.length;n<i;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let n;for(let i=0,s=this.curves;i<s.length;i++){const r=s[i],a=r.isEllipseCurve?2*e:r.isLineCurve||r.isLineCurve3?1:r.isSplineCurve?e*r.points.length:e,o=r.getPoints(a);for(let e=0;e<o.length;e++){const i=o[e];n&&n.equals(i)||(t.push(i),n=i)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push(n.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){const n=this.curves[t];e.curves.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push((new Ah[n.type]).fromJSON(n))}return this}}class Rh extends Lh{constructor(e){super(),this.type="Path",this.currentPoint=new Zn,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const n=new Eh(this.currentPoint.clone(),new Zn(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,i){const s=new Ch(this.currentPoint.clone(),new Zn(e,t),new Zn(n,i));return this.curves.push(s),this.currentPoint.set(n,i),this}bezierCurveTo(e,t,n,i,s,r){const a=new xh(this.currentPoint.clone(),new Zn(e,t),new Zn(n,i),new Zn(s,r));return this.curves.push(a),this.currentPoint.set(s,r),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),n=new Ph(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,i,s,r){const a=this.currentPoint.x,o=this.currentPoint.y;return this.absarc(e+a,t+o,n,i,s,r),this}absarc(e,t,n,i,s,r){return this.absellipse(e,t,n,n,i,s,r),this}ellipse(e,t,n,i,s,r,a,o){const l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+l,t+c,n,i,s,r,a,o),this}absellipse(e,t,n,i,s,r,a,o){const l=new uh(e,t,n,i,s,r,a,o);if(this.curves.length>0){const e=l.getPoint(0);e.equals(this.currentPoint)||this.lineTo(e.x,e.y)}this.curves.push(l);const c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class Dh extends Mr{constructor(e=[new Zn(0,-.5),new Zn(.5,0),new Zn(0,.5)],t=12,n=0,i=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:i},t=Math.floor(t),i=Hn(i,0,2*Math.PI);const s=[],r=[],a=[],o=[],l=[],c=1/t,h=new Ai,u=new Zn,d=new Ai,p=new Ai,m=new Ai;let f=0,v=0;for(let t=0;t<=e.length-1;t++)switch(t){case 0:f=e[t+1].x-e[t].x,v=e[t+1].y-e[t].y,d.x=1*v,d.y=-f,d.z=0*v,m.copy(d),d.normalize(),o.push(d.x,d.y,d.z);break;case e.length-1:o.push(m.x,m.y,m.z);break;default:f=e[t+1].x-e[t].x,v=e[t+1].y-e[t].y,d.x=1*v,d.y=-f,d.z=0*v,p.copy(d),d.x+=m.x,d.y+=m.y,d.z+=m.z,d.normalize(),o.push(d.x,d.y,d.z),m.copy(p)}for(let s=0;s<=t;s++){const d=n+s*c*i,p=Math.sin(d),m=Math.cos(d);for(let n=0;n<=e.length-1;n++){h.x=e[n].x*p,h.y=e[n].y,h.z=e[n].x*m,r.push(h.x,h.y,h.z),u.x=s/t,u.y=n/(e.length-1),a.push(u.x,u.y);const i=o[3*n+0]*p,c=o[3*n+1],d=o[3*n+0]*m;l.push(i,c,d)}}for(let n=0;n<t;n++)for(let t=0;t<e.length-1;t++){const i=t+n*e.length,r=i,a=i+e.length,o=i+e.length+1,l=i+1;s.push(r,a,l),s.push(o,l,a)}this.setIndex(s),this.setAttribute("position",new mr(r,3)),this.setAttribute("uv",new mr(a,2)),this.setAttribute("normal",new mr(l,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Dh(e.points,e.segments,e.phiStart,e.phiLength)}}class Ih extends Dh{constructor(e=1,t=1,n=4,i=8){const s=new Rh;s.absarc(0,-t/2,e,1.5*Math.PI,0),s.absarc(0,t/2,e,0,.5*Math.PI),super(s.getPoints(n),i),this.type="CapsuleGeometry",this.parameters={radius:e,length:t,capSegments:n,radialSegments:i}}static fromJSON(e){return new Ih(e.radius,e.length,e.capSegments,e.radialSegments)}}class kh extends Mr{constructor(e=1,t=32,n=0,i=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:i},t=Math.max(3,t);const s=[],r=[],a=[],o=[],l=new Ai,c=new Zn;r.push(0,0,0),a.push(0,0,1),o.push(.5,.5);for(let s=0,h=3;s<=t;s++,h+=3){const u=n+s/t*i;l.x=e*Math.cos(u),l.y=e*Math.sin(u),r.push(l.x,l.y,l.z),a.push(0,0,1),c.x=(r[h]/e+1)/2,c.y=(r[h+1]/e+1)/2,o.push(c.x,c.y)}for(let e=1;e<=t;e++)s.push(e,e+1,0);this.setIndex(s),this.setAttribute("position",new mr(r,3)),this.setAttribute("normal",new mr(a,3)),this.setAttribute("uv",new mr(o,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new kh(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class Oh extends Mr{constructor(e=1,t=1,n=1,i=32,s=1,r=!1,a=0,o=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:i,heightSegments:s,openEnded:r,thetaStart:a,thetaLength:o};const l=this;i=Math.floor(i),s=Math.floor(s);const c=[],h=[],u=[],d=[];let p=0;const m=[],f=n/2;let v=0;function g(n){const s=p,r=new Zn,m=new Ai;let g=0;const _=!0===n?e:t,w=!0===n?1:-1;for(let e=1;e<=i;e++)h.push(0,f*w,0),u.push(0,w,0),d.push(.5,.5),p++;const b=p;for(let e=0;e<=i;e++){const t=e/i*o+a,n=Math.cos(t),s=Math.sin(t);m.x=_*s,m.y=f*w,m.z=_*n,h.push(m.x,m.y,m.z),u.push(0,w,0),r.x=.5*n+.5,r.y=.5*s*w+.5,d.push(r.x,r.y),p++}for(let e=0;e<i;e++){const t=s+e,i=b+e;!0===n?c.push(i,i+1,t):c.push(i+1,i,t),g+=3}l.addGroup(v,g,!0===n?1:2),v+=g}!function(){const r=new Ai,g=new Ai;let _=0;const w=(t-e)/n;for(let l=0;l<=s;l++){const c=[],v=l/s,_=v*(t-e)+e;for(let e=0;e<=i;e++){const t=e/i,s=t*o+a,l=Math.sin(s),m=Math.cos(s);g.x=_*l,g.y=-v*n+f,g.z=_*m,h.push(g.x,g.y,g.z),r.set(l,w,m).normalize(),u.push(r.x,r.y,r.z),d.push(t,1-v),c.push(p++)}m.push(c)}for(let e=0;e<i;e++)for(let t=0;t<s;t++){const n=m[t][e],i=m[t+1][e],s=m[t+1][e+1],r=m[t][e+1];c.push(n,i,r),c.push(i,s,r),_+=6}l.addGroup(v,_,0),v+=_}(),!1===r&&(e>0&&g(!0),t>0&&g(!1)),this.setIndex(c),this.setAttribute("position",new mr(h,3)),this.setAttribute("normal",new mr(u,3)),this.setAttribute("uv",new mr(d,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Oh(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Nh extends Oh{constructor(e=1,t=1,n=32,i=1,s=!1,r=0,a=2*Math.PI){super(0,e,t,n,i,s,r,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:i,openEnded:s,thetaStart:r,thetaLength:a}}static fromJSON(e){return new Nh(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Uh extends Mr{constructor(e=[],t=[],n=1,i=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:i};const s=[],r=[];function a(e,t,n,i){const s=i+1,r=[];for(let i=0;i<=s;i++){r[i]=[];const a=e.clone().lerp(n,i/s),o=t.clone().lerp(n,i/s),l=s-i;for(let e=0;e<=l;e++)r[i][e]=0===e&&i===s?a:a.clone().lerp(o,e/l)}for(let e=0;e<s;e++)for(let t=0;t<2*(s-e)-1;t++){const n=Math.floor(t/2);t%2==0?(o(r[e][n+1]),o(r[e+1][n]),o(r[e][n])):(o(r[e][n+1]),o(r[e+1][n+1]),o(r[e+1][n]))}}function o(e){s.push(e.x,e.y,e.z)}function l(t,n){const i=3*t;n.x=e[i+0],n.y=e[i+1],n.z=e[i+2]}function c(e,t,n,i){i<0&&1===e.x&&(r[t]=e.x-1),0===n.x&&0===n.z&&(r[t]=i/2/Math.PI+.5)}function h(e){return Math.atan2(e.z,-e.x)}!function(e){const n=new Ai,i=new Ai,s=new Ai;for(let r=0;r<t.length;r+=3)l(t[r+0],n),l(t[r+1],i),l(t[r+2],s),a(n,i,s,e)}(i),function(e){const t=new Ai;for(let n=0;n<s.length;n+=3)t.x=s[n+0],t.y=s[n+1],t.z=s[n+2],t.normalize().multiplyScalar(e),s[n+0]=t.x,s[n+1]=t.y,s[n+2]=t.z}(n),function(){const e=new Ai;for(let n=0;n<s.length;n+=3){e.x=s[n+0],e.y=s[n+1],e.z=s[n+2];const i=h(e)/2/Math.PI+.5,a=(t=e,Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))/Math.PI+.5);r.push(i,1-a)}var t;(function(){const e=new Ai,t=new Ai,n=new Ai,i=new Ai,a=new Zn,o=new Zn,l=new Zn;for(let u=0,d=0;u<s.length;u+=9,d+=6){e.set(s[u+0],s[u+1],s[u+2]),t.set(s[u+3],s[u+4],s[u+5]),n.set(s[u+6],s[u+7],s[u+8]),a.set(r[d+0],r[d+1]),o.set(r[d+2],r[d+3]),l.set(r[d+4],r[d+5]),i.copy(e).add(t).add(n).divideScalar(3);const p=h(i);c(a,d+0,e,p),c(o,d+2,t,p),c(l,d+4,n,p)}})(),function(){for(let e=0;e<r.length;e+=6){const t=r[e+0],n=r[e+2],i=r[e+4],s=Math.max(t,n,i),a=Math.min(t,n,i);s>.9&&a<.1&&(t<.2&&(r[e+0]+=1),n<.2&&(r[e+2]+=1),i<.2&&(r[e+4]+=1))}}()}(),this.setAttribute("position",new mr(s,3)),this.setAttribute("normal",new mr(s.slice(),3)),this.setAttribute("uv",new mr(r,2)),0===i?this.computeVertexNormals():this.normalizeNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Uh(e.vertices,e.indices,e.radius,e.details)}}class Vh extends Uh{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,i=1/n;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-n,0,-i,n,0,i,-n,0,i,n,-i,-n,0,-i,n,0,i,-n,0,i,n,0,-n,0,-i,n,0,-i,-n,0,i,n,0,i],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Vh(e.radius,e.detail)}}const Bh=new Ai,Fh=new Ai,zh=new Ai,Hh=new Hs;class Gh extends Mr{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},null!==e){const n=4,i=Math.pow(10,n),s=Math.cos(Bn*t),r=e.getIndex(),a=e.getAttribute("position"),o=r?r.count:a.count,l=[0,0,0],c=["a","b","c"],h=new Array(3),u={},d=[];for(let e=0;e<o;e+=3){r?(l[0]=r.getX(e),l[1]=r.getX(e+1),l[2]=r.getX(e+2)):(l[0]=e,l[1]=e+1,l[2]=e+2);const{a:t,b:n,c:o}=Hh;if(t.fromBufferAttribute(a,l[0]),n.fromBufferAttribute(a,l[1]),o.fromBufferAttribute(a,l[2]),Hh.getNormal(zh),h[0]=`${Math.round(t.x*i)},${Math.round(t.y*i)},${Math.round(t.z*i)}`,h[1]=`${Math.round(n.x*i)},${Math.round(n.y*i)},${Math.round(n.z*i)}`,h[2]=`${Math.round(o.x*i)},${Math.round(o.y*i)},${Math.round(o.z*i)}`,h[0]!==h[1]&&h[1]!==h[2]&&h[2]!==h[0])for(let e=0;e<3;e++){const t=(e+1)%3,n=h[e],i=h[t],r=Hh[c[e]],a=Hh[c[t]],o=`${n}_${i}`,p=`${i}_${n}`;p in u&&u[p]?(zh.dot(u[p].normal)<=s&&(d.push(r.x,r.y,r.z),d.push(a.x,a.y,a.z)),u[p]=null):o in u||(u[o]={index0:l[e],index1:l[t],normal:zh.clone()})}}for(const e in u)if(u[e]){const{index0:t,index1:n}=u[e];Bh.fromBufferAttribute(a,t),Fh.fromBufferAttribute(a,n),d.push(Bh.x,Bh.y,Bh.z),d.push(Fh.x,Fh.y,Fh.z)}this.setAttribute("position",new mr(d,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}class jh extends Rh{constructor(e){super(e),this.uuid=zn(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let n=0,i=this.holes.length;n<i;n++)t[n]=this.holes[n].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++){const n=this.holes[t];e.holes.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push((new Rh).fromJSON(n))}return this}}const Wh=function(e,t,n=2){const i=t&&t.length,s=i?t[0]*n:e.length;let r=qh(e,0,s,n,!0);const a=[];if(!r||r.next===r.prev)return a;let o,l,c,h,u,d,p;if(i&&(r=function(e,t,n,i){const s=[];let r,a,o,l,c;for(r=0,a=t.length;r<a;r++)o=t[r]*i,l=r<a-1?t[r+1]*i:e.length,c=qh(e,o,l,i,!1),c===c.next&&(c.steiner=!0),s.push(iu(c));for(s.sort(Qh),r=0;r<s.length;r++)n=eu(s[r],n);return n}(e,t,r,n)),e.length>80*n){o=c=e[0],l=h=e[1];for(let t=n;t<s;t+=n)u=e[t],d=e[t+1],u<o&&(o=u),d<l&&(l=d),u>c&&(c=u),d>h&&(h=d);p=Math.max(c-o,h-l),p=0!==p?32767/p:0}return Kh(r,a,n,o,l,p,0),a};function qh(e,t,n,i,s){let r,a;if(s===function(e,t,n,i){let s=0;for(let r=t,a=n-i;r<n;r+=i)s+=(e[a]-e[r])*(e[r+1]+e[a+1]),a=r;return s}(e,t,n,i)>0)for(r=t;r<n;r+=i)a=pu(r,e[r],e[r+1],a);else for(r=n-i;r>=t;r-=i)a=pu(r,e[r],e[r+1],a);return a&&ou(a,a.next)&&(mu(a),a=a.next),a}function Xh(e,t){if(!e)return e;t||(t=e);let n,i=e;do{if(n=!1,i.steiner||!ou(i,i.next)&&0!==au(i.prev,i,i.next))i=i.next;else{if(mu(i),i=t=i.prev,i===i.next)break;n=!0}}while(n||i!==t);return t}function Kh(e,t,n,i,s,r,a){if(!e)return;!a&&r&&function(e,t,n,i){let s=e;do{0===s.z&&(s.z=nu(s.x,s.y,t,n,i)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next}while(s!==e);s.prevZ.nextZ=null,s.prevZ=null,function(e){let t,n,i,s,r,a,o,l,c=1;do{for(n=e,e=null,r=null,a=0;n;){for(a++,i=n,o=0,t=0;t<c&&(o++,i=i.nextZ,i);t++);for(l=c;o>0||l>0&&i;)0!==o&&(0===l||!i||n.z<=i.z)?(s=n,n=n.nextZ,o--):(s=i,i=i.nextZ,l--),r?r.nextZ=s:e=s,s.prevZ=r,r=s;n=i}r.nextZ=null,c*=2}while(a>1)}(s)}(e,i,s,r);let o,l,c=e;for(;e.prev!==e.next;)if(o=e.prev,l=e.next,r?$h(e,i,s,r):Yh(e))t.push(o.i/n|0),t.push(e.i/n|0),t.push(l.i/n|0),mu(e),e=l.next,c=l.next;else if((e=l)===c){a?1===a?Kh(e=Zh(Xh(e),t,n),t,n,i,s,r,2):2===a&&Jh(e,t,n,i,s,r):Kh(Xh(e),t,n,i,s,r,1);break}}function Yh(e){const t=e.prev,n=e,i=e.next;if(au(t,n,i)>=0)return!1;const s=t.x,r=n.x,a=i.x,o=t.y,l=n.y,c=i.y,h=s<r?s<a?s:a:r<a?r:a,u=o<l?o<c?o:c:l<c?l:c,d=s>r?s>a?s:a:r>a?r:a,p=o>l?o>c?o:c:l>c?l:c;let m=i.next;for(;m!==t;){if(m.x>=h&&m.x<=d&&m.y>=u&&m.y<=p&&su(s,o,r,l,a,c,m.x,m.y)&&au(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function $h(e,t,n,i){const s=e.prev,r=e,a=e.next;if(au(s,r,a)>=0)return!1;const o=s.x,l=r.x,c=a.x,h=s.y,u=r.y,d=a.y,p=o<l?o<c?o:c:l<c?l:c,m=h<u?h<d?h:d:u<d?u:d,f=o>l?o>c?o:c:l>c?l:c,v=h>u?h>d?h:d:u>d?u:d,g=nu(p,m,t,n,i),_=nu(f,v,t,n,i);let w=e.prevZ,b=e.nextZ;for(;w&&w.z>=g&&b&&b.z<=_;){if(w.x>=p&&w.x<=f&&w.y>=m&&w.y<=v&&w!==s&&w!==a&&su(o,h,l,u,c,d,w.x,w.y)&&au(w.prev,w,w.next)>=0)return!1;if(w=w.prevZ,b.x>=p&&b.x<=f&&b.y>=m&&b.y<=v&&b!==s&&b!==a&&su(o,h,l,u,c,d,b.x,b.y)&&au(b.prev,b,b.next)>=0)return!1;b=b.nextZ}for(;w&&w.z>=g;){if(w.x>=p&&w.x<=f&&w.y>=m&&w.y<=v&&w!==s&&w!==a&&su(o,h,l,u,c,d,w.x,w.y)&&au(w.prev,w,w.next)>=0)return!1;w=w.prevZ}for(;b&&b.z<=_;){if(b.x>=p&&b.x<=f&&b.y>=m&&b.y<=v&&b!==s&&b!==a&&su(o,h,l,u,c,d,b.x,b.y)&&au(b.prev,b,b.next)>=0)return!1;b=b.nextZ}return!0}function Zh(e,t,n){let i=e;do{const s=i.prev,r=i.next.next;!ou(s,r)&&lu(s,i,i.next,r)&&uu(s,r)&&uu(r,s)&&(t.push(s.i/n|0),t.push(i.i/n|0),t.push(r.i/n|0),mu(i),mu(i.next),i=e=r),i=i.next}while(i!==e);return Xh(i)}function Jh(e,t,n,i,s,r){let a=e;do{let e=a.next.next;for(;e!==a.prev;){if(a.i!==e.i&&ru(a,e)){let o=du(a,e);return a=Xh(a,a.next),o=Xh(o,o.next),Kh(a,t,n,i,s,r,0),void Kh(o,t,n,i,s,r,0)}e=e.next}a=a.next}while(a!==e)}function Qh(e,t){return e.x-t.x}function eu(e,t){const n=function(e,t){let n,i=t,s=-1/0;const r=e.x,a=e.y;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){const e=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(e<=r&&e>s&&(s=e,n=i.x<i.next.x?i:i.next,e===r))return n}i=i.next}while(i!==t);if(!n)return null;const o=n,l=n.x,c=n.y;let h,u=1/0;i=n;do{r>=i.x&&i.x>=l&&r!==i.x&&su(a<c?r:s,a,l,c,a<c?s:r,a,i.x,i.y)&&(h=Math.abs(a-i.y)/(r-i.x),uu(i,e)&&(h<u||h===u&&(i.x>n.x||i.x===n.x&&tu(n,i)))&&(n=i,u=h)),i=i.next}while(i!==o);return n}(e,t);if(!n)return t;const i=du(n,e);return Xh(i,i.next),Xh(n,n.next)}function tu(e,t){return au(e.prev,e,t.prev)<0&&au(t.next,e,e.next)<0}function nu(e,t,n,i,s){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*s|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*s|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function iu(e){let t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function su(e,t,n,i,s,r,a,o){return(s-a)*(t-o)>=(e-a)*(r-o)&&(e-a)*(i-o)>=(n-a)*(t-o)&&(n-a)*(r-o)>=(s-a)*(i-o)}function ru(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&lu(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(uu(e,t)&&uu(t,e)&&function(e,t){let n=e,i=!1;const s=(e.x+t.x)/2,r=(e.y+t.y)/2;do{n.y>r!=n.next.y>r&&n.next.y!==n.y&&s<(n.next.x-n.x)*(r-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==e);return i}(e,t)&&(au(e.prev,e,t.prev)||au(e,t.prev,t))||ou(e,t)&&au(e.prev,e,e.next)>0&&au(t.prev,t,t.next)>0)}function au(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function ou(e,t){return e.x===t.x&&e.y===t.y}function lu(e,t,n,i){const s=hu(au(e,t,n)),r=hu(au(e,t,i)),a=hu(au(n,i,e)),o=hu(au(n,i,t));return s!==r&&a!==o||(!(0!==s||!cu(e,n,t))||(!(0!==r||!cu(e,i,t))||(!(0!==a||!cu(n,e,i))||!(0!==o||!cu(n,t,i)))))}function cu(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function hu(e){return e>0?1:e<0?-1:0}function uu(e,t){return au(e.prev,e,e.next)<0?au(e,t,e.next)>=0&&au(e,e.prev,t)>=0:au(e,t,e.prev)<0||au(e,e.next,t)<0}function du(e,t){const n=new fu(e.i,e.x,e.y),i=new fu(t.i,t.x,t.y),s=e.next,r=t.prev;return e.next=t,t.prev=e,n.next=s,s.prev=n,i.next=n,n.prev=i,r.next=i,i.prev=r,i}function pu(e,t,n,i){const s=new fu(e,t,n);return i?(s.next=i.next,s.prev=i,i.next.prev=s,i.next=s):(s.prev=s,s.next=s),s}function mu(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function fu(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}class vu{static area(e){const t=e.length;let n=0;for(let i=t-1,s=0;s<t;i=s++)n+=e[i].x*e[s].y-e[s].x*e[i].y;return.5*n}static isClockWise(e){return vu.area(e)<0}static triangulateShape(e,t){const n=[],i=[],s=[];gu(e),_u(n,e);let r=e.length;t.forEach(gu);for(let e=0;e<t.length;e++)i.push(r),r+=t[e].length,_u(n,t[e]);const a=Wh(n,i);for(let e=0;e<a.length;e+=3)s.push(a.slice(e,e+3));return s}}function gu(e){const t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function _u(e,t){for(let n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}class wu extends Mr{constructor(e=new jh([new Zn(.5,.5),new Zn(-.5,.5),new Zn(-.5,-.5),new Zn(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const n=this,i=[],s=[];for(let t=0,n=e.length;t<n;t++){r(e[t])}function r(e){const r=[],a=void 0!==t.curveSegments?t.curveSegments:12,o=void 0!==t.steps?t.steps:1,l=void 0!==t.depth?t.depth:1;let c=void 0===t.bevelEnabled||t.bevelEnabled,h=void 0!==t.bevelThickness?t.bevelThickness:.2,u=void 0!==t.bevelSize?t.bevelSize:h-.1,d=void 0!==t.bevelOffset?t.bevelOffset:0,p=void 0!==t.bevelSegments?t.bevelSegments:3;const m=t.extrudePath,f=void 0!==t.UVGenerator?t.UVGenerator:bu;let v,g,_,w,b,y=!1;m&&(v=m.getSpacedPoints(o),y=!0,c=!1,g=m.computeFrenetFrames(o,!1),_=new Ai,w=new Ai,b=new Ai),c||(p=0,h=0,u=0,d=0);const x=e.extractPoints(a);let M=x.shape;const E=x.holes;if(!vu.isClockWise(M)){M=M.reverse();for(let e=0,t=E.length;e<t;e++){const t=E[e];vu.isClockWise(t)&&(E[e]=t.reverse())}}const S=vu.triangulateShape(M,E),C=M;for(let e=0,t=E.length;e<t;e++){const t=E[e];M=M.concat(t)}function T(e,t,n){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().addScaledVector(t,n)}const P=M.length,A=S.length;function L(e,t,n){let i,s,r;const a=e.x-t.x,o=e.y-t.y,l=n.x-e.x,c=n.y-e.y,h=a*a+o*o,u=a*c-o*l;if(Math.abs(u)>Number.EPSILON){const u=Math.sqrt(h),d=Math.sqrt(l*l+c*c),p=t.x-o/u,m=t.y+a/u,f=((n.x-c/d-p)*c-(n.y+l/d-m)*l)/(a*c-o*l);i=p+a*f-e.x,s=m+o*f-e.y;const v=i*i+s*s;if(v<=2)return new Zn(i,s);r=Math.sqrt(v/2)}else{let e=!1;a>Number.EPSILON?l>Number.EPSILON&&(e=!0):a<-Number.EPSILON?l<-Number.EPSILON&&(e=!0):Math.sign(o)===Math.sign(c)&&(e=!0),e?(i=-o,s=a,r=Math.sqrt(h)):(i=a,s=o,r=Math.sqrt(h/2))}return new Zn(i/r,s/r)}const R=[];for(let e=0,t=C.length,n=t-1,i=e+1;e<t;e++,n++,i++)n===t&&(n=0),i===t&&(i=0),R[e]=L(C[e],C[n],C[i]);const D=[];let I,k=R.concat();for(let e=0,t=E.length;e<t;e++){const t=E[e];I=[];for(let e=0,n=t.length,i=n-1,s=e+1;e<n;e++,i++,s++)i===n&&(i=0),s===n&&(s=0),I[e]=L(t[e],t[i],t[s]);D.push(I),k=k.concat(I)}for(let e=0;e<p;e++){const t=e/p,n=h*Math.cos(t*Math.PI/2),i=u*Math.sin(t*Math.PI/2)+d;for(let e=0,t=C.length;e<t;e++){const t=T(C[e],R[e],i);U(t.x,t.y,-n)}for(let e=0,t=E.length;e<t;e++){const t=E[e];I=D[e];for(let e=0,s=t.length;e<s;e++){const s=T(t[e],I[e],i);U(s.x,s.y,-n)}}}const O=u+d;for(let e=0;e<P;e++){const t=c?T(M[e],k[e],O):M[e];y?(w.copy(g.normals[0]).multiplyScalar(t.x),_.copy(g.binormals[0]).multiplyScalar(t.y),b.copy(v[0]).add(w).add(_),U(b.x,b.y,b.z)):U(t.x,t.y,0)}for(let e=1;e<=o;e++)for(let t=0;t<P;t++){const n=c?T(M[t],k[t],O):M[t];y?(w.copy(g.normals[e]).multiplyScalar(n.x),_.copy(g.binormals[e]).multiplyScalar(n.y),b.copy(v[e]).add(w).add(_),U(b.x,b.y,b.z)):U(n.x,n.y,l/o*e)}for(let e=p-1;e>=0;e--){const t=e/p,n=h*Math.cos(t*Math.PI/2),i=u*Math.sin(t*Math.PI/2)+d;for(let e=0,t=C.length;e<t;e++){const t=T(C[e],R[e],i);U(t.x,t.y,l+n)}for(let e=0,t=E.length;e<t;e++){const t=E[e];I=D[e];for(let e=0,s=t.length;e<s;e++){const s=T(t[e],I[e],i);y?U(s.x,s.y+v[o-1].y,v[o-1].x+n):U(s.x,s.y,l+n)}}}function N(e,t){let n=e.length;for(;--n>=0;){const i=n;let s=n-1;s<0&&(s=e.length-1);for(let e=0,n=o+2*p;e<n;e++){const n=P*e,r=P*(e+1);B(t+i+n,t+s+n,t+s+r,t+i+r)}}}function U(e,t,n){r.push(e),r.push(t),r.push(n)}function V(e,t,s){F(e),F(t),F(s);const r=i.length/3,a=f.generateTopUV(n,i,r-3,r-2,r-1);z(a[0]),z(a[1]),z(a[2])}function B(e,t,s,r){F(e),F(t),F(r),F(t),F(s),F(r);const a=i.length/3,o=f.generateSideWallUV(n,i,a-6,a-3,a-2,a-1);z(o[0]),z(o[1]),z(o[3]),z(o[1]),z(o[2]),z(o[3])}function F(e){i.push(r[3*e+0]),i.push(r[3*e+1]),i.push(r[3*e+2])}function z(e){s.push(e.x),s.push(e.y)}!function(){const e=i.length/3;if(c){let e=0,t=P*e;for(let e=0;e<A;e++){const n=S[e];V(n[2]+t,n[1]+t,n[0]+t)}e=o+2*p,t=P*e;for(let e=0;e<A;e++){const n=S[e];V(n[0]+t,n[1]+t,n[2]+t)}}else{for(let e=0;e<A;e++){const t=S[e];V(t[2],t[1],t[0])}for(let e=0;e<A;e++){const t=S[e];V(t[0]+P*o,t[1]+P*o,t[2]+P*o)}}n.addGroup(e,i.length/3-e,0)}(),function(){const e=i.length/3;let t=0;N(C,t),t+=C.length;for(let e=0,n=E.length;e<n;e++){const n=E[e];N(n,t),t+=n.length}n.addGroup(e,i.length/3-e,1)}()}this.setAttribute("position",new mr(i,3)),this.setAttribute("uv",new mr(s,2)),this.computeVertexNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return function(e,t,n){if(n.shapes=[],Array.isArray(e))for(let t=0,i=e.length;t<i;t++){const i=e[t];n.shapes.push(i.uuid)}else n.shapes.push(e.uuid);n.options=Object.assign({},t),void 0!==t.extrudePath&&(n.options.extrudePath=t.extrudePath.toJSON());return n}(this.parameters.shapes,this.parameters.options,e)}static fromJSON(e,t){const n=[];for(let i=0,s=e.shapes.length;i<s;i++){const s=t[e.shapes[i]];n.push(s)}const i=e.options.extrudePath;return void 0!==i&&(e.options.extrudePath=(new Ah[i.type]).fromJSON(i)),new wu(n,e.options)}}const bu={generateTopUV:function(e,t,n,i,s){const r=t[3*n],a=t[3*n+1],o=t[3*i],l=t[3*i+1],c=t[3*s],h=t[3*s+1];return[new Zn(r,a),new Zn(o,l),new Zn(c,h)]},generateSideWallUV:function(e,t,n,i,s,r){const a=t[3*n],o=t[3*n+1],l=t[3*n+2],c=t[3*i],h=t[3*i+1],u=t[3*i+2],d=t[3*s],p=t[3*s+1],m=t[3*s+2],f=t[3*r],v=t[3*r+1],g=t[3*r+2];return Math.abs(o-h)<Math.abs(a-c)?[new Zn(a,1-l),new Zn(c,1-u),new Zn(d,1-m),new Zn(f,1-g)]:[new Zn(o,1-l),new Zn(h,1-u),new Zn(p,1-m),new Zn(v,1-g)]}};class yu extends Uh{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2;super([-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new yu(e.radius,e.detail)}}class xu extends Uh{constructor(e=1,t=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new xu(e.radius,e.detail)}}class Mu extends Mr{constructor(e=.5,t=1,n=32,i=1,s=0,r=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:i,thetaStart:s,thetaLength:r},n=Math.max(3,n);const a=[],o=[],l=[],c=[];let h=e;const u=(t-e)/(i=Math.max(1,i)),d=new Ai,p=new Zn;for(let e=0;e<=i;e++){for(let e=0;e<=n;e++){const i=s+e/n*r;d.x=h*Math.cos(i),d.y=h*Math.sin(i),o.push(d.x,d.y,d.z),l.push(0,0,1),p.x=(d.x/t+1)/2,p.y=(d.y/t+1)/2,c.push(p.x,p.y)}h+=u}for(let e=0;e<i;e++){const t=e*(n+1);for(let e=0;e<n;e++){const i=e+t,s=i,r=i+n+1,o=i+n+2,l=i+1;a.push(s,r,l),a.push(r,o,l)}}this.setIndex(a),this.setAttribute("position",new mr(o,3)),this.setAttribute("normal",new mr(l,3)),this.setAttribute("uv",new mr(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Mu(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class Eu extends Mr{constructor(e=new jh([new Zn(0,.5),new Zn(-.5,-.5),new Zn(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const n=[],i=[],s=[],r=[];let a=0,o=0;if(!1===Array.isArray(e))l(e);else for(let t=0;t<e.length;t++)l(e[t]),this.addGroup(a,o,t),a+=o,o=0;function l(e){const a=i.length/3,l=e.extractPoints(t);let c=l.shape;const h=l.holes;!1===vu.isClockWise(c)&&(c=c.reverse());for(let e=0,t=h.length;e<t;e++){const t=h[e];!0===vu.isClockWise(t)&&(h[e]=t.reverse())}const u=vu.triangulateShape(c,h);for(let e=0,t=h.length;e<t;e++){const t=h[e];c=c.concat(t)}for(let e=0,t=c.length;e<t;e++){const t=c[e];i.push(t.x,t.y,0),s.push(0,0,1),r.push(t.x,t.y)}for(let e=0,t=u.length;e<t;e++){const t=u[e],i=t[0]+a,s=t[1]+a,r=t[2]+a;n.push(i,s,r),o+=3}}this.setIndex(n),this.setAttribute("position",new mr(i,3)),this.setAttribute("normal",new mr(s,3)),this.setAttribute("uv",new mr(r,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return function(e,t){if(t.shapes=[],Array.isArray(e))for(let n=0,i=e.length;n<i;n++){const i=e[n];t.shapes.push(i.uuid)}else t.shapes.push(e.uuid);return t}(this.parameters.shapes,e)}static fromJSON(e,t){const n=[];for(let i=0,s=e.shapes.length;i<s;i++){const s=t[e.shapes[i]];n.push(s)}return new Eu(n,e.curveSegments)}}class Su extends Mr{constructor(e=1,t=32,n=16,i=0,s=2*Math.PI,r=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:i,phiLength:s,thetaStart:r,thetaLength:a},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const o=Math.min(r+a,Math.PI);let l=0;const c=[],h=new Ai,u=new Ai,d=[],p=[],m=[],f=[];for(let d=0;d<=n;d++){const v=[],g=d/n;let _=0;0===d&&0===r?_=.5/t:d===n&&o===Math.PI&&(_=-.5/t);for(let n=0;n<=t;n++){const o=n/t;h.x=-e*Math.cos(i+o*s)*Math.sin(r+g*a),h.y=e*Math.cos(r+g*a),h.z=e*Math.sin(i+o*s)*Math.sin(r+g*a),p.push(h.x,h.y,h.z),u.copy(h).normalize(),m.push(u.x,u.y,u.z),f.push(o+_,1-g),v.push(l++)}c.push(v)}for(let e=0;e<n;e++)for(let i=0;i<t;i++){const t=c[e][i+1],s=c[e][i],a=c[e+1][i],l=c[e+1][i+1];(0!==e||r>0)&&d.push(t,s,l),(e!==n-1||o<Math.PI)&&d.push(s,a,l)}this.setIndex(d),this.setAttribute("position",new mr(p,3)),this.setAttribute("normal",new mr(m,3)),this.setAttribute("uv",new mr(f,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Su(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class Cu extends Uh{constructor(e=1,t=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Cu(e.radius,e.detail)}}class Tu extends Mr{constructor(e=1,t=.4,n=12,i=48,s=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:i,arc:s},n=Math.floor(n),i=Math.floor(i);const r=[],a=[],o=[],l=[],c=new Ai,h=new Ai,u=new Ai;for(let r=0;r<=n;r++)for(let d=0;d<=i;d++){const p=d/i*s,m=r/n*Math.PI*2;h.x=(e+t*Math.cos(m))*Math.cos(p),h.y=(e+t*Math.cos(m))*Math.sin(p),h.z=t*Math.sin(m),a.push(h.x,h.y,h.z),c.x=e*Math.cos(p),c.y=e*Math.sin(p),u.subVectors(h,c).normalize(),o.push(u.x,u.y,u.z),l.push(d/i),l.push(r/n)}for(let e=1;e<=n;e++)for(let t=1;t<=i;t++){const n=(i+1)*e+t-1,s=(i+1)*(e-1)+t-1,a=(i+1)*(e-1)+t,o=(i+1)*e+t;r.push(n,s,o),r.push(s,a,o)}this.setIndex(r),this.setAttribute("position",new mr(a,3)),this.setAttribute("normal",new mr(o,3)),this.setAttribute("uv",new mr(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Tu(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class Pu extends Mr{constructor(e=1,t=.4,n=64,i=8,s=2,r=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:i,p:s,q:r},n=Math.floor(n),i=Math.floor(i);const a=[],o=[],l=[],c=[],h=new Ai,u=new Ai,d=new Ai,p=new Ai,m=new Ai,f=new Ai,v=new Ai;for(let a=0;a<=n;++a){const _=a/n*s*Math.PI*2;g(_,s,r,e,d),g(_+.01,s,r,e,p),f.subVectors(p,d),v.addVectors(p,d),m.crossVectors(f,v),v.crossVectors(m,f),m.normalize(),v.normalize();for(let e=0;e<=i;++e){const s=e/i*Math.PI*2,r=-t*Math.cos(s),p=t*Math.sin(s);h.x=d.x+(r*v.x+p*m.x),h.y=d.y+(r*v.y+p*m.y),h.z=d.z+(r*v.z+p*m.z),o.push(h.x,h.y,h.z),u.subVectors(h,d).normalize(),l.push(u.x,u.y,u.z),c.push(a/n),c.push(e/i)}}for(let e=1;e<=n;e++)for(let t=1;t<=i;t++){const n=(i+1)*(e-1)+(t-1),s=(i+1)*e+(t-1),r=(i+1)*e+t,o=(i+1)*(e-1)+t;a.push(n,s,o),a.push(s,r,o)}function g(e,t,n,i,s){const r=Math.cos(e),a=Math.sin(e),o=n/t*e,l=Math.cos(o);s.x=i*(2+l)*.5*r,s.y=i*(2+l)*a*.5,s.z=i*Math.sin(o)*.5}this.setIndex(a),this.setAttribute("position",new mr(o,3)),this.setAttribute("normal",new mr(l,3)),this.setAttribute("uv",new mr(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Pu(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class Au extends Mr{constructor(e=new Th(new Ai(-1,-1,0),new Ai(-1,1,0),new Ai(1,1,0)),t=64,n=1,i=8,s=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:i,closed:s};const r=e.computeFrenetFrames(t,s);this.tangents=r.tangents,this.normals=r.normals,this.binormals=r.binormals;const a=new Ai,o=new Ai,l=new Zn;let c=new Ai;const h=[],u=[],d=[],p=[];function m(s){c=e.getPointAt(s/t,c);const l=r.normals[s],d=r.binormals[s];for(let e=0;e<=i;e++){const t=e/i*Math.PI*2,s=Math.sin(t),r=-Math.cos(t);o.x=r*l.x+s*d.x,o.y=r*l.y+s*d.y,o.z=r*l.z+s*d.z,o.normalize(),u.push(o.x,o.y,o.z),a.x=c.x+n*o.x,a.y=c.y+n*o.y,a.z=c.z+n*o.z,h.push(a.x,a.y,a.z)}}!function(){for(let e=0;e<t;e++)m(e);m(!1===s?t:0),function(){for(let e=0;e<=t;e++)for(let n=0;n<=i;n++)l.x=e/t,l.y=n/i,d.push(l.x,l.y)}(),function(){for(let e=1;e<=t;e++)for(let t=1;t<=i;t++){const n=(i+1)*(e-1)+(t-1),s=(i+1)*e+(t-1),r=(i+1)*e+t,a=(i+1)*(e-1)+t;p.push(n,s,a),p.push(s,r,a)}}()}(),this.setIndex(p),this.setAttribute("position",new mr(h,3)),this.setAttribute("normal",new mr(u,3)),this.setAttribute("uv",new mr(d,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new Au((new Ah[e.path.type]).fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class Lu extends Mr{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},null!==e){const t=[],n=new Set,i=new Ai,s=new Ai;if(null!==e.index){const r=e.attributes.position,a=e.index;let o=e.groups;0===o.length&&(o=[{start:0,count:a.count,materialIndex:0}]);for(let e=0,l=o.length;e<l;++e){const l=o[e],c=l.start;for(let e=c,o=c+l.count;e<o;e+=3)for(let o=0;o<3;o++){const l=a.getX(e+o),c=a.getX(e+(o+1)%3);i.fromBufferAttribute(r,l),s.fromBufferAttribute(r,c),!0===Ru(i,s,n)&&(t.push(i.x,i.y,i.z),t.push(s.x,s.y,s.z))}}}else{const r=e.attributes.position;for(let e=0,a=r.count/3;e<a;e++)for(let a=0;a<3;a++){const o=3*e+a,l=3*e+(a+1)%3;i.fromBufferAttribute(r,o),s.fromBufferAttribute(r,l),!0===Ru(i,s,n)&&(t.push(i.x,i.y,i.z),t.push(s.x,s.y,s.z))}}this.setAttribute("position",new mr(t,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function Ru(e,t,n){const i=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`,s=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`;return!0!==n.has(i)&&!0!==n.has(s)&&(n.add(i),n.add(s),!0)}var Du=Object.freeze({__proto__:null,BoxGeometry:Gr,CapsuleGeometry:Ih,CircleGeometry:kh,ConeGeometry:Nh,CylinderGeometry:Oh,DodecahedronGeometry:Vh,EdgesGeometry:Gh,ExtrudeGeometry:wu,IcosahedronGeometry:yu,LatheGeometry:Dh,OctahedronGeometry:xu,PlaneGeometry:ha,PolyhedronGeometry:Uh,RingGeometry:Mu,ShapeGeometry:Eu,SphereGeometry:Su,TetrahedronGeometry:Cu,TorusGeometry:Tu,TorusKnotGeometry:Pu,TubeGeometry:Au,WireframeGeometry:Lu});class Iu extends js{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new Ys(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class ku extends Kr{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class Ou extends js{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Ys(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ys(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Wt,this.normalScale=new Zn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Nu extends Ou{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Zn(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Hn(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Ys(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Ys(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Ys(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class Uu extends js{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Ys(16777215),this.specular=new Ys(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ys(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Wt,this.normalScale=new Zn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=te,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Vu extends js{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Ys(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ys(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Wt,this.normalScale=new Zn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class Bu extends js{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Wt,this.normalScale=new Zn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class Fu extends js{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Ys(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ys(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Wt,this.normalScale=new Zn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=te,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class zu extends js{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Ys(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Wt,this.normalScale=new Zn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Hu extends Fc{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function Gu(e,t,n){return Wu(e)?new e.constructor(e.subarray(t,void 0!==n?n:e.length)):e.slice(t,n)}function ju(e,t,n){return!e||!n&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)}function Wu(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function qu(e){const t=e.length,n=new Array(t);for(let e=0;e!==t;++e)n[e]=e;return n.sort((function(t,n){return e[t]-e[n]})),n}function Xu(e,t,n){const i=e.length,s=new e.constructor(i);for(let r=0,a=0;a!==i;++r){const i=n[r]*t;for(let n=0;n!==t;++n)s[a++]=e[i+n]}return s}function Ku(e,t,n,i){let s=1,r=e[0];for(;void 0!==r&&void 0===r[i];)r=e[s++];if(void 0===r)return;let a=r[i];if(void 0!==a)if(Array.isArray(a))do{a=r[i],void 0!==a&&(t.push(r.time),n.push.apply(n,a)),r=e[s++]}while(void 0!==r);else if(void 0!==a.toArray)do{a=r[i],void 0!==a&&(t.push(r.time),a.toArray(n,n.length)),r=e[s++]}while(void 0!==r);else do{a=r[i],void 0!==a&&(t.push(r.time),n.push(a)),r=e[s++]}while(void 0!==r)}const Yu={arraySlice:Gu,convertArray:ju,isTypedArray:Wu,getKeyframeOrder:qu,sortedArray:Xu,flattenJSON:Ku,subclip:function(e,t,n,i,s=30){const r=e.clone();r.name=t;const a=[];for(let e=0;e<r.tracks.length;++e){const t=r.tracks[e],o=t.getValueSize(),l=[],c=[];for(let e=0;e<t.times.length;++e){const r=t.times[e]*s;if(!(r<n||r>=i)){l.push(t.times[e]);for(let n=0;n<o;++n)c.push(t.values[e*o+n])}}0!==l.length&&(t.times=ju(l,t.times.constructor),t.values=ju(c,t.values.constructor),a.push(t))}r.tracks=a;let o=1/0;for(let e=0;e<r.tracks.length;++e)o>r.tracks[e].times[0]&&(o=r.tracks[e].times[0]);for(let e=0;e<r.tracks.length;++e)r.tracks[e].shift(-1*o);return r.resetDuration(),r},makeClipAdditive:function(e,t=0,n=e,i=30){i<=0&&(i=30);const s=n.tracks.length,r=t/i;for(let t=0;t<s;++t){const i=n.tracks[t],s=i.ValueTypeName;if("bool"===s||"string"===s)continue;const a=e.tracks.find((function(e){return e.name===i.name&&e.ValueTypeName===s}));if(void 0===a)continue;let o=0;const l=i.getValueSize();i.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(o=l/3);let c=0;const h=a.getValueSize();a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=h/3);const u=i.times.length-1;let d;if(r<=i.times[0]){const e=o,t=l-o;d=Gu(i.values,e,t)}else if(r>=i.times[u]){const e=u*l+o,t=e+l-o;d=Gu(i.values,e,t)}else{const e=i.createInterpolant(),t=o,n=l-o;e.evaluate(r),d=Gu(e.resultBuffer,t,n)}if("quaternion"===s){(new Pi).fromArray(d).normalize().conjugate().toArray(d)}const p=a.times.length;for(let e=0;e<p;++e){const t=e*h+c;if("quaternion"===s)Pi.multiplyQuaternionsFlat(a.values,t,d,0,a.values,t);else{const e=h-2*c;for(let n=0;n<e;++n)a.values[t+n]-=d[n]}}}return e.blendMode=Ut,e}};class $u{constructor(e,t,n,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,i=t[n],s=t[n-1];e:{t:{let r;n:{i:if(!(e<i)){for(let r=n+2;;){if(void 0===i){if(e<s)break i;return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===r)break;if(s=i,i=t[++n],e<i)break t}r=t.length;break n}if(e>=s)break e;{const a=t[1];e<a&&(n=2,s=a);for(let r=n-2;;){if(void 0===s)return this._cachedIndex=0,this.copySampleValue_(0);if(n===r)break;if(i=s,s=t[--n-1],e>=s)break t}r=n,n=0}}for(;n<r;){const i=n+r>>>1;e<t[i]?r=i:n=i+1}if(i=t[n],s=t[n-1],void 0===s)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===i)return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,s,i)}return this.interpolate_(n,s,e,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,s=e*i;for(let e=0;e!==i;++e)t[e]=n[s+e];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class Zu extends $u{constructor(e,t,n,i){super(e,t,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:It,endingEnd:It}}intervalChanged_(e,t,n){const i=this.parameterPositions;let s=e-2,r=e+1,a=i[s],o=i[r];if(void 0===a)switch(this.getSettings_().endingStart){case kt:s=e,a=2*t-n;break;case Ot:s=i.length-2,a=t+i[s]-i[s+1];break;default:s=e,a=n}if(void 0===o)switch(this.getSettings_().endingEnd){case kt:r=e,o=2*n-t;break;case Ot:r=1,o=n+i[1]-i[0];break;default:r=e-1,o=t}const l=.5*(n-t),c=this.valueSize;this._weightPrev=l/(t-a),this._weightNext=l/(o-n),this._offsetPrev=s*c,this._offsetNext=r*c}interpolate_(e,t,n,i){const s=this.resultBuffer,r=this.sampleValues,a=this.valueSize,o=e*a,l=o-a,c=this._offsetPrev,h=this._offsetNext,u=this._weightPrev,d=this._weightNext,p=(n-t)/(i-t),m=p*p,f=m*p,v=-u*f+2*u*m-u*p,g=(1+u)*f+(-1.5-2*u)*m+(-.5+u)*p+1,_=(-1-d)*f+(1.5+d)*m+.5*p,w=d*f-d*m;for(let e=0;e!==a;++e)s[e]=v*r[c+e]+g*r[l+e]+_*r[o+e]+w*r[h+e];return s}}class Ju extends $u{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const s=this.resultBuffer,r=this.sampleValues,a=this.valueSize,o=e*a,l=o-a,c=(n-t)/(i-t),h=1-c;for(let e=0;e!==a;++e)s[e]=r[l+e]*h+r[o+e]*c;return s}}class Qu extends $u{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e){return this.copySampleValue_(e-1)}}class ed{constructor(e,t,n,i){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=ju(t,this.TimeBufferType),this.values=ju(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:ju(e.times,Array),values:ju(e.values,Array)};const t=e.getInterpolation();t!==e.DefaultInterpolation&&(n.interpolation=t)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new Qu(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new Ju(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new Zu(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case Lt:t=this.InterpolantFactoryMethodDiscrete;break;case Rt:t=this.InterpolantFactoryMethodLinear;break;case Dt:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Lt;case this.InterpolantFactoryMethodLinear:return Rt;case this.InterpolantFactoryMethodSmooth:return Dt}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]*=e}return this}trim(e,t){const n=this.times,i=n.length;let s=0,r=i-1;for(;s!==i&&n[s]<e;)++s;for(;-1!==r&&n[r]>t;)--r;if(++r,0!==s||r!==i){s>=r&&(r=Math.max(r,1),s=r-1);const e=this.getValueSize();this.times=Gu(n,s,r),this.values=Gu(this.values,s*e,r*e)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,i=this.values,s=n.length;0===s&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let r=null;for(let t=0;t!==s;t++){const i=n[t];if("number"==typeof i&&isNaN(i)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,t,i),e=!1;break}if(null!==r&&r>i){console.error("THREE.KeyframeTrack: Out of order keys.",this,t,i,r),e=!1;break}r=i}if(void 0!==i&&Wu(i))for(let t=0,n=i.length;t!==n;++t){const n=i[t];if(isNaN(n)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,t,n),e=!1;break}}return e}optimize(){const e=Gu(this.times),t=Gu(this.values),n=this.getValueSize(),i=this.getInterpolation()===Dt,s=e.length-1;let r=1;for(let a=1;a<s;++a){let s=!1;const o=e[a];if(o!==e[a+1]&&(1!==a||o!==e[0]))if(i)s=!0;else{const e=a*n,i=e-n,r=e+n;for(let a=0;a!==n;++a){const n=t[e+a];if(n!==t[i+a]||n!==t[r+a]){s=!0;break}}}if(s){if(a!==r){e[r]=e[a];const i=a*n,s=r*n;for(let e=0;e!==n;++e)t[s+e]=t[i+e]}++r}}if(s>0){e[r]=e[s];for(let e=s*n,i=r*n,a=0;a!==n;++a)t[i+a]=t[e+a];++r}return r!==e.length?(this.times=Gu(e,0,r),this.values=Gu(t,0,r*n)):(this.times=e,this.values=t),this}clone(){const e=Gu(this.times,0),t=Gu(this.values,0),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}ed.prototype.TimeBufferType=Float32Array,ed.prototype.ValueBufferType=Float32Array,ed.prototype.DefaultInterpolation=Rt;class td extends ed{}td.prototype.ValueTypeName="bool",td.prototype.ValueBufferType=Array,td.prototype.DefaultInterpolation=Lt,td.prototype.InterpolantFactoryMethodLinear=void 0,td.prototype.InterpolantFactoryMethodSmooth=void 0;class nd extends ed{}nd.prototype.ValueTypeName="color";class id extends ed{}id.prototype.ValueTypeName="number";class sd extends $u{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const s=this.resultBuffer,r=this.sampleValues,a=this.valueSize,o=(n-t)/(i-t);let l=e*a;for(let e=l+a;l!==e;l+=4)Pi.slerpFlat(s,0,r,l-a,r,l,o);return s}}class rd extends ed{InterpolantFactoryMethodLinear(e){return new sd(this.times,this.values,this.getValueSize(),e)}}rd.prototype.ValueTypeName="quaternion",rd.prototype.DefaultInterpolation=Rt,rd.prototype.InterpolantFactoryMethodSmooth=void 0;class ad extends ed{}ad.prototype.ValueTypeName="string",ad.prototype.ValueBufferType=Array,ad.prototype.DefaultInterpolation=Lt,ad.prototype.InterpolantFactoryMethodLinear=void 0,ad.prototype.InterpolantFactoryMethodSmooth=void 0;class od extends ed{}od.prototype.ValueTypeName="vector";class ld{constructor(e,t=-1,n,i=Nt){this.name=e,this.tracks=n,this.duration=t,this.blendMode=i,this.uuid=zn(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],n=e.tracks,i=1/(e.fps||1);for(let e=0,s=n.length;e!==s;++e)t.push(cd(n[e]).scale(i));const s=new this(e.name,e.duration,t,e.blendMode);return s.uuid=e.uuid,s}static toJSON(e){const t=[],n=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let e=0,i=n.length;e!==i;++e)t.push(ed.toJSON(n[e]));return i}static CreateFromMorphTargetSequence(e,t,n,i){const s=t.length,r=[];for(let e=0;e<s;e++){let a=[],o=[];a.push((e+s-1)%s,e,(e+1)%s),o.push(0,1,0);const l=qu(a);a=Xu(a,1,l),o=Xu(o,1,l),i||0!==a[0]||(a.push(s),o.push(o[0])),r.push(new id(".morphTargetInfluences["+t[e].name+"]",a,o).scale(1/n))}return new this(e,-1,r)}static findByName(e,t){let n=e;if(!Array.isArray(e)){const t=e;n=t.geometry&&t.geometry.animations||t.animations}for(let e=0;e<n.length;e++)if(n[e].name===t)return n[e];return null}static CreateClipsFromMorphTargetSequences(e,t,n){const i={},s=/^([\w-]*?)([\d]+)$/;for(let t=0,n=e.length;t<n;t++){const n=e[t],r=n.name.match(s);if(r&&r.length>1){const e=r[1];let t=i[e];t||(i[e]=t=[]),t.push(n)}}const r=[];for(const e in i)r.push(this.CreateFromMorphTargetSequence(e,i[e],t,n));return r}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(e,t,n,i,s){if(0!==n.length){const r=[],a=[];Ku(n,r,a,i),0!==r.length&&s.push(new e(t,r,a))}},i=[],s=e.name||"default",r=e.fps||30,a=e.blendMode;let o=e.length||-1;const l=e.hierarchy||[];for(let e=0;e<l.length;e++){const s=l[e].keys;if(s&&0!==s.length)if(s[0].morphTargets){const e={};let t;for(t=0;t<s.length;t++)if(s[t].morphTargets)for(let n=0;n<s[t].morphTargets.length;n++)e[s[t].morphTargets[n]]=-1;for(const n in e){const e=[],r=[];for(let i=0;i!==s[t].morphTargets.length;++i){const i=s[t];e.push(i.time),r.push(i.morphTarget===n?1:0)}i.push(new id(".morphTargetInfluence["+n+"]",e,r))}o=e.length*r}else{const r=".bones["+t[e].name+"]";n(od,r+".position",s,"pos",i),n(rd,r+".quaternion",s,"rot",i),n(od,r+".scale",s,"scl",i)}}if(0===i.length)return null;return new this(s,o,i,a)}resetDuration(){let e=0;for(let t=0,n=this.tracks.length;t!==n;++t){const n=this.tracks[t];e=Math.max(e,n.times[n.times.length-1])}return this.duration=e,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function cd(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return id;case"vector":case"vector2":case"vector3":case"vector4":return od;case"color":return nd;case"quaternion":return rd;case"bool":case"boolean":return td;case"string":return ad}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){const t=[],n=[];Ku(e.keys,t,n,"value"),e.times=t,e.values=n}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}const hd={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};class ud{constructor(e,t,n){const i=this;let s,r=!1,a=0,o=0;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){o++,!1===r&&void 0!==i.onStart&&i.onStart(e,a,o),r=!0},this.itemEnd=function(e){a++,void 0!==i.onProgress&&i.onProgress(e,a,o),a===o&&(r=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(e){void 0!==i.onError&&i.onError(e)},this.resolveURL=function(e){return s?s(e):e},this.setURLModifier=function(e){return s=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){const t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(let t=0,n=l.length;t<n;t+=2){const n=l[t],i=l[t+1];if(n.global&&(n.lastIndex=0),n.test(e))return i}return null}}}const dd=new ud;class pd{constructor(e){this.manager=void 0!==e?e:dd,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise((function(i,s){n.load(e,i,t,s)}))}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}pd.DEFAULT_MATERIAL_NAME="__DEFAULT";const md={};class fd extends Error{constructor(e,t){super(e),this.response=t}}class vd extends pd{constructor(e){super(e)}load(e,t,n,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const s=hd.get(e);if(void 0!==s)return this.manager.itemStart(e),setTimeout((()=>{t&&t(s),this.manager.itemEnd(e)}),0),s;if(void 0!==md[e])return void md[e].push({onLoad:t,onProgress:n,onError:i});md[e]=[],md[e].push({onLoad:t,onProgress:n,onError:i});const r=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,o=this.responseType;fetch(r).then((t=>{if(200===t.status||0===t.status){if(0===t.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===t.body||void 0===t.body.getReader)return t;const n=md[e],i=t.body.getReader(),s=t.headers.get("Content-Length")||t.headers.get("X-File-Size"),r=s?parseInt(s):0,a=0!==r;let o=0;const l=new ReadableStream({start(e){!function t(){i.read().then((({done:i,value:s})=>{if(i)e.close();else{o+=s.byteLength;const i=new ProgressEvent("progress",{lengthComputable:a,loaded:o,total:r});for(let e=0,t=n.length;e<t;e++){const t=n[e];t.onProgress&&t.onProgress(i)}e.enqueue(s),t()}}))}()}});return new Response(l)}throw new fd(`fetch for "${t.url}" responded with ${t.status}: ${t.statusText}`,t)})).then((e=>{switch(o){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then((e=>(new DOMParser).parseFromString(e,a)));case"json":return e.json();default:if(void 0===a)return e.text();{const t=/charset="?([^;"\s]*)"?/i.exec(a),n=t&&t[1]?t[1].toLowerCase():void 0,i=new TextDecoder(n);return e.arrayBuffer().then((e=>i.decode(e)))}}})).then((t=>{hd.add(e,t);const n=md[e];delete md[e];for(let e=0,i=n.length;e<i;e++){const i=n[e];i.onLoad&&i.onLoad(t)}})).catch((t=>{const n=md[e];if(void 0===n)throw this.manager.itemError(e),t;delete md[e];for(let e=0,i=n.length;e<i;e++){const i=n[e];i.onError&&i.onError(t)}this.manager.itemError(e)})).finally((()=>{this.manager.itemEnd(e)})),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class gd extends pd{constructor(e){super(e)}load(e,t,n,i){const s=this,r=new vd(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,(function(n){try{t(s.parse(JSON.parse(n)))}catch(t){i?i(t):console.error(t),s.manager.itemError(e)}}),n,i)}parse(e){const t=[];for(let n=0;n<e.length;n++){const i=ld.parse(e[n]);t.push(i)}return t}}class _d extends pd{constructor(e){super(e)}load(e,t,n,i){const s=this,r=[],a=new ah,o=new vd(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(s.withCredentials);let l=0;function c(c){o.load(e[c],(function(e){const n=s.parse(e,!0);r[c]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},l+=1,6===l&&(1===n.mipmapCount&&(a.minFilter=Ee),a.image=r,a.format=n.format,a.needsUpdate=!0,t&&t(a))}),n,i)}if(Array.isArray(e))for(let t=0,n=e.length;t<n;++t)c(t);else o.load(e,(function(e){const n=s.parse(e,!0);if(n.isCubemap){const e=n.mipmaps.length/n.mipmapCount;for(let t=0;t<e;t++){r[t]={mipmaps:[]};for(let e=0;e<n.mipmapCount;e++)r[t].mipmaps.push(n.mipmaps[t*n.mipmapCount+e]),r[t].format=n.format,r[t].width=n.width,r[t].height=n.height}a.image=r}else a.image.width=n.width,a.image.height=n.height,a.mipmaps=n.mipmaps;1===n.mipmapCount&&(a.minFilter=Ee),a.format=n.format,a.needsUpdate=!0,t&&t(a)}),n,i);return a}}class wd extends pd{constructor(e){super(e)}load(e,t,n,i){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,r=hd.get(e);if(void 0!==r)return s.manager.itemStart(e),setTimeout((function(){t&&t(r),s.manager.itemEnd(e)}),0),r;const a=ii("img");function o(){c(),hd.add(e,this),t&&t(this),s.manager.itemEnd(e)}function l(t){c(),i&&i(t),s.manager.itemError(e),s.manager.itemEnd(e)}function c(){a.removeEventListener("load",o,!1),a.removeEventListener("error",l,!1)}return a.addEventListener("load",o,!1),a.addEventListener("error",l,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),s.manager.itemStart(e),a.src=e,a}}class bd extends pd{constructor(e){super(e)}load(e,t,n,i){const s=new Qr;s.colorSpace=Kt;const r=new wd(this.manager);r.setCrossOrigin(this.crossOrigin),r.setPath(this.path);let a=0;function o(n){r.load(e[n],(function(e){s.images[n]=e,a++,6===a&&(s.needsUpdate=!0,t&&t(s))}),void 0,i)}for(let t=0;t<e.length;++t)o(t);return s}}class yd extends pd{constructor(e){super(e)}load(e,t,n,i){const s=this,r=new Tc,a=new vd(this.manager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(s.withCredentials),a.load(e,(function(e){let n;try{n=s.parse(e)}catch(e){if(void 0===i)return void console.error(e);i(e)}if(!n)return i();void 0!==n.image?r.image=n.image:void 0!==n.data&&(r.image.width=n.width,r.image.height=n.height,r.image.data=n.data),r.wrapS=void 0!==n.wrapS?n.wrapS:ge,r.wrapT=void 0!==n.wrapT?n.wrapT:ge,r.magFilter=void 0!==n.magFilter?n.magFilter:Ee,r.minFilter=void 0!==n.minFilter?n.minFilter:Ee,r.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.colorSpace?r.colorSpace=n.colorSpace:void 0!==n.encoding&&(r.encoding=n.encoding),void 0!==n.flipY&&(r.flipY=n.flipY),void 0!==n.format&&(r.format=n.format),void 0!==n.type&&(r.type=n.type),void 0!==n.mipmaps&&(r.mipmaps=n.mipmaps,r.minFilter=Te),1===n.mipmapCount&&(r.minFilter=Ee),void 0!==n.generateMipmaps&&(r.generateMipmaps=n.generateMipmaps),r.needsUpdate=!0,t&&t(r,n)}),n,i),r}}class xd extends pd{constructor(e){super(e)}load(e,t,n,i){const s=new wi,r=new wd(this.manager);return r.setCrossOrigin(this.crossOrigin),r.setPath(this.path),r.load(e,(function(e){s.image=e,s.needsUpdate=!0,void 0!==t&&t(s)}),n,i),s}}class Md extends Ls{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new Ys(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}class Ed extends Md{constructor(e,t,n){super(e,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Ls.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Ys(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const Sd=new rs,Cd=new Ai,Td=new Ai;class Pd{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Zn(512,512),this.map=null,this.mapPass=null,this.matrix=new rs,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new oa,this._frameExtents=new Zn(1,1),this._viewportCount=1,this._viewports=[new bi(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;Cd.setFromMatrixPosition(e.matrixWorld),t.position.copy(Cd),Td.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(Td),t.updateMatrixWorld(),Sd.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Sd),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(Sd)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class Ad extends Pd{constructor(){super(new $r(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,n=2*Fn*e.angle*this.focus,i=this.mapSize.width/this.mapSize.height,s=e.distance||t.far;n===t.fov&&i===t.aspect&&s===t.far||(t.fov=n,t.aspect=i,t.far=s,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class Ld extends Md{constructor(e,t,n=0,i=Math.PI/3,s=0,r=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Ls.DEFAULT_UP),this.updateMatrix(),this.target=new Ls,this.distance=n,this.angle=i,this.penumbra=s,this.decay=r,this.map=null,this.shadow=new Ad}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const Rd=new rs,Dd=new Ai,Id=new Ai;class kd extends Pd{constructor(){super(new $r(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Zn(4,2),this._viewportCount=6,this._viewports=[new bi(2,1,1,1),new bi(0,1,1,1),new bi(3,1,1,1),new bi(1,1,1,1),new bi(3,0,1,1),new bi(1,0,1,1)],this._cubeDirections=[new Ai(1,0,0),new Ai(-1,0,0),new Ai(0,0,1),new Ai(0,0,-1),new Ai(0,1,0),new Ai(0,-1,0)],this._cubeUps=[new Ai(0,1,0),new Ai(0,1,0),new Ai(0,1,0),new Ai(0,1,0),new Ai(0,0,1),new Ai(0,0,-1)]}updateMatrices(e,t=0){const n=this.camera,i=this.matrix,s=e.distance||n.far;s!==n.far&&(n.far=s,n.updateProjectionMatrix()),Dd.setFromMatrixPosition(e.matrixWorld),n.position.copy(Dd),Id.copy(n.position),Id.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(Id),n.updateMatrixWorld(),i.makeTranslation(-Dd.x,-Dd.y,-Dd.z),Rd.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Rd)}}class Od extends Md{constructor(e,t,n=0,i=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=i,this.shadow=new kd}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class Nd extends Pd{constructor(){super(new ya(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class Ud extends Md{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Ls.DEFAULT_UP),this.updateMatrix(),this.target=new Ls,this.shadow=new Nd}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class Vd extends Md{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class Bd extends Md{constructor(e,t,n=10,i=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=n,this.height=i}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class Fd{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new Ai)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const n=e.x,i=e.y,s=e.z,r=this.coefficients;return t.copy(r[0]).multiplyScalar(.282095),t.addScaledVector(r[1],.488603*i),t.addScaledVector(r[2],.488603*s),t.addScaledVector(r[3],.488603*n),t.addScaledVector(r[4],n*i*1.092548),t.addScaledVector(r[5],i*s*1.092548),t.addScaledVector(r[6],.315392*(3*s*s-1)),t.addScaledVector(r[7],n*s*1.092548),t.addScaledVector(r[8],.546274*(n*n-i*i)),t}getIrradianceAt(e,t){const n=e.x,i=e.y,s=e.z,r=this.coefficients;return t.copy(r[0]).multiplyScalar(.886227),t.addScaledVector(r[1],1.023328*i),t.addScaledVector(r[2],1.023328*s),t.addScaledVector(r[3],1.023328*n),t.addScaledVector(r[4],.858086*n*i),t.addScaledVector(r[5],.858086*i*s),t.addScaledVector(r[6],.743125*s*s-.247708),t.addScaledVector(r[7],.858086*n*s),t.addScaledVector(r[8],.429043*(n*n-i*i)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(e,t=0){const n=this.coefficients;for(let i=0;i<9;i++)n[i].fromArray(e,t+3*i);return this}toArray(e=[],t=0){const n=this.coefficients;for(let i=0;i<9;i++)n[i].toArray(e,t+3*i);return e}static getBasisAt(e,t){const n=e.x,i=e.y,s=e.z;t[0]=.282095,t[1]=.488603*i,t[2]=.488603*s,t[3]=.488603*n,t[4]=1.092548*n*i,t[5]=1.092548*i*s,t[6]=.315392*(3*s*s-1),t[7]=1.092548*n*s,t[8]=.546274*(n*n-i*i)}}class zd extends Md{constructor(e=new Fd,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class Hd extends pd{constructor(e){super(e),this.textures={}}load(e,t,n,i){const s=this,r=new vd(s.manager);r.setPath(s.path),r.setRequestHeader(s.requestHeader),r.setWithCredentials(s.withCredentials),r.load(e,(function(n){try{t(s.parse(JSON.parse(n)))}catch(t){i?i(t):console.error(t),s.manager.itemError(e)}}),n,i)}parse(e){const t=this.textures;function n(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}const i=Hd.createMaterialFromType(e.type);if(void 0!==e.uuid&&(i.uuid=e.uuid),void 0!==e.name&&(i.name=e.name),void 0!==e.color&&void 0!==i.color&&i.color.setHex(e.color),void 0!==e.roughness&&(i.roughness=e.roughness),void 0!==e.metalness&&(i.metalness=e.metalness),void 0!==e.sheen&&(i.sheen=e.sheen),void 0!==e.sheenColor&&(i.sheenColor=(new Ys).setHex(e.sheenColor)),void 0!==e.sheenRoughness&&(i.sheenRoughness=e.sheenRoughness),void 0!==e.emissive&&void 0!==i.emissive&&i.emissive.setHex(e.emissive),void 0!==e.specular&&void 0!==i.specular&&i.specular.setHex(e.specular),void 0!==e.specularIntensity&&(i.specularIntensity=e.specularIntensity),void 0!==e.specularColor&&void 0!==i.specularColor&&i.specularColor.setHex(e.specularColor),void 0!==e.shininess&&(i.shininess=e.shininess),void 0!==e.clearcoat&&(i.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(i.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.iridescence&&(i.iridescence=e.iridescence),void 0!==e.iridescenceIOR&&(i.iridescenceIOR=e.iridescenceIOR),void 0!==e.iridescenceThicknessRange&&(i.iridescenceThicknessRange=e.iridescenceThicknessRange),void 0!==e.transmission&&(i.transmission=e.transmission),void 0!==e.thickness&&(i.thickness=e.thickness),void 0!==e.attenuationDistance&&(i.attenuationDistance=e.attenuationDistance),void 0!==e.attenuationColor&&void 0!==i.attenuationColor&&i.attenuationColor.setHex(e.attenuationColor),void 0!==e.anisotropy&&(i.anisotropy=e.anisotropy),void 0!==e.anisotropyRotation&&(i.anisotropyRotation=e.anisotropyRotation),void 0!==e.fog&&(i.fog=e.fog),void 0!==e.flatShading&&(i.flatShading=e.flatShading),void 0!==e.blending&&(i.blending=e.blending),void 0!==e.combine&&(i.combine=e.combine),void 0!==e.side&&(i.side=e.side),void 0!==e.shadowSide&&(i.shadowSide=e.shadowSide),void 0!==e.opacity&&(i.opacity=e.opacity),void 0!==e.transparent&&(i.transparent=e.transparent),void 0!==e.alphaTest&&(i.alphaTest=e.alphaTest),void 0!==e.alphaHash&&(i.alphaHash=e.alphaHash),void 0!==e.depthTest&&(i.depthTest=e.depthTest),void 0!==e.depthWrite&&(i.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(i.colorWrite=e.colorWrite),void 0!==e.stencilWrite&&(i.stencilWrite=e.stencilWrite),void 0!==e.stencilWriteMask&&(i.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(i.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(i.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(i.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(i.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(i.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(i.stencilZPass=e.stencilZPass),void 0!==e.wireframe&&(i.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(i.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(i.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(i.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(i.rotation=e.rotation),1!==e.linewidth&&(i.linewidth=e.linewidth),void 0!==e.dashSize&&(i.dashSize=e.dashSize),void 0!==e.gapSize&&(i.gapSize=e.gapSize),void 0!==e.scale&&(i.scale=e.scale),void 0!==e.polygonOffset&&(i.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(i.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(i.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.dithering&&(i.dithering=e.dithering),void 0!==e.alphaToCoverage&&(i.alphaToCoverage=e.alphaToCoverage),void 0!==e.premultipliedAlpha&&(i.premultipliedAlpha=e.premultipliedAlpha),void 0!==e.forceSinglePass&&(i.forceSinglePass=e.forceSinglePass),void 0!==e.visible&&(i.visible=e.visible),void 0!==e.toneMapped&&(i.toneMapped=e.toneMapped),void 0!==e.userData&&(i.userData=e.userData),void 0!==e.vertexColors&&("number"==typeof e.vertexColors?i.vertexColors=e.vertexColors>0:i.vertexColors=e.vertexColors),void 0!==e.uniforms)for(const t in e.uniforms){const s=e.uniforms[t];switch(i.uniforms[t]={},s.type){case"t":i.uniforms[t].value=n(s.value);break;case"c":i.uniforms[t].value=(new Ys).setHex(s.value);break;case"v2":i.uniforms[t].value=(new Zn).fromArray(s.value);break;case"v3":i.uniforms[t].value=(new Ai).fromArray(s.value);break;case"v4":i.uniforms[t].value=(new bi).fromArray(s.value);break;case"m3":i.uniforms[t].value=(new Jn).fromArray(s.value);break;case"m4":i.uniforms[t].value=(new rs).fromArray(s.value);break;default:i.uniforms[t].value=s.value}}if(void 0!==e.defines&&(i.defines=e.defines),void 0!==e.vertexShader&&(i.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(i.fragmentShader=e.fragmentShader),void 0!==e.glslVersion&&(i.glslVersion=e.glslVersion),void 0!==e.extensions)for(const t in e.extensions)i.extensions[t]=e.extensions[t];if(void 0!==e.lights&&(i.lights=e.lights),void 0!==e.clipping&&(i.clipping=e.clipping),void 0!==e.size&&(i.size=e.size),void 0!==e.sizeAttenuation&&(i.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(i.map=n(e.map)),void 0!==e.matcap&&(i.matcap=n(e.matcap)),void 0!==e.alphaMap&&(i.alphaMap=n(e.alphaMap)),void 0!==e.bumpMap&&(i.bumpMap=n(e.bumpMap)),void 0!==e.bumpScale&&(i.bumpScale=e.bumpScale),void 0!==e.normalMap&&(i.normalMap=n(e.normalMap)),void 0!==e.normalMapType&&(i.normalMapType=e.normalMapType),void 0!==e.normalScale){let t=e.normalScale;!1===Array.isArray(t)&&(t=[t,t]),i.normalScale=(new Zn).fromArray(t)}return void 0!==e.displacementMap&&(i.displacementMap=n(e.displacementMap)),void 0!==e.displacementScale&&(i.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(i.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(i.roughnessMap=n(e.roughnessMap)),void 0!==e.metalnessMap&&(i.metalnessMap=n(e.metalnessMap)),void 0!==e.emissiveMap&&(i.emissiveMap=n(e.emissiveMap)),void 0!==e.emissiveIntensity&&(i.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(i.specularMap=n(e.specularMap)),void 0!==e.specularIntensityMap&&(i.specularIntensityMap=n(e.specularIntensityMap)),void 0!==e.specularColorMap&&(i.specularColorMap=n(e.specularColorMap)),void 0!==e.envMap&&(i.envMap=n(e.envMap)),void 0!==e.envMapIntensity&&(i.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(i.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(i.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(i.lightMap=n(e.lightMap)),void 0!==e.lightMapIntensity&&(i.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(i.aoMap=n(e.aoMap)),void 0!==e.aoMapIntensity&&(i.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(i.gradientMap=n(e.gradientMap)),void 0!==e.clearcoatMap&&(i.clearcoatMap=n(e.clearcoatMap)),void 0!==e.clearcoatRoughnessMap&&(i.clearcoatRoughnessMap=n(e.clearcoatRoughnessMap)),void 0!==e.clearcoatNormalMap&&(i.clearcoatNormalMap=n(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(i.clearcoatNormalScale=(new Zn).fromArray(e.clearcoatNormalScale)),void 0!==e.iridescenceMap&&(i.iridescenceMap=n(e.iridescenceMap)),void 0!==e.iridescenceThicknessMap&&(i.iridescenceThicknessMap=n(e.iridescenceThicknessMap)),void 0!==e.transmissionMap&&(i.transmissionMap=n(e.transmissionMap)),void 0!==e.thicknessMap&&(i.thicknessMap=n(e.thicknessMap)),void 0!==e.anisotropyMap&&(i.anisotropyMap=n(e.anisotropyMap)),void 0!==e.sheenColorMap&&(i.sheenColorMap=n(e.sheenColorMap)),void 0!==e.sheenRoughnessMap&&(i.sheenRoughnessMap=n(e.sheenRoughnessMap)),i}setTextures(e){return this.textures=e,this}static createMaterialFromType(e){return new{ShadowMaterial:Iu,SpriteMaterial:Zl,RawShaderMaterial:ku,ShaderMaterial:Kr,PointsMaterial:Zc,MeshPhysicalMaterial:Nu,MeshStandardMaterial:Ou,MeshPhongMaterial:Uu,MeshToonMaterial:Vu,MeshNormalMaterial:Bu,MeshLambertMaterial:Fu,MeshDepthMaterial:Pl,MeshDistanceMaterial:Al,MeshBasicMaterial:Zs,MeshMatcapMaterial:zu,LineDashedMaterial:Hu,LineBasicMaterial:Fc,Material:js}[e]}}class Gd{static decodeText(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);let t="";for(let n=0,i=e.length;n<i;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch(e){return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return-1===t?"./":e.slice(0,t+1)}static resolveURL(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class jd extends Mr{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class Wd extends pd{constructor(e){super(e)}load(e,t,n,i){const s=this,r=new vd(s.manager);r.setPath(s.path),r.setRequestHeader(s.requestHeader),r.setWithCredentials(s.withCredentials),r.load(e,(function(n){try{t(s.parse(JSON.parse(n)))}catch(t){i?i(t):console.error(t),s.manager.itemError(e)}}),n,i)}parse(e){const t={},n={};function i(e,i){if(void 0!==t[i])return t[i];const s=e.interleavedBuffers[i],r=function(e,t){if(void 0!==n[t])return n[t];const i=e.arrayBuffers,s=i[t],r=new Uint32Array(s).buffer;return n[t]=r,r}(e,s.buffer),a=ni(s.type,r),o=new Kl(a,s.stride);return o.uuid=s.uuid,t[i]=o,o}const s=e.isInstancedBufferGeometry?new jd:new Mr,r=e.data.index;if(void 0!==r){const e=ni(r.type,r.array);s.setIndex(new rr(e,1))}const a=e.data.attributes;for(const t in a){const n=a[t];let r;if(n.isInterleavedBufferAttribute){const t=i(e.data,n.data);r=new $l(t,n.itemSize,n.offset,n.normalized)}else{const e=ni(n.type,n.array);r=new(n.isInstancedBufferAttribute?Rc:rr)(e,n.itemSize,n.normalized)}void 0!==n.name&&(r.name=n.name),void 0!==n.usage&&r.setUsage(n.usage),void 0!==n.updateRange&&(r.updateRange.offset=n.updateRange.offset,r.updateRange.count=n.updateRange.count),s.setAttribute(t,r)}const o=e.data.morphAttributes;if(o)for(const t in o){const n=o[t],r=[];for(let t=0,s=n.length;t<s;t++){const s=n[t];let a;if(s.isInterleavedBufferAttribute){const t=i(e.data,s.data);a=new $l(t,s.itemSize,s.offset,s.normalized)}else{const e=ni(s.type,s.array);a=new rr(e,s.itemSize,s.normalized)}void 0!==s.name&&(a.name=s.name),r.push(a)}s.morphAttributes[t]=r}e.data.morphTargetsRelative&&(s.morphTargetsRelative=!0);const l=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==l)for(let e=0,t=l.length;e!==t;++e){const t=l[e];s.addGroup(t.start,t.count,t.materialIndex)}const c=e.data.boundingSphere;if(void 0!==c){const e=new Ai;void 0!==c.center&&e.fromArray(c.center),s.boundingSphere=new $i(e,c.radius)}return e.name&&(s.name=e.name),e.userData&&(s.userData=e.userData),s}}class qd extends pd{constructor(e){super(e)}load(e,t,n,i){const s=this,r=""===this.path?Gd.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||r;const a=new vd(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,(function(n){let r=null;try{r=JSON.parse(n)}catch(t){return void 0!==i&&i(t),void console.error("THREE:ObjectLoader: Can't parse "+e+".",t.message)}const a=r.metadata;if(void 0===a||void 0===a.type||"geometry"===a.type.toLowerCase())return void 0!==i&&i(new Error("THREE.ObjectLoader: Can't load "+e)),void console.error("THREE.ObjectLoader: Can't load "+e);s.parse(r,t)}),n,i)}async loadAsync(e,t){const n=""===this.path?Gd.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||n;const i=new vd(this.manager);i.setPath(this.path),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials);const s=await i.loadAsync(e,t),r=JSON.parse(s),a=r.metadata;if(void 0===a||void 0===a.type||"geometry"===a.type.toLowerCase())throw new Error("THREE.ObjectLoader: Can't load "+e);return await this.parseAsync(r)}parse(e,t){const n=this.parseAnimations(e.animations),i=this.parseShapes(e.shapes),s=this.parseGeometries(e.geometries,i),r=this.parseImages(e.images,(function(){void 0!==t&&t(l)})),a=this.parseTextures(e.textures,r),o=this.parseMaterials(e.materials,a),l=this.parseObject(e.object,s,o,a,n),c=this.parseSkeletons(e.skeletons,l);if(this.bindSkeletons(l,c),void 0!==t){let e=!1;for(const t in r)if(r[t].data instanceof HTMLImageElement){e=!0;break}!1===e&&t(l)}return l}async parseAsync(e){const t=this.parseAnimations(e.animations),n=this.parseShapes(e.shapes),i=this.parseGeometries(e.geometries,n),s=await this.parseImagesAsync(e.images),r=this.parseTextures(e.textures,s),a=this.parseMaterials(e.materials,r),o=this.parseObject(e.object,i,a,r,t),l=this.parseSkeletons(e.skeletons,o);return this.bindSkeletons(o,l),o}parseShapes(e){const t={};if(void 0!==e)for(let n=0,i=e.length;n<i;n++){const i=(new jh).fromJSON(e[n]);t[i.uuid]=i}return t}parseSkeletons(e,t){const n={},i={};if(t.traverse((function(e){e.isBone&&(i[e.uuid]=e)})),void 0!==e)for(let t=0,s=e.length;t<s;t++){const s=(new Lc).fromJSON(e[t],i);n[s.uuid]=s}return n}parseGeometries(e,t){const n={};if(void 0!==e){const i=new Wd;for(let s=0,r=e.length;s<r;s++){let r;const a=e[s];switch(a.type){case"BufferGeometry":case"InstancedBufferGeometry":r=i.parse(a);break;default:a.type in Du?r=Du[a.type].fromJSON(a,t):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${a.type}"`)}r.uuid=a.uuid,void 0!==a.name&&(r.name=a.name),void 0!==a.userData&&(r.userData=a.userData),n[a.uuid]=r}}return n}parseMaterials(e,t){const n={},i={};if(void 0!==e){const s=new Hd;s.setTextures(t);for(let t=0,r=e.length;t<r;t++){const r=e[t];void 0===n[r.uuid]&&(n[r.uuid]=s.parse(r)),i[r.uuid]=n[r.uuid]}}return i}parseAnimations(e){const t={};if(void 0!==e)for(let n=0;n<e.length;n++){const i=e[n],s=ld.parse(i);t[s.uuid]=s}return t}parseImages(e,t){const n=this,i={};let s;function r(e){if("string"==typeof e){const t=e;return function(e){return n.manager.itemStart(e),s.load(e,(function(){n.manager.itemEnd(e)}),void 0,(function(){n.manager.itemError(e),n.manager.itemEnd(e)}))}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(t)?t:n.resourcePath+t)}return e.data?{data:ni(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){const n=new ud(t);s=new wd(n),s.setCrossOrigin(this.crossOrigin);for(let t=0,n=e.length;t<n;t++){const n=e[t],s=n.url;if(Array.isArray(s)){const e=[];for(let t=0,n=s.length;t<n;t++){const n=r(s[t]);null!==n&&(n instanceof HTMLImageElement?e.push(n):e.push(new Tc(n.data,n.width,n.height)))}i[n.uuid]=new vi(e)}else{const e=r(n.url);i[n.uuid]=new vi(e)}}}return i}async parseImagesAsync(e){const t=this,n={};let i;async function s(e){if("string"==typeof e){const n=e,s=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(n)?n:t.resourcePath+n;return await i.loadAsync(s)}return e.data?{data:ni(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){i=new wd(this.manager),i.setCrossOrigin(this.crossOrigin);for(let t=0,i=e.length;t<i;t++){const i=e[t],r=i.url;if(Array.isArray(r)){const e=[];for(let t=0,n=r.length;t<n;t++){const n=r[t],i=await s(n);null!==i&&(i instanceof HTMLImageElement?e.push(i):e.push(new Tc(i.data,i.width,i.height)))}n[i.uuid]=new vi(e)}else{const e=await s(i.url);n[i.uuid]=new vi(e)}}}return n}parseTextures(e,t){function n(e,t){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}const i={};if(void 0!==e)for(let s=0,r=e.length;s<r;s++){const r=e[s];void 0===r.image&&console.warn('THREE.ObjectLoader: No "image" specified for',r.uuid),void 0===t[r.image]&&console.warn("THREE.ObjectLoader: Undefined image",r.image);const a=t[r.image],o=a.data;let l;Array.isArray(o)?(l=new Qr,6===o.length&&(l.needsUpdate=!0)):(l=o&&o.data?new Tc:new wi,o&&(l.needsUpdate=!0)),l.source=a,l.uuid=r.uuid,void 0!==r.name&&(l.name=r.name),void 0!==r.mapping&&(l.mapping=n(r.mapping,Xd)),void 0!==r.channel&&(l.channel=r.channel),void 0!==r.offset&&l.offset.fromArray(r.offset),void 0!==r.repeat&&l.repeat.fromArray(r.repeat),void 0!==r.center&&l.center.fromArray(r.center),void 0!==r.rotation&&(l.rotation=r.rotation),void 0!==r.wrap&&(l.wrapS=n(r.wrap[0],Kd),l.wrapT=n(r.wrap[1],Kd)),void 0!==r.format&&(l.format=r.format),void 0!==r.internalFormat&&(l.internalFormat=r.internalFormat),void 0!==r.type&&(l.type=r.type),void 0!==r.colorSpace&&(l.colorSpace=r.colorSpace),void 0!==r.encoding&&(l.encoding=r.encoding),void 0!==r.minFilter&&(l.minFilter=n(r.minFilter,Yd)),void 0!==r.magFilter&&(l.magFilter=n(r.magFilter,Yd)),void 0!==r.anisotropy&&(l.anisotropy=r.anisotropy),void 0!==r.flipY&&(l.flipY=r.flipY),void 0!==r.generateMipmaps&&(l.generateMipmaps=r.generateMipmaps),void 0!==r.premultiplyAlpha&&(l.premultiplyAlpha=r.premultiplyAlpha),void 0!==r.unpackAlignment&&(l.unpackAlignment=r.unpackAlignment),void 0!==r.compareFunction&&(l.compareFunction=r.compareFunction),void 0!==r.userData&&(l.userData=r.userData),i[r.uuid]=l}return i}parseObject(e,t,n,i,s){let r,a,o;function l(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function c(e){if(void 0!==e){if(Array.isArray(e)){const t=[];for(let i=0,s=e.length;i<s;i++){const s=e[i];void 0===n[s]&&console.warn("THREE.ObjectLoader: Undefined material",s),t.push(n[s])}return t}return void 0===n[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),n[e]}}function h(e){return void 0===i[e]&&console.warn("THREE.ObjectLoader: Undefined texture",e),i[e]}switch(e.type){case"Scene":r=new Xl,void 0!==e.background&&(Number.isInteger(e.background)?r.background=new Ys(e.background):r.background=h(e.background)),void 0!==e.environment&&(r.environment=h(e.environment)),void 0!==e.fog&&("Fog"===e.fog.type?r.fog=new ql(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(r.fog=new Wl(e.fog.color,e.fog.density))),void 0!==e.backgroundBlurriness&&(r.backgroundBlurriness=e.backgroundBlurriness),void 0!==e.backgroundIntensity&&(r.backgroundIntensity=e.backgroundIntensity);break;case"PerspectiveCamera":r=new $r(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(r.focus=e.focus),void 0!==e.zoom&&(r.zoom=e.zoom),void 0!==e.filmGauge&&(r.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(r.filmOffset=e.filmOffset),void 0!==e.view&&(r.view=Object.assign({},e.view));break;case"OrthographicCamera":r=new ya(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(r.zoom=e.zoom),void 0!==e.view&&(r.view=Object.assign({},e.view));break;case"AmbientLight":r=new Vd(e.color,e.intensity);break;case"DirectionalLight":r=new Ud(e.color,e.intensity);break;case"PointLight":r=new Od(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":r=new Bd(e.color,e.intensity,e.width,e.height);break;case"SpotLight":r=new Ld(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":r=new Ed(e.color,e.groundColor,e.intensity);break;case"LightProbe":r=(new zd).fromJSON(e);break;case"SkinnedMesh":a=l(e.geometry),o=c(e.material),r=new Sc(a,o),void 0!==e.bindMode&&(r.bindMode=e.bindMode),void 0!==e.bindMatrix&&r.bindMatrix.fromArray(e.bindMatrix),void 0!==e.skeleton&&(r.skeleton=e.skeleton);break;case"Mesh":a=l(e.geometry),o=c(e.material),r=new zr(a,o);break;case"InstancedMesh":a=l(e.geometry),o=c(e.material);const t=e.count,n=e.instanceMatrix,i=e.instanceColor;r=new Bc(a,o,t),r.instanceMatrix=new Rc(new Float32Array(n.array),16),void 0!==i&&(r.instanceColor=new Rc(new Float32Array(i.array),i.itemSize));break;case"LOD":r=new fc;break;case"Line":r=new qc(l(e.geometry),c(e.material));break;case"LineLoop":r=new $c(l(e.geometry),c(e.material));break;case"LineSegments":r=new Yc(l(e.geometry),c(e.material));break;case"PointCloud":case"Points":r=new nh(l(e.geometry),c(e.material));break;case"Sprite":r=new uc(c(e.material));break;case"Group":r=new Ol;break;case"Bone":r=new Cc;break;default:r=new Ls}if(r.uuid=e.uuid,void 0!==e.name&&(r.name=e.name),void 0!==e.matrix?(r.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(r.matrixAutoUpdate=e.matrixAutoUpdate),r.matrixAutoUpdate&&r.matrix.decompose(r.position,r.quaternion,r.scale)):(void 0!==e.position&&r.position.fromArray(e.position),void 0!==e.rotation&&r.rotation.fromArray(e.rotation),void 0!==e.quaternion&&r.quaternion.fromArray(e.quaternion),void 0!==e.scale&&r.scale.fromArray(e.scale)),void 0!==e.up&&r.up.fromArray(e.up),void 0!==e.castShadow&&(r.castShadow=e.castShadow),void 0!==e.receiveShadow&&(r.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(r.shadow.bias=e.shadow.bias),void 0!==e.shadow.normalBias&&(r.shadow.normalBias=e.shadow.normalBias),void 0!==e.shadow.radius&&(r.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&r.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(r.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(r.visible=e.visible),void 0!==e.frustumCulled&&(r.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(r.renderOrder=e.renderOrder),void 0!==e.userData&&(r.userData=e.userData),void 0!==e.layers&&(r.layers.mask=e.layers),void 0!==e.children){const a=e.children;for(let e=0;e<a.length;e++)r.add(this.parseObject(a[e],t,n,i,s))}if(void 0!==e.animations){const t=e.animations;for(let e=0;e<t.length;e++){const n=t[e];r.animations.push(s[n])}}if("LOD"===e.type){void 0!==e.autoUpdate&&(r.autoUpdate=e.autoUpdate);const t=e.levels;for(let e=0;e<t.length;e++){const n=t[e],i=r.getObjectByProperty("uuid",n.object);void 0!==i&&r.addLevel(i,n.distance,n.hysteresis)}}return r}bindSkeletons(e,t){0!==Object.keys(t).length&&e.traverse((function(e){if(!0===e.isSkinnedMesh&&void 0!==e.skeleton){const n=t[e.skeleton];void 0===n?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",e.skeleton):e.bind(n,e.bindMatrix)}}))}}const Xd={UVMapping:he,CubeReflectionMapping:ue,CubeRefractionMapping:de,EquirectangularReflectionMapping:pe,EquirectangularRefractionMapping:me,CubeUVReflectionMapping:fe},Kd={RepeatWrapping:ve,ClampToEdgeWrapping:ge,MirroredRepeatWrapping:_e},Yd={NearestFilter:we,NearestMipmapNearestFilter:be,NearestMipmapLinearFilter:xe,LinearFilter:Ee,LinearMipmapNearestFilter:Se,LinearMipmapLinearFilter:Te};class $d extends pd{constructor(e){super(e),this.isImageBitmapLoader=!0,"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,n,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,r=hd.get(e);if(void 0!==r)return s.manager.itemStart(e),setTimeout((function(){t&&t(r),s.manager.itemEnd(e)}),0),r;const a={};a.credentials="anonymous"===this.crossOrigin?"same-origin":"include",a.headers=this.requestHeader,fetch(e,a).then((function(e){return e.blob()})).then((function(e){return createImageBitmap(e,Object.assign(s.options,{colorSpaceConversion:"none"}))})).then((function(n){hd.add(e,n),t&&t(n),s.manager.itemEnd(e)})).catch((function(t){i&&i(t),s.manager.itemError(e),s.manager.itemEnd(e)})),s.manager.itemStart(e)}}let Zd;class Jd{static getContext(){return void 0===Zd&&(Zd=new(window.AudioContext||window.webkitAudioContext)),Zd}static setContext(e){Zd=e}}class Qd extends pd{constructor(e){super(e)}load(e,t,n,i){const s=this,r=new vd(this.manager);function a(t){i?i(t):console.error(t),s.manager.itemError(e)}r.setResponseType("arraybuffer"),r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,(function(e){try{const n=e.slice(0);Jd.getContext().decodeAudioData(n,(function(e){t(e)}),a)}catch(e){a(e)}}),n,i)}}class ep extends zd{constructor(e,t,n=1){super(void 0,n),this.isHemisphereLightProbe=!0;const i=(new Ys).set(e),s=(new Ys).set(t),r=new Ai(i.r,i.g,i.b),a=new Ai(s.r,s.g,s.b),o=Math.sqrt(Math.PI),l=o*Math.sqrt(.75);this.sh.coefficients[0].copy(r).add(a).multiplyScalar(o),this.sh.coefficients[1].copy(r).sub(a).multiplyScalar(l)}}class tp extends zd{constructor(e,t=1){super(void 0,t),this.isAmbientLightProbe=!0;const n=(new Ys).set(e);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}}const np=new rs,ip=new rs,sp=new rs;class rp{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new $r,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new $r,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,sp.copy(e.projectionMatrix);const n=t.eyeSep/2,i=n*t.near/t.focus,s=t.near*Math.tan(Bn*t.fov*.5)/t.zoom;let r,a;ip.elements[12]=-n,np.elements[12]=n,r=-s*t.aspect+i,a=s*t.aspect+i,sp.elements[0]=2*t.near/(a-r),sp.elements[8]=(a+r)/(a-r),this.cameraL.projectionMatrix.copy(sp),r=-s*t.aspect-i,a=s*t.aspect-i,sp.elements[0]=2*t.near/(a-r),sp.elements[8]=(a+r)/(a-r),this.cameraR.projectionMatrix.copy(sp)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(ip),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(np)}}class ap{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=op(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=op();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function op(){return("undefined"==typeof performance?Date:performance).now()}const lp=new Ai,cp=new Pi,hp=new Ai,up=new Ai;class dp extends Ls{constructor(){super(),this.type="AudioListener",this.context=Jd.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new ap}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(lp,cp,hp),up.set(0,0,-1).applyQuaternion(cp),t.positionX){const e=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(lp.x,e),t.positionY.linearRampToValueAtTime(lp.y,e),t.positionZ.linearRampToValueAtTime(lp.z,e),t.forwardX.linearRampToValueAtTime(up.x,e),t.forwardY.linearRampToValueAtTime(up.y,e),t.forwardZ.linearRampToValueAtTime(up.z,e),t.upX.linearRampToValueAtTime(n.x,e),t.upY.linearRampToValueAtTime(n.y,e),t.upZ.linearRampToValueAtTime(n.z,e)}else t.setPosition(lp.x,lp.y,lp.z),t.setOrientation(up.x,up.y,up.z,n.x,n.y,n.z)}}class pp extends Ls{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,null!==this.source&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}const mp=new Ai,fp=new Pi,vp=new Ai,gp=new Ai;class _p extends pp{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){super.connect(),this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(mp,fp,vp),gp.set(0,0,1).applyQuaternion(fp);const t=this.panner;if(t.positionX){const e=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(mp.x,e),t.positionY.linearRampToValueAtTime(mp.y,e),t.positionZ.linearRampToValueAtTime(mp.z,e),t.orientationX.linearRampToValueAtTime(gp.x,e),t.orientationY.linearRampToValueAtTime(gp.y,e),t.orientationZ.linearRampToValueAtTime(gp.z,e)}else t.setPosition(mp.x,mp.y,mp.z),t.setOrientation(gp.x,gp.y,gp.z)}}class wp{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let n=0;n<t.length;n++)e+=t[n];return e/t.length}}class bp{constructor(e,t,n){let i,s,r;switch(this.binding=e,this.valueSize=n,t){case"quaternion":i=this._slerp,s=this._slerpAdditive,r=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":i=this._select,s=this._select,r=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:i=this._lerp,s=this._lerpAdditive,r=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=s,this._setIdentity=r,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const n=this.buffer,i=this.valueSize,s=e*i+i;let r=this.cumulativeWeight;if(0===r){for(let e=0;e!==i;++e)n[s+e]=n[e];r=t}else{r+=t;const e=t/r;this._mixBufferRegion(n,s,0,e,i)}this.cumulativeWeight=r}accumulateAdditive(e){const t=this.buffer,n=this.valueSize,i=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,i,0,e,n),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,n=this.buffer,i=e*t+t,s=this.cumulativeWeight,r=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,s<1){const e=t*this._origIndex;this._mixBufferRegion(n,i,e,1-s,t)}r>0&&this._mixBufferRegionAdditive(n,i,this._addIndex*t,1,t);for(let e=t,s=t+t;e!==s;++e)if(n[e]!==n[e+t]){a.setValue(n,i);break}}saveOriginalState(){const e=this.binding,t=this.buffer,n=this.valueSize,i=n*this._origIndex;e.getValue(t,i);for(let e=n,s=i;e!==s;++e)t[e]=t[i+e%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=3*this.valueSize;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}_select(e,t,n,i,s){if(i>=.5)for(let i=0;i!==s;++i)e[t+i]=e[n+i]}_slerp(e,t,n,i){Pi.slerpFlat(e,t,e,t,e,n,i)}_slerpAdditive(e,t,n,i,s){const r=this._workIndex*s;Pi.multiplyQuaternionsFlat(e,r,e,t,e,n),Pi.slerpFlat(e,t,e,t,e,r,i)}_lerp(e,t,n,i,s){const r=1-i;for(let a=0;a!==s;++a){const s=t+a;e[s]=e[s]*r+e[n+a]*i}}_lerpAdditive(e,t,n,i,s){for(let r=0;r!==s;++r){const s=t+r;e[s]=e[s]+e[n+r]*i}}}const yp="\\[\\]\\.:\\/",xp=new RegExp("["+yp+"]","g"),Mp="[^"+yp+"]",Ep="[^"+yp.replace("\\.","")+"]",Sp=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",Mp)+/(WCOD+)?/.source.replace("WCOD",Ep)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Mp)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Mp)+"$"),Cp=["material","materials","bones","map"];class Tp{constructor(e,t,n){this.path=t,this.parsedPath=n||Tp.parseTrackName(t),this.node=Tp.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new Tp.Composite(e,t,n):new Tp(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(xp,"")}static parseTrackName(e){const t=Sp.exec(e);if(null===t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){const e=n.nodeName.substring(i+1);-1!==Cp.indexOf(e)&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=e)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(void 0===t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){const n=function(e){for(let i=0;i<e.length;i++){const s=e[i];if(s.name===t||s.uuid===t)return s;const r=n(s.children);if(r)return r}return null},i=n(e.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let i=0,s=n.length;i!==s;++i)e[t++]=n[i]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let i=0,s=n.length;i!==s;++i)n[i]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let i=0,s=n.length;i!==s;++i)n[i]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let i=0,s=n.length;i!==s;++i)n[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,i=t.propertyName;let s=t.propertyIndex;if(e||(e=Tp.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");if(n){let i=t.objectIndex;switch(n){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===i){i=t;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);e=e.material.map;break;default:if(void 0===e[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[n]}if(void 0!==i){if(void 0===e[i])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[i]}}const r=e[i];if(void 0===r){const n=t.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+i+" but it wasn't found.",e)}let a=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?a=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(a=this.Versioning.MatrixWorldNeedsUpdate);let o=this.BindingType.Direct;if(void 0!==s){if("morphTargetInfluences"===i){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[s]&&(s=e.morphTargetDictionary[s])}o=this.BindingType.ArrayElement,this.resolvedProperty=r,this.propertyIndex=s}else void 0!==r.fromArray&&void 0!==r.toArray?(o=this.BindingType.HasFromToArray,this.resolvedProperty=r):Array.isArray(r)?(o=this.BindingType.EntireArray,this.resolvedProperty=r):this.propertyName=i;this.getValue=this.GetterByBindingType[o],this.setValue=this.SetterByBindingTypeAndVersioning[o][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Tp.Composite=class{constructor(e,t,n){const i=n||Tp.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,i=this._bindings[n];void 0!==i&&i.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let i=this._targetGroup.nCachedObjects_,s=n.length;i!==s;++i)n[i].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}},Tp.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Tp.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Tp.prototype.GetterByBindingType=[Tp.prototype._getValue_direct,Tp.prototype._getValue_array,Tp.prototype._getValue_arrayElement,Tp.prototype._getValue_toArray],Tp.prototype.SetterByBindingTypeAndVersioning=[[Tp.prototype._setValue_direct,Tp.prototype._setValue_direct_setNeedsUpdate,Tp.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Tp.prototype._setValue_array,Tp.prototype._setValue_array_setNeedsUpdate,Tp.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Tp.prototype._setValue_arrayElement,Tp.prototype._setValue_arrayElement_setNeedsUpdate,Tp.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Tp.prototype._setValue_fromArray,Tp.prototype._setValue_fromArray_setNeedsUpdate,Tp.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Pp{constructor(){this.isAnimationObjectGroup=!0,this.uuid=zn(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let t=0,n=arguments.length;t!==n;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,n=this._paths,i=this._parsedPaths,s=this._bindings,r=s.length;let a,o=e.length,l=this.nCachedObjects_;for(let c=0,h=arguments.length;c!==h;++c){const h=arguments[c],u=h.uuid;let d=t[u];if(void 0===d){d=o++,t[u]=d,e.push(h);for(let e=0,t=r;e!==t;++e)s[e].push(new Tp(h,n[e],i[e]))}else if(d<l){a=e[d];const o=--l,c=e[o];t[c.uuid]=d,e[d]=c,t[u]=o,e[o]=h;for(let e=0,t=r;e!==t;++e){const t=s[e],r=t[o];let a=t[d];t[d]=r,void 0===a&&(a=new Tp(h,n[e],i[e])),t[o]=a}}else e[d]!==a&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=l}remove(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,i=n.length;let s=this.nCachedObjects_;for(let r=0,a=arguments.length;r!==a;++r){const a=arguments[r],o=a.uuid,l=t[o];if(void 0!==l&&l>=s){const r=s++,c=e[r];t[c.uuid]=l,e[l]=c,t[o]=r,e[r]=a;for(let e=0,t=i;e!==t;++e){const t=n[e],i=t[r],s=t[l];t[l]=i,t[r]=s}}}this.nCachedObjects_=s}uncache(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,i=n.length;let s=this.nCachedObjects_,r=e.length;for(let a=0,o=arguments.length;a!==o;++a){const o=arguments[a].uuid,l=t[o];if(void 0!==l)if(delete t[o],l<s){const a=--s,o=e[a],c=--r,h=e[c];t[o.uuid]=l,e[l]=o,t[h.uuid]=a,e[a]=h,e.pop();for(let e=0,t=i;e!==t;++e){const t=n[e],i=t[a],s=t[c];t[l]=i,t[a]=s,t.pop()}}else{const s=--r,a=e[s];s>0&&(t[a.uuid]=l),e[l]=a,e.pop();for(let e=0,t=i;e!==t;++e){const t=n[e];t[l]=t[s],t.pop()}}}this.nCachedObjects_=s}subscribe_(e,t){const n=this._bindingsIndicesByPath;let i=n[e];const s=this._bindings;if(void 0!==i)return s[i];const r=this._paths,a=this._parsedPaths,o=this._objects,l=o.length,c=this.nCachedObjects_,h=new Array(l);i=s.length,n[e]=i,r.push(e),a.push(t),s.push(h);for(let n=c,i=o.length;n!==i;++n){const i=o[n];h[n]=new Tp(i,e,t)}return h}unsubscribe_(e){const t=this._bindingsIndicesByPath,n=t[e];if(void 0!==n){const i=this._paths,s=this._parsedPaths,r=this._bindings,a=r.length-1,o=r[a];t[e[a]]=n,r[n]=o,r.pop(),s[n]=s[a],s.pop(),i[n]=i[a],i.pop()}}}class Ap{constructor(e,t,n=null,i=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=i;const s=t.tracks,r=s.length,a=new Array(r),o={endingStart:It,endingEnd:It};for(let e=0;e!==r;++e){const t=s[e].createInterpolant(null);a[e]=t,t.settings=o}this._interpolantSettings=o,this._interpolants=a,this._propertyBindings=new Array(r),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Pt,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){const n=this._clip.duration,i=e._clip.duration,s=i/n,r=n/i;e.warp(1,s,t),this.warp(r,1,t)}return this}crossFadeTo(e,t,n){return e.crossFadeFrom(this,t,n)}stopFading(){const e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){const i=this._mixer,s=i.time,r=this.timeScale;let a=this._timeScaleInterpolant;null===a&&(a=i._lendControlInterpolant(),this._timeScaleInterpolant=a);const o=a.parameterPositions,l=a.sampleValues;return o[0]=s,o[1]=s+n,l[0]=e/r,l[1]=t/r,this}stopWarping(){const e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,i){if(!this.enabled)return void this._updateWeight(e);const s=this._startTime;if(null!==s){const i=(e-s)*n;i<0||0===n?t=0:(this._startTime=null,t=n*i)}t*=this._updateTimeScale(e);const r=this._updateTime(t),a=this._updateWeight(e);if(a>0){const e=this._interpolants,t=this._propertyBindings;if(this.blendMode===Ut)for(let n=0,i=e.length;n!==i;++n)e[n].evaluate(r),t[n].accumulateAdditive(a);else for(let n=0,s=e.length;n!==s;++n)e[n].evaluate(r),t[n].accumulate(i,a)}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const n=this._weightInterpolant;if(null!==n){const i=n.evaluate(e)[0];t*=i,e>n.parameterPositions[1]&&(this.stopFading(),0===i&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const n=this._timeScaleInterpolant;if(null!==n){t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,n=this.loop;let i=this.time+e,s=this._loopCount;const r=n===At;if(0===e)return-1===s?i:r&&1==(1&s)?t-i:i;if(n===Tt){-1===s&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(i>=t)i=t;else{if(!(i<0)){this.time=i;break e}i=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===s&&(e>=0?(s=0,this._setEndings(!0,0===this.repetitions,r)):this._setEndings(0===this.repetitions,!0,r)),i>=t||i<0){const n=Math.floor(i/t);i-=t*n,s+=Math.abs(n);const a=this.repetitions-s;if(a<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=e>0?t:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===a){const t=e<0;this._setEndings(t,!t,r)}else this._setEndings(!1,!1,r);this._loopCount=s,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n})}}else this.time=i;if(r&&1==(1&s))return t-i}return i}_setEndings(e,t,n){const i=this._interpolantSettings;n?(i.endingStart=kt,i.endingEnd=kt):(i.endingStart=e?this.zeroSlopeAtStart?kt:It:Ot,i.endingEnd=t?this.zeroSlopeAtEnd?kt:It:Ot)}_scheduleFading(e,t,n){const i=this._mixer,s=i.time;let r=this._weightInterpolant;null===r&&(r=i._lendControlInterpolant(),this._weightInterpolant=r);const a=r.parameterPositions,o=r.sampleValues;return a[0]=s,o[0]=t,a[1]=s+e,o[1]=n,this}}const Lp=new Float32Array(1);class Rp extends Nn{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const n=e._localRoot||this._root,i=e._clip.tracks,s=i.length,r=e._propertyBindings,a=e._interpolants,o=n.uuid,l=this._bindingsByRootAndName;let c=l[o];void 0===c&&(c={},l[o]=c);for(let e=0;e!==s;++e){const s=i[e],l=s.name;let h=c[l];if(void 0!==h)++h.referenceCount,r[e]=h;else{if(h=r[e],void 0!==h){null===h._cacheIndex&&(++h.referenceCount,this._addInactiveBinding(h,o,l));continue}const i=t&&t._propertyBindings[e].binding.parsedPath;h=new bp(Tp.create(n,l,i),s.ValueTypeName,s.getValueSize()),++h.referenceCount,this._addInactiveBinding(h,o,l),r[e]=h}a[e].resultBuffer=h.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){const t=(e._localRoot||this._root).uuid,n=e._clip.uuid,i=this._actionsByClip[n];this._bindAction(e,i&&i.knownActions[0]),this._addInactiveAction(e,n,t)}const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0==n.useCount++&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0==--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return null!==t&&t<this._nActiveActions}_addInactiveAction(e,t,n){const i=this._actions,s=this._actionsByClip;let r=s[t];if(void 0===r)r={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,s[t]=r;else{const t=r.knownActions;e._byClipCacheIndex=t.length,t.push(e)}e._cacheIndex=i.length,i.push(e),r.actionByRoot[n]=e}_removeInactiveAction(e){const t=this._actions,n=t[t.length-1],i=e._cacheIndex;n._cacheIndex=i,t[i]=n,t.pop(),e._cacheIndex=null;const s=e._clip.uuid,r=this._actionsByClip,a=r[s],o=a.knownActions,l=o[o.length-1],c=e._byClipCacheIndex;l._byClipCacheIndex=c,o[c]=l,o.pop(),e._byClipCacheIndex=null;delete a.actionByRoot[(e._localRoot||this._root).uuid],0===o.length&&delete r[s],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0==--n.referenceCount&&this._removeInactiveBinding(n)}}_lendAction(e){const t=this._actions,n=e._cacheIndex,i=this._nActiveActions++,s=t[i];e._cacheIndex=i,t[i]=e,s._cacheIndex=n,t[n]=s}_takeBackAction(e){const t=this._actions,n=e._cacheIndex,i=--this._nActiveActions,s=t[i];e._cacheIndex=i,t[i]=e,s._cacheIndex=n,t[n]=s}_addInactiveBinding(e,t,n){const i=this._bindingsByRootAndName,s=this._bindings;let r=i[t];void 0===r&&(r={},i[t]=r),r[n]=e,e._cacheIndex=s.length,s.push(e)}_removeInactiveBinding(e){const t=this._bindings,n=e.binding,i=n.rootNode.uuid,s=n.path,r=this._bindingsByRootAndName,a=r[i],o=t[t.length-1],l=e._cacheIndex;o._cacheIndex=l,t[l]=o,t.pop(),delete a[s],0===Object.keys(a).length&&delete r[i]}_lendBinding(e){const t=this._bindings,n=e._cacheIndex,i=this._nActiveBindings++,s=t[i];e._cacheIndex=i,t[i]=e,s._cacheIndex=n,t[n]=s}_takeBackBinding(e){const t=this._bindings,n=e._cacheIndex,i=--this._nActiveBindings,s=t[i];e._cacheIndex=i,t[i]=e,s._cacheIndex=n,t[n]=s}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let n=e[t];return void 0===n&&(n=new Ju(new Float32Array(2),new Float32Array(2),1,Lp),n.__cacheIndex=t,e[t]=n),n}_takeBackControlInterpolant(e){const t=this._controlInterpolants,n=e.__cacheIndex,i=--this._nActiveControlInterpolants,s=t[i];e.__cacheIndex=i,t[i]=e,s.__cacheIndex=n,t[n]=s}clipAction(e,t,n){const i=t||this._root,s=i.uuid;let r="string"==typeof e?ld.findByName(i,e):e;const a=null!==r?r.uuid:e,o=this._actionsByClip[a];let l=null;if(void 0===n&&(n=null!==r?r.blendMode:Nt),void 0!==o){const e=o.actionByRoot[s];if(void 0!==e&&e.blendMode===n)return e;l=o.knownActions[0],null===r&&(r=l._clip)}if(null===r)return null;const c=new Ap(this,r,t,n);return this._bindAction(c,l),this._addInactiveAction(c,a,s),c}existingAction(e,t){const n=t||this._root,i=n.uuid,s="string"==typeof e?ld.findByName(n,e):e,r=s?s.uuid:e,a=this._actionsByClip[r];return void 0!==a&&a.actionByRoot[i]||null}stopAllAction(){const e=this._actions;for(let t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this}update(e){e*=this.timeScale;const t=this._actions,n=this._nActiveActions,i=this.time+=e,s=Math.sign(e),r=this._accuIndex^=1;for(let a=0;a!==n;++a){t[a]._update(i,e,s,r)}const a=this._bindings,o=this._nActiveBindings;for(let e=0;e!==o;++e)a[e].apply(r);return this}setTime(e){this.time=0;for(let e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,n=e.uuid,i=this._actionsByClip,s=i[n];if(void 0!==s){const e=s.knownActions;for(let n=0,i=e.length;n!==i;++n){const i=e[n];this._deactivateAction(i);const s=i._cacheIndex,r=t[t.length-1];i._cacheIndex=null,i._byClipCacheIndex=null,r._cacheIndex=s,t[s]=r,t.pop(),this._removeInactiveBindingsForAction(i)}delete i[n]}}uncacheRoot(e){const t=e.uuid,n=this._actionsByClip;for(const e in n){const i=n[e].actionByRoot[t];void 0!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}const i=this._bindingsByRootAndName[t];if(void 0!==i)for(const e in i){const t=i[e];t.restoreOriginalState(),this._removeInactiveBinding(t)}}uncacheAction(e,t){const n=this.existingAction(e,t);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}class Dp{constructor(e){this.value=e}clone(){return new Dp(void 0===this.value.clone?this.value:this.value.clone())}}let Ip=0;class kp extends Nn{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:Ip++}),this.name="",this.usage=xn,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const t=this.uniforms.indexOf(e);return-1!==t&&this.uniforms.splice(t,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(e){this.name=e.name,this.usage=e.usage;const t=e.uniforms;this.uniforms.length=0;for(let e=0,n=t.length;e<n;e++)this.uniforms.push(t[e].clone());return this}clone(){return(new this.constructor).copy(this)}}class Op extends Kl{constructor(e,t,n=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}class Np{constructor(e,t,n,i,s){this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=t,this.itemSize=n,this.elementSize=i,this.count=s,this.version=0}set needsUpdate(e){!0===e&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}class Up{constructor(e,t,n=0,i=1/0){this.ray=new ss(e,t),this.near=n,this.far=i,this.camera=null,this.layers=new vs,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,n=[]){return Bp(e,this,n,t),n.sort(Vp),n}intersectObjects(e,t=!0,n=[]){for(let i=0,s=e.length;i<s;i++)Bp(e[i],this,n,t);return n.sort(Vp),n}}function Vp(e,t){return e.distance-t.distance}function Bp(e,t,n,i){if(e.layers.test(t.layers)&&e.raycast(t,n),!0===i){const i=e.children;for(let e=0,s=i.length;e<s;e++)Bp(i[e],t,n,!0)}}class Fp{constructor(e=1,t=0,n=0){return this.radius=e,this.phi=t,this.theta=n,this}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){const e=1e-6;return this.phi=Math.max(e,Math.min(Math.PI-e,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(Hn(t/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}class zp{constructor(e=1,t=0,n=0){return this.radius=e,this.theta=t,this.y=n,this}set(e,t,n){return this.radius=e,this.theta=t,this.y=n,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}clone(){return(new this.constructor).copy(this)}}const Hp=new Zn;class Gp{constructor(e=new Zn(1/0,1/0),t=new Zn(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=Hp.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Hp).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const jp=new Ai,Wp=new Ai;class qp{constructor(e=new Ai,t=new Ai){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){jp.subVectors(e,this.start),Wp.subVectors(this.end,this.start);const n=Wp.dot(Wp);let i=Wp.dot(jp)/n;return t&&(i=Hn(i,0,1)),i}closestPointToPoint(e,t,n){const i=this.closestPointToPointParameter(e,t);return this.delta(n).multiplyScalar(i).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}const Xp=new Ai;class Kp extends Ls{constructor(e,t){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";const n=new Mr,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let e=0,t=1,n=32;e<n;e++,t++){const s=e/n*Math.PI*2,r=t/n*Math.PI*2;i.push(Math.cos(s),Math.sin(s),1,Math.cos(r),Math.sin(r),1)}n.setAttribute("position",new mr(i,3));const s=new Fc({fog:!1,toneMapped:!1});this.cone=new Yc(n,s),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),Xp.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Xp),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const Yp=new Ai,$p=new rs,Zp=new rs;class Jp extends Yc{constructor(e){const t=Qp(e),n=new Mr,i=[],s=[],r=new Ys(0,0,1),a=new Ys(0,1,0);for(let e=0;e<t.length;e++){const n=t[e];n.parent&&n.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),s.push(r.r,r.g,r.b),s.push(a.r,a.g,a.b))}n.setAttribute("position",new mr(i,3)),n.setAttribute("color",new mr(s,3));super(n,new Fc({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,n=this.geometry,i=n.getAttribute("position");Zp.copy(this.root.matrixWorld).invert();for(let e=0,n=0;e<t.length;e++){const s=t[e];s.parent&&s.parent.isBone&&($p.multiplyMatrices(Zp,s.matrixWorld),Yp.setFromMatrixPosition($p),i.setXYZ(n,Yp.x,Yp.y,Yp.z),$p.multiplyMatrices(Zp,s.parent.matrixWorld),Yp.setFromMatrixPosition($p),i.setXYZ(n+1,Yp.x,Yp.y,Yp.z),n+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose()}}function Qp(e){const t=[];!0===e.isBone&&t.push(e);for(let n=0;n<e.children.length;n++)t.push.apply(t,Qp(e.children[n]));return t}class em extends zr{constructor(e,t,n){super(new Su(t,4,2),new Zs({wireframe:!0,fog:!1,toneMapped:!1})),this.light=e,this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const tm=new Ai,nm=new Ys,im=new Ys;class sm extends Ls{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="HemisphereLightHelper";const i=new xu(t);i.rotateY(.5*Math.PI),this.material=new Zs({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const s=i.getAttribute("position"),r=new Float32Array(3*s.count);i.setAttribute("color",new rr(r,3)),this.add(new zr(i,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");nm.copy(this.light.color),im.copy(this.light.groundColor);for(let e=0,n=t.count;e<n;e++){const i=e<n/2?nm:im;t.setXYZ(e,i.r,i.g,i.b)}t.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(tm.setFromMatrixPosition(this.light.matrixWorld).negate())}}class rm extends Yc{constructor(e=10,t=10,n=4473924,i=8947848){n=new Ys(n),i=new Ys(i);const s=t/2,r=e/t,a=e/2,o=[],l=[];for(let e=0,c=0,h=-a;e<=t;e++,h+=r){o.push(-a,0,h,a,0,h),o.push(h,0,-a,h,0,a);const t=e===s?n:i;t.toArray(l,c),c+=3,t.toArray(l,c),c+=3,t.toArray(l,c),c+=3,t.toArray(l,c),c+=3}const c=new Mr;c.setAttribute("position",new mr(o,3)),c.setAttribute("color",new mr(l,3));super(c,new Fc({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class am extends Yc{constructor(e=10,t=16,n=8,i=64,s=4473924,r=8947848){s=new Ys(s),r=new Ys(r);const a=[],o=[];if(t>1)for(let n=0;n<t;n++){const i=n/t*(2*Math.PI),l=Math.sin(i)*e,c=Math.cos(i)*e;a.push(0,0,0),a.push(l,0,c);const h=1&n?s:r;o.push(h.r,h.g,h.b),o.push(h.r,h.g,h.b)}for(let t=0;t<n;t++){const l=1&t?s:r,c=e-e/n*t;for(let e=0;e<i;e++){let t=e/i*(2*Math.PI),n=Math.sin(t)*c,s=Math.cos(t)*c;a.push(n,0,s),o.push(l.r,l.g,l.b),t=(e+1)/i*(2*Math.PI),n=Math.sin(t)*c,s=Math.cos(t)*c,a.push(n,0,s),o.push(l.r,l.g,l.b)}}const l=new Mr;l.setAttribute("position",new mr(a,3)),l.setAttribute("color",new mr(o,3));super(l,new Fc({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const om=new Ai,lm=new Ai,cm=new Ai;class hm extends Ls{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="DirectionalLightHelper",void 0===t&&(t=1);let i=new Mr;i.setAttribute("position",new mr([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const s=new Fc({fog:!1,toneMapped:!1});this.lightPlane=new qc(i,s),this.add(this.lightPlane),i=new Mr,i.setAttribute("position",new mr([0,0,0,0,0,1],3)),this.targetLine=new qc(i,s),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),om.setFromMatrixPosition(this.light.matrixWorld),lm.setFromMatrixPosition(this.light.target.matrixWorld),cm.subVectors(lm,om),this.lightPlane.lookAt(lm),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(lm),this.targetLine.scale.z=cm.length()}}const um=new Ai,dm=new Yr;class pm extends Yc{constructor(e){const t=new Mr,n=new Fc({color:16777215,vertexColors:!0,toneMapped:!1}),i=[],s=[],r={};function a(e,t){o(e),o(t)}function o(e){i.push(0,0,0),s.push(0,0,0),void 0===r[e]&&(r[e]=[]),r[e].push(i.length/3-1)}a("n1","n2"),a("n2","n4"),a("n4","n3"),a("n3","n1"),a("f1","f2"),a("f2","f4"),a("f4","f3"),a("f3","f1"),a("n1","f1"),a("n2","f2"),a("n3","f3"),a("n4","f4"),a("p","n1"),a("p","n2"),a("p","n3"),a("p","n4"),a("u1","u2"),a("u2","u3"),a("u3","u1"),a("c","t"),a("p","c"),a("cn1","cn2"),a("cn3","cn4"),a("cf1","cf2"),a("cf3","cf4"),t.setAttribute("position",new mr(i,3)),t.setAttribute("color",new mr(s,3)),super(t,n),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=r,this.update();const l=new Ys(16755200),c=new Ys(16711680),h=new Ys(43775),u=new Ys(16777215),d=new Ys(3355443);this.setColors(l,c,h,u,d)}setColors(e,t,n,i,s){const r=this.geometry.getAttribute("color");r.setXYZ(0,e.r,e.g,e.b),r.setXYZ(1,e.r,e.g,e.b),r.setXYZ(2,e.r,e.g,e.b),r.setXYZ(3,e.r,e.g,e.b),r.setXYZ(4,e.r,e.g,e.b),r.setXYZ(5,e.r,e.g,e.b),r.setXYZ(6,e.r,e.g,e.b),r.setXYZ(7,e.r,e.g,e.b),r.setXYZ(8,e.r,e.g,e.b),r.setXYZ(9,e.r,e.g,e.b),r.setXYZ(10,e.r,e.g,e.b),r.setXYZ(11,e.r,e.g,e.b),r.setXYZ(12,e.r,e.g,e.b),r.setXYZ(13,e.r,e.g,e.b),r.setXYZ(14,e.r,e.g,e.b),r.setXYZ(15,e.r,e.g,e.b),r.setXYZ(16,e.r,e.g,e.b),r.setXYZ(17,e.r,e.g,e.b),r.setXYZ(18,e.r,e.g,e.b),r.setXYZ(19,e.r,e.g,e.b),r.setXYZ(20,e.r,e.g,e.b),r.setXYZ(21,e.r,e.g,e.b),r.setXYZ(22,e.r,e.g,e.b),r.setXYZ(23,e.r,e.g,e.b),r.setXYZ(24,t.r,t.g,t.b),r.setXYZ(25,t.r,t.g,t.b),r.setXYZ(26,t.r,t.g,t.b),r.setXYZ(27,t.r,t.g,t.b),r.setXYZ(28,t.r,t.g,t.b),r.setXYZ(29,t.r,t.g,t.b),r.setXYZ(30,t.r,t.g,t.b),r.setXYZ(31,t.r,t.g,t.b),r.setXYZ(32,n.r,n.g,n.b),r.setXYZ(33,n.r,n.g,n.b),r.setXYZ(34,n.r,n.g,n.b),r.setXYZ(35,n.r,n.g,n.b),r.setXYZ(36,n.r,n.g,n.b),r.setXYZ(37,n.r,n.g,n.b),r.setXYZ(38,i.r,i.g,i.b),r.setXYZ(39,i.r,i.g,i.b),r.setXYZ(40,s.r,s.g,s.b),r.setXYZ(41,s.r,s.g,s.b),r.setXYZ(42,s.r,s.g,s.b),r.setXYZ(43,s.r,s.g,s.b),r.setXYZ(44,s.r,s.g,s.b),r.setXYZ(45,s.r,s.g,s.b),r.setXYZ(46,s.r,s.g,s.b),r.setXYZ(47,s.r,s.g,s.b),r.setXYZ(48,s.r,s.g,s.b),r.setXYZ(49,s.r,s.g,s.b),r.needsUpdate=!0}update(){const e=this.geometry,t=this.pointMap;dm.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),mm("c",t,e,dm,0,0,-1),mm("t",t,e,dm,0,0,1),mm("n1",t,e,dm,-1,-1,-1),mm("n2",t,e,dm,1,-1,-1),mm("n3",t,e,dm,-1,1,-1),mm("n4",t,e,dm,1,1,-1),mm("f1",t,e,dm,-1,-1,1),mm("f2",t,e,dm,1,-1,1),mm("f3",t,e,dm,-1,1,1),mm("f4",t,e,dm,1,1,1),mm("u1",t,e,dm,.7,1.1,-1),mm("u2",t,e,dm,-.7,1.1,-1),mm("u3",t,e,dm,0,2,-1),mm("cf1",t,e,dm,-1,0,1),mm("cf2",t,e,dm,1,0,1),mm("cf3",t,e,dm,0,-1,1),mm("cf4",t,e,dm,0,1,1),mm("cn1",t,e,dm,-1,0,-1),mm("cn2",t,e,dm,1,0,-1),mm("cn3",t,e,dm,0,-1,-1),mm("cn4",t,e,dm,0,1,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function mm(e,t,n,i,s,r,a){um.set(s,r,a).unproject(i);const o=t[e];if(void 0!==o){const e=n.getAttribute("position");for(let t=0,n=o.length;t<n;t++)e.setXYZ(o[t],um.x,um.y,um.z)}}const fm=new Di;class vm extends Yc{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(24),s=new Mr;s.setIndex(new rr(n,1)),s.setAttribute("position",new rr(i,3)),super(s,new Fc({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(void 0!==e&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&fm.setFromObject(this.object),fm.isEmpty())return;const t=fm.min,n=fm.max,i=this.geometry.attributes.position,s=i.array;s[0]=n.x,s[1]=n.y,s[2]=n.z,s[3]=t.x,s[4]=n.y,s[5]=n.z,s[6]=t.x,s[7]=t.y,s[8]=n.z,s[9]=n.x,s[10]=t.y,s[11]=n.z,s[12]=n.x,s[13]=n.y,s[14]=t.z,s[15]=t.x,s[16]=n.y,s[17]=t.z,s[18]=t.x,s[19]=t.y,s[20]=t.z,s[21]=n.x,s[22]=t.y,s[23]=t.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,t){return super.copy(e,t),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class gm extends Yc{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Mr;i.setIndex(new rr(n,1)),i.setAttribute("position",new mr([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(i,new Fc({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class _m extends qc{constructor(e,t=1,n=16776960){const i=n,s=new Mr;s.setAttribute("position",new mr([1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),s.computeBoundingSphere(),super(s,new Fc({color:i,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const r=new Mr;r.setAttribute("position",new mr([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),r.computeBoundingSphere(),this.add(new zr(r,new Zs({color:i,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const wm=new Ai;let bm,ym;class xm extends Ls{constructor(e=new Ai(0,0,1),t=new Ai(0,0,0),n=1,i=16776960,s=.2*n,r=.2*s){super(),this.type="ArrowHelper",void 0===bm&&(bm=new Mr,bm.setAttribute("position",new mr([0,0,0,0,1,0],3)),ym=new Oh(0,.5,1,5,1),ym.translate(0,-.5,0)),this.position.copy(t),this.line=new qc(bm,new Fc({color:i,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new zr(ym,new Zs({color:i,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,s,r)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{wm.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(wm,t)}}setLength(e,t=.2*e,n=.2*t){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class Mm extends Yc{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=new Mr;n.setAttribute("position",new mr(t,3)),n.setAttribute("color",new mr([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));super(n,new Fc({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(e,t,n){const i=new Ys,s=this.geometry.attributes.color.array;return i.set(e),i.toArray(s,0),i.toArray(s,3),i.set(t),i.toArray(s,6),i.toArray(s,9),i.set(n),i.toArray(s,12),i.toArray(s,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class Em{constructor(){this.type="ShapePath",this.color=new Ys,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new Rh,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,n,i){return this.currentPath.quadraticCurveTo(e,t,n,i),this}bezierCurveTo(e,t,n,i,s,r){return this.currentPath.bezierCurveTo(e,t,n,i,s,r),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function t(e,t){const n=t.length;let i=!1;for(let s=n-1,r=0;r<n;s=r++){let n=t[s],a=t[r],o=a.x-n.x,l=a.y-n.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(n=t[r],o=-o,a=t[s],l=-l),e.y<n.y||e.y>a.y)continue;if(e.y===n.y){if(e.x===n.x)return!0}else{const t=l*(e.x-n.x)-o*(e.y-n.y);if(0===t)return!0;if(t<0)continue;i=!i}}else{if(e.y!==n.y)continue;if(a.x<=e.x&&e.x<=n.x||n.x<=e.x&&e.x<=a.x)return!0}}return i}const n=vu.isClockWise,i=this.subPaths;if(0===i.length)return[];let s,r,a;const o=[];if(1===i.length)return r=i[0],a=new jh,a.curves=r.curves,o.push(a),o;let l=!n(i[0].getPoints());l=e?!l:l;const c=[],h=[];let u,d,p=[],m=0;h[m]=void 0,p[m]=[];for(let t=0,a=i.length;t<a;t++)r=i[t],u=r.getPoints(),s=n(u),s=e?!s:s,s?(!l&&h[m]&&m++,h[m]={s:new jh,p:u},h[m].s.curves=r.curves,l&&m++,p[m]=[]):p[m].push({h:r,p:u[0]});if(!h[0])return function(e){const t=[];for(let n=0,i=e.length;n<i;n++){const i=e[n],s=new jh;s.curves=i.curves,t.push(s)}return t}(i);if(h.length>1){let e=!1,n=0;for(let e=0,t=h.length;e<t;e++)c[e]=[];for(let i=0,s=h.length;i<s;i++){const s=p[i];for(let r=0;r<s.length;r++){const a=s[r];let o=!0;for(let s=0;s<h.length;s++)t(a.p,h[s].p)&&(i!==s&&n++,o?(o=!1,c[s].push(a)):e=!0);o&&c[i].push(a)}}n>0&&!1===e&&(p=c)}for(let e=0,t=h.length;e<t;e++){a=h[e].s,o.push(a),d=p[e];for(let e=0,t=d.length;e<t;e++)a.holes.push(d[e].h)}return o}}function Sm(e,t){if(t===Vt)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),e;if(t===Ft||t===Bt){let n=e.getIndex();if(null===n){const t=[],i=e.getAttribute("position");if(void 0===i)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<i.count;e++)t.push(e);e.setIndex(t),n=e.getIndex()}const i=n.count-2,s=[];if(t===Ft)for(let e=1;e<=i;e++)s.push(n.getX(0)),s.push(n.getX(e)),s.push(n.getX(e+1));else for(let e=0;e<i;e++)e%2==0?(s.push(n.getX(e)),s.push(n.getX(e+1)),s.push(n.getX(e+2))):(s.push(n.getX(e+2)),s.push(n.getX(e+1)),s.push(n.getX(e)));s.length/3!==i&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const r=e.clone();return r.setIndex(s),r.clearGroups(),r}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),e}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:h}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=h);class Cm extends pd{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(e){return new Dm(e)})),this.register((function(e){return new Fm(e)})),this.register((function(e){return new zm(e)})),this.register((function(e){return new Hm(e)})),this.register((function(e){return new km(e)})),this.register((function(e){return new Om(e)})),this.register((function(e){return new Nm(e)})),this.register((function(e){return new Um(e)})),this.register((function(e){return new Rm(e)})),this.register((function(e){return new Vm(e)})),this.register((function(e){return new Im(e)})),this.register((function(e){return new Bm(e)})),this.register((function(e){return new Am(e)})),this.register((function(e){return new Gm(e)})),this.register((function(e){return new jm(e)}))}load(e,t,n,i){const s=this;let r;r=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:Gd.extractUrlBase(e),this.manager.itemStart(e);const a=function(t){i?i(t):console.error(t),s.manager.itemError(e),s.manager.itemEnd(e)},o=new vd(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,(function(n){try{s.parse(n,r,(function(n){t(n),s.manager.itemEnd(e)}),a)}catch(e){a(e)}}),n,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,i){let s;const r={},a={},o=new TextDecoder;if("string"==typeof e)s=JSON.parse(e);else if(e instanceof ArrayBuffer){if(o.decode(new Uint8Array(e,0,4))===Wm){try{r[Pm.KHR_BINARY_GLTF]=new Km(e)}catch(e){return void(i&&i(e))}s=JSON.parse(r[Pm.KHR_BINARY_GLTF].content)}else s=JSON.parse(o.decode(e))}else s=e;if(void 0===s.asset||s.asset.version[0]<2)return void(i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const l=new bf(s,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let e=0;e<this.pluginCallbacks.length;e++){const t=this.pluginCallbacks[e](l);a[t.name]=t,r[t.name]=!0}if(s.extensionsUsed)for(let e=0;e<s.extensionsUsed.length;++e){const t=s.extensionsUsed[e],n=s.extensionsRequired||[];switch(t){case Pm.KHR_MATERIALS_UNLIT:r[t]=new Lm;break;case Pm.KHR_DRACO_MESH_COMPRESSION:r[t]=new Ym(s,this.dracoLoader);break;case Pm.KHR_TEXTURE_TRANSFORM:r[t]=new $m;break;case Pm.KHR_MESH_QUANTIZATION:r[t]=new Zm;break;default:n.indexOf(t)>=0&&void 0===a[t]&&console.warn('THREE.GLTFLoader: Unknown extension "'+t+'".')}}l.setExtensions(r),l.setPlugins(a),l.parse(n,i)}parseAsync(e,t){const n=this;return new Promise((function(i,s){n.parse(e,t,i,s)}))}}function Tm(){let e={};return{get:function(t){return e[t]},add:function(t,n){e[t]=n},remove:function(t){delete e[t]},removeAll:function(){e={}}}}const Pm={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class Am{constructor(e){this.parser=e,this.name=Pm.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,i=t.length;n<i;n++){const i=t[n];i.extensions&&i.extensions[this.name]&&void 0!==i.extensions[this.name].light&&e._addNodeRef(this.cache,i.extensions[this.name].light)}}_loadLight(e){const t=this.parser,n="light:"+e;let i=t.cache.get(n);if(i)return i;const s=t.json,r=((s.extensions&&s.extensions[this.name]||{}).lights||[])[e];let a;const o=new Ys(16777215);void 0!==r.color&&o.fromArray(r.color);const l=void 0!==r.range?r.range:0;switch(r.type){case"directional":a=new Ud(o),a.target.position.set(0,0,-1),a.add(a.target);break;case"point":a=new Od(o),a.distance=l;break;case"spot":a=new Ld(o),a.distance=l,r.spot=r.spot||{},r.spot.innerConeAngle=void 0!==r.spot.innerConeAngle?r.spot.innerConeAngle:0,r.spot.outerConeAngle=void 0!==r.spot.outerConeAngle?r.spot.outerConeAngle:Math.PI/4,a.angle=r.spot.outerConeAngle,a.penumbra=1-r.spot.innerConeAngle/r.spot.outerConeAngle,a.target.position.set(0,0,-1),a.add(a.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+r.type)}return a.position.set(0,0,0),a.decay=2,mf(a,r),void 0!==r.intensity&&(a.intensity=r.intensity),a.name=t.createUniqueName(r.name||"light_"+e),i=Promise.resolve(a),t.cache.add(n,i),i}getDependency(e,t){if("light"===e)return this._loadLight(t)}createNodeAttachment(e){const t=this,n=this.parser,i=n.json.nodes[e],s=(i.extensions&&i.extensions[this.name]||{}).light;return void 0===s?null:this._loadLight(s).then((function(e){return n._getNodeRef(t.cache,s,e)}))}}class Lm{constructor(){this.name=Pm.KHR_MATERIALS_UNLIT}getMaterialType(){return Zs}extendParams(e,t,n){const i=[];e.color=new Ys(1,1,1),e.opacity=1;const s=t.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){const t=s.baseColorFactor;e.color.fromArray(t),e.opacity=t[3]}void 0!==s.baseColorTexture&&i.push(n.assignTexture(e,"map",s.baseColorTexture,Kt))}return Promise.all(i)}}class Rm{constructor(e){this.parser=e,this.name=Pm.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name].emissiveStrength;return void 0!==i&&(t.emissiveIntensity=i),Promise.resolve()}}class Dm{constructor(e){this.parser=e,this.name=Pm.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Nu:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],r=i.extensions[this.name];if(void 0!==r.clearcoatFactor&&(t.clearcoat=r.clearcoatFactor),void 0!==r.clearcoatTexture&&s.push(n.assignTexture(t,"clearcoatMap",r.clearcoatTexture)),void 0!==r.clearcoatRoughnessFactor&&(t.clearcoatRoughness=r.clearcoatRoughnessFactor),void 0!==r.clearcoatRoughnessTexture&&s.push(n.assignTexture(t,"clearcoatRoughnessMap",r.clearcoatRoughnessTexture)),void 0!==r.clearcoatNormalTexture&&(s.push(n.assignTexture(t,"clearcoatNormalMap",r.clearcoatNormalTexture)),void 0!==r.clearcoatNormalTexture.scale)){const e=r.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new Zn(e,e)}return Promise.all(s)}}class Im{constructor(e){this.parser=e,this.name=Pm.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Nu:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],r=i.extensions[this.name];return void 0!==r.iridescenceFactor&&(t.iridescence=r.iridescenceFactor),void 0!==r.iridescenceTexture&&s.push(n.assignTexture(t,"iridescenceMap",r.iridescenceTexture)),void 0!==r.iridescenceIor&&(t.iridescenceIOR=r.iridescenceIor),void 0===t.iridescenceThicknessRange&&(t.iridescenceThicknessRange=[100,400]),void 0!==r.iridescenceThicknessMinimum&&(t.iridescenceThicknessRange[0]=r.iridescenceThicknessMinimum),void 0!==r.iridescenceThicknessMaximum&&(t.iridescenceThicknessRange[1]=r.iridescenceThicknessMaximum),void 0!==r.iridescenceThicknessTexture&&s.push(n.assignTexture(t,"iridescenceThicknessMap",r.iridescenceThicknessTexture)),Promise.all(s)}}class km{constructor(e){this.parser=e,this.name=Pm.KHR_MATERIALS_SHEEN}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Nu:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[];t.sheenColor=new Ys(0,0,0),t.sheenRoughness=0,t.sheen=1;const r=i.extensions[this.name];return void 0!==r.sheenColorFactor&&t.sheenColor.fromArray(r.sheenColorFactor),void 0!==r.sheenRoughnessFactor&&(t.sheenRoughness=r.sheenRoughnessFactor),void 0!==r.sheenColorTexture&&s.push(n.assignTexture(t,"sheenColorMap",r.sheenColorTexture,Kt)),void 0!==r.sheenRoughnessTexture&&s.push(n.assignTexture(t,"sheenRoughnessMap",r.sheenRoughnessTexture)),Promise.all(s)}}class Om{constructor(e){this.parser=e,this.name=Pm.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Nu:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],r=i.extensions[this.name];return void 0!==r.transmissionFactor&&(t.transmission=r.transmissionFactor),void 0!==r.transmissionTexture&&s.push(n.assignTexture(t,"transmissionMap",r.transmissionTexture)),Promise.all(s)}}class Nm{constructor(e){this.parser=e,this.name=Pm.KHR_MATERIALS_VOLUME}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Nu:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],r=i.extensions[this.name];t.thickness=void 0!==r.thicknessFactor?r.thicknessFactor:0,void 0!==r.thicknessTexture&&s.push(n.assignTexture(t,"thicknessMap",r.thicknessTexture)),t.attenuationDistance=r.attenuationDistance||1/0;const a=r.attenuationColor||[1,1,1];return t.attenuationColor=new Ys(a[0],a[1],a[2]),Promise.all(s)}}class Um{constructor(e){this.parser=e,this.name=Pm.KHR_MATERIALS_IOR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Nu:null}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name];return t.ior=void 0!==i.ior?i.ior:1.5,Promise.resolve()}}class Vm{constructor(e){this.parser=e,this.name=Pm.KHR_MATERIALS_SPECULAR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Nu:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],r=i.extensions[this.name];t.specularIntensity=void 0!==r.specularFactor?r.specularFactor:1,void 0!==r.specularTexture&&s.push(n.assignTexture(t,"specularIntensityMap",r.specularTexture));const a=r.specularColorFactor||[1,1,1];return t.specularColor=new Ys(a[0],a[1],a[2]),void 0!==r.specularColorTexture&&s.push(n.assignTexture(t,"specularColorMap",r.specularColorTexture,Kt)),Promise.all(s)}}class Bm{constructor(e){this.parser=e,this.name=Pm.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Nu:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],r=i.extensions[this.name];return void 0!==r.anisotropyStrength&&(t.anisotropy=r.anisotropyStrength),void 0!==r.anisotropyRotation&&(t.anisotropyRotation=r.anisotropyRotation),void 0!==r.anisotropyTexture&&s.push(n.assignTexture(t,"anisotropyMap",r.anisotropyTexture)),Promise.all(s)}}class Fm{constructor(e){this.parser=e,this.name=Pm.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,i=n.textures[e];if(!i.extensions||!i.extensions[this.name])return null;const s=i.extensions[this.name],r=t.options.ktx2Loader;if(!r){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,s.source,r)}}class zm{constructor(e){this.parser=e,this.name=Pm.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,i=n.json,s=i.textures[e];if(!s.extensions||!s.extensions[t])return null;const r=s.extensions[t],a=i.images[r.source];let o=n.textureLoader;if(a.uri){const e=n.options.manager.getHandler(a.uri);null!==e&&(o=e)}return this.detectSupport().then((function(s){if(s)return n.loadTextureImage(e,r.source,o);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}}class Hm{constructor(e){this.parser=e,this.name=Pm.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,i=n.json,s=i.textures[e];if(!s.extensions||!s.extensions[t])return null;const r=s.extensions[t],a=i.images[r.source];let o=n.textureLoader;if(a.uri){const e=n.options.manager.getHandler(a.uri);null!==e&&(o=e)}return this.detectSupport().then((function(s){if(s)return n.loadTextureImage(e,r.source,o);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return n.loadTexture(e)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}}class Gm{constructor(e){this.name=Pm.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const e=n.extensions[this.name],i=this.parser.getDependency("buffer",e.buffer),s=this.parser.options.meshoptDecoder;if(!s||!s.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return i.then((function(t){const n=e.byteOffset||0,i=e.byteLength||0,r=e.count,a=e.byteStride,o=new Uint8Array(t,n,i);return s.decodeGltfBufferAsync?s.decodeGltfBufferAsync(r,a,o,e.mode,e.filter).then((function(e){return e.buffer})):s.ready.then((function(){const t=new ArrayBuffer(r*a);return s.decodeGltfBuffer(new Uint8Array(t),r,a,o,e.mode,e.filter),t}))}))}return null}}class jm{constructor(e){this.name=Pm.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,n=t.nodes[e];if(!n.extensions||!n.extensions[this.name]||void 0===n.mesh)return null;const i=t.meshes[n.mesh];for(const e of i.primitives)if(e.mode!==tf.TRIANGLES&&e.mode!==tf.TRIANGLE_STRIP&&e.mode!==tf.TRIANGLE_FAN&&void 0!==e.mode)return null;const s=n.extensions[this.name].attributes,r=[],a={};for(const e in s)r.push(this.parser.getDependency("accessor",s[e]).then((t=>(a[e]=t,a[e]))));return r.length<1?null:(r.push(this.parser.createNodeMesh(e)),Promise.all(r).then((e=>{const t=e.pop(),n=t.isGroup?t.children:[t],i=e[0].count,s=[];for(const e of n){const t=new rs,n=new Ai,r=new Pi,o=new Ai(1,1,1),l=new Bc(e.geometry,e.material,i);for(let e=0;e<i;e++)a.TRANSLATION&&n.fromBufferAttribute(a.TRANSLATION,e),a.ROTATION&&r.fromBufferAttribute(a.ROTATION,e),a.SCALE&&o.fromBufferAttribute(a.SCALE,e),l.setMatrixAt(e,t.compose(n,r,o));for(const t in a)"TRANSLATION"!==t&&"ROTATION"!==t&&"SCALE"!==t&&e.geometry.setAttribute(t,a[t]);Ls.prototype.copy.call(l,e),this.parser.assignFinalMaterial(l),s.push(l)}return t.isGroup?(t.clear(),t.add(...s),t):s[0]})))}}const Wm="glTF",qm=1313821514,Xm=5130562;class Km{constructor(e){this.name=Pm.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,12),n=new TextDecoder;if(this.header={magic:n.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==Wm)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const i=this.header.length-12,s=new DataView(e,12);let r=0;for(;r<i;){const t=s.getUint32(r,!0);r+=4;const i=s.getUint32(r,!0);if(r+=4,i===qm){const i=new Uint8Array(e,12+r,t);this.content=n.decode(i)}else if(i===Xm){const n=12+r;this.body=e.slice(n,n+t)}r+=t}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Ym{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Pm.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,i=this.dracoLoader,s=e.extensions[this.name].bufferView,r=e.extensions[this.name].attributes,a={},o={},l={};for(const e in r){const t=of[e]||e.toLowerCase();a[t]=r[e]}for(const t in e.attributes){const i=of[t]||t.toLowerCase();if(void 0!==r[t]){const s=n.accessors[e.attributes[t]],r=nf[s.componentType];l[i]=r.name,o[i]=!0===s.normalized}}return t.getDependency("bufferView",s).then((function(e){return new Promise((function(t){i.decodeDracoFile(e,(function(e){for(const t in e.attributes){const n=e.attributes[t],i=o[t];void 0!==i&&(n.normalized=i)}t(e)}),a,l)}))}))}}class $m{constructor(){this.name=Pm.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return void 0!==t.texCoord&&t.texCoord!==e.channel||void 0!==t.offset||void 0!==t.rotation||void 0!==t.scale?(e=e.clone(),void 0!==t.texCoord&&(e.channel=t.texCoord),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0,e):e}}class Zm{constructor(){this.name=Pm.KHR_MESH_QUANTIZATION}}class Jm extends $u{constructor(e,t,n,i){super(e,t,n,i)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,s=e*i*3+i;for(let e=0;e!==i;e++)t[e]=n[s+e];return t}interpolate_(e,t,n,i){const s=this.resultBuffer,r=this.sampleValues,a=this.valueSize,o=2*a,l=3*a,c=i-t,h=(n-t)/c,u=h*h,d=u*h,p=e*l,m=p-l,f=-2*d+3*u,v=d-u,g=1-f,_=v-u+h;for(let e=0;e!==a;e++){const t=r[m+e+a],n=r[m+e+o]*c,i=r[p+e+a],l=r[p+e]*c;s[e]=g*t+_*n+f*i+v*l}return s}}const Qm=new Pi;class ef extends Jm{interpolate_(e,t,n,i){const s=super.interpolate_(e,t,n,i);return Qm.fromArray(s).normalize().toArray(s),s}}const tf={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},nf={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},sf={9728:we,9729:Ee,9984:be,9985:Se,9986:xe,9987:Te},rf={33071:ge,33648:_e,10497:ve},af={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},of={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},lf={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},cf={CUBICSPLINE:void 0,LINEAR:Rt,STEP:Lt},hf="OPAQUE",uf="MASK",df="BLEND";function pf(e,t,n){for(const i in n.extensions)void 0===e[i]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[i]=n.extensions[i])}function mf(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function ff(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let n=0,i=t.weights.length;n<i;n++)e.morphTargetInfluences[n]=t.weights[n];if(t.extras&&Array.isArray(t.extras.targetNames)){const n=t.extras.targetNames;if(e.morphTargetInfluences.length===n.length){e.morphTargetDictionary={};for(let t=0,i=n.length;t<i;t++)e.morphTargetDictionary[n[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function vf(e){let t;const n=e.extensions&&e.extensions[Pm.KHR_DRACO_MESH_COMPRESSION];if(t=n?"draco:"+n.bufferView+":"+n.indices+":"+gf(n.attributes):e.indices+":"+gf(e.attributes)+":"+e.mode,void 0!==e.targets)for(let n=0,i=e.targets.length;n<i;n++)t+=":"+gf(e.targets[n]);return t}function gf(e){let t="";const n=Object.keys(e).sort();for(let i=0,s=n.length;i<s;i++)t+=n[i]+":"+e[n[i]]+";";return t}function _f(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}const wf=new rs;class bf{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new Tm,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let n=!1,i=!1,s=-1;"undefined"!=typeof navigator&&(n=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),i=navigator.userAgent.indexOf("Firefox")>-1,s=i?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),"undefined"==typeof createImageBitmap||n||i&&s<98?this.textureLoader=new xd(this.options.manager):this.textureLoader=new $d(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new vd(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,i=this.json,s=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll((function(e){return e._markDefs&&e._markDefs()})),Promise.all(this._invokeAll((function(e){return e.beforeRoot&&e.beforeRoot()}))).then((function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])})).then((function(t){const r={scene:t[0][i.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:i.asset,parser:n,userData:{}};pf(s,r,i),mf(r,i),Promise.all(n._invokeAll((function(e){return e.afterRoot&&e.afterRoot(r)}))).then((function(){e(r)}))})).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let n=0,i=t.length;n<i;n++){const i=t[n].joints;for(let t=0,n=i.length;t<n;t++)e[i[t]].isBone=!0}for(let t=0,i=e.length;t<i;t++){const i=e[t];void 0!==i.mesh&&(this._addNodeRef(this.meshCache,i.mesh),void 0!==i.skin&&(n[i.mesh].isSkinnedMesh=!0)),void 0!==i.camera&&this._addNodeRef(this.cameraCache,i.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const i=n.clone(),s=(e,t)=>{const n=this.associations.get(e);null!=n&&this.associations.set(t,n);for(const[n,i]of e.children.entries())s(i,t.children[n])};return s(n,i),i.name+="_instance_"+e.uses[t]++,i}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const i=e(t[n]);if(i)return i}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let i=0;i<t.length;i++){const s=e(t[i]);s&&n.push(s)}return n}getDependency(e,t){const n=e+":"+t;let i=this.cache.get(n);if(!i){switch(e){case"scene":i=this.loadScene(t);break;case"node":i=this._invokeOne((function(e){return e.loadNode&&e.loadNode(t)}));break;case"mesh":i=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(t)}));break;case"accessor":i=this.loadAccessor(t);break;case"bufferView":i=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(t)}));break;case"buffer":i=this.loadBuffer(t);break;case"material":i=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(t)}));break;case"texture":i=this._invokeOne((function(e){return e.loadTexture&&e.loadTexture(t)}));break;case"skin":i=this.loadSkin(t);break;case"animation":i=this._invokeOne((function(e){return e.loadAnimation&&e.loadAnimation(t)}));break;case"camera":i=this.loadCamera(t);break;default:if(i=this._invokeOne((function(n){return n!=this&&n.getDependency&&n.getDependency(e,t)})),!i)throw new Error("Unknown type: "+e)}this.cache.add(n,i)}return i}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this,i=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(i.map((function(t,i){return n.getDependency(e,i)}))),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],n=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[Pm.KHR_BINARY_GLTF].body);const i=this.options;return new Promise((function(e,s){n.load(Gd.resolveURL(t.uri,i.path),e,void 0,(function(){s(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){const n=t.byteLength||0,i=t.byteOffset||0;return e.slice(i,i+n)}))}loadAccessor(e){const t=this,n=this.json,i=this.json.accessors[e];if(void 0===i.bufferView&&void 0===i.sparse){const e=af[i.type],t=nf[i.componentType],n=!0===i.normalized,s=new t(i.count*e);return Promise.resolve(new rr(s,e,n))}const s=[];return void 0!==i.bufferView?s.push(this.getDependency("bufferView",i.bufferView)):s.push(null),void 0!==i.sparse&&(s.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(s).then((function(e){const s=e[0],r=af[i.type],a=nf[i.componentType],o=a.BYTES_PER_ELEMENT,l=o*r,c=i.byteOffset||0,h=void 0!==i.bufferView?n.bufferViews[i.bufferView].byteStride:void 0,u=!0===i.normalized;let d,p;if(h&&h!==l){const e=Math.floor(c/h),n="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+e+":"+i.count;let l=t.cache.get(n);l||(d=new a(s,e*h,i.count*h/o),l=new Kl(d,h/o),t.cache.add(n,l)),p=new $l(l,r,c%h/o,u)}else d=null===s?new a(i.count*r):new a(s,c,i.count*r),p=new rr(d,r,u);if(void 0!==i.sparse){const t=af.SCALAR,n=nf[i.sparse.indices.componentType],o=i.sparse.indices.byteOffset||0,l=i.sparse.values.byteOffset||0,c=new n(e[1],o,i.sparse.count*t),h=new a(e[2],l,i.sparse.count*r);null!==s&&(p=new rr(p.array.slice(),p.itemSize,p.normalized));for(let e=0,t=c.length;e<t;e++){const t=c[e];if(p.setX(t,h[e*r]),r>=2&&p.setY(t,h[e*r+1]),r>=3&&p.setZ(t,h[e*r+2]),r>=4&&p.setW(t,h[e*r+3]),r>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return p}))}loadTexture(e){const t=this.json,n=this.options,i=t.textures[e].source,s=t.images[i];let r=this.textureLoader;if(s.uri){const e=n.manager.getHandler(s.uri);null!==e&&(r=e)}return this.loadTextureImage(e,i,r)}loadTextureImage(e,t,n){const i=this,s=this.json,r=s.textures[e],a=s.images[t],o=(a.uri||a.bufferView)+":"+r.sampler;if(this.textureCache[o])return this.textureCache[o];const l=this.loadImageSource(t,n).then((function(t){t.flipY=!1,t.name=r.name||a.name||"",""===t.name&&"string"==typeof a.uri&&!1===a.uri.startsWith("data:image/")&&(t.name=a.uri);const n=(s.samplers||{})[r.sampler]||{};return t.magFilter=sf[n.magFilter]||Ee,t.minFilter=sf[n.minFilter]||Te,t.wrapS=rf[n.wrapS]||ve,t.wrapT=rf[n.wrapT]||ve,i.associations.set(t,{textures:e}),t})).catch((function(){return null}));return this.textureCache[o]=l,l}loadImageSource(e,t){const n=this,i=this.json,s=this.options;if(void 0!==this.sourceCache[e])return this.sourceCache[e].then((e=>e.clone()));const r=i.images[e],a=self.URL||self.webkitURL;let o=r.uri||"",l=!1;if(void 0!==r.bufferView)o=n.getDependency("bufferView",r.bufferView).then((function(e){l=!0;const t=new Blob([e],{type:r.mimeType});return o=a.createObjectURL(t),o}));else if(void 0===r.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const c=Promise.resolve(o).then((function(e){return new Promise((function(n,i){let r=n;!0===t.isImageBitmapLoader&&(r=function(e){const t=new wi(e);t.needsUpdate=!0,n(t)}),t.load(Gd.resolveURL(e,s.path),r,void 0,i)}))})).then((function(e){var t;return!0===l&&a.revokeObjectURL(o),e.userData.mimeType=r.mimeType||((t=r.uri).search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/)?"image/jpeg":t.search(/\.webp($|\?)/i)>0||0===t.search(/^data\:image\/webp/)?"image/webp":"image/png"),e})).catch((function(e){throw console.error("THREE.GLTFLoader: Couldn't load texture",o),e}));return this.sourceCache[e]=c,c}assignTexture(e,t,n,i){const s=this;return this.getDependency("texture",n.index).then((function(r){if(!r)return null;if(void 0!==n.texCoord&&n.texCoord>0&&((r=r.clone()).channel=n.texCoord),s.extensions[Pm.KHR_TEXTURE_TRANSFORM]){const e=void 0!==n.extensions?n.extensions[Pm.KHR_TEXTURE_TRANSFORM]:void 0;if(e){const t=s.associations.get(r);r=s.extensions[Pm.KHR_TEXTURE_TRANSFORM].extendTexture(r,e),s.associations.set(r,t)}}return void 0!==i&&(r.colorSpace=i),e[t]=r,r}))}assignFinalMaterial(e){const t=e.geometry;let n=e.material;const i=void 0===t.attributes.tangent,s=void 0!==t.attributes.color,r=void 0===t.attributes.normal;if(e.isPoints){const e="PointsMaterial:"+n.uuid;let t=this.cache.get(e);t||(t=new Zc,js.prototype.copy.call(t,n),t.color.copy(n.color),t.map=n.map,t.sizeAttenuation=!1,this.cache.add(e,t)),n=t}else if(e.isLine){const e="LineBasicMaterial:"+n.uuid;let t=this.cache.get(e);t||(t=new Fc,js.prototype.copy.call(t,n),t.color.copy(n.color),t.map=n.map,this.cache.add(e,t)),n=t}if(i||s||r){let e="ClonedMaterial:"+n.uuid+":";i&&(e+="derivative-tangents:"),s&&(e+="vertex-colors:"),r&&(e+="flat-shading:");let t=this.cache.get(e);t||(t=n.clone(),s&&(t.vertexColors=!0),r&&(t.flatShading=!0),i&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(n))),n=t}e.material=n}getMaterialType(){return Ou}loadMaterial(e){const t=this,n=this.json,i=this.extensions,s=n.materials[e];let r;const a={},o=[];if((s.extensions||{})[Pm.KHR_MATERIALS_UNLIT]){const e=i[Pm.KHR_MATERIALS_UNLIT];r=e.getMaterialType(),o.push(e.extendParams(a,s,t))}else{const n=s.pbrMetallicRoughness||{};if(a.color=new Ys(1,1,1),a.opacity=1,Array.isArray(n.baseColorFactor)){const e=n.baseColorFactor;a.color.fromArray(e),a.opacity=e[3]}void 0!==n.baseColorTexture&&o.push(t.assignTexture(a,"map",n.baseColorTexture,Kt)),a.metalness=void 0!==n.metallicFactor?n.metallicFactor:1,a.roughness=void 0!==n.roughnessFactor?n.roughnessFactor:1,void 0!==n.metallicRoughnessTexture&&(o.push(t.assignTexture(a,"metalnessMap",n.metallicRoughnessTexture)),o.push(t.assignTexture(a,"roughnessMap",n.metallicRoughnessTexture))),r=this._invokeOne((function(t){return t.getMaterialType&&t.getMaterialType(e)})),o.push(Promise.all(this._invokeAll((function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,a)}))))}!0===s.doubleSided&&(a.side=M);const l=s.alphaMode||hf;if(l===df?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,l===uf&&(a.alphaTest=void 0!==s.alphaCutoff?s.alphaCutoff:.5)),void 0!==s.normalTexture&&r!==Zs&&(o.push(t.assignTexture(a,"normalMap",s.normalTexture)),a.normalScale=new Zn(1,1),void 0!==s.normalTexture.scale)){const e=s.normalTexture.scale;a.normalScale.set(e,e)}return void 0!==s.occlusionTexture&&r!==Zs&&(o.push(t.assignTexture(a,"aoMap",s.occlusionTexture)),void 0!==s.occlusionTexture.strength&&(a.aoMapIntensity=s.occlusionTexture.strength)),void 0!==s.emissiveFactor&&r!==Zs&&(a.emissive=(new Ys).fromArray(s.emissiveFactor)),void 0!==s.emissiveTexture&&r!==Zs&&o.push(t.assignTexture(a,"emissiveMap",s.emissiveTexture,Kt)),Promise.all(o).then((function(){const n=new r(a);return s.name&&(n.name=s.name),mf(n,s),t.associations.set(n,{materials:e}),s.extensions&&pf(i,n,s),n}))}createUniqueName(e){const t=Tp.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,n=this.extensions,i=this.primitiveCache;function s(e){return n[Pm.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then((function(n){return yf(n,e,t)}))}const r=[];for(let n=0,a=e.length;n<a;n++){const a=e[n],o=vf(a),l=i[o];if(l)r.push(l.promise);else{let e;e=a.extensions&&a.extensions[Pm.KHR_DRACO_MESH_COMPRESSION]?s(a):yf(new Mr,a,t),i[o]={primitive:a,promise:e},r.push(e)}}return Promise.all(r)}loadMesh(e){const t=this,n=this.json,i=this.extensions,s=n.meshes[e],r=s.primitives,a=[];for(let e=0,t=r.length;e<t;e++){const t=void 0===r[e].material?(void 0===(o=this.cache).DefaultMaterial&&(o.DefaultMaterial=new Ou({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:y})),o.DefaultMaterial):this.getDependency("material",r[e].material);a.push(t)}var o;return a.push(t.loadGeometries(r)),Promise.all(a).then((function(n){const a=n.slice(0,n.length-1),o=n[n.length-1],l=[];for(let n=0,c=o.length;n<c;n++){const c=o[n],h=r[n];let u;const d=a[n];if(h.mode===tf.TRIANGLES||h.mode===tf.TRIANGLE_STRIP||h.mode===tf.TRIANGLE_FAN||void 0===h.mode)u=!0===s.isSkinnedMesh?new Sc(c,d):new zr(c,d),!0===u.isSkinnedMesh&&u.normalizeSkinWeights(),h.mode===tf.TRIANGLE_STRIP?u.geometry=Sm(u.geometry,Bt):h.mode===tf.TRIANGLE_FAN&&(u.geometry=Sm(u.geometry,Ft));else if(h.mode===tf.LINES)u=new Yc(c,d);else if(h.mode===tf.LINE_STRIP)u=new qc(c,d);else if(h.mode===tf.LINE_LOOP)u=new $c(c,d);else{if(h.mode!==tf.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+h.mode);u=new nh(c,d)}Object.keys(u.geometry.morphAttributes).length>0&&ff(u,s),u.name=t.createUniqueName(s.name||"mesh_"+e),mf(u,s),h.extensions&&pf(i,u,h),t.assignFinalMaterial(u),l.push(u)}for(let n=0,i=l.length;n<i;n++)t.associations.set(l[n],{meshes:e,primitives:n});if(1===l.length)return s.extensions&&pf(i,l[0],s),l[0];const c=new Ol;s.extensions&&pf(i,c,s),t.associations.set(c,{meshes:e});for(let e=0,t=l.length;e<t;e++)c.add(l[e]);return c}))}loadCamera(e){let t;const n=this.json.cameras[e],i=n[n.type];if(i)return"perspective"===n.type?t=new $r($n.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):"orthographic"===n.type&&(t=new ya(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),mf(t,n),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const t=this.json.skins[e],n=[];for(let e=0,i=t.joints.length;e<i;e++)n.push(this._loadNodeShallow(t.joints[e]));return void 0!==t.inverseBindMatrices?n.push(this.getDependency("accessor",t.inverseBindMatrices)):n.push(null),Promise.all(n).then((function(e){const n=e.pop(),i=e,s=[],r=[];for(let e=0,a=i.length;e<a;e++){const a=i[e];if(a){s.push(a);const t=new rs;null!==n&&t.fromArray(n.array,16*e),r.push(t)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[e])}return new Lc(s,r)}))}loadAnimation(e){const t=this.json,n=this,i=t.animations[e],s=i.name?i.name:"animation_"+e,r=[],a=[],o=[],l=[],c=[];for(let e=0,t=i.channels.length;e<t;e++){const t=i.channels[e],n=i.samplers[t.sampler],s=t.target,h=s.node,u=void 0!==i.parameters?i.parameters[n.input]:n.input,d=void 0!==i.parameters?i.parameters[n.output]:n.output;void 0!==s.node&&(r.push(this.getDependency("node",h)),a.push(this.getDependency("accessor",u)),o.push(this.getDependency("accessor",d)),l.push(n),c.push(s))}return Promise.all([Promise.all(r),Promise.all(a),Promise.all(o),Promise.all(l),Promise.all(c)]).then((function(e){const t=e[0],i=e[1],r=e[2],a=e[3],o=e[4],l=[];for(let e=0,s=t.length;e<s;e++){const s=t[e],c=i[e],h=r[e],u=a[e],d=o[e];if(void 0===s)continue;s.updateMatrix&&s.updateMatrix();const p=n._createAnimationTracks(s,c,h,u,d);if(p)for(let e=0;e<p.length;e++)l.push(p[e])}return new ld(s,void 0,l)}))}createNodeMesh(e){const t=this.json,n=this,i=t.nodes[e];return void 0===i.mesh?null:n.getDependency("mesh",i.mesh).then((function(e){const t=n._getNodeRef(n.meshCache,i.mesh,e);return void 0!==i.weights&&t.traverse((function(e){if(e.isMesh)for(let t=0,n=i.weights.length;t<n;t++)e.morphTargetInfluences[t]=i.weights[t]})),t}))}loadNode(e){const t=this,n=this.json.nodes[e],i=t._loadNodeShallow(e),s=[],r=n.children||[];for(let e=0,n=r.length;e<n;e++)s.push(t.getDependency("node",r[e]));const a=void 0===n.skin?Promise.resolve(null):t.getDependency("skin",n.skin);return Promise.all([i,Promise.all(s),a]).then((function(e){const t=e[0],n=e[1],i=e[2];null!==i&&t.traverse((function(e){e.isSkinnedMesh&&e.bind(i,wf)}));for(let e=0,i=n.length;e<i;e++)t.add(n[e]);return t}))}_loadNodeShallow(e){const t=this.json,n=this.extensions,i=this;if(void 0!==this.nodeCache[e])return this.nodeCache[e];const s=t.nodes[e],r=s.name?i.createUniqueName(s.name):"",a=[],o=i._invokeOne((function(t){return t.createNodeMesh&&t.createNodeMesh(e)}));return o&&a.push(o),void 0!==s.camera&&a.push(i.getDependency("camera",s.camera).then((function(e){return i._getNodeRef(i.cameraCache,s.camera,e)}))),i._invokeAll((function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)})).forEach((function(e){a.push(e)})),this.nodeCache[e]=Promise.all(a).then((function(t){let a;if(a=!0===s.isBone?new Cc:t.length>1?new Ol:1===t.length?t[0]:new Ls,a!==t[0])for(let e=0,n=t.length;e<n;e++)a.add(t[e]);if(s.name&&(a.userData.name=s.name,a.name=r),mf(a,s),s.extensions&&pf(n,a,s),void 0!==s.matrix){const e=new rs;e.fromArray(s.matrix),a.applyMatrix4(e)}else void 0!==s.translation&&a.position.fromArray(s.translation),void 0!==s.rotation&&a.quaternion.fromArray(s.rotation),void 0!==s.scale&&a.scale.fromArray(s.scale);return i.associations.has(a)||i.associations.set(a,{}),i.associations.get(a).nodes=e,a})),this.nodeCache[e]}loadScene(e){const t=this.extensions,n=this.json.scenes[e],i=this,s=new Ol;n.name&&(s.name=i.createUniqueName(n.name)),mf(s,n),n.extensions&&pf(t,s,n);const r=n.nodes||[],a=[];for(let e=0,t=r.length;e<t;e++)a.push(i.getDependency("node",r[e]));return Promise.all(a).then((function(e){for(let t=0,n=e.length;t<n;t++)s.add(e[t]);return i.associations=(e=>{const t=new Map;for(const[e,n]of i.associations)(e instanceof js||e instanceof wi)&&t.set(e,n);return e.traverse((e=>{const n=i.associations.get(e);null!=n&&t.set(e,n)})),t})(s),s}))}_createAnimationTracks(e,t,n,i,s){const r=[],a=e.name?e.name:e.uuid,o=[];let l;switch(lf[s.path]===lf.weights?e.traverse((function(e){e.morphTargetInfluences&&o.push(e.name?e.name:e.uuid)})):o.push(a),lf[s.path]){case lf.weights:l=id;break;case lf.rotation:l=rd;break;case lf.position:case lf.scale:l=od;break;default:if(1===n.itemSize)l=id;else l=od}const c=void 0!==i.interpolation?cf[i.interpolation]:Rt,h=this._getArrayFromAccessor(n);for(let e=0,n=o.length;e<n;e++){const n=new l(o[e]+"."+lf[s.path],t.array,h,c);"CUBICSPLINE"===i.interpolation&&this._createCubicSplineTrackInterpolant(n),r.push(n)}return r}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const e=_f(t.constructor),n=new Float32Array(t.length);for(let i=0,s=t.length;i<s;i++)n[i]=t[i]*e;t=n}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(e){return new(this instanceof rd?ef:Jm)(this.times,this.values,this.getValueSize()/3,e)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function yf(e,t,n){const i=t.attributes,s=[];function r(t,i){return n.getDependency("accessor",t).then((function(t){e.setAttribute(i,t)}))}for(const t in i){const n=of[t]||t.toLowerCase();n in e.attributes||s.push(r(i[t],n))}if(void 0!==t.indices&&!e.index){const i=n.getDependency("accessor",t.indices).then((function(t){e.setIndex(t)}));s.push(i)}return mf(e,t),function(e,t,n){const i=t.attributes,s=new Di;if(void 0===i.POSITION)return;{const e=n.json.accessors[i.POSITION],t=e.min,r=e.max;if(void 0===t||void 0===r)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(s.set(new Ai(t[0],t[1],t[2]),new Ai(r[0],r[1],r[2])),e.normalized){const t=_f(nf[e.componentType]);s.min.multiplyScalar(t),s.max.multiplyScalar(t)}}const r=t.targets;if(void 0!==r){const e=new Ai,t=new Ai;for(let i=0,s=r.length;i<s;i++){const s=r[i];if(void 0!==s.POSITION){const i=n.json.accessors[s.POSITION],r=i.min,a=i.max;if(void 0!==r&&void 0!==a){if(t.setX(Math.max(Math.abs(r[0]),Math.abs(a[0]))),t.setY(Math.max(Math.abs(r[1]),Math.abs(a[1]))),t.setZ(Math.max(Math.abs(r[2]),Math.abs(a[2]))),i.normalized){const e=_f(nf[i.componentType]);t.multiplyScalar(e)}e.max(t)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}s.expandByVector(e)}e.boundingBox=s;const a=new $i;s.getCenter(a.center),a.radius=s.min.distanceTo(s.max)/2,e.boundingSphere=a}(e,t,n),Promise.all(s).then((function(){return void 0!==t.targets?function(e,t,n){let i=!1,s=!1,r=!1;for(let e=0,n=t.length;e<n;e++){const n=t[e];if(void 0!==n.POSITION&&(i=!0),void 0!==n.NORMAL&&(s=!0),void 0!==n.COLOR_0&&(r=!0),i&&s&&r)break}if(!i&&!s&&!r)return Promise.resolve(e);const a=[],o=[],l=[];for(let c=0,h=t.length;c<h;c++){const h=t[c];if(i){const t=void 0!==h.POSITION?n.getDependency("accessor",h.POSITION):e.attributes.position;a.push(t)}if(s){const t=void 0!==h.NORMAL?n.getDependency("accessor",h.NORMAL):e.attributes.normal;o.push(t)}if(r){const t=void 0!==h.COLOR_0?n.getDependency("accessor",h.COLOR_0):e.attributes.color;l.push(t)}}return Promise.all([Promise.all(a),Promise.all(o),Promise.all(l)]).then((function(t){const n=t[0],a=t[1],o=t[2];return i&&(e.morphAttributes.position=n),s&&(e.morphAttributes.normal=a),r&&(e.morphAttributes.color=o),e.morphTargetsRelative=!0,e}))}(e,t.targets,n):e}))}class xf extends yd{constructor(e){super(e),this.type=Ne}parse(e){const t=function(e,t){switch(e){case 1:console.error("THREE.RGBELoader Read Error: "+(t||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(t||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(t||""));break;default:console.error("THREE.RGBELoader: Error: "+(t||""))}return-1},n=function(e,t,n){t=t||1024;let i=e.pos,s=-1,r=0,a="",o=String.fromCharCode.apply(null,new Uint16Array(e.subarray(i,i+128)));for(;0>(s=o.indexOf("\n"))&&r<t&&i<e.byteLength;)a+=o,r+=o.length,i+=128,o+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(i,i+128)));return-1<s&&(!1!==n&&(e.pos+=r+s+1),a+o.slice(0,s))},i=function(e,t,n,i){const s=e[t+3],r=Math.pow(2,s-128)/255;n[i+0]=e[t+0]*r,n[i+1]=e[t+1]*r,n[i+2]=e[t+2]*r,n[i+3]=1},s=function(e,t,n,i){const s=e[t+3],r=Math.pow(2,s-128)/255;n[i+0]=nr.toHalfFloat(Math.min(e[t+0]*r,65504)),n[i+1]=nr.toHalfFloat(Math.min(e[t+1]*r,65504)),n[i+2]=nr.toHalfFloat(Math.min(e[t+2]*r,65504)),n[i+3]=nr.toHalfFloat(1)},r=new Uint8Array(e);r.pos=0;const a=function(e){const i=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,s=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,r=/^\s*FORMAT=(\S+)\s*$/,a=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,o={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let l,c;if(e.pos>=e.byteLength||!(l=n(e)))return t(1,"no header found");if(!(c=l.match(/^#\?(\S+)/)))return t(3,"bad initial token");for(o.valid|=1,o.programtype=c[1],o.string+=l+"\n";l=n(e),!1!==l;)if(o.string+=l+"\n","#"!==l.charAt(0)){if((c=l.match(i))&&(o.gamma=parseFloat(c[1])),(c=l.match(s))&&(o.exposure=parseFloat(c[1])),(c=l.match(r))&&(o.valid|=2,o.format=c[1]),(c=l.match(a))&&(o.valid|=4,o.height=parseInt(c[1],10),o.width=parseInt(c[2],10)),2&o.valid&&4&o.valid)break}else o.comments+=l+"\n";return 2&o.valid?4&o.valid?o:t(3,"missing image size specifier"):t(3,"missing format specifier")}(r);if(-1!==a){const e=a.width,n=a.height,o=function(e,n,i){const s=n;if(s<8||s>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);if(s!==(e[2]<<8|e[3]))return t(3,"wrong scanline width");const r=new Uint8Array(4*n*i);if(!r.length)return t(4,"unable to allocate buffer space");let a=0,o=0;const l=4*s,c=new Uint8Array(4),h=new Uint8Array(l);let u=i;for(;u>0&&o<e.byteLength;){if(o+4>e.byteLength)return t(1);if(c[0]=e[o++],c[1]=e[o++],c[2]=e[o++],c[3]=e[o++],2!=c[0]||2!=c[1]||(c[2]<<8|c[3])!=s)return t(3,"bad rgbe scanline format");let n,i=0;for(;i<l&&o<e.byteLength;){n=e[o++];const s=n>128;if(s&&(n-=128),0===n||i+n>l)return t(3,"bad scanline data");if(s){const t=e[o++];for(let e=0;e<n;e++)h[i++]=t}else h.set(e.subarray(o,o+n),i),i+=n,o+=n}const d=s;for(let e=0;e<d;e++){let t=0;r[a]=h[e+t],t+=s,r[a+1]=h[e+t],t+=s,r[a+2]=h[e+t],t+=s,r[a+3]=h[e+t],a+=4}u--}return r}(r.subarray(r.pos),e,n);if(-1!==o){let t,r,l;switch(this.type){case Oe:l=o.length/4;const e=new Float32Array(4*l);for(let t=0;t<l;t++)i(o,4*t,e,4*t);t=e,r=Oe;break;case Ne:l=o.length/4;const n=new Uint16Array(4*l);for(let e=0;e<l;e++)s(o,4*e,n,4*e);t=n,r=Ne;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type)}return{width:e,height:n,data:t,header:a.string,gamma:a.gamma,exposure:a.exposure,type:r}}}return null}setDataType(e){return this.type=e,this}load(e,t,n,i){return super.load(e,(function(e,n){switch(e.type){case Oe:case Ne:e.colorSpace=Yt,e.minFilter=Ee,e.magFilter=Ee,e.generateMipmaps=!1,e.flipY=!0}t&&t(e,n)}),n,i)}}const Mf=new WeakMap;class Ef extends pd{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,n,i){const s=new vd(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,(e=>{this.parse(e,t,i)}),n,i)}parse(e,t,n){this.decodeDracoFile(e,t,null,null,Kt).catch(n)}decodeDracoFile(e,t,n,i,s=Yt){const r={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:i||this.defaultAttributeTypes,useUniqueIDs:!!n,vertexColorSpace:s};return this.decodeGeometry(e,r).then(t)}decodeGeometry(e,t){const n=JSON.stringify(t);if(Mf.has(e)){const t=Mf.get(e);if(t.key===n)return t.promise;if(0===e.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let i;const s=this.workerNextTaskID++,r=e.byteLength,a=this._getWorker(s,r).then((n=>(i=n,new Promise(((n,r)=>{i._callbacks[s]={resolve:n,reject:r},i.postMessage({type:"decode",id:s,taskConfig:t,buffer:e},[e])}))))).then((e=>this._createGeometry(e.geometry)));return a.catch((()=>!0)).then((()=>{i&&s&&this._releaseTask(i,s)})),Mf.set(e,{key:n,promise:a}),a}_createGeometry(e){const t=new Mr;e.index&&t.setIndex(new rr(e.index.array,1));for(let n=0;n<e.attributes.length;n++){const i=e.attributes[n],s=i.name,r=i.array,a=i.itemSize,o=new rr(r,a);"color"===s&&(this._assignVertexColorSpace(o,i.vertexColorSpace),o.normalized=r instanceof Float32Array==!1),t.setAttribute(s,o)}return t}_assignVertexColorSpace(e,t){if(t!==Kt)return;const n=new Ys;for(let t=0,i=e.count;t<i;t++)n.fromBufferAttribute(e,t).convertSRGBToLinear(),e.setXYZ(t,n.r,n.g,n.b)}_loadLibrary(e,t){const n=new vd(this.manager);return n.setPath(this.decoderPath),n.setResponseType(t),n.setWithCredentials(this.withCredentials),new Promise(((t,i)=>{n.load(e,t,void 0,i)}))}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then((t=>{const n=t[0];e||(this.decoderConfig.wasmBinary=t[1]);const i=Sf.toString(),s=["/* draco decoder */",n,"","/* worker */",i.substring(i.indexOf("{")+1,i.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([s]))})),this.decoderPending}_getWorker(e,t){return this._initDecoder().then((()=>{if(this.workerPool.length<this.workerLimit){const e=new Worker(this.workerSourceURL);e._callbacks={},e._taskCosts={},e._taskLoad=0,e.postMessage({type:"init",decoderConfig:this.decoderConfig}),e.onmessage=function(t){const n=t.data;switch(n.type){case"decode":e._callbacks[n.id].resolve(n);break;case"error":e._callbacks[n.id].reject(n);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+n.type+'"')}},this.workerPool.push(e)}else this.workerPool.sort((function(e,t){return e._taskLoad>t._taskLoad?-1:1}));const n=this.workerPool[this.workerPool.length-1];return n._taskCosts[e]=t,n._taskLoad+=t,n}))}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map((e=>e._taskLoad)))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,""!==this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),this}}function Sf(){let e,t;function n(e,t,n,i,s,r){const a=r.num_components(),o=n.num_points()*a,l=o*s.BYTES_PER_ELEMENT,c=function(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32}}(e,s),h=e._malloc(l);t.GetAttributeDataArrayForAllPoints(n,r,c,l,h);const u=new s(e.HEAPF32.buffer,h,o).slice();return e._free(h),{name:i,array:u,itemSize:a}}onmessage=function(i){const s=i.data;switch(s.type){case"init":e=s.decoderConfig,t=new Promise((function(t){e.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(e)}));break;case"decode":const i=s.buffer,r=s.taskConfig;t.then((e=>{const t=e.draco,a=new t.Decoder;try{const e=function(e,t,i,s){const r=s.attributeIDs,a=s.attributeTypes;let o,l;const c=t.GetEncodedGeometryType(i);if(c===e.TRIANGULAR_MESH)o=new e.Mesh,l=t.DecodeArrayToMesh(i,i.byteLength,o);else{if(c!==e.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");o=new e.PointCloud,l=t.DecodeArrayToPointCloud(i,i.byteLength,o)}if(!l.ok()||0===o.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+l.error_msg());const h={index:null,attributes:[]};for(const i in r){const l=self[a[i]];let c,u;if(s.useUniqueIDs)u=r[i],c=t.GetAttributeByUniqueId(o,u);else{if(u=t.GetAttributeId(o,e[r[i]]),-1===u)continue;c=t.GetAttribute(o,u)}const d=n(e,t,o,i,l,c);"color"===i&&(d.vertexColorSpace=s.vertexColorSpace),h.attributes.push(d)}c===e.TRIANGULAR_MESH&&(h.index=function(e,t,n){const i=n.num_faces(),s=3*i,r=4*s,a=e._malloc(r);t.GetTrianglesUInt32Array(n,r,a);const o=new Uint32Array(e.HEAPF32.buffer,a,s).slice();return e._free(a),{array:o,itemSize:1}}(e,t,o));return e.destroy(o),h}(t,a,new Int8Array(i),r),o=e.attributes.map((e=>e.array.buffer));e.index&&o.push(e.index.array.buffer),self.postMessage({type:"decode",id:s.id,geometry:e},o)}catch(e){console.error(e),self.postMessage({type:"error",id:s.id,error:e.message})}finally{t.destroy(a)}}))}}}var Cf=s(919),Tf=s.n(Cf),Pf=s(593),Af=s.n(Pf),Lf=s(444),Rf=s.n(Lf),Df=s(86),If=s.n(Df),kf=s(367),Of=s.n(kf),Nf=s(168),Uf=s.n(Nf),Vf=s(850),Bf=s.n(Vf),Ff=s(924),zf=s.n(Ff),Hf=s(136),Gf=s.n(Hf),jf=s(575),Wf=s.n(jf),qf=s(908),Xf=s.n(qf),Kf=s(479),Yf=s.n(Kf),$f=s(102),Zf=s.n($f),Jf=s(330),Qf=s.n(Jf);const ev=e=>window.isSecureContext&&navigator.clipboard?navigator.clipboard.writeText(e):tv(e),tv=e=>new Promise(((t,n)=>{const i=document.createElement("textarea");i.value=e,document.body.appendChild(i),i.focus(),i.select();try{const e=document.execCommand("copy");document.body.removeChild(i),e?t():n(new Error("Failed to copy to clipboard"))}catch(e){console.error("Unable to copy to clipboard",e),n(e)}})),nv=async(e,t=100)=>{for(;!e();)await new Promise((e=>setTimeout(e,t)))};function iv(e,t){const n=t.fov*Math.PI/180,i=t.position.distanceTo(new Ai(0,0,0));return 2*Math.tan(n/2)*i*(e/window.innerHeight)}function sv(e,t){const n=t.fov*Math.PI/180,i=t.position.distanceTo(new Ai(0,0,0));return e/(2*Math.tan(n/2)*i)*window.innerHeight}function rv(e,t,n){const i=new Up,s=new Zn;return n.touches?(s.x=n.touches[0].clientX/window.innerWidth*2-1,s.y=-n.touches[0].clientY/window.innerHeight*2+1):(s.x=n.clientX/window.innerWidth*2-1,s.y=-n.clientY/window.innerHeight*2+1),i.setFromCamera(s,t),i.intersectObject(e).length>0}function av(e){let t=[],n=JSON.stringify(e,(function(e,n){if("object"==typeof n&&null!==n){if(-1!==t.indexOf(n))return;t.push(n)}return n}));return t=null,n}function ov(e,t){var n=0,i=0,s=0,r=0;function a(e){(e=e||event).preventDefault(),s=e.clientX,r=e.clientY,document.onmouseup=l,document.onmousemove=o}function o(t){(t=t||event).preventDefault(),n=s-t.clientX,i=r-t.clientY,s=t.clientX,r=t.clientY,e.style.top=e.offsetTop-i+"px",e.style.left=e.offsetLeft-n+"px"}function l(){document.onmouseup=null,document.onmousemove=null}document.getElementById(e.id+"header")?document.getElementById(e.id+"header").onmousedown=a:t.onmousedown=a}function lv(e){const t=hv.load(e);return t.colorSpace=Kt,t}function cv(e){const t=document.createElement("canvas"),n=t.getContext("2d");return t.width=e.width,t.height=e.height,n.drawImage(e,0,0),t.toDataURL()}const hv=new xd,uv=$n.lerp,dv=$n.degToRad,pv=$n.clamp,mv=$n.damp,fv=$n.lerp,vv=$n.seededRandom,gv=$n.randInt,_v=$n.randFloat,wv=$n.randFloatSpread,bv=$n.normalize;function yv(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function xv(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}var Mv,Ev,Sv,Cv,Tv,Pv,Av,Lv,Rv,Dv,Iv,kv,Ov,Nv,Uv,Vv={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},Bv={duration:.5,overwrite:!1,delay:0},Fv=1e8,zv=1e-8,Hv=2*Math.PI,Gv=Hv/4,jv=0,Wv=Math.sqrt,qv=Math.cos,Xv=Math.sin,Kv=function(e){return"string"==typeof e},Yv=function(e){return"function"==typeof e},$v=function(e){return"number"==typeof e},Zv=function(e){return void 0===e},Jv=function(e){return"object"==typeof e},Qv=function(e){return!1!==e},eg=function(){return"undefined"!=typeof window},tg=function(e){return Yv(e)||Kv(e)},ng="function"==typeof ArrayBuffer&&ArrayBuffer.isView||function(){},ig=Array.isArray,sg=/(?:-?\.?\d|\.)+/gi,rg=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,ag=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,og=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,lg=/[+-]=-?[.\d]+/,cg=/[^,'"\[\]\s]+/gi,hg=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,ug={},dg={},pg=function(e){return(dg=Hg(e,ug))&&Hw},mg=function(e,t){return console.warn("Invalid property",e,"set to",t,"Missing plugin? gsap.registerPlugin()")},fg=function(e,t){return!t&&console.warn(e)},vg=function(e,t){return e&&(ug[e]=t)&&dg&&(dg[e]=t)||ug},gg=function(){return 0},_g={suppressEvents:!0,isStart:!0,kill:!1},wg={suppressEvents:!0,kill:!1},bg={suppressEvents:!0},yg={},xg=[],Mg={},Eg={},Sg={},Cg=30,Tg=[],Pg="",Ag=function(e){var t,n,i=e[0];if(Jv(i)||Yv(i)||(e=[e]),!(t=(i._gsap||{}).harness)){for(n=Tg.length;n--&&!Tg[n].targetTest(i););t=Tg[n]}for(n=e.length;n--;)e[n]&&(e[n]._gsap||(e[n]._gsap=new nw(e[n],t)))||e.splice(n,1);return e},Lg=function(e){return e._gsap||Ag(b_(e))[0]._gsap},Rg=function(e,t,n){return(n=e[t])&&Yv(n)?e[t]():Zv(n)&&e.getAttribute&&e.getAttribute(t)||n},Dg=function(e,t){return(e=e.split(",")).forEach(t)||e},Ig=function(e){return Math.round(1e5*e)/1e5||0},kg=function(e){return Math.round(1e7*e)/1e7||0},Og=function(e,t){var n=t.charAt(0),i=parseFloat(t.substr(2));return e=parseFloat(e),"+"===n?e+i:"-"===n?e-i:"*"===n?e*i:e/i},Ng=function(e,t){for(var n=t.length,i=0;e.indexOf(t[i])<0&&++i<n;);return i<n},Ug=function(){var e,t,n=xg.length,i=xg.slice(0);for(Mg={},xg.length=0,e=0;e<n;e++)(t=i[e])&&t._lazy&&(t.render(t._lazy[0],t._lazy[1],!0)._lazy=0)},Vg=function(e,t,n,i){xg.length&&!Ev&&Ug(),e.render(t,n,i||Ev&&t<0&&(e._initted||e._startAt)),xg.length&&!Ev&&Ug()},Bg=function(e){var t=parseFloat(e);return(t||0===t)&&(e+"").match(cg).length<2?t:Kv(e)?e.trim():e},Fg=function(e){return e},zg=function(e,t){for(var n in t)n in e||(e[n]=t[n]);return e},Hg=function(e,t){for(var n in t)e[n]=t[n];return e},Gg=function e(t,n){for(var i in n)"__proto__"!==i&&"constructor"!==i&&"prototype"!==i&&(t[i]=Jv(n[i])?e(t[i]||(t[i]={}),n[i]):n[i]);return t},jg=function(e,t){var n,i={};for(n in e)n in t||(i[n]=e[n]);return i},Wg=function(e){var t,n=e.parent||Cv,i=e.keyframes?(t=ig(e.keyframes),function(e,n){for(var i in n)i in e||"duration"===i&&t||"ease"===i||(e[i]=n[i])}):zg;if(Qv(e.inherit))for(;n;)i(e,n.vars.defaults),n=n.parent||n._dp;return e},qg=function(e,t,n,i,s){void 0===n&&(n="_first"),void 0===i&&(i="_last");var r,a=e[i];if(s)for(r=t[s];a&&a[s]>r;)a=a._prev;return a?(t._next=a._next,a._next=t):(t._next=e[n],e[n]=t),t._next?t._next._prev=t:e[i]=t,t._prev=a,t.parent=t._dp=e,t},Xg=function(e,t,n,i){void 0===n&&(n="_first"),void 0===i&&(i="_last");var s=t._prev,r=t._next;s?s._next=r:e[n]===t&&(e[n]=r),r?r._prev=s:e[i]===t&&(e[i]=s),t._next=t._prev=t.parent=null},Kg=function(e,t){e.parent&&(!t||e.parent.autoRemoveChildren)&&e.parent.remove&&e.parent.remove(e),e._act=0},Yg=function(e,t){if(e&&(!t||t._end>e._dur||t._start<0))for(var n=e;n;)n._dirty=1,n=n.parent;return e},$g=function(e,t,n,i){return e._startAt&&(Ev?e._startAt.revert(wg):e.vars.immediateRender&&!e.vars.autoRevert||e._startAt.render(t,!0,i))},Zg=function e(t){return!t||t._ts&&e(t.parent)},Jg=function(e){return e._repeat?Qg(e._tTime,e=e.duration()+e._rDelay)*e:0},Qg=function(e,t){var n=Math.floor(e/=t);return e&&n===e?n-1:n},e_=function(e,t){return(e-t._start)*t._ts+(t._ts>=0?0:t._dirty?t.totalDuration():t._tDur)},t_=function(e){return e._end=kg(e._start+(e._tDur/Math.abs(e._ts||e._rts||zv)||0))},n_=function(e,t){var n=e._dp;return n&&n.smoothChildTiming&&e._ts&&(e._start=kg(n._time-(e._ts>0?t/e._ts:((e._dirty?e.totalDuration():e._tDur)-t)/-e._ts)),t_(e),n._dirty||Yg(n,e)),e},i_=function(e,t){var n;if((t._time||!t._dur&&t._initted||t._start<e._time&&(t._dur||!t.add))&&(n=e_(e.rawTime(),t),(!t._dur||f_(0,t.totalDuration(),n)-t._tTime>zv)&&t.render(n,!0)),Yg(e,t)._dp&&e._initted&&e._time>=e._dur&&e._ts){if(e._dur<e.duration())for(n=e;n._dp;)n.rawTime()>=0&&n.totalTime(n._tTime),n=n._dp;e._zTime=-1e-8}},s_=function(e,t,n,i){return t.parent&&Kg(t),t._start=kg(($v(n)?n:n||e!==Cv?d_(e,n,t):e._time)+t._delay),t._end=kg(t._start+(t.totalDuration()/Math.abs(t.timeScale())||0)),qg(e,t,"_first","_last",e._sort?"_start":0),l_(t)||(e._recent=t),i||i_(e,t),e._ts<0&&n_(e,e._tTime),e},r_=function(e,t){return(ug.ScrollTrigger||mg("scrollTrigger",t))&&ug.ScrollTrigger.create(t,e)},a_=function(e,t,n,i,s){return hw(e,t,s),e._initted?!n&&e._pt&&!Ev&&(e._dur&&!1!==e.vars.lazy||!e._dur&&e.vars.lazy)&&Rv!==G_.frame?(xg.push(e),e._lazy=[s,i],1):void 0:1},o_=function e(t){var n=t.parent;return n&&n._ts&&n._initted&&!n._lock&&(n.rawTime()<0||e(n))},l_=function(e){var t=e.data;return"isFromStart"===t||"isStart"===t},c_=function(e,t,n,i){var s=e._repeat,r=kg(t)||0,a=e._tTime/e._tDur;return a&&!i&&(e._time*=r/e._dur),e._dur=r,e._tDur=s?s<0?1e10:kg(r*(s+1)+e._rDelay*s):r,a>0&&!i&&n_(e,e._tTime=e._tDur*a),e.parent&&t_(e),n||Yg(e.parent,e),e},h_=function(e){return e instanceof sw?Yg(e):c_(e,e._dur)},u_={_start:0,endTime:gg,totalDuration:gg},d_=function e(t,n,i){var s,r,a,o=t.labels,l=t._recent||u_,c=t.duration()>=Fv?l.endTime(!1):t._dur;return Kv(n)&&(isNaN(n)||n in o)?(r=n.charAt(0),a="%"===n.substr(-1),s=n.indexOf("="),"<"===r||">"===r?(s>=0&&(n=n.replace(/=/,"")),("<"===r?l._start:l.endTime(l._repeat>=0))+(parseFloat(n.substr(1))||0)*(a?(s<0?l:i).totalDuration()/100:1)):s<0?(n in o||(o[n]=c),o[n]):(r=parseFloat(n.charAt(s-1)+n.substr(s+1)),a&&i&&(r=r/100*(ig(i)?i[0]:i).totalDuration()),s>1?e(t,n.substr(0,s-1),i)+r:c+r)):null==n?c:+n},p_=function(e,t,n){var i,s,r=$v(t[1]),a=(r?2:1)+(e<2?0:1),o=t[a];if(r&&(o.duration=t[1]),o.parent=n,e){for(i=o,s=n;s&&!("immediateRender"in i);)i=s.vars.defaults||{},s=Qv(s.vars.inherit)&&s.parent;o.immediateRender=Qv(i.immediateRender),e<2?o.runBackwards=1:o.startAt=t[a-1]}return new fw(t[0],o,t[a+1])},m_=function(e,t){return e||0===e?t(e):t},f_=function(e,t,n){return n<e?e:n>t?t:n},v_=function(e,t){return Kv(e)&&(t=hg.exec(e))?t[1]:""},g_=[].slice,__=function(e,t){return e&&Jv(e)&&"length"in e&&(!t&&!e.length||e.length-1 in e&&Jv(e[0]))&&!e.nodeType&&e!==Tv},w_=function(e,t,n){return void 0===n&&(n=[]),e.forEach((function(e){var i;return Kv(e)&&!t||__(e,1)?(i=n).push.apply(i,b_(e)):n.push(e)}))||n},b_=function(e,t,n){return Sv&&!t&&Sv.selector?Sv.selector(e):!Kv(e)||n||!Pv&&j_()?ig(e)?w_(e,n):__(e)?g_.call(e,0):e?[e]:[]:g_.call((t||Av).querySelectorAll(e),0)},y_=function(e){return e=b_(e)[0]||fg("Invalid scope")||{},function(t){var n=e.current||e.nativeElement||e;return b_(t,n.querySelectorAll?n:n===e?fg("Invalid scope")||Av.createElement("div"):e)}},x_=function(e){return e.sort((function(){return.5-Math.random()}))},M_=function(e){if(Yv(e))return e;var t=Jv(e)?e:{each:e},n=Z_(t.ease),i=t.from||0,s=parseFloat(t.base)||0,r={},a=i>0&&i<1,o=isNaN(i)||a,l=t.axis,c=i,h=i;return Kv(i)?c=h={center:.5,edges:.5,end:1}[i]||0:!a&&o&&(c=i[0],h=i[1]),function(e,a,u){var d,p,m,f,v,g,_,w,b,y=(u||t).length,x=r[y];if(!x){if(!(b="auto"===t.grid?0:(t.grid||[1,Fv])[1])){for(_=-Fv;_<(_=u[b++].getBoundingClientRect().left)&&b<y;);b--}for(x=r[y]=[],d=o?Math.min(b,y)*c-.5:i%b,p=b===Fv?0:o?y*h/b-.5:i/b|0,_=0,w=Fv,g=0;g<y;g++)m=g%b-d,f=p-(g/b|0),x[g]=v=l?Math.abs("y"===l?f:m):Wv(m*m+f*f),v>_&&(_=v),v<w&&(w=v);"random"===i&&x_(x),x.max=_-w,x.min=w,x.v=y=(parseFloat(t.amount)||parseFloat(t.each)*(b>y?y-1:l?"y"===l?y/b:b:Math.max(b,y/b))||0)*("edges"===i?-1:1),x.b=y<0?s-y:s,x.u=v_(t.amount||t.each)||0,n=n&&y<0?Y_(n):n}return y=(x[e]-x.min)/x.max||0,kg(x.b+(n?n(y):y)*x.v)+x.u}},E_=function(e){var t=Math.pow(10,((e+"").split(".")[1]||"").length);return function(n){var i=kg(Math.round(parseFloat(n)/e)*e*t);return(i-i%1)/t+($v(n)?0:v_(n))}},S_=function(e,t){var n,i,s=ig(e);return!s&&Jv(e)&&(n=s=e.radius||Fv,e.values?(e=b_(e.values),(i=!$v(e[0]))&&(n*=n)):e=E_(e.increment)),m_(t,s?Yv(e)?function(t){return i=e(t),Math.abs(i-t)<=n?i:t}:function(t){for(var s,r,a=parseFloat(i?t.x:t),o=parseFloat(i?t.y:0),l=Fv,c=0,h=e.length;h--;)(s=i?(s=e[h].x-a)*s+(r=e[h].y-o)*r:Math.abs(e[h]-a))<l&&(l=s,c=h);return c=!n||l<=n?e[c]:t,i||c===t||$v(t)?c:c+v_(t)}:E_(e))},C_=function(e,t,n,i){return m_(ig(e)?!t:!0===n?!!(n=0):!i,(function(){return ig(e)?e[~~(Math.random()*e.length)]:(n=n||1e-5)&&(i=n<1?Math.pow(10,(n+"").length-2):1)&&Math.floor(Math.round((e-n/2+Math.random()*(t-e+.99*n))/n)*n*i)/i}))},T_=function(e,t,n){return m_(n,(function(n){return e[~~t(n)]}))},P_=function(e){for(var t,n,i,s,r=0,a="";~(t=e.indexOf("random(",r));)i=e.indexOf(")",t),s="["===e.charAt(t+7),n=e.substr(t+7,i-t-7).match(s?cg:sg),a+=e.substr(r,t-r)+C_(s?n:+n[0],s?0:+n[1],+n[2]||1e-5),r=i+1;return a+e.substr(r,e.length-r)},A_=function(e,t,n,i,s){var r=t-e,a=i-n;return m_(s,(function(t){return n+((t-e)/r*a||0)}))},L_=function(e,t,n){var i,s,r,a=e.labels,o=Fv;for(i in a)(s=a[i]-t)<0==!!n&&s&&o>(s=Math.abs(s))&&(r=i,o=s);return r},R_=function(e,t,n){var i,s,r,a=e.vars,o=a[t],l=Sv,c=e._ctx;if(o)return i=a[t+"Params"],s=a.callbackScope||e,n&&xg.length&&Ug(),c&&(Sv=c),r=i?o.apply(s,i):o.call(s),Sv=l,r},D_=function(e){return Kg(e),e.scrollTrigger&&e.scrollTrigger.kill(!!Ev),e.progress()<1&&R_(e,"onInterrupt"),e},I_=[],k_=function(e){if(eg()&&e){var t=(e=!e.name&&e.default||e).name,n=Yv(e),i=t&&!n&&e.init?function(){this._props=[]}:e,s={init:gg,render:Ew,add:lw,kill:Cw,modifier:Sw,rawVars:0},r={targetTest:0,get:0,getSetter:bw,aliases:{},register:0};if(j_(),e!==i){if(Eg[t])return;zg(i,zg(jg(e,s),r)),Hg(i.prototype,Hg(s,jg(e,r))),Eg[i.prop=t]=i,e.targetTest&&(Tg.push(i),yg[t]=1),t=("css"===t?"CSS":t.charAt(0).toUpperCase()+t.substr(1))+"Plugin"}vg(t,i),e.register&&e.register(Hw,i,Aw)}else e&&I_.push(e)},O_=255,N_={aqua:[0,O_,O_],lime:[0,O_,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,O_],navy:[0,0,128],white:[O_,O_,O_],olive:[128,128,0],yellow:[O_,O_,0],orange:[O_,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[O_,0,0],pink:[O_,192,203],cyan:[0,O_,O_],transparent:[O_,O_,O_,0]},U_=function(e,t,n){return(6*(e+=e<0?1:e>1?-1:0)<1?t+(n-t)*e*6:e<.5?n:3*e<2?t+(n-t)*(2/3-e)*6:t)*O_+.5|0},V_=function(e,t,n){var i,s,r,a,o,l,c,h,u,d,p=e?$v(e)?[e>>16,e>>8&O_,e&O_]:0:N_.black;if(!p){if(","===e.substr(-1)&&(e=e.substr(0,e.length-1)),N_[e])p=N_[e];else if("#"===e.charAt(0)){if(e.length<6&&(i=e.charAt(1),s=e.charAt(2),r=e.charAt(3),e="#"+i+i+s+s+r+r+(5===e.length?e.charAt(4)+e.charAt(4):"")),9===e.length)return[(p=parseInt(e.substr(1,6),16))>>16,p>>8&O_,p&O_,parseInt(e.substr(7),16)/255];p=[(e=parseInt(e.substr(1),16))>>16,e>>8&O_,e&O_]}else if("hsl"===e.substr(0,3))if(p=d=e.match(sg),t){if(~e.indexOf("="))return p=e.match(rg),n&&p.length<4&&(p[3]=1),p}else a=+p[0]%360/360,o=+p[1]/100,i=2*(l=+p[2]/100)-(s=l<=.5?l*(o+1):l+o-l*o),p.length>3&&(p[3]*=1),p[0]=U_(a+1/3,i,s),p[1]=U_(a,i,s),p[2]=U_(a-1/3,i,s);else p=e.match(sg)||N_.transparent;p=p.map(Number)}return t&&!d&&(i=p[0]/O_,s=p[1]/O_,r=p[2]/O_,l=((c=Math.max(i,s,r))+(h=Math.min(i,s,r)))/2,c===h?a=o=0:(u=c-h,o=l>.5?u/(2-c-h):u/(c+h),a=c===i?(s-r)/u+(s<r?6:0):c===s?(r-i)/u+2:(i-s)/u+4,a*=60),p[0]=~~(a+.5),p[1]=~~(100*o+.5),p[2]=~~(100*l+.5)),n&&p.length<4&&(p[3]=1),p},B_=function(e){var t=[],n=[],i=-1;return e.split(z_).forEach((function(e){var s=e.match(ag)||[];t.push.apply(t,s),n.push(i+=s.length+1)})),t.c=n,t},F_=function(e,t,n){var i,s,r,a,o="",l=(e+o).match(z_),c=t?"hsla(":"rgba(",h=0;if(!l)return e;if(l=l.map((function(e){return(e=V_(e,t,1))&&c+(t?e[0]+","+e[1]+"%,"+e[2]+"%,"+e[3]:e.join(","))+")"})),n&&(r=B_(e),(i=n.c).join(o)!==r.c.join(o)))for(a=(s=e.replace(z_,"1").split(ag)).length-1;h<a;h++)o+=s[h]+(~i.indexOf(h)?l.shift()||c+"0,0,0,0)":(r.length?r:l.length?l:n).shift());if(!s)for(a=(s=e.split(z_)).length-1;h<a;h++)o+=s[h]+l[h];return o+s[a]},z_=function(){var e,t="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b";for(e in N_)t+="|"+e+"\\b";return new RegExp(t+")","gi")}(),H_=/hsl[a]?\(/,G_=function(){var e,t,n,i,s,r,a=Date.now,o=500,l=33,c=a(),h=c,u=1e3/240,d=u,p=[],m=function n(m){var f,v,g,_,w=a()-h,b=!0===m;if(w>o&&(c+=w-l),((f=(g=(h+=w)-c)-d)>0||b)&&(_=++i.frame,s=g-1e3*i.time,i.time=g/=1e3,d+=f+(f>=u?4:u-f),v=1),b||(e=t(n)),v)for(r=0;r<p.length;r++)p[r](g,s,_,m)};return i={time:0,frame:0,tick:function(){m(!0)},deltaRatio:function(e){return s/(1e3/(e||60))},wake:function(){Lv&&(!Pv&&eg()&&(Tv=Pv=window,Av=Tv.document||{},ug.gsap=Hw,(Tv.gsapVersions||(Tv.gsapVersions=[])).push(Hw.version),pg(dg||Tv.GreenSockGlobals||!Tv.gsap&&Tv||{}),n=Tv.requestAnimationFrame,I_.forEach(k_)),e&&i.sleep(),t=n||function(e){return setTimeout(e,d-1e3*i.time+1|0)},Iv=1,m(2))},sleep:function(){(n?Tv.cancelAnimationFrame:clearTimeout)(e),Iv=0,t=gg},lagSmoothing:function(e,t){o=e||1/0,l=Math.min(t||33,o)},fps:function(e){u=1e3/(e||240),d=1e3*i.time+u},add:function(e,t,n){var s=t?function(t,n,r,a){e(t,n,r,a),i.remove(s)}:e;return i.remove(e),p[n?"unshift":"push"](s),j_(),s},remove:function(e,t){~(t=p.indexOf(e))&&p.splice(t,1)&&r>=t&&r--},_listeners:p},i}(),j_=function(){return!Iv&&G_.wake()},W_={},q_=/^[\d.\-M][\d.\-,\s]/,X_=/["']/g,K_=function(e){for(var t,n,i,s={},r=e.substr(1,e.length-3).split(":"),a=r[0],o=1,l=r.length;o<l;o++)n=r[o],t=o!==l-1?n.lastIndexOf(","):n.length,i=n.substr(0,t),s[a]=isNaN(i)?i.replace(X_,"").trim():+i,a=n.substr(t+1).trim();return s},Y_=function(e){return function(t){return 1-e(1-t)}},$_=function e(t,n){for(var i,s=t._first;s;)s instanceof sw?e(s,n):!s.vars.yoyoEase||s._yoyo&&s._repeat||s._yoyo===n||(s.timeline?e(s.timeline,n):(i=s._ease,s._ease=s._yEase,s._yEase=i,s._yoyo=n)),s=s._next},Z_=function(e,t){return e&&(Yv(e)?e:W_[e]||function(e){var t,n,i,s,r=(e+"").split("("),a=W_[r[0]];return a&&r.length>1&&a.config?a.config.apply(null,~e.indexOf("{")?[K_(r[1])]:(t=e,n=t.indexOf("(")+1,i=t.indexOf(")"),s=t.indexOf("(",n),t.substring(n,~s&&s<i?t.indexOf(")",i+1):i)).split(",").map(Bg)):W_._CE&&q_.test(e)?W_._CE("",e):a}(e))||t},J_=function(e,t,n,i){void 0===n&&(n=function(e){return 1-t(1-e)}),void 0===i&&(i=function(e){return e<.5?t(2*e)/2:1-t(2*(1-e))/2});var s,r={easeIn:t,easeOut:n,easeInOut:i};return Dg(e,(function(e){for(var t in W_[e]=ug[e]=r,W_[s=e.toLowerCase()]=n,r)W_[s+("easeIn"===t?".in":"easeOut"===t?".out":".inOut")]=W_[e+"."+t]=r[t]})),r},Q_=function(e){return function(t){return t<.5?(1-e(1-2*t))/2:.5+e(2*(t-.5))/2}},ew=function e(t,n,i){var s=n>=1?n:1,r=(i||(t?.3:.45))/(n<1?n:1),a=r/Hv*(Math.asin(1/s)||0),o=function(e){return 1===e?1:s*Math.pow(2,-10*e)*Xv((e-a)*r)+1},l="out"===t?o:"in"===t?function(e){return 1-o(1-e)}:Q_(o);return r=Hv/r,l.config=function(n,i){return e(t,n,i)},l},tw=function e(t,n){void 0===n&&(n=1.70158);var i=function(e){return e?--e*e*((n+1)*e+n)+1:0},s="out"===t?i:"in"===t?function(e){return 1-i(1-e)}:Q_(i);return s.config=function(n){return e(t,n)},s};Dg("Linear,Quad,Cubic,Quart,Quint,Strong",(function(e,t){var n=t<5?t+1:t;J_(e+",Power"+(n-1),t?function(e){return Math.pow(e,n)}:function(e){return e},(function(e){return 1-Math.pow(1-e,n)}),(function(e){return e<.5?Math.pow(2*e,n)/2:1-Math.pow(2*(1-e),n)/2}))})),W_.Linear.easeNone=W_.none=W_.Linear.easeIn,J_("Elastic",ew("in"),ew("out"),ew()),kv=7.5625,Nv=1/(Ov=2.75),J_("Bounce",(function(e){return 1-Uv(1-e)}),Uv=function(e){return e<Nv?kv*e*e:e<.7272727272727273?kv*Math.pow(e-1.5/Ov,2)+.75:e<.9090909090909092?kv*(e-=2.25/Ov)*e+.9375:kv*Math.pow(e-2.625/Ov,2)+.984375}),J_("Expo",(function(e){return e?Math.pow(2,10*(e-1)):0})),J_("Circ",(function(e){return-(Wv(1-e*e)-1)})),J_("Sine",(function(e){return 1===e?1:1-qv(e*Gv)})),J_("Back",tw("in"),tw("out"),tw()),W_.SteppedEase=W_.steps=ug.SteppedEase={config:function(e,t){void 0===e&&(e=1);var n=1/e,i=e+(t?0:1),s=t?1:0;return function(e){return((i*f_(0,.99999999,e)|0)+s)*n}}},Bv.ease=W_["quad.out"],Dg("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",(function(e){return Pg+=e+","+e+"Params,"}));var nw=function(e,t){this.id=jv++,e._gsap=this,this.target=e,this.harness=t,this.get=t?t.get:Rg,this.set=t?t.getSetter:bw},iw=function(){function e(e){this.vars=e,this._delay=+e.delay||0,(this._repeat=e.repeat===1/0?-2:e.repeat||0)&&(this._rDelay=e.repeatDelay||0,this._yoyo=!!e.yoyo||!!e.yoyoEase),this._ts=1,c_(this,+e.duration,1,1),this.data=e.data,Sv&&(this._ctx=Sv,Sv.data.push(this)),Iv||G_.wake()}var t=e.prototype;return t.delay=function(e){return e||0===e?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+e-this._delay),this._delay=e,this):this._delay},t.duration=function(e){return arguments.length?this.totalDuration(this._repeat>0?e+(e+this._rDelay)*this._repeat:e):this.totalDuration()&&this._dur},t.totalDuration=function(e){return arguments.length?(this._dirty=0,c_(this,this._repeat<0?e:(e-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},t.totalTime=function(e,t){if(j_(),!arguments.length)return this._tTime;var n=this._dp;if(n&&n.smoothChildTiming&&this._ts){for(n_(this,e),!n._dp||n.parent||i_(n,this);n&&n.parent;)n.parent._time!==n._start+(n._ts>=0?n._tTime/n._ts:(n.totalDuration()-n._tTime)/-n._ts)&&n.totalTime(n._tTime,!0),n=n.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&e<this._tDur||this._ts<0&&e>0||!this._tDur&&!e)&&s_(this._dp,this,this._start-this._delay)}return(this._tTime!==e||!this._dur&&!t||this._initted&&Math.abs(this._zTime)===zv||!e&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=e),Vg(this,e,t)),this},t.time=function(e,t){return arguments.length?this.totalTime(Math.min(this.totalDuration(),e+Jg(this))%(this._dur+this._rDelay)||(e?this._dur:0),t):this._time},t.totalProgress=function(e,t){return arguments.length?this.totalTime(this.totalDuration()*e,t):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.ratio},t.progress=function(e,t){return arguments.length?this.totalTime(this.duration()*(!this._yoyo||1&this.iteration()?e:1-e)+Jg(this),t):this.duration()?Math.min(1,this._time/this._dur):this.ratio},t.iteration=function(e,t){var n=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(e-1)*n,t):this._repeat?Qg(this._tTime,n)+1:1},t.timeScale=function(e){if(!arguments.length)return-1e-8===this._rts?0:this._rts;if(this._rts===e)return this;var t=this.parent&&this._ts?e_(this.parent._time,this):this._tTime;return this._rts=+e||0,this._ts=this._ps||-1e-8===e?0:this._rts,this.totalTime(f_(-Math.abs(this._delay),this._tDur,t),!0),t_(this),function(e){for(var t=e.parent;t&&t.parent;)t._dirty=1,t.totalDuration(),t=t.parent;return e}(this)},t.paused=function(e){return arguments.length?(this._ps!==e&&(this._ps=e,e?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(j_(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,1===this.progress()&&Math.abs(this._zTime)!==zv&&(this._tTime-=zv)))),this):this._ps},t.startTime=function(e){if(arguments.length){this._start=e;var t=this.parent||this._dp;return t&&(t._sort||!this.parent)&&s_(t,this,e-this._delay),this}return this._start},t.endTime=function(e){return this._start+(Qv(e)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},t.rawTime=function(e){var t=this.parent||this._dp;return t?e&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?e_(t.rawTime(e),this):this._tTime:this._tTime},t.revert=function(e){void 0===e&&(e=bg);var t=Ev;return Ev=e,(this._initted||this._startAt)&&(this.timeline&&this.timeline.revert(e),this.totalTime(-.01,e.suppressEvents)),"nested"!==this.data&&!1!==e.kill&&this.kill(),Ev=t,this},t.globalTime=function(e){for(var t=this,n=arguments.length?e:t.rawTime();t;)n=t._start+n/(t._ts||1),t=t._dp;return!this.parent&&this._sat?this._sat.vars.immediateRender?-1/0:this._sat.globalTime(e):n},t.repeat=function(e){return arguments.length?(this._repeat=e===1/0?-2:e,h_(this)):-2===this._repeat?1/0:this._repeat},t.repeatDelay=function(e){if(arguments.length){var t=this._time;return this._rDelay=e,h_(this),t?this.time(t):this}return this._rDelay},t.yoyo=function(e){return arguments.length?(this._yoyo=e,this):this._yoyo},t.seek=function(e,t){return this.totalTime(d_(this,e),Qv(t))},t.restart=function(e,t){return this.play().totalTime(e?-this._delay:0,Qv(t))},t.play=function(e,t){return null!=e&&this.seek(e,t),this.reversed(!1).paused(!1)},t.reverse=function(e,t){return null!=e&&this.seek(e||this.totalDuration(),t),this.reversed(!0).paused(!1)},t.pause=function(e,t){return null!=e&&this.seek(e,t),this.paused(!0)},t.resume=function(){return this.paused(!1)},t.reversed=function(e){return arguments.length?(!!e!==this.reversed()&&this.timeScale(-this._rts||(e?-1e-8:0)),this):this._rts<0},t.invalidate=function(){return this._initted=this._act=0,this._zTime=-1e-8,this},t.isActive=function(){var e,t=this.parent||this._dp,n=this._start;return!(t&&!(this._ts&&this._initted&&t.isActive()&&(e=t.rawTime(!0))>=n&&e<this.endTime(!0)-zv))},t.eventCallback=function(e,t,n){var i=this.vars;return arguments.length>1?(t?(i[e]=t,n&&(i[e+"Params"]=n),"onUpdate"===e&&(this._onUpdate=t)):delete i[e],this):i[e]},t.then=function(e){var t=this;return new Promise((function(n){var i=Yv(e)?e:Fg,s=function(){var e=t.then;t.then=null,Yv(i)&&(i=i(t))&&(i.then||i===t)&&(t.then=e),n(i),t.then=e};t._initted&&1===t.totalProgress()&&t._ts>=0||!t._tTime&&t._ts<0?s():t._prom=s}))},t.kill=function(){D_(this)},e}();zg(iw.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-1e-8,_prom:0,_ps:!1,_rts:1});var sw=function(e){function t(t,n){var i;return void 0===t&&(t={}),(i=e.call(this,t)||this).labels={},i.smoothChildTiming=!!t.smoothChildTiming,i.autoRemoveChildren=!!t.autoRemoveChildren,i._sort=Qv(t.sortChildren),Cv&&s_(t.parent||Cv,yv(i),n),t.reversed&&i.reverse(),t.paused&&i.paused(!0),t.scrollTrigger&&r_(yv(i),t.scrollTrigger),i}xv(t,e);var n=t.prototype;return n.to=function(e,t,n){return p_(0,arguments,this),this},n.from=function(e,t,n){return p_(1,arguments,this),this},n.fromTo=function(e,t,n,i){return p_(2,arguments,this),this},n.set=function(e,t,n){return t.duration=0,t.parent=this,Wg(t).repeatDelay||(t.repeat=0),t.immediateRender=!!t.immediateRender,new fw(e,t,d_(this,n),1),this},n.call=function(e,t,n){return s_(this,fw.delayedCall(0,e,t),n)},n.staggerTo=function(e,t,n,i,s,r,a){return n.duration=t,n.stagger=n.stagger||i,n.onComplete=r,n.onCompleteParams=a,n.parent=this,new fw(e,n,d_(this,s)),this},n.staggerFrom=function(e,t,n,i,s,r,a){return n.runBackwards=1,Wg(n).immediateRender=Qv(n.immediateRender),this.staggerTo(e,t,n,i,s,r,a)},n.staggerFromTo=function(e,t,n,i,s,r,a,o){return i.startAt=n,Wg(i).immediateRender=Qv(i.immediateRender),this.staggerTo(e,t,i,s,r,a,o)},n.render=function(e,t,n){var i,s,r,a,o,l,c,h,u,d,p,m,f=this._time,v=this._dirty?this.totalDuration():this._tDur,g=this._dur,_=e<=0?0:kg(e),w=this._zTime<0!=e<0&&(this._initted||!g);if(this!==Cv&&_>v&&e>=0&&(_=v),_!==this._tTime||n||w){if(f!==this._time&&g&&(_+=this._time-f,e+=this._time-f),i=_,u=this._start,l=!(h=this._ts),w&&(g||(f=this._zTime),(e||!t)&&(this._zTime=e)),this._repeat){if(p=this._yoyo,o=g+this._rDelay,this._repeat<-1&&e<0)return this.totalTime(100*o+e,t,n);if(i=kg(_%o),_===v?(a=this._repeat,i=g):((a=~~(_/o))&&a===_/o&&(i=g,a--),i>g&&(i=g)),d=Qg(this._tTime,o),!f&&this._tTime&&d!==a&&this._tTime-d*o-this._dur<=0&&(d=a),p&&1&a&&(i=g-i,m=1),a!==d&&!this._lock){var b=p&&1&d,y=b===(p&&1&a);if(a<d&&(b=!b),f=b?0:_%g?g:_,this._lock=1,this.render(f||(m?0:kg(a*o)),t,!g)._lock=0,this._tTime=_,!t&&this.parent&&R_(this,"onRepeat"),this.vars.repeatRefresh&&!m&&(this.invalidate()._lock=1),f&&f!==this._time||l!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(g=this._dur,v=this._tDur,y&&(this._lock=2,f=b?g:-1e-4,this.render(f,!0),this.vars.repeatRefresh&&!m&&this.invalidate()),this._lock=0,!this._ts&&!l)return this;$_(this,m)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(c=function(e,t,n){var i;if(n>t)for(i=e._first;i&&i._start<=n;){if("isPause"===i.data&&i._start>t)return i;i=i._next}else for(i=e._last;i&&i._start>=n;){if("isPause"===i.data&&i._start<t)return i;i=i._prev}}(this,kg(f),kg(i)),c&&(_-=i-(i=c._start))),this._tTime=_,this._time=i,this._act=!h,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=e,f=0),!f&&i&&!t&&!a&&(R_(this,"onStart"),this._tTime!==_))return this;if(i>=f&&e>=0)for(s=this._first;s;){if(r=s._next,(s._act||i>=s._start)&&s._ts&&c!==s){if(s.parent!==this)return this.render(e,t,n);if(s.render(s._ts>0?(i-s._start)*s._ts:(s._dirty?s.totalDuration():s._tDur)+(i-s._start)*s._ts,t,n),i!==this._time||!this._ts&&!l){c=0,r&&(_+=this._zTime=-1e-8);break}}s=r}else{s=this._last;for(var x=e<0?e:i;s;){if(r=s._prev,(s._act||x<=s._end)&&s._ts&&c!==s){if(s.parent!==this)return this.render(e,t,n);if(s.render(s._ts>0?(x-s._start)*s._ts:(s._dirty?s.totalDuration():s._tDur)+(x-s._start)*s._ts,t,n||Ev&&(s._initted||s._startAt)),i!==this._time||!this._ts&&!l){c=0,r&&(_+=this._zTime=x?-1e-8:zv);break}}s=r}}if(c&&!t&&(this.pause(),c.render(i>=f?0:-1e-8)._zTime=i>=f?1:-1,this._ts))return this._start=u,t_(this),this.render(e,t,n);this._onUpdate&&!t&&R_(this,"onUpdate",!0),(_===v&&this._tTime>=this.totalDuration()||!_&&f)&&(u!==this._start&&Math.abs(h)===Math.abs(this._ts)||this._lock||((e||!g)&&(_===v&&this._ts>0||!_&&this._ts<0)&&Kg(this,1),t||e<0&&!f||!_&&!f&&v||(R_(this,_===v&&e>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(_<v&&this.timeScale()>0)&&this._prom())))}return this},n.add=function(e,t){var n=this;if($v(t)||(t=d_(this,t,e)),!(e instanceof iw)){if(ig(e))return e.forEach((function(e){return n.add(e,t)})),this;if(Kv(e))return this.addLabel(e,t);if(!Yv(e))return this;e=fw.delayedCall(0,e)}return this!==e?s_(this,e,t):this},n.getChildren=function(e,t,n,i){void 0===e&&(e=!0),void 0===t&&(t=!0),void 0===n&&(n=!0),void 0===i&&(i=-Fv);for(var s=[],r=this._first;r;)r._start>=i&&(r instanceof fw?t&&s.push(r):(n&&s.push(r),e&&s.push.apply(s,r.getChildren(!0,t,n)))),r=r._next;return s},n.getById=function(e){for(var t=this.getChildren(1,1,1),n=t.length;n--;)if(t[n].vars.id===e)return t[n]},n.remove=function(e){return Kv(e)?this.removeLabel(e):Yv(e)?this.killTweensOf(e):(Xg(this,e),e===this._recent&&(this._recent=this._last),Yg(this))},n.totalTime=function(t,n){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=kg(G_.time-(this._ts>0?t/this._ts:(this.totalDuration()-t)/-this._ts))),e.prototype.totalTime.call(this,t,n),this._forcing=0,this):this._tTime},n.addLabel=function(e,t){return this.labels[e]=d_(this,t),this},n.removeLabel=function(e){return delete this.labels[e],this},n.addPause=function(e,t,n){var i=fw.delayedCall(0,t||gg,n);return i.data="isPause",this._hasPause=1,s_(this,i,d_(this,e))},n.removePause=function(e){var t=this._first;for(e=d_(this,e);t;)t._start===e&&"isPause"===t.data&&Kg(t),t=t._next},n.killTweensOf=function(e,t,n){for(var i=this.getTweensOf(e,n),s=i.length;s--;)rw!==i[s]&&i[s].kill(e,t);return this},n.getTweensOf=function(e,t){for(var n,i=[],s=b_(e),r=this._first,a=$v(t);r;)r instanceof fw?Ng(r._targets,s)&&(a?(!rw||r._initted&&r._ts)&&r.globalTime(0)<=t&&r.globalTime(r.totalDuration())>t:!t||r.isActive())&&i.push(r):(n=r.getTweensOf(s,t)).length&&i.push.apply(i,n),r=r._next;return i},n.tweenTo=function(e,t){t=t||{};var n,i=this,s=d_(i,e),r=t,a=r.startAt,o=r.onStart,l=r.onStartParams,c=r.immediateRender,h=fw.to(i,zg({ease:t.ease||"none",lazy:!1,immediateRender:!1,time:s,overwrite:"auto",duration:t.duration||Math.abs((s-(a&&"time"in a?a.time:i._time))/i.timeScale())||zv,onStart:function(){if(i.pause(),!n){var e=t.duration||Math.abs((s-(a&&"time"in a?a.time:i._time))/i.timeScale());h._dur!==e&&c_(h,e,0,1).render(h._time,!0,!0),n=1}o&&o.apply(h,l||[])}},t));return c?h.render(0):h},n.tweenFromTo=function(e,t,n){return this.tweenTo(t,zg({startAt:{time:d_(this,e)}},n))},n.recent=function(){return this._recent},n.nextLabel=function(e){return void 0===e&&(e=this._time),L_(this,d_(this,e))},n.previousLabel=function(e){return void 0===e&&(e=this._time),L_(this,d_(this,e),1)},n.currentLabel=function(e){return arguments.length?this.seek(e,!0):this.previousLabel(this._time+zv)},n.shiftChildren=function(e,t,n){void 0===n&&(n=0);for(var i,s=this._first,r=this.labels;s;)s._start>=n&&(s._start+=e,s._end+=e),s=s._next;if(t)for(i in r)r[i]>=n&&(r[i]+=e);return Yg(this)},n.invalidate=function(t){var n=this._first;for(this._lock=0;n;)n.invalidate(t),n=n._next;return e.prototype.invalidate.call(this,t)},n.clear=function(e){void 0===e&&(e=!0);for(var t,n=this._first;n;)t=n._next,this.remove(n),n=t;return this._dp&&(this._time=this._tTime=this._pTime=0),e&&(this.labels={}),Yg(this)},n.totalDuration=function(e){var t,n,i,s=0,r=this,a=r._last,o=Fv;if(arguments.length)return r.timeScale((r._repeat<0?r.duration():r.totalDuration())/(r.reversed()?-e:e));if(r._dirty){for(i=r.parent;a;)t=a._prev,a._dirty&&a.totalDuration(),(n=a._start)>o&&r._sort&&a._ts&&!r._lock?(r._lock=1,s_(r,a,n-a._delay,1)._lock=0):o=n,n<0&&a._ts&&(s-=n,(!i&&!r._dp||i&&i.smoothChildTiming)&&(r._start+=n/r._ts,r._time-=n,r._tTime-=n),r.shiftChildren(-n,!1,-Infinity),o=0),a._end>s&&a._ts&&(s=a._end),a=t;c_(r,r===Cv&&r._time>s?r._time:s,1,1),r._dirty=0}return r._tDur},t.updateRoot=function(e){if(Cv._ts&&(Vg(Cv,e_(e,Cv)),Rv=G_.frame),G_.frame>=Cg){Cg+=Vv.autoSleep||120;var t=Cv._first;if((!t||!t._ts)&&Vv.autoSleep&&G_._listeners.length<2){for(;t&&!t._ts;)t=t._next;t||G_.sleep()}}},t}(iw);zg(sw.prototype,{_lock:0,_hasPause:0,_forcing:0});var rw,aw,ow=function(e,t,n,i,s,r,a){var o,l,c,h,u,d,p,m,f=new Aw(this._pt,e,t,0,1,Mw,null,s),v=0,g=0;for(f.b=n,f.e=i,n+="",(p=~(i+="").indexOf("random("))&&(i=P_(i)),r&&(r(m=[n,i],e,t),n=m[0],i=m[1]),l=n.match(og)||[];o=og.exec(i);)h=o[0],u=i.substring(v,o.index),c?c=(c+1)%5:"rgba("===u.substr(-5)&&(c=1),h!==l[g++]&&(d=parseFloat(l[g-1])||0,f._pt={_next:f._pt,p:u||1===g?u:",",s:d,c:"="===h.charAt(1)?Og(d,h)-d:parseFloat(h)-d,m:c&&c<4?Math.round:0},v=og.lastIndex);return f.c=v<i.length?i.substring(v,i.length):"",f.fp=a,(lg.test(i)||p)&&(f.e=0),this._pt=f,f},lw=function(e,t,n,i,s,r,a,o,l,c){Yv(i)&&(i=i(s||0,e,r));var h,u=e[t],d="get"!==n?n:Yv(u)?l?e[t.indexOf("set")||!Yv(e["get"+t.substr(3)])?t:"get"+t.substr(3)](l):e[t]():u,p=Yv(u)?l?_w:gw:vw;if(Kv(i)&&(~i.indexOf("random(")&&(i=P_(i)),"="===i.charAt(1)&&((h=Og(d,i)+(v_(d)||0))||0===h)&&(i=h)),!c||d!==i||aw)return isNaN(d*i)||""===i?(!u&&!(t in e)&&mg(t,i),ow.call(this,e,t,d,i,p,o||Vv.stringFilter,l)):(h=new Aw(this._pt,e,t,+d||0,i-(d||0),"boolean"==typeof u?xw:yw,0,p),l&&(h.fp=l),a&&h.modifier(a,this,e),this._pt=h)},cw=function(e,t,n,i,s,r){var a,o,l,c;if(Eg[e]&&!1!==(a=new Eg[e]).init(s,a.rawVars?t[e]:function(e,t,n,i,s){if(Yv(e)&&(e=dw(e,s,t,n,i)),!Jv(e)||e.style&&e.nodeType||ig(e)||ng(e))return Kv(e)?dw(e,s,t,n,i):e;var r,a={};for(r in e)a[r]=dw(e[r],s,t,n,i);return a}(t[e],i,s,r,n),n,i,r)&&(n._pt=o=new Aw(n._pt,s,e,0,1,a.render,a,0,a.priority),n!==Dv))for(l=n._ptLookup[n._targets.indexOf(s)],c=a._props.length;c--;)l[a._props[c]]=o;return a},hw=function e(t,n,i){var s,r,a,o,l,c,h,u,d,p,m,f,v,g=t.vars,_=g.ease,w=g.startAt,b=g.immediateRender,y=g.lazy,x=g.onUpdate,M=g.onUpdateParams,E=g.callbackScope,S=g.runBackwards,C=g.yoyoEase,T=g.keyframes,P=g.autoRevert,A=t._dur,L=t._startAt,R=t._targets,D=t.parent,I=D&&"nested"===D.data?D.vars.targets:R,k="auto"===t._overwrite&&!Mv,O=t.timeline;if(O&&(!T||!_)&&(_="none"),t._ease=Z_(_,Bv.ease),t._yEase=C?Y_(Z_(!0===C?_:C,Bv.ease)):0,C&&t._yoyo&&!t._repeat&&(C=t._yEase,t._yEase=t._ease,t._ease=C),t._from=!O&&!!g.runBackwards,!O||T&&!g.stagger){if(f=(u=R[0]?Lg(R[0]).harness:0)&&g[u.prop],s=jg(g,yg),L&&(L._zTime<0&&L.progress(1),n<0&&S&&b&&!P?L.render(-1,!0):L.revert(S&&A?wg:_g),L._lazy=0),w){if(Kg(t._startAt=fw.set(R,zg({data:"isStart",overwrite:!1,parent:D,immediateRender:!0,lazy:!L&&Qv(y),startAt:null,delay:0,onUpdate:x,onUpdateParams:M,callbackScope:E,stagger:0},w))),t._startAt._dp=0,t._startAt._sat=t,n<0&&(Ev||!b&&!P)&&t._startAt.revert(wg),b&&A&&n<=0&&i<=0)return void(n&&(t._zTime=n))}else if(S&&A&&!L)if(n&&(b=!1),a=zg({overwrite:!1,data:"isFromStart",lazy:b&&!L&&Qv(y),immediateRender:b,stagger:0,parent:D},s),f&&(a[u.prop]=f),Kg(t._startAt=fw.set(R,a)),t._startAt._dp=0,t._startAt._sat=t,n<0&&(Ev?t._startAt.revert(wg):t._startAt.render(-1,!0)),t._zTime=n,b){if(!n)return}else e(t._startAt,zv,zv);for(t._pt=t._ptCache=0,y=A&&Qv(y)||y&&!A,r=0;r<R.length;r++){if(h=(l=R[r])._gsap||Ag(R)[r]._gsap,t._ptLookup[r]=p={},Mg[h.id]&&xg.length&&Ug(),m=I===R?r:I.indexOf(l),u&&!1!==(d=new u).init(l,f||s,t,m,I)&&(t._pt=o=new Aw(t._pt,l,d.name,0,1,d.render,d,0,d.priority),d._props.forEach((function(e){p[e]=o})),d.priority&&(c=1)),!u||f)for(a in s)Eg[a]&&(d=cw(a,s,t,m,l,I))?d.priority&&(c=1):p[a]=o=lw.call(t,l,a,"get",s[a],m,I,0,g.stringFilter);t._op&&t._op[r]&&t.kill(l,t._op[r]),k&&t._pt&&(rw=t,Cv.killTweensOf(l,p,t.globalTime(n)),v=!t.parent,rw=0),t._pt&&y&&(Mg[h.id]=1)}c&&Pw(t),t._onInit&&t._onInit(t)}t._onUpdate=x,t._initted=(!t._op||t._pt)&&!v,T&&n<=0&&O.render(Fv,!0,!0)},uw=function(e,t,n,i){var s,r,a=t.ease||i||"power1.inOut";if(ig(t))r=n[e]||(n[e]=[]),t.forEach((function(e,n){return r.push({t:n/(t.length-1)*100,v:e,e:a})}));else for(s in t)r=n[s]||(n[s]=[]),"ease"===s||r.push({t:parseFloat(e),v:t[s],e:a})},dw=function(e,t,n,i,s){return Yv(e)?e.call(t,n,i,s):Kv(e)&&~e.indexOf("random(")?P_(e):e},pw=Pg+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",mw={};Dg(pw+",id,stagger,delay,duration,paused,scrollTrigger",(function(e){return mw[e]=1}));var fw=function(e){function t(t,n,i,s){var r;"number"==typeof n&&(i.duration=n,n=i,i=null);var a,o,l,c,h,u,d,p,m=(r=e.call(this,s?n:Wg(n))||this).vars,f=m.duration,v=m.delay,g=m.immediateRender,_=m.stagger,w=m.overwrite,b=m.keyframes,y=m.defaults,x=m.scrollTrigger,M=m.yoyoEase,E=n.parent||Cv,S=(ig(t)||ng(t)?$v(t[0]):"length"in n)?[t]:b_(t);if(r._targets=S.length?Ag(S):fg("GSAP target "+t+" not found. https://greensock.com",!Vv.nullTargetWarn)||[],r._ptLookup=[],r._overwrite=w,b||_||tg(f)||tg(v)){if(n=r.vars,(a=r.timeline=new sw({data:"nested",defaults:y||{},targets:E&&"nested"===E.data?E.vars.targets:S})).kill(),a.parent=a._dp=yv(r),a._start=0,_||tg(f)||tg(v)){if(c=S.length,d=_&&M_(_),Jv(_))for(h in _)~pw.indexOf(h)&&(p||(p={}),p[h]=_[h]);for(o=0;o<c;o++)(l=jg(n,mw)).stagger=0,M&&(l.yoyoEase=M),p&&Hg(l,p),u=S[o],l.duration=+dw(f,yv(r),o,u,S),l.delay=(+dw(v,yv(r),o,u,S)||0)-r._delay,!_&&1===c&&l.delay&&(r._delay=v=l.delay,r._start+=v,l.delay=0),a.to(u,l,d?d(o,u,S):0),a._ease=W_.none;a.duration()?f=v=0:r.timeline=0}else if(b){Wg(zg(a.vars.defaults,{ease:"none"})),a._ease=Z_(b.ease||n.ease||"none");var C,T,P,A=0;if(ig(b))b.forEach((function(e){return a.to(S,e,">")})),a.duration();else{for(h in l={},b)"ease"===h||"easeEach"===h||uw(h,b[h],l,b.easeEach);for(h in l)for(C=l[h].sort((function(e,t){return e.t-t.t})),A=0,o=0;o<C.length;o++)(P={ease:(T=C[o]).e,duration:(T.t-(o?C[o-1].t:0))/100*f})[h]=T.v,a.to(S,P,A),A+=P.duration;a.duration()<f&&a.to({},{duration:f-a.duration()})}}f||r.duration(f=a.duration())}else r.timeline=0;return!0!==w||Mv||(rw=yv(r),Cv.killTweensOf(S),rw=0),s_(E,yv(r),i),n.reversed&&r.reverse(),n.paused&&r.paused(!0),(g||!f&&!b&&r._start===kg(E._time)&&Qv(g)&&Zg(yv(r))&&"nested"!==E.data)&&(r._tTime=-1e-8,r.render(Math.max(0,-v)||0)),x&&r_(yv(r),x),r}xv(t,e);var n=t.prototype;return n.render=function(e,t,n){var i,s,r,a,o,l,c,h,u,d=this._time,p=this._tDur,m=this._dur,f=e<0,v=e>p-zv&&!f?p:e<zv?0:e;if(m){if(v!==this._tTime||!e||n||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==f){if(i=v,h=this.timeline,this._repeat){if(a=m+this._rDelay,this._repeat<-1&&f)return this.totalTime(100*a+e,t,n);if(i=kg(v%a),v===p?(r=this._repeat,i=m):((r=~~(v/a))&&r===v/a&&(i=m,r--),i>m&&(i=m)),(l=this._yoyo&&1&r)&&(u=this._yEase,i=m-i),o=Qg(this._tTime,a),i===d&&!n&&this._initted)return this._tTime=v,this;r!==o&&(h&&this._yEase&&$_(h,l),!this.vars.repeatRefresh||l||this._lock||(this._lock=n=1,this.render(kg(a*r),!0).invalidate()._lock=0))}if(!this._initted){if(a_(this,f?e:i,n,t,v))return this._tTime=0,this;if(d!==this._time)return this;if(m!==this._dur)return this.render(e,t,n)}if(this._tTime=v,this._time=i,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=c=(u||this._ease)(i/m),this._from&&(this.ratio=c=1-c),i&&!d&&!t&&!r&&(R_(this,"onStart"),this._tTime!==v))return this;for(s=this._pt;s;)s.r(c,s.d),s=s._next;h&&h.render(e<0?e:!i&&l?-1e-8:h._dur*h._ease(i/this._dur),t,n)||this._startAt&&(this._zTime=e),this._onUpdate&&!t&&(f&&$g(this,e,0,n),R_(this,"onUpdate")),this._repeat&&r!==o&&this.vars.onRepeat&&!t&&this.parent&&R_(this,"onRepeat"),v!==this._tDur&&v||this._tTime!==v||(f&&!this._onUpdate&&$g(this,e,0,!0),(e||!m)&&(v===this._tDur&&this._ts>0||!v&&this._ts<0)&&Kg(this,1),t||f&&!d||!(v||d||l)||(R_(this,v===p?"onComplete":"onReverseComplete",!0),this._prom&&!(v<p&&this.timeScale()>0)&&this._prom()))}}else!function(e,t,n,i){var s,r,a,o=e.ratio,l=t<0||!t&&(!e._start&&o_(e)&&(e._initted||!l_(e))||(e._ts<0||e._dp._ts<0)&&!l_(e))?0:1,c=e._rDelay,h=0;if(c&&e._repeat&&(h=f_(0,e._tDur,t),r=Qg(h,c),e._yoyo&&1&r&&(l=1-l),r!==Qg(e._tTime,c)&&(o=1-l,e.vars.repeatRefresh&&e._initted&&e.invalidate())),l!==o||Ev||i||e._zTime===zv||!t&&e._zTime){if(!e._initted&&a_(e,t,i,n,h))return;for(a=e._zTime,e._zTime=t||(n?zv:0),n||(n=t&&!a),e.ratio=l,e._from&&(l=1-l),e._time=0,e._tTime=h,s=e._pt;s;)s.r(l,s.d),s=s._next;t<0&&$g(e,t,0,!0),e._onUpdate&&!n&&R_(e,"onUpdate"),h&&e._repeat&&!n&&e.parent&&R_(e,"onRepeat"),(t>=e._tDur||t<0)&&e.ratio===l&&(l&&Kg(e,1),n||Ev||(R_(e,l?"onComplete":"onReverseComplete",!0),e._prom&&e._prom()))}else e._zTime||(e._zTime=t)}(this,e,t,n);return this},n.targets=function(){return this._targets},n.invalidate=function(t){return(!t||!this.vars.runBackwards)&&(this._startAt=0),this._pt=this._op=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(t),e.prototype.invalidate.call(this,t)},n.resetTo=function(e,t,n,i){Iv||G_.wake(),this._ts||this.play();var s=Math.min(this._dur,(this._dp._time-this._start)*this._ts);return this._initted||hw(this,s),function(e,t,n,i,s,r,a){var o,l,c,h,u=(e._pt&&e._ptCache||(e._ptCache={}))[t];if(!u)for(u=e._ptCache[t]=[],c=e._ptLookup,h=e._targets.length;h--;){if((o=c[h][t])&&o.d&&o.d._pt)for(o=o.d._pt;o&&o.p!==t&&o.fp!==t;)o=o._next;if(!o)return aw=1,e.vars[t]="+=0",hw(e,a),aw=0,1;u.push(o)}for(h=u.length;h--;)(o=(l=u[h])._pt||l).s=!i&&0!==i||s?o.s+(i||0)+r*o.c:i,o.c=n-o.s,l.e&&(l.e=Ig(n)+v_(l.e)),l.b&&(l.b=o.s+v_(l.b))}(this,e,t,n,i,this._ease(s/this._dur),s)?this.resetTo(e,t,n,i):(n_(this,0),this.parent||qg(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},n.kill=function(e,t){if(void 0===t&&(t="all"),!(e||t&&"all"!==t))return this._lazy=this._pt=0,this.parent?D_(this):this;if(this.timeline){var n=this.timeline.totalDuration();return this.timeline.killTweensOf(e,t,rw&&!0!==rw.vars.overwrite)._first||D_(this),this.parent&&n!==this.timeline.totalDuration()&&c_(this,this._dur*this.timeline._tDur/n,0,1),this}var i,s,r,a,o,l,c,h=this._targets,u=e?b_(e):h,d=this._ptLookup,p=this._pt;if((!t||"all"===t)&&function(e,t){for(var n=e.length,i=n===t.length;i&&n--&&e[n]===t[n];);return n<0}(h,u))return"all"===t&&(this._pt=0),D_(this);for(i=this._op=this._op||[],"all"!==t&&(Kv(t)&&(o={},Dg(t,(function(e){return o[e]=1})),t=o),t=function(e,t){var n,i,s,r,a=e[0]?Lg(e[0]).harness:0,o=a&&a.aliases;if(!o)return t;for(i in n=Hg({},t),o)if(i in n)for(s=(r=o[i].split(",")).length;s--;)n[r[s]]=n[i];return n}(h,t)),c=h.length;c--;)if(~u.indexOf(h[c]))for(o in s=d[c],"all"===t?(i[c]=t,a=s,r={}):(r=i[c]=i[c]||{},a=t),a)(l=s&&s[o])&&("kill"in l.d&&!0!==l.d.kill(o)||Xg(this,l,"_pt"),delete s[o]),"all"!==r&&(r[o]=1);return this._initted&&!this._pt&&p&&D_(this),this},t.to=function(e,n){return new t(e,n,arguments[2])},t.from=function(e,t){return p_(1,arguments)},t.delayedCall=function(e,n,i,s){return new t(n,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:e,onComplete:n,onReverseComplete:n,onCompleteParams:i,onReverseCompleteParams:i,callbackScope:s})},t.fromTo=function(e,t,n){return p_(2,arguments)},t.set=function(e,n){return n.duration=0,n.repeatDelay||(n.repeat=0),new t(e,n)},t.killTweensOf=function(e,t,n){return Cv.killTweensOf(e,t,n)},t}(iw);zg(fw.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0}),Dg("staggerTo,staggerFrom,staggerFromTo",(function(e){fw[e]=function(){var t=new sw,n=g_.call(arguments,0);return n.splice("staggerFromTo"===e?5:4,0,0),t[e].apply(t,n)}}));var vw=function(e,t,n){return e[t]=n},gw=function(e,t,n){return e[t](n)},_w=function(e,t,n,i){return e[t](i.fp,n)},ww=function(e,t,n){return e.setAttribute(t,n)},bw=function(e,t){return Yv(e[t])?gw:Zv(e[t])&&e.setAttribute?ww:vw},yw=function(e,t){return t.set(t.t,t.p,Math.round(1e6*(t.s+t.c*e))/1e6,t)},xw=function(e,t){return t.set(t.t,t.p,!!(t.s+t.c*e),t)},Mw=function(e,t){var n=t._pt,i="";if(!e&&t.b)i=t.b;else if(1===e&&t.e)i=t.e;else{for(;n;)i=n.p+(n.m?n.m(n.s+n.c*e):Math.round(1e4*(n.s+n.c*e))/1e4)+i,n=n._next;i+=t.c}t.set(t.t,t.p,i,t)},Ew=function(e,t){for(var n=t._pt;n;)n.r(e,n.d),n=n._next},Sw=function(e,t,n,i){for(var s,r=this._pt;r;)s=r._next,r.p===i&&r.modifier(e,t,n),r=s},Cw=function(e){for(var t,n,i=this._pt;i;)n=i._next,i.p===e&&!i.op||i.op===e?Xg(this,i,"_pt"):i.dep||(t=1),i=n;return!t},Tw=function(e,t,n,i){i.mSet(e,t,i.m.call(i.tween,n,i.mt),i)},Pw=function(e){for(var t,n,i,s,r=e._pt;r;){for(t=r._next,n=i;n&&n.pr>r.pr;)n=n._next;(r._prev=n?n._prev:s)?r._prev._next=r:i=r,(r._next=n)?n._prev=r:s=r,r=t}e._pt=i},Aw=function(){function e(e,t,n,i,s,r,a,o,l){this.t=t,this.s=i,this.c=s,this.p=n,this.r=r||yw,this.d=a||this,this.set=o||vw,this.pr=l||0,this._next=e,e&&(e._prev=this)}return e.prototype.modifier=function(e,t,n){this.mSet=this.mSet||this.set,this.set=Tw,this.m=e,this.mt=n,this.tween=t},e}();Dg(Pg+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",(function(e){return yg[e]=1})),ug.TweenMax=ug.TweenLite=fw,ug.TimelineLite=ug.TimelineMax=sw,Cv=new sw({sortChildren:!1,defaults:Bv,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0}),Vv.stringFilter=function(e){var t,n=e.join(" ");if(z_.lastIndex=0,z_.test(n))return t=H_.test(n),e[1]=F_(e[1],t),e[0]=F_(e[0],t,B_(e[1])),!0};var Lw=[],Rw={},Dw=[],Iw=0,kw=0,Ow=function(e){return(Rw[e]||Dw).map((function(e){return e()}))},Nw=function(){var e=Date.now(),t=[];e-Iw>2&&(Ow("matchMediaInit"),Lw.forEach((function(e){var n,i,s,r,a=e.queries,o=e.conditions;for(i in a)(n=Tv.matchMedia(a[i]).matches)&&(s=1),n!==o[i]&&(o[i]=n,r=1);r&&(e.revert(),s&&t.push(e))})),Ow("matchMediaRevert"),t.forEach((function(e){return e.onMatch(e)})),Iw=e,Ow("matchMedia"))},Uw=function(){function e(e,t){this.selector=t&&y_(t),this.data=[],this._r=[],this.isReverted=!1,this.id=kw++,e&&this.add(e)}var t=e.prototype;return t.add=function(e,t,n){Yv(e)&&(n=t,t=e,e=Yv);var i=this,s=function(){var e,s=Sv,r=i.selector;return s&&s!==i&&s.data.push(i),n&&(i.selector=y_(n)),Sv=i,e=t.apply(i,arguments),Yv(e)&&i._r.push(e),Sv=s,i.selector=r,i.isReverted=!1,e};return i.last=s,e===Yv?s(i):e?i[e]=s:s},t.ignore=function(e){var t=Sv;Sv=null,e(this),Sv=t},t.getTweens=function(){var t=[];return this.data.forEach((function(n){return n instanceof e?t.push.apply(t,n.getTweens()):n instanceof fw&&!(n.parent&&"nested"===n.parent.data)&&t.push(n)})),t},t.clear=function(){this._r.length=this.data.length=0},t.kill=function(e,t){var n=this;if(e){var i=this.getTweens();this.data.forEach((function(e){"isFlip"===e.data&&(e.revert(),e.getChildren(!0,!0,!1).forEach((function(e){return i.splice(i.indexOf(e),1)})))})),i.map((function(e){return{g:e.globalTime(0),t:e}})).sort((function(e,t){return t.g-e.g||-1/0})).forEach((function(t){return t.t.revert(e)})),this.data.forEach((function(t){return!(t instanceof fw)&&t.revert&&t.revert(e)})),this._r.forEach((function(t){return t(e,n)})),this.isReverted=!0}else this.data.forEach((function(e){return e.kill&&e.kill()}));if(this.clear(),t)for(var s=Lw.length;s--;)Lw[s].id===this.id&&Lw.splice(s,1)},t.revert=function(e){this.kill(e||{})},e}(),Vw=function(){function e(e){this.contexts=[],this.scope=e}var t=e.prototype;return t.add=function(e,t,n){Jv(e)||(e={matches:e});var i,s,r,a=new Uw(0,n||this.scope),o=a.conditions={};for(s in Sv&&!a.selector&&(a.selector=Sv.selector),this.contexts.push(a),t=a.add("onMatch",t),a.queries=e,e)"all"===s?r=1:(i=Tv.matchMedia(e[s]))&&(Lw.indexOf(a)<0&&Lw.push(a),(o[s]=i.matches)&&(r=1),i.addListener?i.addListener(Nw):i.addEventListener("change",Nw));return r&&t(a),this},t.revert=function(e){this.kill(e||{})},t.kill=function(e){this.contexts.forEach((function(t){return t.kill(e,!0)}))},e}(),Bw={registerPlugin:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t.forEach((function(e){return k_(e)}))},timeline:function(e){return new sw(e)},getTweensOf:function(e,t){return Cv.getTweensOf(e,t)},getProperty:function(e,t,n,i){Kv(e)&&(e=b_(e)[0]);var s=Lg(e||{}).get,r=n?Fg:Bg;return"native"===n&&(n=""),e?t?r((Eg[t]&&Eg[t].get||s)(e,t,n,i)):function(t,n,i){return r((Eg[t]&&Eg[t].get||s)(e,t,n,i))}:e},quickSetter:function(e,t,n){if((e=b_(e)).length>1){var i=e.map((function(e){return Hw.quickSetter(e,t,n)})),s=i.length;return function(e){for(var t=s;t--;)i[t](e)}}e=e[0]||{};var r=Eg[t],a=Lg(e),o=a.harness&&(a.harness.aliases||{})[t]||t,l=r?function(t){var i=new r;Dv._pt=0,i.init(e,n?t+n:t,Dv,0,[e]),i.render(1,i),Dv._pt&&Ew(1,Dv)}:a.set(e,o);return r?l:function(t){return l(e,o,n?t+n:t,a,1)}},quickTo:function(e,t,n){var i,s=Hw.to(e,Hg(((i={})[t]="+=0.1",i.paused=!0,i),n||{})),r=function(e,n,i){return s.resetTo(t,e,n,i)};return r.tween=s,r},isTweening:function(e){return Cv.getTweensOf(e,!0).length>0},defaults:function(e){return e&&e.ease&&(e.ease=Z_(e.ease,Bv.ease)),Gg(Bv,e||{})},config:function(e){return Gg(Vv,e||{})},registerEffect:function(e){var t=e.name,n=e.effect,i=e.plugins,s=e.defaults,r=e.extendTimeline;(i||"").split(",").forEach((function(e){return e&&!Eg[e]&&!ug[e]&&fg(t+" effect requires "+e+" plugin.")})),Sg[t]=function(e,t,i){return n(b_(e),zg(t||{},s),i)},r&&(sw.prototype[t]=function(e,n,i){return this.add(Sg[t](e,Jv(n)?n:(i=n)&&{},this),i)})},registerEase:function(e,t){W_[e]=Z_(t)},parseEase:function(e,t){return arguments.length?Z_(e,t):W_},getById:function(e){return Cv.getById(e)},exportRoot:function(e,t){void 0===e&&(e={});var n,i,s=new sw(e);for(s.smoothChildTiming=Qv(e.smoothChildTiming),Cv.remove(s),s._dp=0,s._time=s._tTime=Cv._time,n=Cv._first;n;)i=n._next,!t&&!n._dur&&n instanceof fw&&n.vars.onComplete===n._targets[0]||s_(s,n,n._start-n._delay),n=i;return s_(Cv,s,0),s},context:function(e,t){return e?new Uw(e,t):Sv},matchMedia:function(e){return new Vw(e)},matchMediaRefresh:function(){return Lw.forEach((function(e){var t,n,i=e.conditions;for(n in i)i[n]&&(i[n]=!1,t=1);t&&e.revert()}))||Nw()},addEventListener:function(e,t){var n=Rw[e]||(Rw[e]=[]);~n.indexOf(t)||n.push(t)},removeEventListener:function(e,t){var n=Rw[e],i=n&&n.indexOf(t);i>=0&&n.splice(i,1)},utils:{wrap:function e(t,n,i){var s=n-t;return ig(t)?T_(t,e(0,t.length),n):m_(i,(function(e){return(s+(e-t)%s)%s+t}))},wrapYoyo:function e(t,n,i){var s=n-t,r=2*s;return ig(t)?T_(t,e(0,t.length-1),n):m_(i,(function(e){return t+((e=(r+(e-t)%r)%r||0)>s?r-e:e)}))},distribute:M_,random:C_,snap:S_,normalize:function(e,t,n){return A_(e,t,0,1,n)},getUnit:v_,clamp:function(e,t,n){return m_(n,(function(n){return f_(e,t,n)}))},splitColor:V_,toArray:b_,selector:y_,mapRange:A_,pipe:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return t.reduce((function(e,t){return t(e)}),e)}},unitize:function(e,t){return function(n){return e(parseFloat(n))+(t||v_(n))}},interpolate:function e(t,n,i,s){var r=isNaN(t+n)?0:function(e){return(1-e)*t+e*n};if(!r){var a,o,l,c,h,u=Kv(t),d={};if(!0===i&&(s=1)&&(i=null),u)t={p:t},n={p:n};else if(ig(t)&&!ig(n)){for(l=[],c=t.length,h=c-2,o=1;o<c;o++)l.push(e(t[o-1],t[o]));c--,r=function(e){e*=c;var t=Math.min(h,~~e);return l[t](e-t)},i=n}else s||(t=Hg(ig(t)?[]:{},t));if(!l){for(a in n)lw.call(d,t,a,"get",n[a]);r=function(e){return Ew(e,d)||(u?t.p:t)}}}return m_(i,r)},shuffle:x_},install:pg,effects:Sg,ticker:G_,updateRoot:sw.updateRoot,plugins:Eg,globalTimeline:Cv,core:{PropTween:Aw,globals:vg,Tween:fw,Timeline:sw,Animation:iw,getCache:Lg,_removeLinkedListItem:Xg,reverting:function(){return Ev},context:function(e){return e&&Sv&&(Sv.data.push(e),e._ctx=Sv),Sv},suppressOverwrites:function(e){return Mv=e}}};Dg("to,from,fromTo,delayedCall,set,killTweensOf",(function(e){return Bw[e]=fw[e]})),G_.add(sw.updateRoot),Dv=Bw.to({},{duration:0});var Fw=function(e,t){for(var n=e._pt;n&&n.p!==t&&n.op!==t&&n.fp!==t;)n=n._next;return n},zw=function(e,t){return{name:e,rawVars:1,init:function(e,n,i){i._onInit=function(e){var i,s;if(Kv(n)&&(i={},Dg(n,(function(e){return i[e]=1})),n=i),t){for(s in i={},n)i[s]=t(n[s]);n=i}!function(e,t){var n,i,s,r=e._targets;for(n in t)for(i=r.length;i--;)(s=e._ptLookup[i][n])&&(s=s.d)&&(s._pt&&(s=Fw(s,n)),s&&s.modifier&&s.modifier(t[n],e,r[i],n))}(e,n)}}}},Hw=Bw.registerPlugin({name:"attr",init:function(e,t,n,i,s){var r,a,o;for(r in this.tween=n,t)o=e.getAttribute(r)||"",(a=this.add(e,"setAttribute",(o||0)+"",t[r],i,s,0,0,r)).op=r,a.b=o,this._props.push(r)},render:function(e,t){for(var n=t._pt;n;)Ev?n.set(n.t,n.p,n.b,n):n.r(e,n.d),n=n._next}},{name:"endArray",init:function(e,t){for(var n=t.length;n--;)this.add(e,n,e[n]||0,t[n],0,0,0,0,0,1)}},zw("roundProps",E_),zw("modifiers"),zw("snap",S_))||Bw;fw.version=sw.version=Hw.version="3.12.2",Lv=1,eg()&&j_();W_.Power0;var Gw=W_.Power1,jw=W_.Power2,Ww=(W_.Power3,W_.Power4,W_.Linear,W_.Quad,W_.Cubic,W_.Quart,W_.Quint,W_.Strong,W_.Elastic,W_.Back,W_.SteppedEase,W_.Bounce,W_.Sine,W_.Expo),qw=W_.Circ,Xw=s(904);function Kw(e){return null==e}function Yw(e){return null!==e&&"object"==typeof e}function $w(e){return null!==e&&"object"==typeof e}function Zw(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function Jw(e,t){return Array.from(new Set([...Object.keys(e),...Object.keys(t)])).reduce(((n,i)=>{const s=e[i],r=t[i];return $w(s)&&$w(r)?Object.assign(Object.assign({},n),{[i]:Jw(s,r)}):Object.assign(Object.assign({},n),{[i]:i in t?r:s})}),{})}const Qw={alreadydisposed:()=>"View has been already disposed",invalidparams:e=>`Invalid parameters for '${e.name}'`,nomatchingcontroller:e=>`No matching controller for '${e.key}'`,nomatchingview:e=>`No matching view for '${JSON.stringify(e.params)}'`,notbindable:()=>"Value is not bindable",notcompatible:e=>`Not compatible with  plugin '${e.id}'`,propertynotfound:e=>`Property '${e.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class eb{static alreadyDisposed(){return new eb({type:"alreadydisposed"})}static notBindable(){return new eb({type:"notbindable"})}static notCompatible(e,t){return new eb({type:"notcompatible",context:{id:`${e}.${t}`}})}static propertyNotFound(e){return new eb({type:"propertynotfound",context:{name:e}})}static shouldNeverHappen(){return new eb({type:"shouldneverhappen"})}constructor(e){var t;this.message=null!==(t=Qw[e.type](e.context))&&void 0!==t?t:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=e.type}toString(){return this.message}}class tb{constructor(e,t){this.obj_=e,this.key=t}static isBindable(e){return null!==e&&("object"==typeof e||"function"==typeof e)}read(){return this.obj_[this.key]}write(e){this.obj_[this.key]=e}writeProperty(e,t){const n=this.read();if(!tb.isBindable(n))throw eb.notBindable();if(!(e in n))throw eb.propertyNotFound(e);n[e]=t}}class nb{constructor(){this.observers_={}}on(e,t){let n=this.observers_[e];return n||(n=this.observers_[e]=[]),n.push({handler:t}),this}off(e,t){const n=this.observers_[e];return n&&(this.observers_[e]=n.filter((e=>e.handler!==t))),this}emit(e,t){const n=this.observers_[e];n&&n.forEach((e=>{e.handler(t)}))}}class ib{constructor(e,t){var n;this.constraint_=null==t?void 0:t.constraint,this.equals_=null!==(n=null==t?void 0:t.equals)&&void 0!==n?n:(e,t)=>e===t,this.emitter=new nb,this.rawValue_=e}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const n=null!=t?t:{forceEmit:!1,last:!0},i=this.constraint_?this.constraint_.constrain(e):e,s=this.rawValue_;(!this.equals_(s,i)||n.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=i,this.emitter.emit("change",{options:n,previousRawValue:s,rawValue:i,sender:this}))}}class sb{constructor(e){this.emitter=new nb,this.value_=e}get rawValue(){return this.value_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const n=null!=t?t:{forceEmit:!1,last:!0},i=this.value_;(i!==e||n.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.value_=e,this.emitter.emit("change",{options:n,previousRawValue:i,rawValue:this.value_,sender:this}))}}class rb{constructor(e){this.emitter=new nb,this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.value_=e,this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_)}get rawValue(){return this.value_.rawValue}onValueBeforeChange_(e){this.emitter.emit("beforechange",Object.assign(Object.assign({},e),{sender:this}))}onValueChange_(e){this.emitter.emit("change",Object.assign(Object.assign({},e),{sender:this}))}}function ab(e,t){const n=null==t?void 0:t.constraint,i=null==t?void 0:t.equals;return n||i?new ib(e,t):new sb(e)}class ob{constructor(e){this.emitter=new nb,this.valMap_=e;for(const e in this.valMap_){this.valMap_[e].emitter.on("change",(()=>{this.emitter.emit("change",{key:e,sender:this})}))}}static createCore(e){return Object.keys(e).reduce(((t,n)=>Object.assign(t,{[n]:ab(e[n])})),{})}static fromObject(e){const t=this.createCore(e);return new ob(t)}get(e){return this.valMap_[e].rawValue}set(e,t){this.valMap_[e].rawValue=t}value(e){return this.valMap_[e]}}class lb{constructor(e){this.values=ob.fromObject({max:e.max,min:e.min})}constrain(e){const t=this.values.get("max"),n=this.values.get("min");return Math.min(Math.max(e,n),t)}}class cb{constructor(e){this.values=ob.fromObject({max:e.max,min:e.min})}constrain(e){const t=this.values.get("max"),n=this.values.get("min");let i=e;return Kw(n)||(i=Math.max(i,n)),Kw(t)||(i=Math.min(i,t)),i}}class hb{constructor(e,t=0){this.step=e,this.origin=t}constrain(e){const t=this.origin%this.step;return t+Math.round((e-t)/this.step)*this.step}}class ub{constructor(e){this.text=e}evaluate(){return Number(this.text)}toString(){return this.text}}const db={"**":(e,t)=>Math.pow(e,t),"*":(e,t)=>e*t,"/":(e,t)=>e/t,"%":(e,t)=>e%t,"+":(e,t)=>e+t,"-":(e,t)=>e-t,"<<":(e,t)=>e<<t,">>":(e,t)=>e>>t,">>>":(e,t)=>e>>>t,"&":(e,t)=>e&t,"^":(e,t)=>e^t,"|":(e,t)=>e|t};class pb{constructor(e,t,n){this.left=t,this.operator=e,this.right=n}evaluate(){const e=db[this.operator];if(!e)throw new Error(`unexpected binary operator: '${this.operator}`);return e(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const mb={"+":e=>e,"-":e=>-e,"~":e=>~e};class fb{constructor(e,t){this.operator=e,this.expression=t}evaluate(){const e=mb[this.operator];if(!e)throw new Error(`unexpected unary operator: '${this.operator}`);return e(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function vb(e){return(t,n)=>{for(let i=0;i<e.length;i++){const s=e[i](t,n);if(""!==s)return s}return""}}function gb(e,t){var n;const i=e.substr(t).match(/^\s+/);return null!==(n=i&&i[0])&&void 0!==n?n:""}function _b(e,t){var n;const i=e.substr(t).match(/^[0-9]+/);return null!==(n=i&&i[0])&&void 0!==n?n:""}function wb(e,t){const n=e.substr(t,1);if(t+=1,"e"!==n.toLowerCase())return"";const i=function(e,t){const n=_b(e,t);if(""!==n)return n;const i=e.substr(t,1);if("-"!==i&&"+"!==i)return"";const s=_b(e,t+=1);return""===s?"":i+s}(e,t);return""===i?"":n+i}function bb(e,t){const n=e.substr(t,1);if("0"===n)return n;const i=function(e,t){const n=e.substr(t,1);return n.match(/^[1-9]$/)?n:""}(e,t);return t+=i.length,""===i?"":i+_b(e,t)}const yb=vb([function(e,t){const n=bb(e,t);if(t+=n.length,""===n)return"";const i=e.substr(t,1);if(t+=i.length,"."!==i)return"";const s=_b(e,t);return n+i+s+wb(e,t+=s.length)},function(e,t){const n=e.substr(t,1);if(t+=n.length,"."!==n)return"";const i=_b(e,t);return t+=i.length,""===i?"":n+i+wb(e,t)},function(e,t){const n=bb(e,t);return t+=n.length,""===n?"":n+wb(e,t)}]);const xb=vb([function(e,t){const n=e.substr(t,2);if(t+=n.length,"0b"!==n.toLowerCase())return"";const i=function(e,t){var n;const i=e.substr(t).match(/^[01]+/);return null!==(n=i&&i[0])&&void 0!==n?n:""}(e,t);return""===i?"":n+i},function(e,t){const n=e.substr(t,2);if(t+=n.length,"0o"!==n.toLowerCase())return"";const i=function(e,t){var n;const i=e.substr(t).match(/^[0-7]+/);return null!==(n=i&&i[0])&&void 0!==n?n:""}(e,t);return""===i?"":n+i},function(e,t){const n=e.substr(t,2);if(t+=n.length,"0x"!==n.toLowerCase())return"";const i=function(e,t){var n;const i=e.substr(t).match(/^[0-9a-f]+/i);return null!==(n=i&&i[0])&&void 0!==n?n:""}(e,t);return""===i?"":n+i}]),Mb=vb([xb,yb]);function Eb(e,t){var n;return null!==(n=function(e,t){const n=Mb(e,t);return t+=n.length,""===n?null:{evaluable:new ub(n),cursor:t}}(e,t))&&void 0!==n?n:function(e,t){const n=e.substr(t,1);if(t+=n.length,"("!==n)return null;const i=Tb(e,t);if(!i)return null;t=i.cursor,t+=gb(e,t).length;const s=e.substr(t,1);return t+=s.length,")"!==s?null:{evaluable:i.evaluable,cursor:t}}(e,t)}function Sb(e,t,n){n+=gb(t,n).length;const i=e.filter((e=>t.startsWith(e,n)))[0];return i?(n+=i.length,{cursor:n+=gb(t,n).length,operator:i}):null}const Cb=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce(((e,t)=>function(e,t){return(n,i)=>{const s=e(n,i);if(!s)return null;i=s.cursor;let r=s.evaluable;for(;;){const s=Sb(t,n,i);if(!s)break;i=s.cursor;const a=e(n,i);if(!a)return null;i=a.cursor,r=new pb(s.operator,r,a.evaluable)}return r?{cursor:i,evaluable:r}:null}}(e,t)),(function e(t,n){const i=Eb(t,n);if(i)return i;const s=t.substr(n,1);if(n+=s.length,"+"!==s&&"-"!==s&&"~"!==s)return null;const r=e(t,n);return r?{cursor:n=r.cursor,evaluable:new fb(s,r.evaluable)}:null}));function Tb(e,t){return t+=gb(e,t).length,Cb(e,t)}function Pb(e){var t;const n=function(e){const t=Tb(e,0);return t?t.cursor+gb(e,t.cursor).length!==e.length?null:t.evaluable:null}(e);return null!==(t=null==n?void 0:n.evaluate())&&void 0!==t?t:null}function Ab(e){if("number"==typeof e)return e;if("string"==typeof e){const t=Pb(e);if(!Kw(t))return t}return 0}function Lb(e){return t=>t.toFixed(Math.max(Math.min(e,20),0))}function Rb(e,t,n,i,s){return i+(e-t)/(n-t)*(s-i)}function Db(e){return String(e.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function Ib(e,t,n){return Math.min(Math.max(e,t),n)}function kb(e,t){return(e%t+t)%t}function Ob(e,t){return Kw(e.step)?Math.max(Db(t),2):Db(e.step)}function Nb(e){var t;return null!==(t=e.step)&&void 0!==t?t:1}function Ub(e,t){var n;const i=Math.abs(null!==(n=e.step)&&void 0!==n?n:t);return 0===i?.1:Math.pow(10,Math.floor(Math.log10(i))-1)}function Vb(e,t){return Kw(e.step)?null:new hb(e.step,t)}function Bb(e){return Kw(e.max)||Kw(e.min)?Kw(e.max)&&Kw(e.min)?null:new cb({max:e.max,min:e.min}):new lb({max:e.max,min:e.min})}function Fb(e,t){var n,i,s;return{formatter:null!==(n=e.format)&&void 0!==n?n:Lb(Ob(e,t)),keyScale:null!==(i=e.keyScale)&&void 0!==i?i:Nb(e),pointerScale:null!==(s=e.pointerScale)&&void 0!==s?s:Ub(e,t)}}function zb(e){return{format:e.optional.function,keyScale:e.optional.number,max:e.optional.number,min:e.optional.number,pointerScale:e.optional.number,step:e.optional.number}}function Hb(e){return{constraint:e.constraint,textProps:ob.fromObject(Fb(e.params,e.initialValue))}}class Gb{constructor(e){this.controller=e}get element(){return this.controller.view.element}get disabled(){return this.controller.viewProps.get("disabled")}set disabled(e){this.controller.viewProps.set("disabled",e)}get hidden(){return this.controller.viewProps.get("hidden")}set hidden(e){this.controller.viewProps.set("hidden",e)}dispose(){this.controller.viewProps.set("disposed",!0)}importState(e){return this.controller.importState(e)}exportState(){return this.controller.exportState()}}class jb{constructor(e){this.target=e}}class Wb extends jb{constructor(e,t,n){super(e),this.value=t,this.last=null==n||n}}class qb extends jb{constructor(e,t){super(e),this.expanded=t}}class Xb extends jb{constructor(e,t){super(e),this.index=t}}class Kb extends Gb{constructor(e){super(e),this.onValueChange_=this.onValueChange_.bind(this),this.emitter_=new nb,this.controller.value.emitter.on("change",this.onValueChange_)}get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get key(){return this.controller.value.binding.target.key}get tag(){return this.controller.tag}set tag(e){this.controller.tag=e}on(e,t){const n=t.bind(this);return this.emitter_.on(e,(e=>{n(e)})),this}refresh(){this.controller.value.fetch()}onValueChange_(e){const t=this.controller.value;this.emitter_.emit("change",new Wb(this,t.binding.target.read(),e.options.last))}}function Yb(e){return t=>n=>{if(!t&&void 0===n)return{succeeded:!1,value:void 0};if(t&&void 0===n)return{succeeded:!0,value:void 0};const i=e(n);return void 0!==i?{succeeded:!0,value:i}:{succeeded:!1,value:void 0}}}function $b(e){return{custom:t=>Yb(t)(e),boolean:Yb((e=>"boolean"==typeof e?e:void 0))(e),number:Yb((e=>"number"==typeof e?e:void 0))(e),string:Yb((e=>"string"==typeof e?e:void 0))(e),function:Yb((e=>"function"==typeof e?e:void 0))(e),constant:t=>Yb((e=>e===t?t:void 0))(e),raw:Yb((e=>e))(e),object:t=>Yb((e=>{var n;if(null!==(n=e)&&"object"==typeof n)return function(e,t){const n=Object.keys(t).reduce(((n,i)=>{if(void 0===n)return;const s=(0,t[i])(e[i]);return s.succeeded?Object.assign(Object.assign({},n),{[i]:s.value}):void 0}),{});return n}(e,t)}))(e),array:t=>Yb((e=>{var n;if(Array.isArray(e))return n=t,e.reduce(((e,t)=>{if(void 0===e)return;const i=n(t);return i.succeeded&&void 0!==i.value?[...e,i.value]:void 0}),[])}))(e)}}const Zb={optional:$b(!0),required:$b(!1)};function Jb(e,t){const n=t(Zb),i=Zb.required.object(n)(e);return i.succeeded?i.value:void 0}function Qb(e,t,n,i){if(t&&!t(e))return!1;const s=Jb(e,n);return!!s&&i(s)}function ey(e,t){var n;return Jw(null!==(n=null==e?void 0:e())&&void 0!==n?n:{},t)}function ty(e){return"value"in e}function ny(e){if(!Yw(e)||!("binding"in e))return!1;const t=e.binding;return!!Yw(n=t)&&"target"in n;var n}const iy="http://www.w3.org/2000/svg";function sy(e){e.offsetHeight}function ry(e){return void 0!==e.ontouchstart}const ay={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function oy(e,t){const n=e.createElementNS(iy,"svg");return n.innerHTML=ay[t],n}function ly(e,t,n){e.insertBefore(t,e.children[n])}function cy(e){e.parentElement&&e.parentElement.removeChild(e)}function hy(e){for(;e.children.length>0;)e.removeChild(e.children[0])}function uy(e){return e.relatedTarget?e.relatedTarget:"explicitOriginalTarget"in e?e.explicitOriginalTarget:null}function dy(e,t){e.emitter.on("change",(e=>{t(e.rawValue)})),t(e.rawValue)}function py(e,t,n){dy(e.value(t),n)}const my="tp";function fy(e){return(t,n)=>[my,"-",e,"v",t?`_${t}`:"",n?`-${n}`:""].join("")}const vy=fy("lbl");class gy{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(vy()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(vy("l")),py(t.props,"label",(t=>{Kw(t)?this.element.classList.add(vy(void 0,"nol")):(this.element.classList.remove(vy(void 0,"nol")),function(e){for(;e.childNodes.length>0;)e.removeChild(e.childNodes[0])}(n),n.appendChild(function(e,t){const n=e.createDocumentFragment();return t.split("\n").map((t=>e.createTextNode(t))).forEach(((t,i)=>{i>0&&n.appendChild(e.createElement("br")),n.appendChild(t)})),n}(e,t)))})),this.element.appendChild(n),this.labelElement=n;const i=e.createElement("div");i.classList.add(vy("v")),this.element.appendChild(i),this.valueElement=i}}class _y{constructor(e,t){this.props=t.props,this.valueController=t.valueController,this.viewProps=t.valueController.viewProps,this.view=new gy(e,{props:t.props,viewProps:this.viewProps}),this.view.valueElement.appendChild(this.valueController.view.element)}importProps(e){return Qb(e,null,(e=>({label:e.optional.string})),(e=>(this.props.set("label",e.label),!0)))}exportProps(){return ey(null,{label:this.props.get("label")})}}const wy=fy(""),by={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class yy{constructor(e){this.parent_=null,this.blade=e.blade,this.view=e.view,this.viewProps=e.viewProps;const t=this.view.element;this.blade.value("positions").emitter.on("change",(()=>{["veryfirst","first","last","verylast"].forEach((e=>{t.classList.remove(wy(void 0,by[e]))})),this.blade.get("positions").forEach((e=>{t.classList.add(wy(void 0,by[e]))}))})),this.viewProps.handleDispose((()=>{cy(t)}))}get parent(){return this.parent_}set parent(e){this.parent_=e,this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null)}importState(e){return Qb(e,null,(e=>({disabled:e.required.boolean,hidden:e.required.boolean})),(e=>(this.viewProps.importState(e),!0)))}exportState(){return ey(null,Object.assign({},this.viewProps.exportState()))}}class xy extends yy{constructor(e,t){if(t.value!==t.valueController.value)throw eb.shouldNeverHappen();const n=t.valueController.viewProps,i=new _y(e,{blade:t.blade,props:t.props,valueController:t.valueController});super(Object.assign(Object.assign({},t),{view:new gy(e,{props:t.props,viewProps:n}),viewProps:n})),this.labelController=i,this.value=t.value,this.valueController=t.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}importState(e){return Qb(e,(t=>{var n,i,s;return super.importState(t)&&this.labelController.importProps(t)&&(null===(s=null===(i=(n=this.valueController).importProps)||void 0===i?void 0:i.call(n,e))||void 0===s||s)}),(e=>({value:e.optional.raw})),(e=>(e.value&&(this.value.rawValue=e.value),!0)))}exportState(){var e,t,n;return ey((()=>super.exportState()),Object.assign(Object.assign({value:this.value.rawValue},this.labelController.exportProps()),null!==(n=null===(t=(e=this.valueController).exportProps)||void 0===t?void 0:t.call(e))&&void 0!==n?n:{}))}}function My(e,t){for(;e.length<t;)e.push(void 0)}function Ey(e){const t=[];return My(t,e),t}function Sy(e){const t=e.indexOf(void 0);return t<0?e:e.slice(0,t)}class Cy extends Gb{get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get title(){var e;return null!==(e=this.controller.buttonController.props.get("title"))&&void 0!==e?e:""}set title(e){this.controller.buttonController.props.set("title",e)}on(e,t){const n=t.bind(this);return this.controller.buttonController.emitter.on(e,(()=>{n(new jb(this))})),this}}function Ty(e,t){return n=>{!function(e,t,n){n?e.classList.add(t):e.classList.remove(t)}(e,t,n)}}function Py(e,t){dy(e,(e=>{t.textContent=null!=e?e:""}))}const Ay=fy("btn");class Ly{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Ay()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("button");n.classList.add(Ay("b")),t.viewProps.bindDisabled(n),this.element.appendChild(n),this.buttonElement=n;const i=e.createElement("div");i.classList.add(Ay("t")),Py(t.props.value("title"),i),this.buttonElement.appendChild(i)}}class Ry{constructor(e,t){this.emitter=new nb,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new Ly(e,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}importProps(e){return Qb(e,null,(e=>({title:e.optional.string})),(e=>(this.props.set("title",e.title),!0)))}exportProps(){return ey(null,{title:this.props.get("title")})}onClick_(){this.emitter.emit("click",{sender:this})}}class Dy extends yy{constructor(e,t){const n=new Ry(e,{props:t.buttonProps,viewProps:t.viewProps}),i=new _y(e,{blade:t.blade,props:t.labelProps,valueController:n});super({blade:t.blade,view:i.view,viewProps:t.viewProps}),this.buttonController=n,this.labelController=i}importState(e){return Qb(e,(e=>super.importState(e)&&this.buttonController.importProps(e)&&this.labelController.importProps(e)),(()=>({})),(()=>!0))}exportState(){return ey((()=>super.exportState()),Object.assign(Object.assign({},this.buttonController.exportProps()),this.labelController.exportProps()))}}const Iy=new class{constructor(e){const[t,n]=e.split("-"),i=t.split(".");this.major=parseInt(i[0],10),this.minor=parseInt(i[1],10),this.patch=parseInt(i[2],10),this.prerelease=null!=n?n:null}toString(){const e=[this.major,this.minor,this.patch].join(".");return null!==this.prerelease?[e,this.prerelease].join("-"):e}}("2.0.0-beta.2");function ky(e){return Object.assign({core:Iy},e)}ky({id:"button",type:"blade",accept(e){const t=Jb(e,(e=>({title:e.required.string,view:e.required.constant("button"),label:e.optional.string})));return t?{params:t}:null},controller:e=>new Dy(e.document,{blade:e.blade,buttonProps:ob.fromObject({title:e.params.title}),labelProps:ob.fromObject({label:e.params.label}),viewProps:e.viewProps}),api:e=>e.controller instanceof Dy?new Cy(e.controller):null});class Oy{constructor(e,t){this.onRackValueChange_=this.onRackValueChange_.bind(this),this.controller_=e,this.emitter_=new nb,this.pool_=t;this.controller_.rack.emitter.on("valuechange",this.onRackValueChange_)}get children(){return this.controller_.rack.children.map((e=>this.pool_.createApi(e)))}addBinding(e,t,n){const i=null!=n?n:{},s=this.controller_.element.ownerDocument,r=this.pool_.createBinding(s,function(e,t){if(!tb.isBindable(e))throw eb.notBindable();return new tb(e,t)}(e,t),i),a=this.pool_.createBindingApi(r);return this.add(a,i.index)}addFolder(e){return function(e,t){return e.addBlade(Object.assign(Object.assign({},t),{view:"folder"}))}(this,e)}addButton(e){return function(e,t){return e.addBlade(Object.assign(Object.assign({},t),{view:"button"}))}(this,e)}addTab(e){return function(e,t){return e.addBlade(Object.assign(Object.assign({},t),{view:"tab"}))}(this,e)}add(e,t){const n=e.controller;return this.controller_.rack.add(n,t),e}remove(e){this.controller_.rack.remove(e.controller)}addBlade(e){const t=this.controller_.element.ownerDocument,n=this.pool_.createBlade(t,e),i=this.pool_.createApi(n);return this.add(i,e.index)}on(e,t){const n=t.bind(this);return this.emitter_.on(e,(e=>{n(e)})),this}refresh(){this.children.forEach((e=>{var t;Yw(t=e)&&"refresh"in t&&"function"==typeof t.refresh&&e.refresh()}))}onRackValueChange_(e){const t=e.bladeController,n=this.pool_.createApi(t),i=ny(t.value)?t.value.binding:null;this.emitter_.emit("change",new Wb(n,i?i.target.read():t.value.rawValue,e.options.last))}}class Ny extends Gb{constructor(e,t){super(e),this.rackApi_=new Oy(e.rackController,t)}}class Uy extends yy{constructor(e){super({blade:e.blade,view:e.view,viewProps:e.rackController.viewProps}),this.rackController=e.rackController}importState(e){return Qb(e,(e=>super.importState(e)),(e=>({children:e.required.array(e.required.raw)})),(e=>this.rackController.rack.children.every(((t,n)=>t.importState(e.children[n])))))}exportState(){return ey((()=>super.exportState()),{children:this.rackController.rack.children.map((e=>e.exportState()))})}}function Vy(e){return"rackController"in e}class By{constructor(e){this.emitter=new nb,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=e}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(e){for(const t of this.allItems())if(e(t))return t;return null}includes(e){return this.cache_.has(e)}add(e,t){if(this.includes(e))throw eb.shouldNeverHappen();const n=void 0!==t?t:this.items_.length;this.items_.splice(n,0,e),this.cache_.add(e);const i=this.extract_(e);i&&(i.emitter.on("add",this.onSubListAdd_),i.emitter.on("remove",this.onSubListRemove_),i.allItems().forEach((e=>{this.cache_.add(e)}))),this.emitter.emit("add",{index:n,item:e,root:this,target:this})}remove(e){const t=this.items_.indexOf(e);if(t<0)return;this.items_.splice(t,1),this.cache_.delete(e);const n=this.extract_(e);n&&(n.allItems().forEach((e=>{this.cache_.delete(e)})),n.emitter.off("add",this.onSubListAdd_),n.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:t,item:e,root:this,target:this})}onSubListAdd_(e){this.cache_.add(e.item),this.emitter.emit("add",{index:e.index,item:e.item,root:this,target:e.target})}onSubListRemove_(e){this.cache_.delete(e.item),this.emitter.emit("remove",{index:e.index,item:e.item,root:this,target:e.target})}}function Fy(e){return Vy(e)?e.rackController.rack.bcSet_:null}class zy{constructor(e){var t,n;this.emitter=new nb,this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onRackLayout_=this.onRackLayout_.bind(this),this.onRackValueChange_=this.onRackValueChange_.bind(this),this.blade_=null!==(t=e.blade)&&void 0!==t?t:null,null===(n=this.blade_)||void 0===n||n.value("positions").emitter.on("change",this.onBladePositionsChange_),this.viewProps=e.viewProps,this.bcSet_=new By(Fy),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(e,t){var n;null===(n=e.parent)||void 0===n||n.remove(e),e.parent=this,this.bcSet_.add(e,t)}remove(e){e.parent=null,this.bcSet_.remove(e)}find(e){return this.bcSet_.allItems().filter(e)}onSetAdd_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("add",{bladeController:e.item,index:e.index,root:t,sender:this}),!t)return;const n=e.item;if(n.viewProps.emitter.on("change",this.onChildViewPropsChange_),n.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),n.viewProps.handleDispose(this.onChildDispose_),ty(n))n.value.emitter.on("change",this.onChildValueChange_);else if(Vy(n)){const e=n.rackController.rack;if(e){const t=e.emitter;t.on("layout",this.onRackLayout_),t.on("valuechange",this.onRackValueChange_)}}}onSetRemove_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("remove",{bladeController:e.item,root:t,sender:this}),!t)return;const n=e.item;if(ty(n))n.value.emitter.off("change",this.onChildValueChange_);else if(Vy(n)){const e=n.rackController.rack;if(e){const t=e.emitter;t.off("layout",this.onRackLayout_),t.off("valuechange",this.onRackValueChange_)}}}updatePositions_(){const e=this.bcSet_.items.filter((e=>!e.viewProps.get("hidden"))),t=e[0],n=e[e.length-1];this.bcSet_.items.forEach((e=>{const i=[];e===t&&(i.push("first"),this.blade_&&!this.blade_.get("positions").includes("veryfirst")||i.push("veryfirst")),e===n&&(i.push("last"),this.blade_&&!this.blade_.get("positions").includes("verylast")||i.push("verylast")),e.blade.set("positions",i)}))}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter((e=>e.viewProps.get("disposed"))).forEach((e=>{this.bcSet_.remove(e)}))}onChildValueChange_(e){const t=function(e,t){for(let n=0;n<e.length;n++){const i=e[n];if(ty(i)&&i.value===t)return i}return null}(this.find(ty),e.sender);if(!t)throw eb.alreadyDisposed();this.emitter.emit("valuechange",{bladeController:t,options:e.options,sender:this})}onRackLayout_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onRackValueChange_(e){this.emitter.emit("valuechange",{bladeController:e.bladeController,options:e.options,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class Hy{constructor(e){this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.element=e.element,this.viewProps=e.viewProps;const t=new zy({blade:e.root?void 0:e.blade,viewProps:e.viewProps});t.emitter.on("add",this.onRackAdd_),t.emitter.on("remove",this.onRackRemove_),this.rack=t,this.viewProps.handleDispose((()=>{for(let e=this.rack.children.length-1;e>=0;e--){this.rack.children[e].viewProps.set("disposed",!0)}}))}onRackAdd_(e){e.root&&ly(this.element,e.bladeController.view.element,e.index)}onRackRemove_(e){e.root&&cy(e.bladeController.view.element)}}function Gy(){return new ob({positions:ab([],{equals:Zw})})}class jy extends ob{constructor(e){super(e)}static create(e){const t={completed:!0,expanded:e,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},n=ob.createCore(t);return new jy(n)}get styleExpanded(){var e;return null!==(e=this.get("temporaryExpanded"))&&void 0!==e?e:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const e=this.get("expandedHeight");return this.get("shouldFixHeight")&&!Kw(e)?`${e}px`:"auto"}bindExpandedClass(e,t){const n=()=>{this.styleExpanded?e.classList.add(t):e.classList.remove(t)};py(this,"expanded",n),py(this,"temporaryExpanded",n)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function Wy(e,t){t.style.height=e.styleHeight}function qy(e,t){e.value("expanded").emitter.on("beforechange",(()=>{if(e.set("completed",!1),Kw(e.get("expandedHeight"))){const n=function(e,t){let n=0;return function(e,t){const n=e.style.transition;e.style.transition="none",t(),e.style.transition=n}(t,(()=>{e.set("expandedHeight",null),e.set("temporaryExpanded",!0),sy(t),n=t.clientHeight,e.set("temporaryExpanded",null),sy(t)})),n}(e,t);n>0&&e.set("expandedHeight",n)}e.set("shouldFixHeight",!0),sy(t)})),e.emitter.on("change",(()=>{Wy(e,t)})),Wy(e,t),t.addEventListener("transitionend",(t=>{"height"===t.propertyName&&e.cleanUpTransition()}))}class Xy extends Ny{constructor(e,t){super(e,t),this.emitter_=new nb,this.controller.foldable.value("expanded").emitter.on("change",(e=>{this.emitter_.emit("fold",new qb(this,e.sender.rawValue))})),this.rackApi_.on("change",(e=>{this.emitter_.emit("change",e)}))}get expanded(){return this.controller.foldable.get("expanded")}set expanded(e){this.controller.foldable.set("expanded",e)}get title(){return this.controller.props.get("title")}set title(e){this.controller.props.set("title",e)}get children(){return this.rackApi_.children}addBinding(e,t,n){return this.rackApi_.addBinding(e,t,n)}addFolder(e){return this.rackApi_.addFolder(e)}addButton(e){return this.rackApi_.addButton(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){return this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBlade(e){return this.rackApi_.addBlade(e)}on(e,t){const n=t.bind(this);return this.emitter_.on(e,(e=>{n(e)})),this}refresh(){this.rackApi_.refresh()}}const Ky=fy("cnt");class Yy{constructor(e,t){var n;this.className_=fy(null!==(n=t.viewName)&&void 0!==n?n:"fld"),this.element=e.createElement("div"),this.element.classList.add(this.className_(),Ky()),t.viewProps.bindClassModifiers(this.element),this.foldable_=t.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),py(this.foldable_,"completed",Ty(this.element,this.className_(void 0,"cpl")));const i=e.createElement("button");i.classList.add(this.className_("b")),py(t.props,"title",(e=>{Kw(e)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))})),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const s=e.createElement("div");s.classList.add(this.className_("i")),this.element.appendChild(s);const r=e.createElement("div");r.classList.add(this.className_("t")),Py(t.props.value("title"),r),this.buttonElement.appendChild(r),this.titleElement=r;const a=e.createElement("div");a.classList.add(this.className_("m")),this.buttonElement.appendChild(a);const o=e.createElement("div");o.classList.add(this.className_("c")),this.element.appendChild(o),this.containerElement=o}}class $y extends Uy{constructor(e,t){var n;const i=jy.create(null===(n=t.expanded)||void 0===n||n),s=new Yy(e,{foldable:i,props:t.props,viewName:t.root?"rot":void 0,viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:new Hy({blade:t.blade,element:s.containerElement,root:t.root,viewProps:t.viewProps}),view:s})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=t.props,this.foldable=i,qy(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",(()=>{this.foldable.cleanUpTransition()})),this.rackController.rack.emitter.on("remove",(()=>{this.foldable.cleanUpTransition()})),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}importState(e){return Qb(e,(e=>super.importState(e)),(e=>({expanded:e.required.boolean,title:e.optional.string})),(e=>(this.foldable.set("expanded",e.expanded),this.props.set("title",e.title),!0)))}exportState(){return ey((()=>super.exportState()),{expanded:this.foldable.get("expanded"),title:this.props.get("title")})}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}ky({id:"folder",type:"blade",accept(e){const t=Jb(e,(e=>({title:e.required.string,view:e.required.constant("folder"),expanded:e.optional.boolean})));return t?{params:t}:null},controller:e=>new $y(e.document,{blade:e.blade,expanded:e.params.expanded,props:ob.fromObject({title:e.params.title}),viewProps:e.viewProps}),api:e=>e.controller instanceof $y?new Xy(e.controller,e.pool):null});const Zy=fy("");function Jy(e,t){return Ty(e,Zy(void 0,t))}class Qy extends ob{constructor(e){var t,n;super(e),this.onDisabledChange_=this.onDisabledChange_.bind(this),this.onParentChange_=this.onParentChange_.bind(this),this.onParentGlobalDisabledChange_=this.onParentGlobalDisabledChange_.bind(this),[this.globalDisabled_,this.setGlobalDisabled_]=(n=ab(this.getGlobalDisabled_()),[new rb(n),(e,t)=>{n.setRawValue(e,t)}]),this.value("disabled").emitter.on("change",this.onDisabledChange_),this.value("parent").emitter.on("change",this.onParentChange_),null===(t=this.get("parent"))||void 0===t||t.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_)}static create(e){var t,n,i;const s=null!=e?e:{};return new Qy(ob.createCore({disabled:null!==(t=s.disabled)&&void 0!==t&&t,disposed:!1,hidden:null!==(n=s.hidden)&&void 0!==n&&n,parent:null!==(i=s.parent)&&void 0!==i?i:null}))}get globalDisabled(){return this.globalDisabled_}bindClassModifiers(e){dy(this.globalDisabled_,Jy(e,"disabled")),py(this,"hidden",Jy(e,"hidden"))}bindDisabled(e){dy(this.globalDisabled_,(t=>{e.disabled=t}))}bindTabIndex(e){dy(this.globalDisabled_,(t=>{e.tabIndex=t?-1:0}))}handleDispose(e){this.value("disposed").emitter.on("change",(t=>{t&&e()}))}importState(e){this.set("disabled",e.disabled),this.set("hidden",e.hidden)}exportState(){return{disabled:this.get("disabled"),hidden:this.get("hidden")}}getGlobalDisabled_(){const e=this.get("parent");return!!e&&e.globalDisabled.rawValue||this.get("disabled")}updateGlobalDisabled_(){this.setGlobalDisabled_(this.getGlobalDisabled_())}onDisabledChange_(){this.updateGlobalDisabled_()}onParentGlobalDisabledChange_(){this.updateGlobalDisabled_()}onParentChange_(e){var t;const n=e.previousRawValue;null==n||n.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),null===(t=this.get("parent"))||void 0===t||t.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}}const ex=fy("tbp");class tx{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(ex()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(ex("c")),this.element.appendChild(n),this.containerElement=n}}const nx=fy("tbi");class ix{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(nx()),t.viewProps.bindClassModifiers(this.element),py(t.props,"selected",(e=>{e?this.element.classList.add(nx(void 0,"sel")):this.element.classList.remove(nx(void 0,"sel"))}));const n=e.createElement("button");n.classList.add(nx("b")),t.viewProps.bindDisabled(n),this.element.appendChild(n),this.buttonElement=n;const i=e.createElement("div");i.classList.add(nx("t")),Py(t.props.value("title"),i),this.buttonElement.appendChild(i),this.titleElement=i}}class sx{constructor(e,t){this.emitter=new nb,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new ix(e,{props:t.props,viewProps:t.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class rx extends Uy{constructor(e,t){const n=new tx(e,{viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:new Hy({blade:t.blade,element:n.containerElement,viewProps:t.viewProps}),view:n})),this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new sx(e,{props:t.itemProps,viewProps:Qy.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.props=t.props,py(this.props,"selected",(e=>{this.itemController.props.set("selected",e),this.viewProps.set("hidden",!e)}))}get itemController(){return this.ic_}importState(e){return Qb(e,(e=>super.importState(e)),(e=>({selected:e.required.boolean,title:e.required.string})),(e=>(this.ic_.props.set("selected",e.selected),this.ic_.props.set("title",e.title),!0)))}exportState(){return ey((()=>super.exportState()),{selected:this.ic_.props.get("selected"),title:this.ic_.props.get("title")})}onItemClick_(){this.props.set("selected",!0)}}class ax extends Ny{constructor(e,t){super(e,t),this.emitter_=new nb,this.onSelect_=this.onSelect_.bind(this),this.pool_=t,this.rackApi_.on("change",(e=>{this.emitter_.emit("change",e)})),this.controller.tab.selectedIndex.emitter.on("change",this.onSelect_)}get pages(){return this.rackApi_.children}addPage(e){const t=this.controller.view.element.ownerDocument,n=new rx(t,{blade:Gy(),itemProps:ob.fromObject({selected:!1,title:e.title}),props:ob.fromObject({selected:!1}),viewProps:Qy.create()}),i=this.pool_.createApi(n);return this.rackApi_.add(i,e.index)}removePage(e){this.rackApi_.remove(this.rackApi_.children[e])}on(e,t){const n=t.bind(this);return this.emitter_.on(e,(e=>{n(e)})),this}onSelect_(e){this.emitter_.emit("select",new Xb(this,e.rawValue))}}class ox extends Ny{get title(){var e;return null!==(e=this.controller.itemController.props.get("title"))&&void 0!==e?e:""}set title(e){this.controller.itemController.props.set("title",e)}get selected(){return this.controller.props.get("selected")}set selected(e){this.controller.props.set("selected",e)}get children(){return this.rackApi_.children}addButton(e){return this.rackApi_.addButton(e)}addFolder(e){return this.rackApi_.addFolder(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBinding(e,t,n){return this.rackApi_.addBinding(e,t,n)}addBlade(e){return this.rackApi_.addBlade(e)}refresh(){this.rackApi_.refresh()}}class lx{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=ab(!0),this.selectedIndex=ab(-1),this.items_=[]}add(e,t){const n=null!=t?t:this.items_.length;this.items_.splice(n,0,e),e.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(e){const t=this.items_.indexOf(e);t<0||(this.items_.splice(t,1),e.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(0===this.items_.length)return this.selectedIndex.rawValue=-1,void(this.empty.rawValue=!0);const e=this.items_.findIndex((e=>e.rawValue));e<0?(this.items_.forEach(((e,t)=>{e.rawValue=0===t})),this.selectedIndex.rawValue=0):(this.items_.forEach(((t,n)=>{t.rawValue=n===e})),this.selectedIndex.rawValue=e),this.empty.rawValue=!1}onItemSelectedChange_(e){if(e.rawValue){const t=this.items_.findIndex((t=>t===e.sender));this.items_.forEach(((e,n)=>{e.rawValue=n===t})),this.selectedIndex.rawValue=t}else this.keepSelection_()}}const cx=fy("tab");class hx{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(cx(),Ky()),t.viewProps.bindClassModifiers(this.element),dy(t.empty,Ty(this.element,cx(void 0,"nop")));const n=e.createElement("div");n.classList.add(cx("t")),this.element.appendChild(n),this.itemsElement=n;const i=e.createElement("div");i.classList.add(cx("i")),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(cx("c")),this.element.appendChild(s),this.contentsElement=s}}class ux extends Uy{constructor(e,t){const n=new lx,i=new hx(e,{empty:n.empty,viewProps:t.viewProps});super({blade:t.blade,rackController:new Hy({blade:t.blade,element:i.contentsElement,viewProps:t.viewProps}),view:i}),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const s=this.rackController.rack;s.emitter.on("add",this.onRackAdd_),s.emitter.on("remove",this.onRackRemove_),this.tab=n}add(e,t){this.rackController.rack.add(e,t)}remove(e){this.rackController.rack.remove(this.rackController.rack.children[e])}onRackAdd_(e){if(!e.root)return;const t=e.bladeController;ly(this.view.itemsElement,t.itemController.view.element,e.index),t.itemController.viewProps.set("parent",this.viewProps),this.tab.add(t.props.value("selected"))}onRackRemove_(e){if(!e.root)return;const t=e.bladeController;cy(t.itemController.view.element),t.itemController.viewProps.set("parent",null),this.tab.remove(t.props.value("selected"))}}ky({id:"tab",type:"blade",accept(e){const t=Jb(e,(e=>({pages:e.required.array(e.required.object({title:e.required.string})),view:e.required.constant("tab")})));return t&&0!==t.pages.length?{params:t}:null},controller(e){const t=new ux(e.document,{blade:e.blade,viewProps:e.viewProps});return e.params.pages.forEach((n=>{const i=new rx(e.document,{blade:Gy(),itemProps:ob.fromObject({selected:!1,title:n.title}),props:ob.fromObject({selected:!1}),viewProps:Qy.create()});t.add(i)})),t},api:e=>e.controller instanceof ux?new ax(e.controller,e.pool):e.controller instanceof rx?new ox(e.controller,e.pool):null});class dx extends Kb{get options(){return this.controller.valueController.props.get("options")}set options(e){this.controller.valueController.props.set("options",e)}}class px{constructor(){this.disabled=!1,this.emitter=new nb}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class mx{constructor(e,t){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=e,this.emitter=new nb,this.interval_=t,this.setTimer_()}get disabled(){return this.disabled_}set disabled(e){this.disabled_=e,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(null===this.timerId_)return;const e=this.doc_.defaultView;e&&e.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const e=this.doc_.defaultView;e&&(this.timerId_=e.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class fx{constructor(e){this.constraints=e}constrain(e){return this.constraints.reduce(((e,t)=>t.constrain(e)),e)}}function vx(e,t){if(e instanceof t)return e;if(e instanceof fx){const n=e.constraints.reduce(((e,n)=>e||(n instanceof t?n:null)),null);if(n)return n}return null}class gx{constructor(e){this.values=ob.fromObject({options:e})}constrain(e){const t=this.values.get("options");if(0===t.length)return e;return t.filter((t=>t.value===e)).length>0?e:t[0].value}}function _x(e){var t;const n=Zb;return Array.isArray(e)?null===(t=Jb({items:e},(e=>({items:e.required.array(e.required.object({text:e.required.string,value:e.required.raw}))}))))||void 0===t?void 0:t.items:"object"==typeof e?n.required.raw(e).value:void 0}function wx(e){if(Array.isArray(e))return e;const t=[];return Object.keys(e).forEach((n=>{t.push({text:n,value:e[n]})})),t}function bx(e){return Kw(e)?null:new gx(wx(e))}const yx=fy("lst");class xx{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.element=e.createElement("div"),this.element.classList.add(yx()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("select");n.classList.add(yx("s")),t.viewProps.bindDisabled(n),this.element.appendChild(n),this.selectElement=n;const i=e.createElement("div");i.classList.add(yx("m")),i.appendChild(oy(e,"dropdown")),this.element.appendChild(i),t.value.emitter.on("change",this.onValueChange_),this.value_=t.value,py(this.props_,"options",(t=>{hy(this.selectElement),t.forEach((t=>{const n=e.createElement("option");n.textContent=t.text,this.selectElement.appendChild(n)})),this.update_()}))}update_(){const e=this.props_.get("options").map((e=>e.value));this.selectElement.selectedIndex=e.indexOf(this.value_.rawValue)}onValueChange_(){this.update_()}}class Mx{constructor(e,t){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new xx(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(e){const t=e.currentTarget;this.value.rawValue=this.props.get("options")[t.selectedIndex].value}importProps(e){return Qb(e,null,(e=>({options:e.required.custom(_x)})),(e=>(this.props.set("options",wx(e.options)),!0)))}exportProps(){return ey(null,{options:this.props.get("options")})}}const Ex=fy("pop");class Sx{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Ex()),t.viewProps.bindClassModifiers(this.element),dy(t.shows,Ty(this.element,Ex(void 0,"v")))}}class Cx{constructor(e,t){this.shows=ab(!1),this.viewProps=t.viewProps,this.view=new Sx(e,{shows:this.shows,viewProps:this.viewProps})}}const Tx=fy("txt");class Px{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(Tx()),t.viewProps.bindClassModifiers(this.element),this.props_=t.props,this.props_.emitter.on("change",this.onChange_);const n=e.createElement("input");n.classList.add(Tx("i")),n.type="text",t.viewProps.bindDisabled(n),this.element.appendChild(n),this.inputElement=n,t.value.emitter.on("change",this.onChange_),this.value_=t.value,this.refresh()}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value_.rawValue)}onChange_(){this.refresh()}}class Ax{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=t.parser,this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new Px(e,{props:t.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const t=e.currentTarget.value,n=this.parser_(t);Kw(n)||(this.value.rawValue=n),this.view.refresh()}}function Lx(e){return"false"!==e&&!!e}function Rx(e){return function(e){return String(e)}(e)}const Dx=Lb(0);function Ix(e){return Dx(e)+"%"}function kx(e){return String(e)}function Ox(e){return e}function Nx({primary:e,secondary:t,forward:n,backward:i}){let s=!1;function r(e){s||(s=!0,e(),s=!1)}e.emitter.on("change",(i=>{r((()=>{t.setRawValue(n(e.rawValue,t.rawValue),i.options)}))})),t.emitter.on("change",(s=>{r((()=>{e.setRawValue(i(e.rawValue,t.rawValue),s.options)})),r((()=>{t.setRawValue(n(e.rawValue,t.rawValue),s.options)}))})),r((()=>{t.setRawValue(n(e.rawValue,t.rawValue),{forceEmit:!1,last:!0})}))}function Ux(e,t){const n=e*(t.altKey?.1:1)*(t.shiftKey?10:1);return t.upKey?+n:t.downKey?-n:0}function Vx(e){return{altKey:e.altKey,downKey:"ArrowDown"===e.key,shiftKey:e.shiftKey,upKey:"ArrowUp"===e.key}}function Bx(e){return{altKey:e.altKey,downKey:"ArrowLeft"===e.key,shiftKey:e.shiftKey,upKey:"ArrowRight"===e.key}}function Fx(e){return function(e){return"ArrowUp"===e||"ArrowDown"===e}(e)||"ArrowLeft"===e||"ArrowRight"===e}function zx(e,t){var n,i;const s=t.ownerDocument.defaultView,r=t.getBoundingClientRect();return{x:e.pageX-((null!==(n=s&&s.scrollX)&&void 0!==n?n:0)+r.left),y:e.pageY-((null!==(i=s&&s.scrollY)&&void 0!==i?i:0)+r.top)}}class Hx{constructor(e){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=e,this.emitter=new nb,e.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),e.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),e.addEventListener("touchend",this.onTouchEnd_),e.addEventListener("mousedown",this.onMouseDown_)}computePosition_(e){const t=this.elem_.getBoundingClientRect();return{bounds:{width:t.width,height:t.height},point:e?{x:e.x,y:e.y}:null}}onMouseDown_(e){var t;e.preventDefault(),null===(t=e.currentTarget)||void 0===t||t.focus();const n=this.elem_.ownerDocument;n.addEventListener("mousemove",this.onDocumentMouseMove_),n.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(zx(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseMove_(e){this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(zx(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseUp_(e){const t=this.elem_.ownerDocument;t.removeEventListener("mousemove",this.onDocumentMouseMove_),t.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(zx(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onTouchStart_(e){e.preventDefault();const t=e.targetTouches.item(0),n=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-n.left,y:t.clientY-n.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchMove_(e){const t=e.targetTouches.item(0),n=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-n.left,y:t.clientY-n.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchEnd_(e){var t;const n=null!==(t=e.targetTouches.item(0))&&void 0!==t?t:this.lastTouch_,i=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(n?{x:n.clientX-i.left,y:n.clientY-i.top}:void 0),sender:this,shiftKey:e.shiftKey})}}const Gx=fy("txt");class jx{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(Gx(),Gx(void 0,"num")),t.arrayPosition&&this.element.classList.add(Gx(void 0,t.arrayPosition)),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("input");n.classList.add(Gx("i")),n.type="text",t.viewProps.bindDisabled(n),this.element.appendChild(n),this.inputElement=n,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=t.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(Gx()),this.inputElement.classList.add(Gx("i"));const i=e.createElement("div");i.classList.add(Gx("k")),this.element.appendChild(i),this.knobElement=i;const s=e.createElementNS(iy,"svg");s.classList.add(Gx("g")),this.knobElement.appendChild(s);const r=e.createElementNS(iy,"path");r.classList.add(Gx("gb")),s.appendChild(r),this.guideBodyElem_=r;const a=e.createElementNS(iy,"path");a.classList.add(Gx("gh")),s.appendChild(a),this.guideHeadElem_=a;const o=e.createElement("div");o.classList.add(fy("tt")()),this.knobElement.appendChild(o),this.tooltipElem_=o,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.refresh()}onDraggingChange_(e){if(null===e.rawValue)return void this.element.classList.remove(Gx(void 0,"drg"));this.element.classList.add(Gx(void 0,"drg"));const t=e.rawValue/this.props_.get("pointerScale"),n=t+(t>0?-1:t<0?1:0),i=Ib(-n,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${n+i},0 L${n},4 L${n+i},8`,`M ${t},-1 L${t},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${t},4`);const s=this.props_.get("formatter");this.tooltipElem_.textContent=s(this.value.rawValue),this.tooltipElem_.style.left=`${t}px`}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value.rawValue)}onChange_(){this.refresh()}}class Wx{constructor(e,t){var n;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.parser_=t.parser,this.props=t.props,this.sliderProps_=null!==(n=t.sliderProps)&&void 0!==n?n:null,this.value=t.value,this.viewProps=t.viewProps,this.dragging_=ab(null),this.view=new jx(e,{arrayPosition:t.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const i=new Hx(this.view.knobElement);i.emitter.on("down",this.onPointerDown_),i.emitter.on("move",this.onPointerMove_),i.emitter.on("up",this.onPointerUp_)}constrainValue_(e){var t,n;const i=null===(t=this.sliderProps_)||void 0===t?void 0:t.get("min"),s=null===(n=this.sliderProps_)||void 0===n?void 0:n.get("max");let r=e;return void 0!==i&&(r=Math.max(r,i)),void 0!==s&&(r=Math.min(r,s)),r}onInputChange_(e){const t=e.currentTarget.value,n=this.parser_(t);Kw(n)||(this.value.rawValue=this.constrainValue_(n)),this.view.refresh()}onInputKeyDown_(e){const t=Ux(this.props.get("keyScale"),Vx(e));0!==t&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+t),{forceEmit:!1,last:!1})}onInputKeyUp_(e){0!==Ux(this.props.get("keyScale"),Vx(e))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(e){if(!e.point)return null;const t=e.point.x-e.bounds.width/2;return this.constrainValue_(this.originRawValue_+t*this.props.get("pointerScale"))}onPointerMove_(e){const t=this.computeDraggingValue_(e.data);null!==t&&(this.value.setRawValue(t,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(e){const t=this.computeDraggingValue_(e.data);null!==t&&(this.value.setRawValue(t,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}const qx=fy("sld");class Xx{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(qx()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(qx("t")),t.viewProps.bindTabIndex(n),this.element.appendChild(n),this.trackElement=n;const i=e.createElement("div");i.classList.add(qx("k")),this.trackElement.appendChild(i),this.knobElement=i,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.update_()}update_(){const e=Ib(Rb(this.value.rawValue,this.props_.get("min"),this.props_.get("max"),0,100),0,100);this.knobElement.style.width=`${e}%`}onChange_(){this.update_()}}class Kx{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.props=t.props,this.view=new Xx(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Hx(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){e.point&&this.value.setRawValue(Rb(Ib(e.point.x,0,e.bounds.width),0,e.bounds.width,this.props.get("min"),this.props.get("max")),t)}onPointerDownOrMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=Ux(this.props.get("keyScale"),Bx(e));0!==t&&this.value.setRawValue(this.value.rawValue+t,{forceEmit:!1,last:!1})}onKeyUp_(e){0!==Ux(this.props.get("keyScale"),Bx(e))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Yx=fy("sldtxt");class $x{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Yx());const n=e.createElement("div");n.classList.add(Yx("s")),this.sliderView_=t.sliderView,n.appendChild(this.sliderView_.element),this.element.appendChild(n);const i=e.createElement("div");i.classList.add(Yx("t")),this.textView_=t.textView,i.appendChild(this.textView_.element),this.element.appendChild(i)}}class Zx{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.sliderC_=new Kx(e,{props:t.sliderProps,value:t.value,viewProps:this.viewProps}),this.textC_=new Wx(e,{parser:t.parser,props:t.textProps,sliderProps:t.sliderProps,value:t.value,viewProps:t.viewProps}),this.view=new $x(e,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}importProps(e){return Qb(e,null,(e=>({max:e.required.number,min:e.required.number})),(e=>{const t=this.sliderC_.props;return t.set("max",e.max),t.set("min",e.min),!0}))}exportProps(){const e=this.sliderC_.props;return ey(null,{max:e.get("max"),min:e.get("min")})}}const Jx={containerUnitSize:"cnt-usz"};function Qx(e){return`--${Jx[e]}`}class eM{constructor(e,t){const n=fy(t.viewName);this.element=e.createElement("div"),this.element.classList.add(n()),t.viewProps.bindClassModifiers(this.element)}}function tM(e){return zb(e)}function nM(e){if($w(e))return Jb(e,tM)}function iM(e,t){if(!e)return;const n=[],i=Vb(e,t);i&&n.push(i);const s=Bb(e);return s&&n.push(s),new fx(n)}function sM(e){if("inline"===e||"popup"===e)return e}function rM(e,t){e.write(t)}const aM=fy("ckb");class oM{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(aM()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("label");n.classList.add(aM("l")),this.element.appendChild(n);const i=e.createElement("input");i.classList.add(aM("i")),i.type="checkbox",n.appendChild(i),this.inputElement=i,t.viewProps.bindDisabled(this.inputElement);const s=e.createElement("div");s.classList.add(aM("w")),n.appendChild(s);const r=oy(e,"check");s.appendChild(r),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class lM{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new oM(e,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const t=e.currentTarget;this.value.rawValue=t.checked}}ky({id:"input-bool",type:"input",accept:(e,t)=>{if("boolean"!=typeof e)return null;const n=Jb(t,(e=>({options:e.optional.custom(_x),readonly:e.optional.constant(!1)})));return n?{initialValue:e,params:n}:null},binding:{reader:e=>Lx,constraint:e=>function(e){const t=[],n=bx(e.options);return n&&t.push(n),new fx(t)}(e.params),writer:e=>rM},controller:e=>{const t=e.document,n=e.value,i=e.constraint,s=i&&vx(i,gx);return s?new Mx(t,{props:new ob({options:s.values.value("options")}),value:n,viewProps:e.viewProps}):new lM(t,{value:n,viewProps:e.viewProps})},api:e=>"boolean"!=typeof e.controller.value.rawValue?null:e.controller.valueController instanceof Mx?new dx(e.controller):null});const cM=fy("col");class hM{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(cM()),t.foldable.bindExpandedClass(this.element,cM(void 0,"expanded")),py(t.foldable,"completed",Ty(this.element,cM(void 0,"cpl")));const n=e.createElement("div");n.classList.add(cM("h")),this.element.appendChild(n);const i=e.createElement("div");i.classList.add(cM("s")),n.appendChild(i),this.swatchElement=i;const s=e.createElement("div");if(s.classList.add(cM("t")),n.appendChild(s),this.textElement=s,"inline"===t.pickerLayout){const t=e.createElement("div");t.classList.add(cM("p")),this.element.appendChild(t),this.pickerElement=t}else this.pickerElement=null}}function uM(e,t,n){const i=kb(e,360),s=Ib(t/100,0,1),r=Ib(n/100,0,1),a=r*s,o=a*(1-Math.abs(i/60%2-1)),l=r-a;let c,h,u;return[c,h,u]=i>=0&&i<60?[a,o,0]:i>=60&&i<120?[o,a,0]:i>=120&&i<180?[0,a,o]:i>=180&&i<240?[0,o,a]:i>=240&&i<300?[o,0,a]:[a,0,o],[255*(c+l),255*(h+l),255*(u+l)]}function dM(e){return[e[0],e[1],e[2]]}function pM(e,t){return[e[0],e[1],e[2],t]}const mM={hsl:{hsl:(e,t,n)=>[e,t,n],hsv:function(e,t,n){const i=n+t*(100-Math.abs(2*n-100))/200;return[e,0!==i?t*(100-Math.abs(2*n-100))/i:0,n+t*(100-Math.abs(2*n-100))/200]},rgb:function(e,t,n){const i=(e%360+360)%360,s=Ib(t/100,0,1),r=Ib(n/100,0,1),a=(1-Math.abs(2*r-1))*s,o=a*(1-Math.abs(i/60%2-1)),l=r-a/2;let c,h,u;return[c,h,u]=i>=0&&i<60?[a,o,0]:i>=60&&i<120?[o,a,0]:i>=120&&i<180?[0,a,o]:i>=180&&i<240?[0,o,a]:i>=240&&i<300?[o,0,a]:[a,0,o],[255*(c+l),255*(h+l),255*(u+l)]}},hsv:{hsl:function(e,t,n){const i=100-Math.abs(n*(200-t)/100-100);return[e,0!==i?t*n/i:0,n*(200-t)/200]},hsv:(e,t,n)=>[e,t,n],rgb:uM},rgb:{hsl:function(e,t,n){const i=Ib(e/255,0,1),s=Ib(t/255,0,1),r=Ib(n/255,0,1),a=Math.max(i,s,r),o=Math.min(i,s,r),l=a-o;let c=0,h=0;const u=(o+a)/2;return 0!==l&&(h=l/(1-Math.abs(a+o-1)),c=i===a?(s-r)/l:s===a?2+(r-i)/l:4+(i-s)/l,c=c/6+(c<0?1:0)),[360*c,100*h,100*u]},hsv:function(e,t,n){const i=Ib(e/255,0,1),s=Ib(t/255,0,1),r=Ib(n/255,0,1),a=Math.max(i,s,r),o=a-Math.min(i,s,r);let l;return l=0===o?0:a===i?((s-r)/o%6+6)%6*60:a===s?60*((r-i)/o+2):60*((i-s)/o+4),[l,100*(0===a?0:o/a),100*a]},rgb:(e,t,n)=>[e,t,n]}};function fM(e,t){return["float"===t?1:"rgb"===e?255:360,"float"===t?1:"rgb"===e?255:100,"float"===t?1:"rgb"===e?255:100]}function vM(e,t,n){var i;const s=fM(t,n);return["rgb"===t?Ib(e[0],0,s[0]):(r=e[0],a=s[0],r===a?a:kb(r,a)),Ib(e[1],0,s[1]),Ib(e[2],0,s[2]),Ib(null!==(i=e[3])&&void 0!==i?i:1,0,1)];var r,a}function gM(e,t,n,i){const s=fM(t,n),r=fM(t,i);return e.map(((e,t)=>e/s[t]*r[t]))}function _M(e,t,n){const i=gM(e,t.mode,t.type,"int");return gM(mM[t.mode][n.mode](...i),n.mode,"int",n.type)}class wM{static black(){return new wM([0,0,0],"rgb")}constructor(e,t){this.type="int",this.mode=t,this.comps_=vM(e,t,this.type)}getComponents(e){return pM(_M(dM(this.comps_),{mode:this.mode,type:this.type},{mode:null!=e?e:this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const e=this.getComponents("rgb");return{r:e[0],g:e[1],b:e[2],a:e[3]}}}const bM=fy("colp");class yM{constructor(e,t){this.alphaViews_=null,this.element=e.createElement("div"),this.element.classList.add(bM()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(bM("hsv"));const i=e.createElement("div");i.classList.add(bM("sv")),this.svPaletteView_=t.svPaletteView,i.appendChild(this.svPaletteView_.element),n.appendChild(i);const s=e.createElement("div");s.classList.add(bM("h")),this.hPaletteView_=t.hPaletteView,s.appendChild(this.hPaletteView_.element),n.appendChild(s),this.element.appendChild(n);const r=e.createElement("div");if(r.classList.add(bM("rgb")),this.textsView_=t.textsView,r.appendChild(this.textsView_.element),this.element.appendChild(r),t.alphaViews){this.alphaViews_={palette:t.alphaViews.palette,text:t.alphaViews.text};const n=e.createElement("div");n.classList.add(bM("a"));const i=e.createElement("div");i.classList.add(bM("ap")),i.appendChild(this.alphaViews_.palette.element),n.appendChild(i);const s=e.createElement("div");s.classList.add(bM("at")),s.appendChild(this.alphaViews_.text.element),n.appendChild(s),this.element.appendChild(n)}}get allFocusableElements(){const e=[this.svPaletteView_.element,this.hPaletteView_.element,this.textsView_.modeSelectElement,...this.textsView_.inputViews.map((e=>e.inputElement))];return this.alphaViews_&&e.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),e}}function xM(e){return"int"===e?"int":"float"===e?"float":void 0}function MM(e){return Jb(e,(e=>({color:e.optional.object({alpha:e.optional.boolean,type:e.optional.custom(xM)}),expanded:e.optional.boolean,picker:e.optional.custom(sM),readonly:e.optional.constant(!1)})))}function EM(e){return e?.1:1}function SM(e){var t;return null===(t=e.color)||void 0===t?void 0:t.type}class CM{constructor(e,t){this.type="float",this.mode=t,this.comps_=vM(e,t,this.type)}getComponents(e){return pM(_M(dM(this.comps_),{mode:this.mode,type:this.type},{mode:null!=e?e:this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const e=this.getComponents("rgb");return{r:e[0],g:e[1],b:e[2],a:e[3]}}}const TM={int:(e,t)=>new wM(e,t),float:(e,t)=>new CM(e,t)};function PM(e,t,n){return TM[n](e,t)}function AM(e,t){if(e.type===t)return e;if(function(e){return"int"===e.type}(e)&&"float"===t)return function(e){const t=e.getComponents(),n=fM(e.mode,"int");return new CM([Rb(t[0],0,n[0],0,1),Rb(t[1],0,n[1],0,1),Rb(t[2],0,n[2],0,1),t[3]],e.mode)}(e);if(function(e){return"float"===e.type}(e)&&"int"===t)return function(e){const t=e.getComponents(),n=fM(e.mode,"int");return new wM([Math.round(Rb(t[0],0,1,0,n[0])),Math.round(Rb(t[1],0,1,0,n[1])),Math.round(Rb(t[2],0,1,0,n[2])),t[3]],e.mode)}(e);throw eb.shouldNeverHappen()}function LM(e,t){const n=e.match(/^(.+)%$/);return n?Math.min(.01*parseFloat(n[1])*t,t):Math.min(parseFloat(e),t)}const RM={deg:e=>e,grad:e=>360*e/400,rad:e=>360*e/(2*Math.PI),turn:e=>360*e};function DM(e){const t=e.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!t)return parseFloat(e);const n=parseFloat(t[1]),i=t[2];return RM[i](n)}function IM(e){const t=e.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;const n=[LM(t[1],255),LM(t[2],255),LM(t[3],255)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])?null:n}function kM(e){const t=IM(e);return t?new wM(t,"rgb"):null}function OM(e){const t=e.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;const n=[LM(t[1],255),LM(t[2],255),LM(t[3],255),LM(t[4],1)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])||isNaN(n[3])?null:n}function NM(e){const t=OM(e);return t?new wM(t,"rgb"):null}function UM(e){const t=e.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;const n=[DM(t[1]),LM(t[2],100),LM(t[3],100)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])?null:n}function VM(e){const t=UM(e);return t?new wM(t,"hsl"):null}function BM(e){const t=e.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;const n=[DM(t[1]),LM(t[2],100),LM(t[3],100),LM(t[4],1)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])||isNaN(n[3])?null:n}function FM(e){const t=BM(e);return t?new wM(t,"hsl"):null}function zM(e){const t=e.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(t)return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)];const n=e.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return n?[parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16)]:null}function HM(e){const t=zM(e);return t?new wM(t,"rgb"):null}function GM(e){const t=e.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(t)return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16),Rb(parseInt(t[4]+t[4],16),0,255,0,1)];const n=e.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return n?[parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16),Rb(parseInt(n[4],16),0,255,0,1)]:null}function jM(e){const t=GM(e);return t?new wM(t,"rgb"):null}function WM(e){const t=e.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!t)return null;const n=[parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3])];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])?null:n}function qM(e){return t=>{const n=WM(t);return n?PM(n,"rgb",e):null}}function XM(e){const t=e.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!t)return null;const n=[parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3]),parseFloat(t[4])];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])||isNaN(n[3])?null:n}function KM(e){return t=>{const n=XM(t);return n?PM(n,"rgb",e):null}}const YM=[{parser:zM,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:GM,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:IM,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:OM,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:UM,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:BM,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:WM,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:XM,result:{alpha:!0,mode:"rgb",notation:"object"}}];function $M(e,t="int"){const n=function(e){return YM.reduce(((t,{parser:n,result:i})=>t||(n(e)?i:null)),null)}(e);return n?"hex"===n.notation&&"float"!==t?Object.assign(Object.assign({},n),{type:"int"}):"func"===n.notation?Object.assign(Object.assign({},n),{type:t}):null:null}function ZM(e){const t=[HM,jM,kM,NM,VM,FM];"int"===e&&t.push(qM("int"),KM("int")),"float"===e&&t.push(qM("float"),KM("float"));const n=function(e){return t=>e.reduce(((e,n)=>null!==e?e:n(t)),null)}(t);return t=>{const i=n(t);return i?AM(i,e):null}}function JM(e){const t=ZM("int");if("string"!=typeof e)return wM.black();const n=t(e);return null!=n?n:wM.black()}function QM(e){const t=Ib(Math.floor(e),0,255).toString(16);return 1===t.length?`0${t}`:t}function eE(e,t="#"){return`${t}${dM(e.getComponents("rgb")).map(QM).join("")}`}function tE(e,t="#"){const n=e.getComponents("rgb");return`${t}${[n[0],n[1],n[2],255*n[3]].map(QM).join("")}`}function nE(e){const t=Lb(0);return`rgb(${dM(AM(e,"int").getComponents("rgb")).map((e=>t(e))).join(", ")})`}function iE(e){const t=Lb(2),n=Lb(0);return`rgba(${AM(e,"int").getComponents("rgb").map(((e,i)=>(3===i?t:n)(e))).join(", ")})`}function sE(e,t){const n=Lb("float"===t?2:0),i=["r","g","b"];return`{${dM(AM(e,t).getComponents("rgb")).map(((e,t)=>`${i[t]}: ${n(e)}`)).join(", ")}}`}function rE(e){return t=>sE(t,e)}function aE(e,t){const n=Lb(2),i=Lb("float"===t?2:0),s=["r","g","b","a"];return`{${AM(e,t).getComponents("rgb").map(((e,t)=>`${s[t]}: ${(3===t?n:i)(e)}`)).join(", ")}}`}function oE(e){return t=>aE(t,e)}const lE=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:eE},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:tE},{format:{alpha:!1,mode:"rgb",notation:"func",type:"int"},stringifier:nE},{format:{alpha:!0,mode:"rgb",notation:"func",type:"int"},stringifier:iE},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:function(e){const t=[Lb(0),Ix,Ix];return`hsl(${dM(AM(e,"int").getComponents("hsl")).map(((e,n)=>t[n](e))).join(", ")})`}},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:function(e){const t=[Lb(0),Ix,Ix,Lb(2)];return`hsla(${AM(e,"int").getComponents("hsl").map(((e,n)=>t[n](e))).join(", ")})`}},...["int","float"].reduce(((e,t)=>[...e,{format:{alpha:!1,mode:"rgb",notation:"object",type:t},stringifier:rE(t)},{format:{alpha:!0,mode:"rgb",notation:"object",type:t},stringifier:oE(t)}]),[])];function cE(e){return lE.reduce(((t,n)=>{return t||(i=n.format,s=e,i.alpha===s.alpha&&i.mode===s.mode&&i.notation===s.notation&&i.type===s.type?n.stringifier:null);var i,s}),null)}const hE=fy("apl");class uE{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(hE()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const n=e.createElement("div");n.classList.add(hE("b")),this.element.appendChild(n);const i=e.createElement("div");i.classList.add(hE("c")),n.appendChild(i),this.colorElem_=i;const s=e.createElement("div");s.classList.add(hE("m")),this.element.appendChild(s),this.markerElem_=s;const r=e.createElement("div");r.classList.add(hE("p")),this.markerElem_.appendChild(r),this.previewElem_=r,this.update_()}update_(){const e=this.value.rawValue,t=e.getComponents("rgb"),n=new wM([t[0],t[1],t[2],0],"rgb"),i=new wM([t[0],t[1],t[2],255],"rgb"),s=["to right",iE(n),iE(i)];this.colorElem_.style.background=`linear-gradient(${s.join(",")})`,this.previewElem_.style.backgroundColor=iE(e);const r=Rb(t[3],0,1,0,100);this.markerElem_.style.left=`${r}%`}onValueChange_(){this.update_()}}class dE{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new uE(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Hx(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const n=e.point.x/e.bounds.width,i=this.value.rawValue,[s,r,a]=i.getComponents("hsv");this.value.setRawValue(new wM([s,r,a,n],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=Ux(EM(!0),Bx(e));if(0===t)return;const n=this.value.rawValue,[i,s,r,a]=n.getComponents("hsv");this.value.setRawValue(new wM([i,s,r,a+t],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){0!==Ux(EM(!0),Bx(e))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const pE=fy("coltxt");class mE{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(pE()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(pE("m")),this.modeElem_=function(e){const t=e.createElement("select");return t.appendChild([{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"},{text:"HEX",value:"hex"}].reduce(((t,n)=>{const i=e.createElement("option");return i.textContent=n.text,i.value=n.value,t.appendChild(i),t}),e.createDocumentFragment())),t}(e),this.modeElem_.classList.add(pE("ms")),n.appendChild(this.modeSelectElement),t.viewProps.bindDisabled(this.modeElem_);const i=e.createElement("div");i.classList.add(pE("mm")),i.appendChild(oy(e,"dropdown")),n.appendChild(i),this.element.appendChild(n);const s=e.createElement("div");s.classList.add(pE("w")),this.element.appendChild(s),this.inputsElem_=s,this.inputViews_=t.inputViews,this.applyInputViews_(),dy(t.mode,(e=>{this.modeElem_.value=e}))}get modeSelectElement(){return this.modeElem_}get inputViews(){return this.inputViews_}set inputViews(e){this.inputViews_=e,this.applyInputViews_()}applyInputViews_(){hy(this.inputsElem_);const e=this.element.ownerDocument;this.inputViews_.forEach((t=>{const n=e.createElement("div");n.classList.add(pE("c")),n.appendChild(t.element),this.inputsElem_.appendChild(n)}))}}function fE(e,t,n){const i=fM(e,t)[n];return new lb({min:0,max:i})}function vE(e,t){const n={colorMode:t.colorMode,colorType:t.colorType,parser:Pb,viewProps:t.viewProps};return[0,1,2].map((i=>{const s=function(e,t,n){return new Wx(e,{arrayPosition:0===n?"fst":2===n?"lst":"mid",parser:t.parser,props:ob.fromObject({formatter:(i=t.colorType,Lb("float"===i?2:0)),keyScale:EM(!1),pointerScale:"float"===t.colorType?.01:1}),value:ab(0,{constraint:fE(t.colorMode,t.colorType,n)}),viewProps:t.viewProps});var i}(e,n,i);return Nx({primary:t.value,secondary:s.value,forward:e=>AM(e,t.colorType).getComponents(t.colorMode)[i],backward(e,n){const s=t.colorMode,r=AM(e,t.colorType).getComponents(s);r[i]=n;return AM(PM(pM(dM(r),r[3]),s,t.colorType),"int")}}),s}))}class gE{constructor(e,t){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=t.colorType,this.value=t.value,this.viewProps=t.viewProps,this.colorMode=ab(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(e),this.view=new mE(e,{mode:this.colorMode,inputViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view],viewProps:this.viewProps}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(e){const t=this.colorMode.rawValue;return function(e){return"hex"!==e}(t)?vE(e,{colorMode:t,colorType:this.colorType_,value:this.value,viewProps:this.viewProps}):function(e,t){const n=new Ax(e,{parser:ZM("int"),props:ob.fromObject({formatter:eE}),value:ab(wM.black()),viewProps:t.viewProps});return Nx({primary:t.value,secondary:n.value,forward:e=>new wM(dM(e.getComponents()),e.mode),backward:(e,t)=>new wM(pM(dM(t.getComponents(e.mode)),e.getComponents()[3]),e.mode)}),[n]}(e,{value:this.value,viewProps:this.viewProps})}onModeSelectChange_(e){const t=e.currentTarget;this.colorMode.rawValue=t.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.inputViews=this.ccs_.map((e=>e.view))}}const _E=fy("hpl");class wE{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(_E()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const n=e.createElement("div");n.classList.add(_E("c")),this.element.appendChild(n);const i=e.createElement("div");i.classList.add(_E("m")),this.element.appendChild(i),this.markerElem_=i,this.update_()}update_(){const e=this.value.rawValue,[t]=e.getComponents("hsv");this.markerElem_.style.backgroundColor=nE(new wM([t,100,100],"hsv"));const n=Rb(t,0,360,0,100);this.markerElem_.style.left=`${n}%`}onValueChange_(){this.update_()}}class bE{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new wE(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Hx(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const n=Rb(Ib(e.point.x,0,e.bounds.width),0,e.bounds.width,0,360),i=this.value.rawValue,[,s,r,a]=i.getComponents("hsv");this.value.setRawValue(new wM([n,s,r,a],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=Ux(EM(!1),Bx(e));if(0===t)return;const n=this.value.rawValue,[i,s,r,a]=n.getComponents("hsv");this.value.setRawValue(new wM([i+t,s,r,a],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){0!==Ux(EM(!1),Bx(e))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const yE=fy("svp");class xE{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(yE()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const n=e.createElement("canvas");n.height=64,n.width=64,n.classList.add(yE("c")),this.element.appendChild(n),this.canvasElement=n;const i=e.createElement("div");i.classList.add(yE("m")),this.element.appendChild(i),this.markerElem_=i,this.update_()}update_(){const e=function(e){const t=e.ownerDocument.defaultView;return t&&"document"in t?e.getContext("2d",{willReadFrequently:!0}):null}(this.canvasElement);if(!e)return;const t=this.value.rawValue.getComponents("hsv"),n=this.canvasElement.width,i=this.canvasElement.height,s=e.getImageData(0,0,n,i),r=s.data;for(let e=0;e<i;e++)for(let s=0;s<n;s++){const a=Rb(s,0,n,0,100),o=Rb(e,0,i,100,0),l=uM(t[0],a,o),c=4*(e*n+s);r[c]=l[0],r[c+1]=l[1],r[c+2]=l[2],r[c+3]=255}e.putImageData(s,0,0);const a=Rb(t[1],0,100,0,100);this.markerElem_.style.left=`${a}%`;const o=Rb(t[2],0,100,100,0);this.markerElem_.style.top=`${o}%`}onValueChange_(){this.update_()}}class ME{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new xE(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Hx(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const n=Rb(e.point.x,0,e.bounds.width,0,100),i=Rb(e.point.y,0,e.bounds.height,100,0),[s,,,r]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new wM([s,n,i,r],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){Fx(e.key)&&e.preventDefault();const[t,n,i,s]=this.value.rawValue.getComponents("hsv"),r=EM(!1),a=Ux(r,Bx(e)),o=Ux(r,Vx(e));0===a&&0===o||this.value.setRawValue(new wM([t,n+a,i+o,s],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){const t=EM(!1),n=Ux(t,Bx(e)),i=Ux(t,Vx(e));0===n&&0===i||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class EE{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.hPaletteC_=new bE(e,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new ME(e,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=t.supportsAlpha?{palette:new dE(e,{value:this.value,viewProps:this.viewProps}),text:new Wx(e,{parser:Pb,props:ob.fromObject({pointerScale:.01,keyScale:.1,formatter:Lb(2)}),value:ab(0,{constraint:new lb({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&Nx({primary:this.value,secondary:this.alphaIcs_.text.value,forward:e=>e.getComponents()[3],backward:(e,t)=>{const n=e.getComponents();return n[3]=t,new wM(n,e.mode)}}),this.textsC_=new gE(e,{colorType:t.colorType,value:this.value,viewProps:this.viewProps}),this.view=new yM(e,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:t.supportsAlpha,svPaletteView:this.svPaletteC_.view,textsView:this.textsC_.view,viewProps:this.viewProps})}get textsController(){return this.textsC_}}const SE=fy("colsw");class CE{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.element=e.createElement("div"),this.element.classList.add(SE()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(SE("sw")),this.element.appendChild(n),this.swatchElem_=n;const i=e.createElement("button");i.classList.add(SE("b")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i,this.update_()}update_(){const e=this.value.rawValue;this.swatchElem_.style.backgroundColor=tE(e)}onValueChange_(){this.update_()}}class TE{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new CE(e,{value:this.value,viewProps:this.viewProps})}}class PE{constructor(e,t){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=jy.create(t.expanded),this.swatchC_=new TE(e,{value:this.value,viewProps:this.viewProps});const n=this.swatchC_.view.buttonElement;n.addEventListener("blur",this.onButtonBlur_),n.addEventListener("click",this.onButtonClick_),this.textC_=new Ax(e,{parser:t.parser,props:ob.fromObject({formatter:t.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new hM(e,{foldable:this.foldable_,pickerLayout:t.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_="popup"===t.pickerLayout?new Cx(e,{viewProps:this.viewProps}):null;const i=new EE(e,{colorType:t.colorType,supportsAlpha:t.supportsAlpha,value:this.value,viewProps:this.viewProps});i.view.allFocusableElements.forEach((e=>{e.addEventListener("blur",this.onPopupChildBlur_),e.addEventListener("keydown",this.onPopupChildKeydown_)})),this.pickerC_=i,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(i.view.element),Nx({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:e=>e,backward:(e,t)=>t})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),qy(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,n=e.relatedTarget;n&&t.contains(n)||(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,n=uy(e);n&&t.contains(n)||n&&n===this.swatchC_.view.buttonElement&&!ry(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?"Escape"===e.key&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&"Escape"===e.key&&this.swatchC_.view.buttonElement.focus()}}function AE(e){return dM(e.getComponents("rgb")).reduce(((e,t)=>e<<8|255&Math.floor(t)),0)}function LE(e){return e.getComponents("rgb").reduce(((e,t,n)=>e<<8|255&Math.floor(3===n?255*t:t)),0)>>>0}function RE(e){return"number"!=typeof e?wM.black():new wM([(t=e)>>16&255,t>>8&255,255&t],"rgb");var t}function DE(e){return"number"!=typeof e?wM.black():new wM([(t=e)>>24&255,t>>16&255,t>>8&255,Rb(255&t,0,255,0,1)],"rgb");var t}function IE(e,t){return"object"==typeof e&&!Kw(e)&&(t in e&&"number"==typeof e[t])}function kE(e){return IE(e,"r")&&IE(e,"g")&&IE(e,"b")}function OE(e){return kE(e)&&IE(e,"a")}function NE(e){return kE(e)}function UE(e,t){if(e.mode!==t.mode)return!1;if(e.type!==t.type)return!1;const n=e.getComponents(),i=t.getComponents();for(let e=0;e<n.length;e++)if(n[e]!==i[e])return!1;return!0}function VE(e){return"a"in e?[e.r,e.g,e.b,e.a]:[e.r,e.g,e.b]}function BE(e,t){return(n,i)=>{e?function(e,t,n){const i=AM(t,n).toRgbaObject();e.writeProperty("r",i.r),e.writeProperty("g",i.g),e.writeProperty("b",i.b),e.writeProperty("a",i.a)}(n,i,t):function(e,t,n){const i=AM(t,n).toRgbaObject();e.writeProperty("r",i.r),e.writeProperty("g",i.g),e.writeProperty("b",i.b)}(n,i,t)}}function FE(e){return t=>{const n=function(e,t){if(!NE(e))return AM(wM.black(),t);if("int"===t){const t=VE(e);return new wM(t,"rgb")}if("float"===t){const t=VE(e);return new CM(t,"rgb")}return AM(wM.black(),"int")}(t,e);return AM(n,"int")}}function zE(e,t){return n=>e?aE(n,t):sE(n,t)}ky({id:"input-color-number",type:"input",accept:(e,t)=>{if("number"!=typeof e)return null;if(!function(e){return"color"in e||"color"===e.view}(t))return null;const n=MM(t);return n?{initialValue:e,params:Object.assign(Object.assign({},n),{supportsAlpha:(i=t,!!(null===(s=null==i?void 0:i.color)||void 0===s?void 0:s.alpha))})}:null;var i,s},binding:{reader:e=>e.params.supportsAlpha?DE:RE,equals:UE,writer:e=>function(e){const t=e?LE:AE;return(e,n)=>{rM(e,t(n))}}(e.params.supportsAlpha)},controller:e=>{var t,n,i;return new PE(e.document,{colorType:"int",expanded:null!==(t=e.params.expanded)&&void 0!==t&&t,formatter:(i=e.params.supportsAlpha,i?e=>tE(e,"0x"):e=>eE(e,"0x")),parser:ZM("int"),pickerLayout:null!==(n=e.params.picker)&&void 0!==n?n:"popup",supportsAlpha:e.params.supportsAlpha,value:e.value,viewProps:e.viewProps})}}),ky({id:"input-color-object",type:"input",accept:(e,t)=>{var n;if(!NE(e))return null;const i=MM(t);return i?{initialValue:e,params:Object.assign(Object.assign({},i),{colorType:null!==(n=SM(t))&&void 0!==n?n:"int"})}:null},binding:{reader:e=>FE(e.params.colorType),equals:UE,writer:e=>BE(OE(e.initialValue),e.params.colorType)},controller:e=>{var t,n;const i=OE(e.initialValue);return new PE(e.document,{colorType:e.params.colorType,expanded:null!==(t=e.params.expanded)&&void 0!==t&&t,formatter:zE(i,e.params.colorType),parser:ZM("int"),pickerLayout:null!==(n=e.params.picker)&&void 0!==n?n:"popup",supportsAlpha:i,value:e.value,viewProps:e.viewProps})}}),ky({id:"input-color-string",type:"input",accept:(e,t)=>{if("string"!=typeof e)return null;if("text"===t.view)return null;const n=$M(e,SM(t));if(!n)return null;const i=cE(n);if(!i)return null;const s=MM(t);return s?{initialValue:e,params:Object.assign(Object.assign({},s),{format:n,stringifier:i})}:null},binding:{reader:()=>JM,equals:UE,writer:e=>{const t=function(e){const t=cE(e);return t?(e,n)=>{rM(e,t(n))}:null}(e.params.format);if(!t)throw eb.notBindable();return t}},controller:e=>{var t,n;return new PE(e.document,{colorType:e.params.format.type,expanded:null!==(t=e.params.expanded)&&void 0!==t&&t,formatter:e.params.stringifier,parser:ZM("int"),pickerLayout:null!==(n=e.params.picker)&&void 0!==n?n:"popup",supportsAlpha:e.params.format.alpha,value:e.value,viewProps:e.viewProps})}});class HE{constructor(e){this.components=e.components,this.asm_=e.assembly}constrain(e){const t=this.asm_.toComponents(e).map(((e,t)=>{var n,i;return null!==(i=null===(n=this.components[t])||void 0===n?void 0:n.constrain(e))&&void 0!==i?i:e}));return this.asm_.fromComponents(t)}}const GE=fy("pndtxt");class jE{constructor(e,t){this.textViews=t.textViews,this.element=e.createElement("div"),this.element.classList.add(GE()),this.textViews.forEach((t=>{const n=e.createElement("div");n.classList.add(GE("a")),n.appendChild(t.element),this.element.appendChild(n)}))}}class WE{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.acs_=t.axes.map(((n,i)=>function(e,t,n){return new Wx(e,{arrayPosition:0===n?"fst":n===t.axes.length-1?"lst":"mid",parser:t.parser,props:t.axes[n].textProps,value:ab(0,{constraint:t.axes[n].constraint}),viewProps:t.viewProps})}(e,t,i))),this.acs_.forEach(((e,n)=>{Nx({primary:this.value,secondary:e.value,forward:e=>t.assembly.toComponents(e)[n],backward:(e,i)=>{const s=t.assembly.toComponents(e);return s[n]=i,t.assembly.fromComponents(s)}})})),this.view=new jE(e,{textViews:this.acs_.map((e=>e.view))})}get textControllers(){return this.acs_}}class qE extends Kb{get max(){return this.controller.valueController.sliderController.props.get("max")}set max(e){this.controller.valueController.sliderController.props.set("max",e)}get min(){return this.controller.valueController.sliderController.props.get("min")}set min(e){this.controller.valueController.sliderController.props.set("min",e)}}ky({id:"input-number",type:"input",accept:(e,t)=>{if("number"!=typeof e)return null;const n=Jb(t,(e=>Object.assign(Object.assign({},zb(e)),{options:e.optional.custom(_x),readonly:e.optional.constant(!1)})));return n?{initialValue:e,params:n}:null},binding:{reader:e=>Ab,constraint:e=>function(e,t){const n=[],i=Vb(e,t);i&&n.push(i);const s=Bb(e);s&&n.push(s);const r=bx(e.options);return r&&n.push(r),new fx(n)}(e.params,e.initialValue),writer:e=>rM},controller:e=>{const t=e.value,n=e.constraint,i=n&&vx(n,gx);if(i)return new Mx(e.document,{props:new ob({options:i.values.value("options")}),value:t,viewProps:e.viewProps});const s=Fb(e.params,t.rawValue),r=n&&vx(n,lb);return r?new Zx(e.document,Object.assign(Object.assign({},(a=Object.assign(Object.assign({},s),{keyScale:ab(s.keyScale),max:r.values.value("max"),min:r.values.value("min")}),{sliderProps:new ob({keyScale:a.keyScale,max:a.max,min:a.min}),textProps:new ob({formatter:ab(a.formatter),keyScale:a.keyScale,pointerScale:ab(a.pointerScale)})})),{parser:Pb,value:t,viewProps:e.viewProps})):new Wx(e.document,{parser:Pb,props:ob.fromObject(s),value:t,viewProps:e.viewProps});var a},api:e=>"number"!=typeof e.controller.value.rawValue?null:e.controller.valueController instanceof Zx?new qE(e.controller):e.controller.valueController instanceof Mx?new dx(e.controller):null});class XE{constructor(e=0,t=0){this.x=e,this.y=t}getComponents(){return[this.x,this.y]}static isObject(e){if(Kw(e))return!1;const t=e.x,n=e.y;return"number"==typeof t&&"number"==typeof n}static equals(e,t){return e.x===t.x&&e.y===t.y}toObject(){return{x:this.x,y:this.y}}}const KE={toComponents:e=>e.getComponents(),fromComponents:e=>new XE(...e)},YE=fy("p2d");class $E{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(YE()),t.viewProps.bindClassModifiers(this.element),dy(t.expanded,Ty(this.element,YE(void 0,"expanded")));const n=e.createElement("div");n.classList.add(YE("h")),this.element.appendChild(n);const i=e.createElement("button");i.classList.add(YE("b")),i.appendChild(oy(e,"p2dpad")),t.viewProps.bindDisabled(i),n.appendChild(i),this.buttonElement=i;const s=e.createElement("div");if(s.classList.add(YE("t")),n.appendChild(s),this.textElement=s,"inline"===t.pickerLayout){const t=e.createElement("div");t.classList.add(YE("p")),this.element.appendChild(t),this.pickerElement=t}else this.pickerElement=null}}const ZE=fy("p2dp");class JE{constructor(e,t){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onPropsChange_=this.onPropsChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onPropsChange_),this.element=e.createElement("div"),this.element.classList.add(ZE()),"popup"===t.layout&&this.element.classList.add(ZE(void 0,"p")),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(ZE("p")),t.viewProps.bindTabIndex(n),this.element.appendChild(n),this.padElement=n;const i=e.createElementNS(iy,"svg");i.classList.add(ZE("g")),this.padElement.appendChild(i),this.svgElem_=i;const s=e.createElementNS(iy,"line");s.classList.add(ZE("ax")),s.setAttributeNS(null,"x1","0"),s.setAttributeNS(null,"y1","50%"),s.setAttributeNS(null,"x2","100%"),s.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(s);const r=e.createElementNS(iy,"line");r.classList.add(ZE("ax")),r.setAttributeNS(null,"x1","50%"),r.setAttributeNS(null,"y1","0"),r.setAttributeNS(null,"x2","50%"),r.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(r);const a=e.createElementNS(iy,"line");a.classList.add(ZE("l")),a.setAttributeNS(null,"x1","50%"),a.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(a),this.lineElem_=a;const o=e.createElement("div");o.classList.add(ZE("m")),this.padElement.appendChild(o),this.markerElem_=o,t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[e,t]=this.value.rawValue.getComponents(),n=this.props_.get("max"),i=Rb(e,-n,+n,0,100),s=Rb(t,-n,+n,0,100),r=this.props_.get("invertsY")?100-s:s;this.lineElem_.setAttributeNS(null,"x2",`${i}%`),this.lineElem_.setAttributeNS(null,"y2",`${r}%`),this.markerElem_.style.left=`${i}%`,this.markerElem_.style.top=`${r}%`}onValueChange_(){this.update_()}onPropsChange_(){this.update_()}onFoldableChange_(){this.update_()}}function QE(e,t,n){return[Ux(t[0],Bx(e)),Ux(t[1],Vx(e))*(n?1:-1)]}class eS{constructor(e,t){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new JE(e,{layout:t.layout,props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Hx(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const n=this.props.get("max"),i=Rb(e.point.x,0,e.bounds.width,-n,+n),s=Rb(this.props.get("invertsY")?e.bounds.height-e.point.y:e.point.y,0,e.bounds.height,-n,+n);this.value.setRawValue(new XE(i,s),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onPadKeyDown_(e){Fx(e.key)&&e.preventDefault();const[t,n]=QE(e,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));0===t&&0===n||this.value.setRawValue(new XE(this.value.rawValue.x+t,this.value.rawValue.y+n),{forceEmit:!1,last:!1})}onPadKeyUp_(e){const[t,n]=QE(e,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));0===t&&0===n||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class tS{constructor(e,t){var n,i;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=jy.create(t.expanded),this.popC_="popup"===t.pickerLayout?new Cx(e,{viewProps:this.viewProps}):null;const s=new eS(e,{layout:t.pickerLayout,props:new ob({invertsY:ab(t.invertsY),max:ab(t.max),xKeyScale:t.axes[0].textProps.value("keyScale"),yKeyScale:t.axes[1].textProps.value("keyScale")}),value:this.value,viewProps:this.viewProps});s.view.allFocusableElements.forEach((e=>{e.addEventListener("blur",this.onPopupChildBlur_),e.addEventListener("keydown",this.onPopupChildKeydown_)})),this.pickerC_=s,this.textC_=new WE(e,{assembly:KE,axes:t.axes,parser:t.parser,value:this.value,viewProps:this.viewProps}),this.view=new $E(e,{expanded:this.foldable_.value("expanded"),pickerLayout:t.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),null===(n=this.view.buttonElement)||void 0===n||n.addEventListener("blur",this.onPadButtonBlur_),null===(i=this.view.buttonElement)||void 0===i||i.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),Nx({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:e=>e,backward:(e,t)=>t})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),qy(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onPadButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,n=e.relatedTarget;n&&t.contains(n)||(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,n=uy(e);n&&t.contains(n)||n&&n===this.view.buttonElement&&!ry(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?"Escape"===e.key&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&"Escape"===e.key&&this.view.buttonElement.focus()}}function nS(e){return XE.isObject(e)?new XE(e.x,e.y):new XE}function iS(e,t){e.writeProperty("x",t.x),e.writeProperty("y",t.y)}function sS(e,t){var n,i;if(!Kw(e.min)||!Kw(e.max))return Math.max(Math.abs(null!==(n=e.min)&&void 0!==n?n:0),Math.abs(null!==(i=e.max)&&void 0!==i?i:0));const s=Nb(e);return Math.max(10*Math.abs(s),10*Math.abs(t))}function rS(e,t){var n,i;const s=sS(Jw(e,null!==(n=e.x)&&void 0!==n?n:{}),t.x),r=sS(Jw(e,null!==(i=e.y)&&void 0!==i?i:{}),t.y);return Math.max(s,r)}function aS(e){if(!("y"in e))return!1;const t=e.y;return!!t&&("inverted"in t&&!!t.inverted)}ky({id:"input-point2d",type:"input",accept:(e,t)=>{if(!XE.isObject(e))return null;const n=Jb(t,(e=>Object.assign(Object.assign({},tM(e)),{expanded:e.optional.boolean,picker:e.optional.custom(sM),readonly:e.optional.constant(!1),x:e.optional.custom(nM),y:e.optional.object(Object.assign(Object.assign({},tM(e)),{inverted:e.optional.boolean}))})));return n?{initialValue:e,params:n}:null},binding:{reader:()=>nS,constraint:e=>{return t=e.params,n=e.initialValue,new HE({assembly:KE,components:[iM(Object.assign(Object.assign({},t),t.x),n.x),iM(Object.assign(Object.assign({},t),t.y),n.y)]});var t,n},equals:XE.equals,writer:()=>iS},controller:e=>{var t,n;const i=e.document,s=e.value,r=e.constraint,a=[e.params.x,e.params.y];return new tS(i,{axes:s.rawValue.getComponents().map(((t,n)=>{var i;return Hb({constraint:r.components[n],initialValue:t,params:Jw(e.params,null!==(i=a[n])&&void 0!==i?i:{})})})),expanded:null!==(t=e.params.expanded)&&void 0!==t&&t,invertsY:aS(e.params),max:rS(e.params,s.rawValue),parser:Pb,pickerLayout:null!==(n=e.params.picker)&&void 0!==n?n:"popup",value:s,viewProps:e.viewProps})}});class oS{constructor(e=0,t=0,n=0){this.x=e,this.y=t,this.z=n}getComponents(){return[this.x,this.y,this.z]}static isObject(e){if(Kw(e))return!1;const t=e.x,n=e.y,i=e.z;return"number"==typeof t&&"number"==typeof n&&"number"==typeof i}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}const lS={toComponents:e=>e.getComponents(),fromComponents:e=>new oS(...e)};function cS(e){return oS.isObject(e)?new oS(e.x,e.y,e.z):new oS}function hS(e,t){e.writeProperty("x",t.x),e.writeProperty("y",t.y),e.writeProperty("z",t.z)}ky({id:"input-point3d",type:"input",accept:(e,t)=>{if(!oS.isObject(e))return null;const n=Jb(t,(e=>Object.assign(Object.assign({},tM(e)),{readonly:e.optional.constant(!1),x:e.optional.custom(nM),y:e.optional.custom(nM),z:e.optional.custom(nM)})));return n?{initialValue:e,params:n}:null},binding:{reader:e=>cS,constraint:e=>{return t=e.params,n=e.initialValue,new HE({assembly:lS,components:[iM(Object.assign(Object.assign({},t),t.x),n.x),iM(Object.assign(Object.assign({},t),t.y),n.y),iM(Object.assign(Object.assign({},t),t.z),n.z)]});var t,n},equals:oS.equals,writer:e=>hS},controller:e=>{const t=e.value,n=e.constraint,i=[e.params.x,e.params.y,e.params.z];return new WE(e.document,{assembly:lS,axes:t.rawValue.getComponents().map(((t,s)=>{var r;return Hb({constraint:n.components[s],initialValue:t,params:Jw(e.params,null!==(r=i[s])&&void 0!==r?r:{})})})),parser:Pb,value:t,viewProps:e.viewProps})}});class uS{constructor(e=0,t=0,n=0,i=0){this.x=e,this.y=t,this.z=n,this.w=i}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(e){if(Kw(e))return!1;const t=e.x,n=e.y,i=e.z,s=e.w;return"number"==typeof t&&"number"==typeof n&&"number"==typeof i&&"number"==typeof s}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}const dS={toComponents:e=>e.getComponents(),fromComponents:e=>new uS(...e)};function pS(e){return uS.isObject(e)?new uS(e.x,e.y,e.z,e.w):new uS}function mS(e,t){e.writeProperty("x",t.x),e.writeProperty("y",t.y),e.writeProperty("z",t.z),e.writeProperty("w",t.w)}ky({id:"input-point4d",type:"input",accept:(e,t)=>{if(!uS.isObject(e))return null;const n=Jb(t,(e=>Object.assign(Object.assign({},tM(e)),{readonly:e.optional.constant(!1),w:e.optional.custom(nM),x:e.optional.custom(nM),y:e.optional.custom(nM),z:e.optional.custom(nM)})));return n?{initialValue:e,params:n}:null},binding:{reader:e=>pS,constraint:e=>{return t=e.params,n=e.initialValue,new HE({assembly:dS,components:[iM(Object.assign(Object.assign({},t),t.x),n.x),iM(Object.assign(Object.assign({},t),t.y),n.y),iM(Object.assign(Object.assign({},t),t.z),n.z),iM(Object.assign(Object.assign({},t),t.w),n.w)]});var t,n},equals:uS.equals,writer:e=>mS},controller:e=>{const t=e.value,n=e.constraint,i=[e.params.x,e.params.y,e.params.z,e.params.w];return new WE(e.document,{assembly:dS,axes:t.rawValue.getComponents().map(((t,s)=>{var r;return Hb({constraint:n.components[s],initialValue:t,params:Jw(e.params,null!==(r=i[s])&&void 0!==r?r:{})})})),parser:Pb,value:t,viewProps:e.viewProps})}}),ky({id:"input-string",type:"input",accept:(e,t)=>{if("string"!=typeof e)return null;const n=Jb(t,(e=>({readonly:e.optional.constant(!1),options:e.optional.custom(_x)})));return n?{initialValue:e,params:n}:null},binding:{reader:e=>kx,constraint:e=>function(e){const t=[],n=bx(e.options);return n&&t.push(n),new fx(t)}(e.params),writer:e=>rM},controller:e=>{const t=e.document,n=e.value,i=e.constraint,s=i&&vx(i,gx);return s?new Mx(t,{props:new ob({options:s.values.value("options")}),value:n,viewProps:e.viewProps}):new Ax(t,{parser:e=>e,props:ob.fromObject({formatter:Ox}),value:n,viewProps:e.viewProps})},api:e=>"string"!=typeof e.controller.value.rawValue?null:e.controller.valueController instanceof Mx?new dx(e.controller):null});const fS={defaultInterval:200,defaultRows:3},vS=fy("mll");class gS{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(vS()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("textarea");n.classList.add(vS("i")),n.style.height=`calc(var(${Qx("containerUnitSize")}) * ${t.rows})`,n.readOnly=!0,t.viewProps.bindDisabled(n),this.element.appendChild(n),this.textareaElem_=n,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.textareaElem_,t=e.scrollTop===e.scrollHeight-e.clientHeight,n=[];this.value.rawValue.forEach((e=>{void 0!==e&&n.push(this.formatter_(e))})),e.textContent=n.join("\n"),t&&(e.scrollTop=e.scrollHeight)}onValueUpdate_(){this.update_()}}class _S{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new gS(e,{formatter:t.formatter,rows:t.rows,value:this.value,viewProps:this.viewProps})}}const wS=fy("sgl");class bS{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(wS()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("input");n.classList.add(wS("i")),n.readOnly=!0,n.type="text",t.viewProps.bindDisabled(n),this.element.appendChild(n),this.inputElement=n,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.value.rawValue,t=e[e.length-1];this.inputElement.value=void 0!==t?this.formatter_(t):""}onValueUpdate_(){this.update_()}}class yS{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new bS(e,{formatter:t.formatter,value:this.value,viewProps:this.viewProps})}}ky({id:"monitor-bool",type:"monitor",accept:(e,t)=>{if("boolean"!=typeof e)return null;const n=Jb(t,(e=>({readonly:e.required.constant(!0),rows:e.optional.number})));return n?{initialValue:e,params:n}:null},binding:{reader:e=>Lx},controller:e=>{var t;return 1===e.value.rawValue.length?new yS(e.document,{formatter:Rx,value:e.value,viewProps:e.viewProps}):new _S(e.document,{formatter:Rx,rows:null!==(t=e.params.rows)&&void 0!==t?t:fS.defaultRows,value:e.value,viewProps:e.viewProps})}});class xS extends Kb{get max(){return this.controller.valueController.props.get("max")}set max(e){this.controller.valueController.props.set("max",e)}get min(){return this.controller.valueController.props.get("min")}set min(e){this.controller.valueController.props.set("min",e)}}const MS=fy("grl");class ES{constructor(e,t){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=e.createElement("div"),this.element.classList.add(MS()),t.viewProps.bindClassModifiers(this.element),this.formatter_=t.formatter,this.props_=t.props,this.cursor_=t.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const n=e.createElementNS(iy,"svg");n.classList.add(MS("g")),n.style.height=`calc(var(${Qx("containerUnitSize")}) * ${t.rows})`,this.element.appendChild(n),this.svgElem_=n;const i=e.createElementNS(iy,"polyline");this.svgElem_.appendChild(i),this.lineElem_=i;const s=e.createElement("div");s.classList.add(MS("t"),fy("tt")()),this.element.appendChild(s),this.tooltipElem_=s,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const e=this.svgElem_.getBoundingClientRect(),t=this.value.rawValue.length-1,n=this.props_.get("min"),i=this.props_.get("max"),s=[];this.value.rawValue.forEach(((r,a)=>{if(void 0===r)return;const o=Rb(a,0,t,0,e.width),l=Rb(r,n,i,e.height,0);s.push([o,l].join(","))})),this.lineElem_.setAttributeNS(null,"points",s.join(" "));const r=this.tooltipElem_,a=this.value.rawValue[this.cursor_.rawValue];if(void 0===a)return void r.classList.remove(MS("t","a"));const o=Rb(this.cursor_.rawValue,0,t,0,e.width),l=Rb(a,n,i,e.height,0);r.style.left=`${o}px`,r.style.top=`${l}px`,r.textContent=`${this.formatter_(a)}`,r.classList.contains(MS("t","a"))||(r.classList.add(MS("t","a"),MS("t","in")),sy(r),r.classList.remove(MS("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class SS{constructor(e,t){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.cursor_=ab(-1),this.view=new ES(e,{cursor:this.cursor_,formatter:t.formatter,rows:t.rows,props:this.props,value:this.value,viewProps:this.viewProps}),ry(e)){const e=new Hx(this.view.element);e.emitter.on("down",this.onGraphPointerDown_),e.emitter.on("move",this.onGraphPointerMove_),e.emitter.on("up",this.onGraphPointerUp_)}else this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_)}importProps(e){return Qb(e,null,(e=>({max:e.required.number,min:e.required.number})),(e=>(this.props.set("max",e.max),this.props.set("min",e.min),!0)))}exportProps(){return ey(null,{max:this.props.get("max"),min:this.props.get("min")})}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(e){const t=this.view.element.getBoundingClientRect();this.cursor_.rawValue=Math.floor(Rb(e.offsetX,0,t.width,0,this.value.rawValue.length))}onGraphPointerDown_(e){this.onGraphPointerMove_(e)}onGraphPointerMove_(e){e.data.point?this.cursor_.rawValue=Math.floor(Rb(e.data.point.x,0,e.data.bounds.width,0,this.value.rawValue.length)):this.cursor_.rawValue=-1}onGraphPointerUp_(){this.cursor_.rawValue=-1}}function CS(e){return Kw(e.format)?Lb(2):e.format}function TS(e){return"graph"===e.view}ky({id:"monitor-number",type:"monitor",accept:(e,t)=>{if("number"!=typeof e)return null;const n=Jb(t,(e=>({format:e.optional.function,max:e.optional.number,min:e.optional.number,readonly:e.required.constant(!0),rows:e.optional.number,view:e.optional.string})));return n?{initialValue:e,params:n}:null},binding:{defaultBufferSize:e=>TS(e)?64:1,reader:e=>Ab},controller:e=>TS(e.params)?function(e){var t,n,i;return new SS(e.document,{formatter:CS(e.params),rows:null!==(t=e.params.rows)&&void 0!==t?t:fS.defaultRows,props:ob.fromObject({max:null!==(n=e.params.max)&&void 0!==n?n:100,min:null!==(i=e.params.min)&&void 0!==i?i:0}),value:e.value,viewProps:e.viewProps})}(e):function(e){var t;return 1===e.value.rawValue.length?new yS(e.document,{formatter:CS(e.params),value:e.value,viewProps:e.viewProps}):new _S(e.document,{formatter:CS(e.params),rows:null!==(t=e.params.rows)&&void 0!==t?t:fS.defaultRows,value:e.value,viewProps:e.viewProps})}(e),api:e=>e.controller.valueController instanceof SS?new xS(e.controller):null}),ky({id:"monitor-string",type:"monitor",accept:(e,t)=>{if("string"!=typeof e)return null;const n=Jb(t,(e=>({multiline:e.optional.boolean,readonly:e.required.constant(!0),rows:e.optional.number})));return n?{initialValue:e,params:n}:null},binding:{reader:e=>kx},controller:e=>{var t;const n=e.value;return n.rawValue.length>1||e.params.multiline?new _S(e.document,{formatter:Ox,rows:null!==(t=e.params.rows)&&void 0!==t?t:fS.defaultRows,value:n,viewProps:e.viewProps}):new yS(e.document,{formatter:Ox,value:n,viewProps:e.viewProps})}});class PS{constructor(e){this.controller_=e}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(e){this.controller_.viewProps.set("disabled",e)}get title(){var e;return null!==(e=this.controller_.props.get("title"))&&void 0!==e?e:""}set title(e){this.controller_.props.set("title",e)}on(e,t){const n=t.bind(this);return this.controller_.emitter.on(e,(()=>{n(new jb(this))})),this}}class AS extends jb{constructor(e,t,n){super(e),this.cell=t,this.index=n}}class LS extends Gb{constructor(e){super(e),this.cellToApiMap_=new Map,this.emitter_=new nb;const t=this.controller.valueController;t.cellControllers.forEach(((e,n)=>{const i=new PS(e);this.cellToApiMap_.set(e,i),e.emitter.on("click",(()=>{const e=n%t.size[0],s=Math.floor(n/t.size[0]);this.emitter_.emit("click",{event:new AS(this,i,[e,s])})}))}))}cell(e,t){const n=this.controller.valueController,i=n.cellControllers[t*n.size[0]+e];return this.cellToApiMap_.get(i)}on(e,t){const n=t.bind(this);return this.emitter_.on(e,(e=>{n(e.event)})),this}}class RS{constructor(e,t){this.size=t.size;const[n,i]=this.size,s=[];for(let r=0;r<i;r++)for(let i=0;i<n;i++){const n=new Ry(e,{props:ob.fromObject(Object.assign({},t.cellConfig(i,r))),viewProps:Qy.create()});s.push(n)}this.cellCs_=s,this.viewProps=Qy.create(),this.viewProps.handleDispose((()=>{this.cellCs_.forEach((e=>{e.viewProps.set("disposed",!0)}))})),this.view=new eM(e,{viewProps:this.viewProps,viewName:"btngrid"}),this.view.element.style.gridTemplateColumns=`repeat(${n}, 1fr)`,this.cellCs_.forEach((e=>{this.view.element.appendChild(e.view.element)}))}get cellControllers(){return this.cellCs_}}class DS extends yy{constructor(e,t){const n=t.valueController,i=new _y(e,{blade:t.blade,props:t.labelProps,valueController:n});super({blade:t.blade,view:i.view,viewProps:n.viewProps}),this.valueController=n,this.labelController=i}}const IS=ky({id:"buttongrid",type:"blade",accept(e){const t=Jb(e,(e=>({cells:e.required.function,size:e.required.array(e.required.number),view:e.required.constant("buttongrid"),label:e.optional.string})));return t?{params:t}:null},controller:e=>new DS(e.document,{blade:e.blade,labelProps:ob.fromObject({label:e.params.label}),valueController:new RS(e.document,{cellConfig:e.params.cells,size:e.params.size})}),api:e=>e.controller instanceof DS?new LS(e.controller):null});class kS extends Gb{get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get value(){return this.controller.valueController.value.rawValue}set value(e){this.controller.valueController.value.rawValue=e}on(e,t){const n=t.bind(this);return this.controller.valueController.value.emitter.on(e,(e=>{n(new Wb(this,e.rawValue,e.options.last))})),this}}function OS(e,t,n){return e*(1-n)+t*n}function NS(e,t){let n=.25,i=.5,s=-1;for(let r=0;r<20;r++){const[r,a]=e.curve(i);if(i+=n*(r<t?1:-1),s=a,n*=.5,Math.abs(t-r)<.001)break}return s}class US{constructor(e=0,t=0,n=1,i=1){this.cache_=[],this.comps_=[e,t,n,i]}get x1(){return this.comps_[0]}get y1(){return this.comps_[1]}get x2(){return this.comps_[2]}get y2(){return this.comps_[3]}static isObject(e){return!Kw(e)&&(!!Array.isArray(e)&&("number"==typeof e[0]&&"number"==typeof e[1]&&"number"==typeof e[2]&&"number"==typeof e[3]))}static equals(e,t){return e.x1===t.x1&&e.y1===t.y1&&e.x2===t.x2&&e.y2===t.y2}curve(e){const t=OS(0,this.x1,e),n=OS(0,this.y1,e),i=OS(this.x1,this.x2,e),s=OS(this.y1,this.y2,e),r=OS(this.x2,1,e),a=OS(this.y2,1,e),o=OS(t,i,e),l=OS(n,s,e),c=OS(i,r,e),h=OS(s,a,e);return[OS(o,c,e),OS(l,h,e)]}y(e){if(0===this.cache_.length){const e=[];for(let t=0;t<100;t++)e.push(NS(this,Rb(t,0,99,0,1)));this.cache_=e}return this.cache_[Math.round(Rb(Ib(e,0,1),0,1,0,99))]}toObject(){return[this.comps_[0],this.comps_[1],this.comps_[2],this.comps_[3]]}}const VS={toComponents:e=>e.toObject(),fromComponents:e=>new US(...e)};function BS(e){const t=Lb(2),n=e.toObject().map((e=>t(e)));return`cubic-bezier(${n.join(", ")})`}const FS=[0,.5,.5,1];function zS(e){const t=e.match(/^cubic-bezier\s*\(\s*([0-9.]+)\s*,\s*([0-9.]+)\s*,\s*([0-9.]+)\s*,\s*([0-9.]+)\s*\)$/);if(!t)return new US(...FS);const n=[t[1],t[2],t[3],t[4]].reduce(((e,t)=>{if(!e)return null;const n=Number(t);return isNaN(n)?null:[...e,n]}),[]);return new US(...null!=n?n:FS)}const HS=fy("cbz");class GS{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(HS()),t.viewProps.bindClassModifiers(this.element),t.foldable.bindExpandedClass(this.element,HS(void 0,"expanded")),py(t.foldable,"completed",Ty(this.element,HS(void 0,"cpl")));const n=e.createElement("div");n.classList.add(HS("h")),this.element.appendChild(n);const i=e.createElement("button");i.classList.add(HS("b")),t.viewProps.bindDisabled(i);const s=e.createElementNS(iy,"svg");s.innerHTML='<path d="M2 13C8 13 8 3 14 3"/>',i.appendChild(s),n.appendChild(i),this.buttonElement=i;const r=e.createElement("div");if(r.classList.add(HS("t")),n.appendChild(r),this.textElement=r,"inline"===t.pickerLayout){const t=e.createElement("div");t.classList.add(HS("p")),this.element.appendChild(t),this.pickerElement=t}else this.pickerElement=null}}const jS=fy("cbzp");class WS{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(jS()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(jS("g")),this.element.appendChild(n),this.graphElement=n;const i=e.createElement("div");i.classList.add(jS("t")),this.element.appendChild(i),this.textElement=i}}function qS(e,t){const n=new MutationObserver((e=>{for(const i of e)"childList"===i.type&&i.addedNodes.forEach((e=>{e.contains(e)&&(t(),n.disconnect())}))})),i=e.ownerDocument;n.observe(i.body,{attributes:!0,childList:!0,subtree:!0})}const XS=fy("cbzg");class KS{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(XS()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const n=e.createElement("div");n.classList.add(XS("p")),this.element.appendChild(n),this.previewElement=n;const i=e.createElementNS(iy,"svg");i.classList.add(XS("g")),this.element.appendChild(i),this.svgElem_=i;const s=e.createElementNS(iy,"path");s.classList.add(XS("u")),this.svgElem_.appendChild(s),this.guideElem_=s;const r=e.createElementNS(iy,"polyline");r.classList.add(XS("l")),this.svgElem_.appendChild(r),this.lineElem_=r,this.handleElems_=[e.createElement("div"),e.createElement("div")],this.handleElems_.forEach((e=>{e.classList.add(XS("h")),this.element.appendChild(e)})),this.vectorElems_=[e.createElementNS(iy,"line"),e.createElementNS(iy,"line")],this.vectorElems_.forEach((e=>{e.classList.add(XS("v")),this.svgElem_.appendChild(e)})),this.value_=t.value,this.value_.emitter.on("change",this.onValueChange_.bind(this)),this.sel_=t.selection,this.handleElems_.forEach(((e,t)=>{var n,i;dy(this.sel_,(n=e=>e===t,i=Ty(e,XS("h","sel")),e=>i(n(e))))})),qS(this.element,(()=>{this.refresh()}))}getVertMargin_(e){return.25*e}valueToPosition(e,t){const{clientWidth:n,clientHeight:i}=this.element,s=this.getVertMargin_(i);return{x:Rb(e,0,1,0,n),y:Rb(t,0,1,i-s,s)}}positionToValue(e,t){const n=this.element.getBoundingClientRect(),i=n.width,s=n.height,r=this.getVertMargin_(s);return{x:Ib(Rb(e,0,i,0,1),0,1),y:Rb(t,s-r,r,0,1)}}refresh(){this.guideElem_.setAttributeNS(null,"d",[0,1].map((e=>{const t=this.valueToPosition(0,e),n=this.valueToPosition(1,e);return[`M ${t.x},${t.y}`,`L ${n.x},${n.y}`].join(" ")})).join(" "));const e=this.value_.rawValue,t=[];let n=0;for(;;){const i=this.valueToPosition(...e.curve(n));if(t.push([i.x,i.y].join(",")),n>=1)break;n=Math.min(n+.05,1)}this.lineElem_.setAttributeNS(null,"points",t.join(" "));const i=e.toObject();[0,1].forEach((e=>{const t=this.valueToPosition(e,e),n=this.valueToPosition(i[2*e],i[2*e+1]),s=this.vectorElems_[e];s.setAttributeNS(null,"x1",String(t.x)),s.setAttributeNS(null,"y1",String(t.y)),s.setAttributeNS(null,"x2",String(n.x)),s.setAttributeNS(null,"y2",String(n.y));const r=this.handleElems_[e];r.style.left=`${n.x}px`,r.style.top=`${n.y}px`}))}onValueChange_(){this.refresh()}}const YS=fy("cbzprv");class $S{constructor(e,t){this.stopped_=!0,this.startTime_=-1,this.onDispose_=this.onDispose_.bind(this),this.onTimer_=this.onTimer_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(YS()),t.viewProps.bindClassModifiers(this.element);const n=e.createElementNS(iy,"svg");n.classList.add(YS("g")),this.element.appendChild(n),this.svgElem_=n;const i=e.createElementNS(iy,"path");i.classList.add(YS("t")),this.svgElem_.appendChild(i),this.ticksElem_=i;const s=e.createElement("div");s.classList.add(YS("m")),this.element.appendChild(s),this.markerElem_=s,this.value_=t.value,this.value_.emitter.on("change",this.onValueChange_),t.viewProps.handleDispose(this.onDispose_),qS(this.element,(()=>{this.refresh()}))}play(){this.stop(),this.updateMarker_(0),this.markerElem_.classList.add(YS("m","a")),this.startTime_=(new Date).getTime()+400,this.stopped_=!1,requestAnimationFrame(this.onTimer_)}stop(){this.stopped_=!0,this.markerElem_.classList.remove(YS("m","a"))}onDispose_(){this.stop()}updateMarker_(e){const t=this.value_.rawValue.y(Ib(e,0,1));this.markerElem_.style.left=100*t+"%"}refresh(){const{clientWidth:e,clientHeight:t}=this.svgElem_,n=[],i=this.value_.rawValue;for(let s=0;s<24;s++){const r=Rb(s,0,23,0,1),a=Rb(i.y(r),0,1,0,e);n.push(`M ${a},0 v${t}`)}this.ticksElem_.setAttributeNS(null,"d",n.join(" "))}onTimer_(){if(null===this.startTime_)return;const e=(new Date).getTime()-this.startTime_,t=e/1e3;this.updateMarker_(t),e>1400&&this.stop(),this.stopped_||requestAnimationFrame(this.onTimer_)}onValueChange_(){this.refresh(),this.play()}}function ZS(e,t,n,i){const s=n-e,r=i-t;return Math.sqrt(s*s+r*r)}class JS{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.keyScale_=t.keyScale,this.value=t.value,this.sel_=ab(0),this.viewProps=t.viewProps,this.view=new KS(e,{selection:this.sel_,value:this.value,viewProps:this.viewProps}),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_),this.prevView_=new $S(e,{value:this.value,viewProps:this.viewProps}),this.prevView_.element.addEventListener("mousedown",(e=>{e.stopImmediatePropagation(),e.preventDefault(),this.prevView_.play()})),this.view.previewElement.appendChild(this.prevView_.element);const n=new Hx(this.view.element);n.emitter.on("down",this.onPointerDown_),n.emitter.on("move",this.onPointerMove_),n.emitter.on("up",this.onPointerUp_)}refresh(){this.view.refresh(),this.prevView_.refresh(),this.prevView_.play()}updateValue_(e,t,n){const i=this.sel_.rawValue,s=this.value.rawValue.toObject(),r=this.view.positionToValue(e.x,e.y),a=t?function(e,t,n,i){const s=ZS(e,t,n,i),r=Math.atan2(i-t,n-e),a=Math.round(r/(Math.PI/4))*Math.PI/4;return{x:e+Math.cos(a)*s,y:t+Math.sin(a)*s}}(i,i,r.x,r.y):r;s[2*i]=a.x,s[2*i+1]=a.y,this.value.setRawValue(new US(...s),n)}onPointerDown_(e){const t=e.data;if(!t.point)return;const n=this.value.rawValue,i=this.view.valueToPosition(n.x1,n.y1),s=ZS(t.point.x,t.point.y,i.x,i.y),r=this.view.valueToPosition(n.x2,n.y2),a=ZS(t.point.x,t.point.y,r.x,r.y);this.sel_.rawValue=s<=a?0:1,this.updateValue_(t.point,e.shiftKey,{forceEmit:!1,last:!1})}onPointerMove_(e){const t=e.data;t.point&&this.updateValue_(t.point,e.shiftKey,{forceEmit:!1,last:!1})}onPointerUp_(e){const t=e.data;t.point&&this.updateValue_(t.point,e.shiftKey,{forceEmit:!0,last:!0})}onKeyDown_(e){Fx(e.key)&&e.preventDefault();const t=this.sel_.rawValue,n=this.value.rawValue.toObject(),i=this.keyScale_.rawValue;n[2*t]+=Ux(i,Bx(e)),n[2*t+1]+=Ux(i,Vx(e)),this.value.setRawValue(new US(...n),{forceEmit:!1,last:!1})}onKeyUp_(e){Fx(e.key)&&e.preventDefault();const t=this.keyScale_.rawValue,n=Ux(t,Bx(e)),i=Ux(t,Vx(e));0===n&&0===i||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class QS{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new WS(e,{viewProps:this.viewProps}),this.gc_=new JS(e,{keyScale:t.axis.textProps.value("keyScale"),value:this.value,viewProps:this.viewProps}),this.view.graphElement.appendChild(this.gc_.view.element);const n=Object.assign(Object.assign({},t.axis),{constraint:new cb({max:1,min:0})}),i=Object.assign(Object.assign({},t.axis),{constraint:void 0});this.tc_=new WE(e,{assembly:VS,axes:[n,i,n,i],parser:Pb,value:this.value,viewProps:this.viewProps}),this.view.textElement.appendChild(this.tc_.view.element)}get allFocusableElements(){return[this.gc_.view.element,...this.tc_.view.textViews.map((e=>e.inputElement))]}refresh(){this.gc_.refresh()}}class eC{constructor(e,t){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=jy.create(t.expanded),this.view=new GS(e,{foldable:this.foldable_,pickerLayout:t.pickerLayout,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("blur",this.onButtonBlur_),this.view.buttonElement.addEventListener("click",this.onButtonClick_),this.tc_=new Ax(e,{parser:zS,props:ob.fromObject({formatter:BS}),value:this.value,viewProps:this.viewProps}),this.view.textElement.appendChild(this.tc_.view.element),this.popC_="popup"===t.pickerLayout?new Cx(e,{viewProps:this.viewProps}):null;const n=new QS(e,{axis:t.axis,value:this.value,viewProps:this.viewProps});n.allFocusableElements.forEach((e=>{e.addEventListener("blur",this.onPopupChildBlur_),e.addEventListener("keydown",this.onPopupChildKeydown_)})),this.pickerC_=n,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),dy(this.popC_.shows,(e=>{e&&n.refresh()})),Nx({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:e=>e,backward:(e,t)=>t})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),qy(this.foldable_,this.view.pickerElement))}onButtonBlur_(e){if(!this.popC_)return;const t=e.relatedTarget;t&&this.popC_.view.element.contains(t)||(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,n=uy(e);n&&t.contains(n)||n&&n===this.view.buttonElement&&!ry(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_&&"Escape"===e.key&&(this.popC_.shows.rawValue=!1)}}const tC=ky({id:"cubicbezier",type:"blade",accept(e){const t=Jb(e,(e=>({value:e.required.array(e.required.number),view:e.required.constant("cubicbezier"),expanded:e.optional.boolean,label:e.optional.string,picker:e.optional.custom((e=>"inline"===e||"popup"===e?e:void 0))})));return t?{params:t}:null},controller(e){var t,n;const i=ab(new US(...e.params.value),{constraint:new HE({assembly:VS,components:[0,1,2,3].map((e=>e%2==0?new cb({min:0,max:1}):void 0))}),equals:US.equals}),s=new eC(e.document,{axis:{textProps:ob.fromObject({keyScale:.1,pointerScale:.01,formatter:Lb(2)})},expanded:null!==(t=e.params.expanded)&&void 0!==t&&t,pickerLayout:null!==(n=e.params.picker)&&void 0!==n?n:"popup",value:i,viewProps:e.viewProps});return new xy(e.document,{blade:e.blade,props:ob.fromObject({label:e.params.label}),value:i,valueController:s})},api:e=>e.controller instanceof xy&&e.controller.valueController instanceof eC?new kS(e.controller):null});class nC extends Gb{get fps(){return this.controller.valueController.fps}get max(){return this.controller.valueController.props.get("max")}set max(e){this.controller.valueController.props.set("max",e)}get min(){return this.controller.valueController.props.get("min")}set min(e){this.controller.valueController.props.set("min",e)}begin(){this.controller.valueController.begin()}end(){this.controller.valueController.end()}on(e,t){const n=t.bind(this);return this.controller.valueController.ticker.emitter.on(e,(()=>{n(new jb(this))})),this}}class iC{constructor(){this.start_=null,this.duration_=0,this.fps_=null,this.frameCount_=0,this.timestamps_=[]}get duration(){return this.duration_}get fps(){return this.fps_}begin(e){this.start_=e.getTime()}calculateFps_(e){if(0===this.timestamps_.length)return null;const t=this.timestamps_[0];return 1e3*(this.frameCount_-t.frameCount)/(e-t.time)}compactTimestamps_(){if(this.timestamps_.length<=20)return;const e=this.timestamps_.length-20;this.timestamps_.splice(0,e);const t=this.timestamps_[0].frameCount;this.timestamps_.forEach((e=>{e.frameCount-=t})),this.frameCount_-=t}end(e){if(null===this.start_)return;const t=e.getTime();this.duration_=t-this.start_,this.start_=null,this.fps_=this.calculateFps_(t),this.timestamps_.push({frameCount:this.frameCount_,time:t}),++this.frameCount_,this.compactTimestamps_()}}const sC=fy("fps");class rC{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(sC()),t.viewProps.bindClassModifiers(this.element),this.graphElement=e.createElement("div"),this.graphElement.classList.add(sC("g")),this.element.appendChild(this.graphElement);const n=e.createElement("div");n.classList.add(sC("l")),this.element.appendChild(n);const i=e.createElement("span");i.classList.add(sC("v")),i.textContent="--",n.appendChild(i),this.valueElement=i;const s=e.createElement("span");s.classList.add(sC("u")),s.textContent="FPS",n.appendChild(s)}}class aC{constructor(e,t){this.stopwatch_=new iC,this.onTick_=this.onTick_.bind(this),this.ticker=t.ticker,this.ticker.emitter.on("tick",this.onTick_),this.props=t.props,this.value_=t.value,this.viewProps=t.viewProps,this.view=new rC(e,{viewProps:this.viewProps}),this.graphC_=new SS(e,{formatter:Lb(0),props:this.props,rows:t.rows,value:this.value_,viewProps:this.viewProps}),this.view.graphElement.appendChild(this.graphC_.view.element),this.viewProps.handleDispose((()=>{this.graphC_.viewProps.set("disposed",!0),this.ticker.dispose()}))}get fps(){return this.stopwatch_.fps}begin(){this.stopwatch_.begin(new Date)}end(){this.stopwatch_.end(new Date)}onTick_(){const e=this.fps;if(null!==e){const t=this.value_.rawValue;this.value_.rawValue=function(e,t){const n=[...Sy(e),t];return n.length>e.length?n.splice(0,n.length-e.length):My(n,e.length),n}(t,e),this.view.valueElement.textContent=e.toFixed(0)}}}class oC extends yy{constructor(e,t){const n=t.valueController,i=new _y(e,{blade:t.blade,props:t.labelProps,valueController:n});super({blade:t.blade,view:i.view,viewProps:n.viewProps}),this.valueController=n,this.labelController=i}}function lC(e,t){return 0===t?new px:new mx(e,null!=t?t:fS.defaultInterval)}const cC=ky({id:"fpsgraph",type:"blade",accept(e){const t=Jb(e,(e=>({view:e.required.constant("fpsgraph"),interval:e.optional.number,label:e.optional.string,rows:e.optional.number,max:e.optional.number,min:e.optional.number})));return t?{params:t}:null},controller(e){var t,n,i,s;const r=null!==(t=e.params.interval)&&void 0!==t?t:500;return new oC(e.document,{blade:e.blade,labelProps:ob.fromObject({label:e.params.label}),valueController:new aC(e.document,{props:ob.fromObject({max:null!==(n=e.params.max)&&void 0!==n?n:90,min:null!==(i=e.params.min)&&void 0!==i?i:0}),rows:null!==(s=e.params.rows)&&void 0!==s?s:2,ticker:lC(e.document,r),value:ab(Ey(80)),viewProps:e.viewProps})})},api:e=>e.controller instanceof oC?new nC(e.controller):null});class hC{constructor(e,t){this.min=e,this.max=t}static isObject(e){if("object"!=typeof e||null===e)return!1;const t=e.min,n=e.max;return"number"==typeof t&&"number"==typeof n}static equals(e,t){return e.min===t.min&&e.max===t.max}get length(){return this.max-this.min}toObject(){return{min:this.min,max:this.max}}}const uC={fromComponents:e=>new hC(e[0],e[1]),toComponents:e=>[e.min,e.max]};class dC{constructor(e){this.edge=e}constrain(e){var t,n,i,s,r,a,o,l;if(e.min<=e.max)return new hC(null!==(n=null===(t=this.edge)||void 0===t?void 0:t.constrain(e.min))&&void 0!==n?n:e.min,null!==(s=null===(i=this.edge)||void 0===i?void 0:i.constrain(e.max))&&void 0!==s?s:e.max);const c=(e.min+e.max)/2;return new hC(null!==(a=null===(r=this.edge)||void 0===r?void 0:r.constrain(c))&&void 0!==a?a:c,null!==(l=null===(o=this.edge)||void 0===o?void 0:o.constrain(c))&&void 0!==l?l:c)}}const pC=fy("rsltxt");class mC{constructor(e,t){this.sliderView_=t.sliderView,this.textView_=t.textView,this.element=e.createElement("div"),this.element.classList.add(pC());const n=e.createElement("div");n.classList.add(pC("s")),n.appendChild(this.sliderView_.element),this.element.appendChild(n);const i=e.createElement("div");i.classList.add(pC("t")),i.appendChild(this.textView_.element),this.element.appendChild(i)}}const fC=fy("rsl");class vC{constructor(e,t){this.onSliderPropsChange_=this.onSliderPropsChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.sliderProps_=t.sliderProps,this.sliderProps_.emitter.on("change",this.onSliderPropsChange_),this.element=e.createElement("div"),this.element.classList.add(fC()),t.viewProps.bindClassModifiers(this.element),this.value_=t.value,this.value_.emitter.on("change",this.onValueChange_);const n=e.createElement("div");n.classList.add(fC("t")),this.element.appendChild(n),this.trackElement=n;const i=e.createElement("div");i.classList.add(fC("b")),n.appendChild(i),this.barElement=i;const s=["min","max"].map((t=>{const i=e.createElement("div");return i.classList.add(fC("k"),fC("k",t)),n.appendChild(i),i}));this.knobElements=[s[0],s[1]],this.update_()}valueToX_(e){return 100*Ib(Rb(e,this.sliderProps_.get("min"),this.sliderProps_.get("max"),0,1),0,1)}update_(){const e=this.value_.rawValue;0===e.length?this.element.classList.add(fC(void 0,"zero")):this.element.classList.remove(fC(void 0,"zero"));const t=[this.valueToX_(e.min),this.valueToX_(e.max)];this.barElement.style.left=`${t[0]}%`,this.barElement.style.right=100-t[1]+"%",this.knobElements.forEach(((e,n)=>{e.style.left=`${t[n]}%`}))}onSliderPropsChange_(){this.update_()}onValueChange_(){this.update_()}}class gC{constructor(e,t){this.grabbing_=null,this.grabOffset_=0,this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.sliderProps=t.sliderProps,this.viewProps=t.viewProps,this.value=t.value,this.view=new vC(e,{sliderProps:this.sliderProps,value:this.value,viewProps:t.viewProps});const n=new Hx(this.view.trackElement);n.emitter.on("down",this.onPointerDown_),n.emitter.on("move",this.onPointerMove_),n.emitter.on("up",this.onPointerUp_)}ofs_(){return"min"===this.grabbing_?this.view.knobElements[0].getBoundingClientRect().width/2:"max"===this.grabbing_?-this.view.knobElements[1].getBoundingClientRect().width/2:0}valueFromData_(e){if(!e.point)return null;return Rb((e.point.x+this.ofs_())/e.bounds.width,0,1,this.sliderProps.get("min"),this.sliderProps.get("max"))}onPointerDown_(e){if(!e.data.point)return;const t=e.data.point.x/e.data.bounds.width,n=this.value.rawValue,i=this.sliderProps.get("min"),s=this.sliderProps.get("max"),r=Rb(n.min,i,s,0,1),a=Rb(n.max,i,s,0,1);Math.abs(a-t)<=.025?this.grabbing_="max":Math.abs(r-t)<=.025?this.grabbing_="min":t>=r&&t<=a?(this.grabbing_="length",this.grabOffset_=Rb(t-r,0,1,0,s-i)):t<r?(this.grabbing_="min",this.onPointerMove_(e)):t>a&&(this.grabbing_="max",this.onPointerMove_(e))}applyPointToValue_(e,t){const n=this.valueFromData_(e);if(null===n)return;const i=this.sliderProps.get("min"),s=this.sliderProps.get("max");if("min"===this.grabbing_)this.value.setRawValue(new hC(n,this.value.rawValue.max),t);else if("max"===this.grabbing_)this.value.setRawValue(new hC(this.value.rawValue.min,n),t);else if("length"===this.grabbing_){const e=this.value.rawValue.length;let r=n-this.grabOffset_,a=r+e;r<i?(r=i,a=i+e):a>s&&(r=s-e,a=s),this.value.setRawValue(new hC(r,a),t)}}onPointerMove_(e){this.applyPointToValue_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.applyPointToValue_(e.data,{forceEmit:!0,last:!0}),this.grabbing_=null}}class _C{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.sc_=new gC(e,t);const n={constraint:t.constraint,textProps:t.textProps};this.tc_=new WE(e,{assembly:uC,axes:[n,n],parser:t.parser,value:this.value,viewProps:t.viewProps}),this.view=new mC(e,{sliderView:this.sc_.view,textView:this.tc_.view})}get textController(){return this.tc_}}function wC(e){return hC.isObject(e)?new hC(e.min,e.max):new hC(0,0)}function bC(e,t){e.writeProperty("max",t.max),e.writeProperty("min",t.min)}const yC=ky({id:"input-interval",type:"input",accept:(e,t)=>{if(!hC.isObject(e))return null;const n=Jb(t,(e=>Object.assign(Object.assign({},zb(e)),{readonly:e.optional.constant(!1)})));return n?{initialValue:new hC(e.min,e.max),params:n}:null},binding:{reader:e=>wC,constraint:e=>function(e){const t=[],n=Bb(e);n&&t.push(n);const i=Vb(e);return i&&t.push(i),new dC(new fx(t))}(e.params),equals:hC.equals,writer:e=>bC},controller(e){const t=e.value,n=e.constraint;if(!(n instanceof dC))throw eb.shouldNeverHappen();const i=(t.rawValue.min+t.rawValue.max)/2,s=ob.fromObject(Fb(e.params,i)),r=n.edge&&vx(n.edge,lb);if(r)return new _C(e.document,{constraint:n.edge,parser:Pb,sliderProps:new ob({keyScale:s.value("keyScale"),max:r.values.value("max"),min:r.values.value("min")}),textProps:s,value:t,viewProps:e.viewProps});const a={constraint:n.edge,textProps:s};return new WE(e.document,{assembly:uC,axes:[a,a],parser:Pb,value:t,viewProps:e.viewProps})}});class xC{constructor(e){this.controller_=e}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(e){this.controller_.viewProps.set("disabled",e)}get title(){var e;return null!==(e=this.controller_.props.get("title"))&&void 0!==e?e:""}set title(e){this.controller_.props.set("title",e)}}class MC extends Wb{constructor(e,t,n,i,s){super(e,i,s),this.cell=t,this.index=n}}class EC extends Gb{constructor(e){super(e),this.cellToApiMap_=new Map;this.controller.valueController.cellControllers.forEach((e=>{const t=new xC(e);this.cellToApiMap_.set(e,t)}))}get value(){return this.controller.value}cell(e,t){const n=this.controller.valueController,i=n.cellControllers[t*n.size[0]+e];return this.cellToApiMap_.get(i)}on(e,t){const n=t.bind(this);this.controller.value.emitter.on(e,(e=>{const t=this.controller.valueController,i=t.findCellByValue(e.rawValue);if(!i)return;const s=this.cellToApiMap_.get(i);if(!s)return;const r=t.cellControllers.indexOf(i);n(new MC(this,s,[r%t.size[0],Math.floor(r/t.size[0])],e.rawValue))}))}}const SC=fy("rad");class CC{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(SC()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("label");n.classList.add(SC("l")),this.element.appendChild(n);const i=e.createElement("input");i.classList.add(SC("i")),i.name=t.name,i.type="radio",t.viewProps.bindDisabled(i),n.appendChild(i),this.inputElement=i;const s=e.createElement("div");s.classList.add(SC("b")),n.appendChild(s);const r=e.createElement("div");r.classList.add(SC("t")),s.appendChild(r),py(t.props,"title",(e=>{r.textContent=e}))}}class TC{constructor(e,t){this.props=t.props,this.viewProps=t.viewProps,this.view=new CC(e,{name:t.name,props:this.props,viewProps:this.viewProps})}}class PC{constructor(e,t){this.cellCs_=[],this.cellValues_=[],this.onCellInputChange_=this.onCellInputChange_.bind(this),this.size=t.size;const[n,i]=this.size;for(let s=0;s<i;s++)for(let i=0;i<n;i++){const n=new TC(e,{name:t.groupName,props:ob.fromObject(Object.assign({},t.cellConfig(i,s))),viewProps:Qy.create()});this.cellCs_.push(n),this.cellValues_.push(t.cellConfig(i,s).value)}this.value=t.value,dy(this.value,(e=>{const t=this.findCellByValue(e);t&&(t.view.inputElement.checked=!0)})),this.viewProps=Qy.create(),this.view=new eM(e,{viewProps:this.viewProps,viewName:"radgrid"}),this.view.element.style.gridTemplateColumns=`repeat(${n}, 1fr)`,this.cellCs_.forEach((e=>{e.view.inputElement.addEventListener("change",this.onCellInputChange_),this.view.element.appendChild(e.view.element)}))}get cellControllers(){return this.cellCs_}findCellByValue(e){const t=this.cellValues_.findIndex((t=>t===e));return t<0?null:this.cellCs_[t]}onCellInputChange_(e){const t=e.currentTarget,n=this.cellCs_.findIndex((e=>e.view.inputElement===t));n<0||(this.value.rawValue=this.cellValues_[n])}}const AC=ky({id:"radiogrid",type:"blade",accept(e){const t=Jb(e,(e=>({cells:e.required.function,groupName:e.required.string,size:e.required.array(e.required.number),value:e.required.raw,view:e.required.constant("radiogrid"),label:e.optional.string})));return t?{params:t}:null},controller(e){const t=ab(e.params.value);return new xy(e.document,{blade:e.blade,props:ob.fromObject({label:e.params.label}),value:t,valueController:new PC(e.document,{groupName:e.params.groupName,cellConfig:e.params.cells,size:e.params.size,value:t})})},api:e=>e.controller instanceof xy&&e.controller.valueController instanceof PC?new EC(e.controller):null});function LC(e){return ky({id:"input-radiogrid",type:"input",accept(t,n){if(!e.isType(t))return null;const i=Jb(n,(e=>({cells:e.required.function,groupName:e.required.string,size:e.required.array(e.required.number),view:e.required.constant("radiogrid")})));return i?{initialValue:t,params:i}:null},binding:e.binding,controller:e=>new PC(e.document,{cellConfig:e.params.cells,groupName:e.params.groupName,size:e.params.size,value:e.value})})}const RC=LC({isType:e=>"number"==typeof e,binding:{reader:e=>Ab,writer:e=>rM}}),DC=LC({isType:e=>"string"==typeof e,binding:{reader:e=>kx,writer:e=>rM}}),IC=LC({isType:e=>"boolean"==typeof e,binding:{reader:e=>Lx,writer:e=>rM}}),kC="essentials",OC='.tp-cbzgv,.tp-radv_b,.tp-rslv_k,.tp-cbzv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-radv_b,.tp-rslv_k,.tp-cbzv_b{background-color:var(--btn-bg);border-radius:var(--bld-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--cnt-usz);line-height:var(--cnt-usz);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-radv_b:hover,.tp-rslv_k:hover,.tp-cbzv_b:hover{background-color:var(--btn-bg-h)}.tp-radv_b:focus,.tp-rslv_k:focus,.tp-cbzv_b:focus{background-color:var(--btn-bg-f)}.tp-radv_b:active,.tp-rslv_k:active,.tp-cbzv_b:active{background-color:var(--btn-bg-a)}.tp-radv_b:disabled,.tp-rslv_k:disabled,.tp-cbzv_b:disabled{opacity:.5}.tp-cbzgv{background-color:var(--in-bg);border-radius:var(--bld-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--cnt-usz);line-height:var(--cnt-usz);min-width:0;width:100%}.tp-cbzgv:hover{background-color:var(--in-bg-h)}.tp-cbzgv:focus{background-color:var(--in-bg-f)}.tp-cbzgv:active{background-color:var(--in-bg-a)}.tp-cbzgv:disabled{opacity:.5}.tp-btngridv{border-radius:var(--bld-br);display:grid;overflow:hidden;gap:2px}.tp-btngridv.tp-v-disabled{opacity:.5}.tp-btngridv .tp-btnv_b:disabled{opacity:1}.tp-btngridv .tp-btnv_b:disabled .tp-btnv_t{opacity:.5}.tp-btngridv .tp-btnv_b{border-radius:0}.tp-cbzv{position:relative}.tp-cbzv_h{display:flex}.tp-cbzv_b{margin-right:4px;position:relative;width:var(--cnt-usz)}.tp-cbzv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-cbzv_b svg path{stroke:var(--bs-bg);stroke-width:2}.tp-cbzv_t{flex:1}.tp-cbzv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-cbzv.tp-cbzv-expanded .tp-cbzv_p{margin-top:var(--cnt-usp);opacity:1}.tp-cbzv.tp-cbzv-cpl .tp-cbzv_p{overflow:visible}.tp-cbzv .tp-popv{left:calc(-1 * var(--cnt-hp));position:absolute;right:calc(-1 * var(--cnt-hp));top:var(--cnt-usz)}.tp-cbzpv_t{margin-top:var(--cnt-usp)}.tp-cbzgv{height:auto;overflow:hidden;position:relative}.tp-cbzgv.tp-v-disabled{opacity:.5}.tp-cbzgv_p{left:16px;position:absolute;right:16px;top:0}.tp-cbzgv_g{cursor:pointer;display:block;height:calc(var(--cnt-usz) * 5);width:100%}.tp-cbzgv_u{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-cbzgv_l{fill:rgba(0,0,0,0);stroke:var(--in-fg)}.tp-cbzgv_v{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-cbzgv_h{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;pointer-events:none;position:absolute;width:4px}.tp-cbzgv:focus .tp-cbzgv_h-sel{background-color:var(--in-fg);border-width:0}.tp-cbzprvv{cursor:pointer;height:4px;padding:4px 0;position:relative}.tp-cbzprvv_g{display:block;height:100%;overflow:visible;width:100%}.tp-cbzprvv_t{opacity:.5;stroke:var(--mo-fg)}.tp-cbzprvv_m{background-color:var(--mo-fg);border-radius:50%;height:4px;margin-left:-2px;margin-top:-2px;opacity:0;position:absolute;top:50%;transition:opacity .2s ease-out;width:4px}.tp-cbzprvv_m.tp-cbzprvv_m-a{opacity:1}.tp-fpsv{position:relative}.tp-fpsv_l{bottom:4px;color:var(--mo-fg);line-height:1;right:4px;pointer-events:none;position:absolute}.tp-fpsv_u{margin-left:.2em;opacity:.7}.tp-rslv{cursor:pointer;padding-left:8px;padding-right:8px}.tp-rslv.tp-v-disabled{opacity:.5}.tp-rslv_t{height:calc(var(--cnt-usz));position:relative}.tp-rslv_t::before{background-color:var(--in-bg);border-radius:1px;content:"";height:2px;margin-top:-1px;position:absolute;top:50%;left:-4px;right:-4px}.tp-rslv_b{bottom:0;top:0;position:absolute}.tp-rslv_b::before{background-color:var(--in-fg);content:"";height:2px;margin-top:-1px;position:absolute;top:50%;left:0;right:0}.tp-rslv_k{height:calc(var(--cnt-usz) - 8px);margin-top:calc((var(--cnt-usz) - 8px)/-2);position:absolute;top:50%;width:8px}.tp-rslv_k.tp-rslv_k-min{margin-left:-8px}.tp-rslv_k.tp-rslv_k-max{margin-left:0}.tp-rslv.tp-rslv-zero .tp-rslv_k.tp-rslv_k-min{border-bottom-right-radius:0;border-top-right-radius:0}.tp-rslv.tp-rslv-zero .tp-rslv_k.tp-rslv_k-max{border-bottom-left-radius:0;border-top-left-radius:0}.tp-rsltxtv{display:flex}.tp-rsltxtv_s{flex:1}.tp-rsltxtv_t{flex:1;margin-left:4px}.tp-radv_l{display:block;position:relative}.tp-radv_i{left:0;opacity:0;position:absolute;top:0}.tp-radv_b{opacity:.5}.tp-radv_i:hover+.tp-radv_b{background-color:var(--btn-bg-h)}.tp-radv_i:focus+.tp-radv_b{background-color:var(--btn-bg-f)}.tp-radv_i:active+.tp-radv_b{background-color:var(--btn-bg-a)}.tp-radv_i:checked+.tp-radv_b{opacity:1}.tp-radv_t{bottom:0;color:inherit;left:0;overflow:hidden;position:absolute;right:0;text-align:center;text-overflow:ellipsis;top:0}.tp-radv_i:disabled+.tp-radv_b>.tp-radv_t{opacity:.5}.tp-radgridv{border-radius:var(--bld-br);display:grid;overflow:hidden;gap:2px}.tp-radgridv.tp-v-disabled{opacity:.5}.tp-radgridv .tp-radv_b{border-radius:0}',NC=[IS,tC,cC,yC,AC,IC,RC,DC];function UC(e){return null==e}function VC(e){return null!==e&&"object"==typeof e}function BC(e){return null!==e&&"object"==typeof e}function FC(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function zC(e,t){return Array.from(new Set([...Object.keys(e),...Object.keys(t)])).reduce(((n,i)=>{const s=e[i],r=t[i];return BC(s)&&BC(r)?Object.assign(Object.assign({},n),{[i]:zC(s,r)}):Object.assign(Object.assign({},n),{[i]:i in t?r:s})}),{})}const HC={alreadydisposed:()=>"View has been already disposed",invalidparams:e=>`Invalid parameters for '${e.name}'`,nomatchingcontroller:e=>`No matching controller for '${e.key}'`,nomatchingview:e=>`No matching view for '${JSON.stringify(e.params)}'`,notbindable:()=>"Value is not bindable",notcompatible:e=>`Not compatible with  plugin '${e.id}'`,propertynotfound:e=>`Property '${e.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class GC{static alreadyDisposed(){return new GC({type:"alreadydisposed"})}static notBindable(){return new GC({type:"notbindable"})}static notCompatible(e,t){return new GC({type:"notcompatible",context:{id:`${e}.${t}`}})}static propertyNotFound(e){return new GC({type:"propertynotfound",context:{name:e}})}static shouldNeverHappen(){return new GC({type:"shouldneverhappen"})}constructor(e){var t;this.message=null!==(t=HC[e.type](e.context))&&void 0!==t?t:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=e.type}toString(){return this.message}}class jC{constructor(e,t){this.obj_=e,this.key=t}static isBindable(e){return null!==e&&("object"==typeof e||"function"==typeof e)}read(){return this.obj_[this.key]}write(e){this.obj_[this.key]=e}writeProperty(e,t){const n=this.read();if(!jC.isBindable(n))throw GC.notBindable();if(!(e in n))throw GC.propertyNotFound(e);n[e]=t}}class WC{constructor(){this.observers_={}}on(e,t){let n=this.observers_[e];return n||(n=this.observers_[e]=[]),n.push({handler:t}),this}off(e,t){const n=this.observers_[e];return n&&(this.observers_[e]=n.filter((e=>e.handler!==t))),this}emit(e,t){const n=this.observers_[e];n&&n.forEach((e=>{e.handler(t)}))}}class qC{constructor(e,t){var n;this.constraint_=null==t?void 0:t.constraint,this.equals_=null!==(n=null==t?void 0:t.equals)&&void 0!==n?n:(e,t)=>e===t,this.emitter=new WC,this.rawValue_=e}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const n=null!=t?t:{forceEmit:!1,last:!0},i=this.constraint_?this.constraint_.constrain(e):e,s=this.rawValue_;(!this.equals_(s,i)||n.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=i,this.emitter.emit("change",{options:n,previousRawValue:s,rawValue:i,sender:this}))}}class XC{constructor(e){this.emitter=new WC,this.value_=e}get rawValue(){return this.value_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const n=null!=t?t:{forceEmit:!1,last:!0},i=this.value_;(i!==e||n.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.value_=e,this.emitter.emit("change",{options:n,previousRawValue:i,rawValue:this.value_,sender:this}))}}class KC{constructor(e){this.emitter=new WC,this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.value_=e,this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_)}get rawValue(){return this.value_.rawValue}onValueBeforeChange_(e){this.emitter.emit("beforechange",Object.assign(Object.assign({},e),{sender:this}))}onValueChange_(e){this.emitter.emit("change",Object.assign(Object.assign({},e),{sender:this}))}}function YC(e,t){const n=null==t?void 0:t.constraint,i=null==t?void 0:t.equals;return n||i?new qC(e,t):new XC(e)}class $C{constructor(e){this.emitter=new WC,this.valMap_=e;for(const e in this.valMap_){this.valMap_[e].emitter.on("change",(()=>{this.emitter.emit("change",{key:e,sender:this})}))}}static createCore(e){return Object.keys(e).reduce(((t,n)=>Object.assign(t,{[n]:YC(e[n])})),{})}static fromObject(e){const t=this.createCore(e);return new $C(t)}get(e){return this.valMap_[e].rawValue}set(e,t){this.valMap_[e].rawValue=t}value(e){return this.valMap_[e]}}class ZC{constructor(e){this.values=$C.fromObject({max:e.max,min:e.min})}constrain(e){const t=this.values.get("max"),n=this.values.get("min");return Math.min(Math.max(e,n),t)}}class JC{constructor(e){this.values=$C.fromObject({max:e.max,min:e.min})}constrain(e){const t=this.values.get("max"),n=this.values.get("min");let i=e;return UC(n)||(i=Math.max(i,n)),UC(t)||(i=Math.min(i,t)),i}}class QC{constructor(e,t=0){this.step=e,this.origin=t}constrain(e){const t=this.origin%this.step;return t+Math.round((e-t)/this.step)*this.step}}class eT{constructor(e){this.text=e}evaluate(){return Number(this.text)}toString(){return this.text}}const tT={"**":(e,t)=>Math.pow(e,t),"*":(e,t)=>e*t,"/":(e,t)=>e/t,"%":(e,t)=>e%t,"+":(e,t)=>e+t,"-":(e,t)=>e-t,"<<":(e,t)=>e<<t,">>":(e,t)=>e>>t,">>>":(e,t)=>e>>>t,"&":(e,t)=>e&t,"^":(e,t)=>e^t,"|":(e,t)=>e|t};class nT{constructor(e,t,n){this.left=t,this.operator=e,this.right=n}evaluate(){const e=tT[this.operator];if(!e)throw new Error(`unexpected binary operator: '${this.operator}`);return e(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const iT={"+":e=>e,"-":e=>-e,"~":e=>~e};class sT{constructor(e,t){this.operator=e,this.expression=t}evaluate(){const e=iT[this.operator];if(!e)throw new Error(`unexpected unary operator: '${this.operator}`);return e(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function rT(e){return(t,n)=>{for(let i=0;i<e.length;i++){const s=e[i](t,n);if(""!==s)return s}return""}}function aT(e,t){var n;const i=e.substr(t).match(/^\s+/);return null!==(n=i&&i[0])&&void 0!==n?n:""}function oT(e,t){var n;const i=e.substr(t).match(/^[0-9]+/);return null!==(n=i&&i[0])&&void 0!==n?n:""}function lT(e,t){const n=e.substr(t,1);if(t+=1,"e"!==n.toLowerCase())return"";const i=function(e,t){const n=oT(e,t);if(""!==n)return n;const i=e.substr(t,1);if("-"!==i&&"+"!==i)return"";const s=oT(e,t+=1);return""===s?"":i+s}(e,t);return""===i?"":n+i}function cT(e,t){const n=e.substr(t,1);if("0"===n)return n;const i=function(e,t){const n=e.substr(t,1);return n.match(/^[1-9]$/)?n:""}(e,t);return t+=i.length,""===i?"":i+oT(e,t)}const hT=rT([function(e,t){const n=cT(e,t);if(t+=n.length,""===n)return"";const i=e.substr(t,1);if(t+=i.length,"."!==i)return"";const s=oT(e,t);return n+i+s+lT(e,t+=s.length)},function(e,t){const n=e.substr(t,1);if(t+=n.length,"."!==n)return"";const i=oT(e,t);return t+=i.length,""===i?"":n+i+lT(e,t)},function(e,t){const n=cT(e,t);return t+=n.length,""===n?"":n+lT(e,t)}]);const uT=rT([function(e,t){const n=e.substr(t,2);if(t+=n.length,"0b"!==n.toLowerCase())return"";const i=function(e,t){var n;const i=e.substr(t).match(/^[01]+/);return null!==(n=i&&i[0])&&void 0!==n?n:""}(e,t);return""===i?"":n+i},function(e,t){const n=e.substr(t,2);if(t+=n.length,"0o"!==n.toLowerCase())return"";const i=function(e,t){var n;const i=e.substr(t).match(/^[0-7]+/);return null!==(n=i&&i[0])&&void 0!==n?n:""}(e,t);return""===i?"":n+i},function(e,t){const n=e.substr(t,2);if(t+=n.length,"0x"!==n.toLowerCase())return"";const i=function(e,t){var n;const i=e.substr(t).match(/^[0-9a-f]+/i);return null!==(n=i&&i[0])&&void 0!==n?n:""}(e,t);return""===i?"":n+i}]),dT=rT([uT,hT]);function pT(e,t){var n;return null!==(n=function(e,t){const n=dT(e,t);return t+=n.length,""===n?null:{evaluable:new eT(n),cursor:t}}(e,t))&&void 0!==n?n:function(e,t){const n=e.substr(t,1);if(t+=n.length,"("!==n)return null;const i=vT(e,t);if(!i)return null;t=i.cursor,t+=aT(e,t).length;const s=e.substr(t,1);return t+=s.length,")"!==s?null:{evaluable:i.evaluable,cursor:t}}(e,t)}function mT(e,t,n){n+=aT(t,n).length;const i=e.filter((e=>t.startsWith(e,n)))[0];return i?(n+=i.length,{cursor:n+=aT(t,n).length,operator:i}):null}const fT=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce(((e,t)=>function(e,t){return(n,i)=>{const s=e(n,i);if(!s)return null;i=s.cursor;let r=s.evaluable;for(;;){const s=mT(t,n,i);if(!s)break;i=s.cursor;const a=e(n,i);if(!a)return null;i=a.cursor,r=new nT(s.operator,r,a.evaluable)}return r?{cursor:i,evaluable:r}:null}}(e,t)),(function e(t,n){const i=pT(t,n);if(i)return i;const s=t.substr(n,1);if(n+=s.length,"+"!==s&&"-"!==s&&"~"!==s)return null;const r=e(t,n);return r?{cursor:n=r.cursor,evaluable:new sT(s,r.evaluable)}:null}));function vT(e,t){return t+=aT(e,t).length,fT(e,t)}function gT(e){var t;const n=function(e){const t=vT(e,0);return t?t.cursor+aT(e,t.cursor).length!==e.length?null:t.evaluable:null}(e);return null!==(t=null==n?void 0:n.evaluate())&&void 0!==t?t:null}function _T(e){if("number"==typeof e)return e;if("string"==typeof e){const t=gT(e);if(!UC(t))return t}return 0}function wT(e){return t=>t.toFixed(Math.max(Math.min(e,20),0))}function bT(e,t,n,i,s){return i+(e-t)/(n-t)*(s-i)}function yT(e){return String(e.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function xT(e,t,n){return Math.min(Math.max(e,t),n)}function MT(e,t){return(e%t+t)%t}function ET(e,t){return UC(e.step)?Math.max(yT(t),2):yT(e.step)}function ST(e){var t;return null!==(t=e.step)&&void 0!==t?t:1}function CT(e,t){var n;const i=Math.abs(null!==(n=e.step)&&void 0!==n?n:t);return 0===i?.1:Math.pow(10,Math.floor(Math.log10(i))-1)}function TT(e,t){return UC(e.step)?null:new QC(e.step,t)}function PT(e){return UC(e.max)||UC(e.min)?UC(e.max)&&UC(e.min)?null:new JC({max:e.max,min:e.min}):new ZC({max:e.max,min:e.min})}function AT(e,t){var n,i,s;return{formatter:null!==(n=e.format)&&void 0!==n?n:wT(ET(e,t)),keyScale:null!==(i=e.keyScale)&&void 0!==i?i:ST(e),pointerScale:null!==(s=e.pointerScale)&&void 0!==s?s:CT(e,t)}}function LT(e){return{format:e.optional.function,keyScale:e.optional.number,max:e.optional.number,min:e.optional.number,pointerScale:e.optional.number,step:e.optional.number}}function RT(e){return{constraint:e.constraint,textProps:$C.fromObject(AT(e.params,e.initialValue))}}class DT{constructor(e){this.controller=e}get element(){return this.controller.view.element}get disabled(){return this.controller.viewProps.get("disabled")}set disabled(e){this.controller.viewProps.set("disabled",e)}get hidden(){return this.controller.viewProps.get("hidden")}set hidden(e){this.controller.viewProps.set("hidden",e)}dispose(){this.controller.viewProps.set("disposed",!0)}importState(e){return this.controller.importState(e)}exportState(){return this.controller.exportState()}}class IT{constructor(e){this.target=e}}class kT extends IT{constructor(e,t,n){super(e),this.value=t,this.last=null==n||n}}class OT extends IT{constructor(e,t){super(e),this.expanded=t}}class NT extends IT{constructor(e,t){super(e),this.index=t}}class UT extends DT{constructor(e){super(e),this.onValueChange_=this.onValueChange_.bind(this),this.emitter_=new WC,this.controller.value.emitter.on("change",this.onValueChange_)}get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get key(){return this.controller.value.binding.target.key}get tag(){return this.controller.tag}set tag(e){this.controller.tag=e}on(e,t){const n=t.bind(this);return this.emitter_.on(e,(e=>{n(e)})),this}refresh(){this.controller.value.fetch()}onValueChange_(e){const t=this.controller.value;this.emitter_.emit("change",new kT(this,t.binding.target.read(),e.options.last))}}function VT(e){return t=>n=>{if(!t&&void 0===n)return{succeeded:!1,value:void 0};if(t&&void 0===n)return{succeeded:!0,value:void 0};const i=e(n);return void 0!==i?{succeeded:!0,value:i}:{succeeded:!1,value:void 0}}}function BT(e){return{custom:t=>VT(t)(e),boolean:VT((e=>"boolean"==typeof e?e:void 0))(e),number:VT((e=>"number"==typeof e?e:void 0))(e),string:VT((e=>"string"==typeof e?e:void 0))(e),function:VT((e=>"function"==typeof e?e:void 0))(e),constant:t=>VT((e=>e===t?t:void 0))(e),raw:VT((e=>e))(e),object:t=>VT((e=>{var n;if(null!==(n=e)&&"object"==typeof n)return function(e,t){const n=Object.keys(t).reduce(((n,i)=>{if(void 0===n)return;const s=(0,t[i])(e[i]);return s.succeeded?Object.assign(Object.assign({},n),{[i]:s.value}):void 0}),{});return n}(e,t)}))(e),array:t=>VT((e=>{var n;if(Array.isArray(e))return n=t,e.reduce(((e,t)=>{if(void 0===e)return;const i=n(t);return i.succeeded&&void 0!==i.value?[...e,i.value]:void 0}),[])}))(e)}}const FT={optional:BT(!0),required:BT(!1)};function zT(e,t){const n=t(FT),i=FT.required.object(n)(e);return i.succeeded?i.value:void 0}function HT(e,t,n,i){if(t&&!t(e))return!1;const s=zT(e,n);return!!s&&i(s)}function GT(e,t){var n;return zC(null!==(n=null==e?void 0:e())&&void 0!==n?n:{},t)}function jT(e){return"value"in e}function WT(e){if(!VC(e)||!("binding"in e))return!1;const t=e.binding;return!!VC(n=t)&&"target"in n;var n}const qT="http://www.w3.org/2000/svg";function XT(e){e.offsetHeight}function KT(e){return void 0!==e.ontouchstart}const YT={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function $T(e,t){const n=e.createElementNS(qT,"svg");return n.innerHTML=YT[t],n}function ZT(e,t,n){e.insertBefore(t,e.children[n])}function JT(e){e.parentElement&&e.parentElement.removeChild(e)}function QT(e){for(;e.children.length>0;)e.removeChild(e.children[0])}function eP(e){return e.relatedTarget?e.relatedTarget:"explicitOriginalTarget"in e?e.explicitOriginalTarget:null}function tP(e,t){e.emitter.on("change",(e=>{t(e.rawValue)})),t(e.rawValue)}function nP(e,t,n){tP(e.value(t),n)}const iP="tp";function sP(e){return(t,n)=>[iP,"-",e,"v",t?`_${t}`:"",n?`-${n}`:""].join("")}const rP=sP("lbl");class aP{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(rP()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(rP("l")),nP(t.props,"label",(t=>{UC(t)?this.element.classList.add(rP(void 0,"nol")):(this.element.classList.remove(rP(void 0,"nol")),function(e){for(;e.childNodes.length>0;)e.removeChild(e.childNodes[0])}(n),n.appendChild(function(e,t){const n=e.createDocumentFragment();return t.split("\n").map((t=>e.createTextNode(t))).forEach(((t,i)=>{i>0&&n.appendChild(e.createElement("br")),n.appendChild(t)})),n}(e,t)))})),this.element.appendChild(n),this.labelElement=n;const i=e.createElement("div");i.classList.add(rP("v")),this.element.appendChild(i),this.valueElement=i}}class oP{constructor(e,t){this.props=t.props,this.valueController=t.valueController,this.viewProps=t.valueController.viewProps,this.view=new aP(e,{props:t.props,viewProps:this.viewProps}),this.view.valueElement.appendChild(this.valueController.view.element)}importProps(e){return HT(e,null,(e=>({label:e.optional.string})),(e=>(this.props.set("label",e.label),!0)))}exportProps(){return GT(null,{label:this.props.get("label")})}}const lP=sP(""),cP={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class hP{constructor(e){this.parent_=null,this.blade=e.blade,this.view=e.view,this.viewProps=e.viewProps;const t=this.view.element;this.blade.value("positions").emitter.on("change",(()=>{["veryfirst","first","last","verylast"].forEach((e=>{t.classList.remove(lP(void 0,cP[e]))})),this.blade.get("positions").forEach((e=>{t.classList.add(lP(void 0,cP[e]))}))})),this.viewProps.handleDispose((()=>{JT(t)}))}get parent(){return this.parent_}set parent(e){this.parent_=e,this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null)}importState(e){return HT(e,null,(e=>({disabled:e.required.boolean,hidden:e.required.boolean})),(e=>(this.viewProps.importState(e),!0)))}exportState(){return GT(null,Object.assign({},this.viewProps.exportState()))}}class uP extends DT{get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get title(){var e;return null!==(e=this.controller.buttonController.props.get("title"))&&void 0!==e?e:""}set title(e){this.controller.buttonController.props.set("title",e)}on(e,t){const n=t.bind(this);return this.controller.buttonController.emitter.on(e,(()=>{n(new IT(this))})),this}}function dP(e,t){return n=>{!function(e,t,n){n?e.classList.add(t):e.classList.remove(t)}(e,t,n)}}function pP(e,t){tP(e,(e=>{t.textContent=null!=e?e:""}))}const mP=sP("btn");class fP{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(mP()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("button");n.classList.add(mP("b")),t.viewProps.bindDisabled(n),this.element.appendChild(n),this.buttonElement=n;const i=e.createElement("div");i.classList.add(mP("t")),pP(t.props.value("title"),i),this.buttonElement.appendChild(i)}}class vP{constructor(e,t){this.emitter=new WC,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new fP(e,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}importProps(e){return HT(e,null,(e=>({title:e.optional.string})),(e=>(this.props.set("title",e.title),!0)))}exportProps(){return GT(null,{title:this.props.get("title")})}onClick_(){this.emitter.emit("click",{sender:this})}}class gP extends hP{constructor(e,t){const n=new vP(e,{props:t.buttonProps,viewProps:t.viewProps}),i=new oP(e,{blade:t.blade,props:t.labelProps,valueController:n});super({blade:t.blade,view:i.view,viewProps:t.viewProps}),this.buttonController=n,this.labelController=i}importState(e){return HT(e,(e=>super.importState(e)&&this.buttonController.importProps(e)&&this.labelController.importProps(e)),(()=>({})),(()=>!0))}exportState(){return GT((()=>super.exportState()),Object.assign(Object.assign({},this.buttonController.exportProps()),this.labelController.exportProps()))}}const _P=new class{constructor(e){const[t,n]=e.split("-"),i=t.split(".");this.major=parseInt(i[0],10),this.minor=parseInt(i[1],10),this.patch=parseInt(i[2],10),this.prerelease=null!=n?n:null}toString(){const e=[this.major,this.minor,this.patch].join(".");return null!==this.prerelease?[e,this.prerelease].join("-"):e}}("2.0.1");function wP(e){return Object.assign({core:_P},e)}wP({id:"button",type:"blade",accept(e){const t=zT(e,(e=>({title:e.required.string,view:e.required.constant("button"),label:e.optional.string})));return t?{params:t}:null},controller:e=>new gP(e.document,{blade:e.blade,buttonProps:$C.fromObject({title:e.params.title}),labelProps:$C.fromObject({label:e.params.label}),viewProps:e.viewProps}),api:e=>e.controller instanceof gP?new uP(e.controller):null});class bP{constructor(e,t){this.onRackValueChange_=this.onRackValueChange_.bind(this),this.controller_=e,this.emitter_=new WC,this.pool_=t;this.controller_.rack.emitter.on("valuechange",this.onRackValueChange_)}get children(){return this.controller_.rack.children.map((e=>this.pool_.createApi(e)))}addBinding(e,t,n){const i=null!=n?n:{},s=this.controller_.element.ownerDocument,r=this.pool_.createBinding(s,function(e,t){if(!jC.isBindable(e))throw GC.notBindable();return new jC(e,t)}(e,t),i),a=this.pool_.createBindingApi(r);return this.add(a,i.index)}addFolder(e){return function(e,t){return e.addBlade(Object.assign(Object.assign({},t),{view:"folder"}))}(this,e)}addButton(e){return function(e,t){return e.addBlade(Object.assign(Object.assign({},t),{view:"button"}))}(this,e)}addTab(e){return function(e,t){return e.addBlade(Object.assign(Object.assign({},t),{view:"tab"}))}(this,e)}add(e,t){const n=e.controller;return this.controller_.rack.add(n,t),e}remove(e){this.controller_.rack.remove(e.controller)}addBlade(e){const t=this.controller_.element.ownerDocument,n=this.pool_.createBlade(t,e),i=this.pool_.createApi(n);return this.add(i,e.index)}on(e,t){const n=t.bind(this);return this.emitter_.on(e,(e=>{n(e)})),this}refresh(){this.children.forEach((e=>{var t;VC(t=e)&&"refresh"in t&&"function"==typeof t.refresh&&e.refresh()}))}onRackValueChange_(e){const t=e.bladeController,n=this.pool_.createApi(t),i=WT(t.value)?t.value.binding:null;this.emitter_.emit("change",new kT(n,i?i.target.read():t.value.rawValue,e.options.last))}}class yP extends DT{constructor(e,t){super(e),this.rackApi_=new bP(e.rackController,t)}refresh(){this.rackApi_.refresh()}}class xP extends hP{constructor(e){super({blade:e.blade,view:e.view,viewProps:e.rackController.viewProps}),this.rackController=e.rackController}importState(e){return HT(e,(e=>super.importState(e)),(e=>({children:e.required.array(e.required.raw)})),(e=>this.rackController.rack.children.every(((t,n)=>t.importState(e.children[n])))))}exportState(){return GT((()=>super.exportState()),{children:this.rackController.rack.children.map((e=>e.exportState()))})}}function MP(e){return"rackController"in e}class EP{constructor(e){this.emitter=new WC,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=e}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(e){for(const t of this.allItems())if(e(t))return t;return null}includes(e){return this.cache_.has(e)}add(e,t){if(this.includes(e))throw GC.shouldNeverHappen();const n=void 0!==t?t:this.items_.length;this.items_.splice(n,0,e),this.cache_.add(e);const i=this.extract_(e);i&&(i.emitter.on("add",this.onSubListAdd_),i.emitter.on("remove",this.onSubListRemove_),i.allItems().forEach((e=>{this.cache_.add(e)}))),this.emitter.emit("add",{index:n,item:e,root:this,target:this})}remove(e){const t=this.items_.indexOf(e);if(t<0)return;this.items_.splice(t,1),this.cache_.delete(e);const n=this.extract_(e);n&&(n.allItems().forEach((e=>{this.cache_.delete(e)})),n.emitter.off("add",this.onSubListAdd_),n.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:t,item:e,root:this,target:this})}onSubListAdd_(e){this.cache_.add(e.item),this.emitter.emit("add",{index:e.index,item:e.item,root:this,target:e.target})}onSubListRemove_(e){this.cache_.delete(e.item),this.emitter.emit("remove",{index:e.index,item:e.item,root:this,target:e.target})}}function SP(e){return MP(e)?e.rackController.rack.bcSet_:null}class CP{constructor(e){var t,n;this.emitter=new WC,this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onRackLayout_=this.onRackLayout_.bind(this),this.onRackValueChange_=this.onRackValueChange_.bind(this),this.blade_=null!==(t=e.blade)&&void 0!==t?t:null,null===(n=this.blade_)||void 0===n||n.value("positions").emitter.on("change",this.onBladePositionsChange_),this.viewProps=e.viewProps,this.bcSet_=new EP(SP),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(e,t){var n;null===(n=e.parent)||void 0===n||n.remove(e),e.parent=this,this.bcSet_.add(e,t)}remove(e){e.parent=null,this.bcSet_.remove(e)}find(e){return this.bcSet_.allItems().filter(e)}onSetAdd_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("add",{bladeController:e.item,index:e.index,root:t,sender:this}),!t)return;const n=e.item;if(n.viewProps.emitter.on("change",this.onChildViewPropsChange_),n.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),n.viewProps.handleDispose(this.onChildDispose_),jT(n))n.value.emitter.on("change",this.onChildValueChange_);else if(MP(n)){const e=n.rackController.rack;if(e){const t=e.emitter;t.on("layout",this.onRackLayout_),t.on("valuechange",this.onRackValueChange_)}}}onSetRemove_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("remove",{bladeController:e.item,root:t,sender:this}),!t)return;const n=e.item;if(jT(n))n.value.emitter.off("change",this.onChildValueChange_);else if(MP(n)){const e=n.rackController.rack;if(e){const t=e.emitter;t.off("layout",this.onRackLayout_),t.off("valuechange",this.onRackValueChange_)}}}updatePositions_(){const e=this.bcSet_.items.filter((e=>!e.viewProps.get("hidden"))),t=e[0],n=e[e.length-1];this.bcSet_.items.forEach((e=>{const i=[];e===t&&(i.push("first"),this.blade_&&!this.blade_.get("positions").includes("veryfirst")||i.push("veryfirst")),e===n&&(i.push("last"),this.blade_&&!this.blade_.get("positions").includes("verylast")||i.push("verylast")),e.blade.set("positions",i)}))}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter((e=>e.viewProps.get("disposed"))).forEach((e=>{this.bcSet_.remove(e)}))}onChildValueChange_(e){const t=function(e,t){for(let n=0;n<e.length;n++){const i=e[n];if(jT(i)&&i.value===t)return i}return null}(this.find(jT),e.sender);if(!t)throw GC.alreadyDisposed();this.emitter.emit("valuechange",{bladeController:t,options:e.options,sender:this})}onRackLayout_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onRackValueChange_(e){this.emitter.emit("valuechange",{bladeController:e.bladeController,options:e.options,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class TP{constructor(e){this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.element=e.element,this.viewProps=e.viewProps;const t=new CP({blade:e.root?void 0:e.blade,viewProps:e.viewProps});t.emitter.on("add",this.onRackAdd_),t.emitter.on("remove",this.onRackRemove_),this.rack=t,this.viewProps.handleDispose((()=>{for(let e=this.rack.children.length-1;e>=0;e--){this.rack.children[e].viewProps.set("disposed",!0)}}))}onRackAdd_(e){e.root&&ZT(this.element,e.bladeController.view.element,e.index)}onRackRemove_(e){e.root&&JT(e.bladeController.view.element)}}function PP(){return new $C({positions:YC([],{equals:FC})})}class AP extends $C{constructor(e){super(e)}static create(e){const t={completed:!0,expanded:e,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},n=$C.createCore(t);return new AP(n)}get styleExpanded(){var e;return null!==(e=this.get("temporaryExpanded"))&&void 0!==e?e:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const e=this.get("expandedHeight");return this.get("shouldFixHeight")&&!UC(e)?`${e}px`:"auto"}bindExpandedClass(e,t){const n=()=>{this.styleExpanded?e.classList.add(t):e.classList.remove(t)};nP(this,"expanded",n),nP(this,"temporaryExpanded",n)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function LP(e,t){t.style.height=e.styleHeight}function RP(e,t){e.value("expanded").emitter.on("beforechange",(()=>{if(e.set("completed",!1),UC(e.get("expandedHeight"))){const n=function(e,t){let n=0;return function(e,t){const n=e.style.transition;e.style.transition="none",t(),e.style.transition=n}(t,(()=>{e.set("expandedHeight",null),e.set("temporaryExpanded",!0),XT(t),n=t.clientHeight,e.set("temporaryExpanded",null),XT(t)})),n}(e,t);n>0&&e.set("expandedHeight",n)}e.set("shouldFixHeight",!0),XT(t)})),e.emitter.on("change",(()=>{LP(e,t)})),LP(e,t),t.addEventListener("transitionend",(t=>{"height"===t.propertyName&&e.cleanUpTransition()}))}class DP extends yP{constructor(e,t){super(e,t),this.emitter_=new WC,this.controller.foldable.value("expanded").emitter.on("change",(e=>{this.emitter_.emit("fold",new OT(this,e.sender.rawValue))})),this.rackApi_.on("change",(e=>{this.emitter_.emit("change",e)}))}get expanded(){return this.controller.foldable.get("expanded")}set expanded(e){this.controller.foldable.set("expanded",e)}get title(){return this.controller.props.get("title")}set title(e){this.controller.props.set("title",e)}get children(){return this.rackApi_.children}addBinding(e,t,n){return this.rackApi_.addBinding(e,t,n)}addFolder(e){return this.rackApi_.addFolder(e)}addButton(e){return this.rackApi_.addButton(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){return this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBlade(e){return this.rackApi_.addBlade(e)}on(e,t){const n=t.bind(this);return this.emitter_.on(e,(e=>{n(e)})),this}}const IP=sP("cnt");class kP{constructor(e,t){var n;this.className_=sP(null!==(n=t.viewName)&&void 0!==n?n:"fld"),this.element=e.createElement("div"),this.element.classList.add(this.className_(),IP()),t.viewProps.bindClassModifiers(this.element),this.foldable_=t.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),nP(this.foldable_,"completed",dP(this.element,this.className_(void 0,"cpl")));const i=e.createElement("button");i.classList.add(this.className_("b")),nP(t.props,"title",(e=>{UC(e)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))})),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const s=e.createElement("div");s.classList.add(this.className_("i")),this.element.appendChild(s);const r=e.createElement("div");r.classList.add(this.className_("t")),pP(t.props.value("title"),r),this.buttonElement.appendChild(r),this.titleElement=r;const a=e.createElement("div");a.classList.add(this.className_("m")),this.buttonElement.appendChild(a);const o=e.createElement("div");o.classList.add(this.className_("c")),this.element.appendChild(o),this.containerElement=o}}class OP extends xP{constructor(e,t){var n;const i=AP.create(null===(n=t.expanded)||void 0===n||n),s=new kP(e,{foldable:i,props:t.props,viewName:t.root?"rot":void 0,viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:new TP({blade:t.blade,element:s.containerElement,root:t.root,viewProps:t.viewProps}),view:s})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=t.props,this.foldable=i,RP(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",(()=>{this.foldable.cleanUpTransition()})),this.rackController.rack.emitter.on("remove",(()=>{this.foldable.cleanUpTransition()})),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}importState(e){return HT(e,(e=>super.importState(e)),(e=>({expanded:e.required.boolean,title:e.optional.string})),(e=>(this.foldable.set("expanded",e.expanded),this.props.set("title",e.title),!0)))}exportState(){return GT((()=>super.exportState()),{expanded:this.foldable.get("expanded"),title:this.props.get("title")})}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}wP({id:"folder",type:"blade",accept(e){const t=zT(e,(e=>({title:e.required.string,view:e.required.constant("folder"),expanded:e.optional.boolean})));return t?{params:t}:null},controller:e=>new OP(e.document,{blade:e.blade,expanded:e.params.expanded,props:$C.fromObject({title:e.params.title}),viewProps:e.viewProps}),api:e=>e.controller instanceof OP?new DP(e.controller,e.pool):null});const NP=sP("");function UP(e,t){return dP(e,NP(void 0,t))}class VP extends $C{constructor(e){var t,n;super(e),this.onDisabledChange_=this.onDisabledChange_.bind(this),this.onParentChange_=this.onParentChange_.bind(this),this.onParentGlobalDisabledChange_=this.onParentGlobalDisabledChange_.bind(this),[this.globalDisabled_,this.setGlobalDisabled_]=(n=YC(this.getGlobalDisabled_()),[new KC(n),(e,t)=>{n.setRawValue(e,t)}]),this.value("disabled").emitter.on("change",this.onDisabledChange_),this.value("parent").emitter.on("change",this.onParentChange_),null===(t=this.get("parent"))||void 0===t||t.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_)}static create(e){var t,n,i;const s=null!=e?e:{};return new VP($C.createCore({disabled:null!==(t=s.disabled)&&void 0!==t&&t,disposed:!1,hidden:null!==(n=s.hidden)&&void 0!==n&&n,parent:null!==(i=s.parent)&&void 0!==i?i:null}))}get globalDisabled(){return this.globalDisabled_}bindClassModifiers(e){tP(this.globalDisabled_,UP(e,"disabled")),nP(this,"hidden",UP(e,"hidden"))}bindDisabled(e){tP(this.globalDisabled_,(t=>{e.disabled=t}))}bindTabIndex(e){tP(this.globalDisabled_,(t=>{e.tabIndex=t?-1:0}))}handleDispose(e){this.value("disposed").emitter.on("change",(t=>{t&&e()}))}importState(e){this.set("disabled",e.disabled),this.set("hidden",e.hidden)}exportState(){return{disabled:this.get("disabled"),hidden:this.get("hidden")}}getGlobalDisabled_(){const e=this.get("parent");return!!e&&e.globalDisabled.rawValue||this.get("disabled")}updateGlobalDisabled_(){this.setGlobalDisabled_(this.getGlobalDisabled_())}onDisabledChange_(){this.updateGlobalDisabled_()}onParentGlobalDisabledChange_(){this.updateGlobalDisabled_()}onParentChange_(e){var t;const n=e.previousRawValue;null==n||n.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),null===(t=this.get("parent"))||void 0===t||t.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}}const BP=sP("tbp");class FP{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(BP()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(BP("c")),this.element.appendChild(n),this.containerElement=n}}const zP=sP("tbi");class HP{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(zP()),t.viewProps.bindClassModifiers(this.element),nP(t.props,"selected",(e=>{e?this.element.classList.add(zP(void 0,"sel")):this.element.classList.remove(zP(void 0,"sel"))}));const n=e.createElement("button");n.classList.add(zP("b")),t.viewProps.bindDisabled(n),this.element.appendChild(n),this.buttonElement=n;const i=e.createElement("div");i.classList.add(zP("t")),pP(t.props.value("title"),i),this.buttonElement.appendChild(i),this.titleElement=i}}class GP{constructor(e,t){this.emitter=new WC,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new HP(e,{props:t.props,viewProps:t.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class jP extends xP{constructor(e,t){const n=new FP(e,{viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:new TP({blade:t.blade,element:n.containerElement,viewProps:t.viewProps}),view:n})),this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new GP(e,{props:t.itemProps,viewProps:VP.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.props=t.props,nP(this.props,"selected",(e=>{this.itemController.props.set("selected",e),this.viewProps.set("hidden",!e)}))}get itemController(){return this.ic_}importState(e){return HT(e,(e=>super.importState(e)),(e=>({selected:e.required.boolean,title:e.required.string})),(e=>(this.ic_.props.set("selected",e.selected),this.ic_.props.set("title",e.title),!0)))}exportState(){return GT((()=>super.exportState()),{selected:this.ic_.props.get("selected"),title:this.ic_.props.get("title")})}onItemClick_(){this.props.set("selected",!0)}}class WP extends yP{constructor(e,t){super(e,t),this.emitter_=new WC,this.onSelect_=this.onSelect_.bind(this),this.pool_=t,this.rackApi_.on("change",(e=>{this.emitter_.emit("change",e)})),this.controller.tab.selectedIndex.emitter.on("change",this.onSelect_)}get pages(){return this.rackApi_.children}addPage(e){const t=this.controller.view.element.ownerDocument,n=new jP(t,{blade:PP(),itemProps:$C.fromObject({selected:!1,title:e.title}),props:$C.fromObject({selected:!1}),viewProps:VP.create()}),i=this.pool_.createApi(n);return this.rackApi_.add(i,e.index)}removePage(e){this.rackApi_.remove(this.rackApi_.children[e])}on(e,t){const n=t.bind(this);return this.emitter_.on(e,(e=>{n(e)})),this}onSelect_(e){this.emitter_.emit("select",new NT(this,e.rawValue))}}class qP extends yP{get title(){var e;return null!==(e=this.controller.itemController.props.get("title"))&&void 0!==e?e:""}set title(e){this.controller.itemController.props.set("title",e)}get selected(){return this.controller.props.get("selected")}set selected(e){this.controller.props.set("selected",e)}get children(){return this.rackApi_.children}addButton(e){return this.rackApi_.addButton(e)}addFolder(e){return this.rackApi_.addFolder(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBinding(e,t,n){return this.rackApi_.addBinding(e,t,n)}addBlade(e){return this.rackApi_.addBlade(e)}}class XP{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=YC(!0),this.selectedIndex=YC(-1),this.items_=[]}add(e,t){const n=null!=t?t:this.items_.length;this.items_.splice(n,0,e),e.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(e){const t=this.items_.indexOf(e);t<0||(this.items_.splice(t,1),e.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(0===this.items_.length)return this.selectedIndex.rawValue=-1,void(this.empty.rawValue=!0);const e=this.items_.findIndex((e=>e.rawValue));e<0?(this.items_.forEach(((e,t)=>{e.rawValue=0===t})),this.selectedIndex.rawValue=0):(this.items_.forEach(((t,n)=>{t.rawValue=n===e})),this.selectedIndex.rawValue=e),this.empty.rawValue=!1}onItemSelectedChange_(e){if(e.rawValue){const t=this.items_.findIndex((t=>t===e.sender));this.items_.forEach(((e,n)=>{e.rawValue=n===t})),this.selectedIndex.rawValue=t}else this.keepSelection_()}}const KP=sP("tab");class YP{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(KP(),IP()),t.viewProps.bindClassModifiers(this.element),tP(t.empty,dP(this.element,KP(void 0,"nop")));const n=e.createElement("div");n.classList.add(KP("t")),this.element.appendChild(n),this.itemsElement=n;const i=e.createElement("div");i.classList.add(KP("i")),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(KP("c")),this.element.appendChild(s),this.contentsElement=s}}class $P extends xP{constructor(e,t){const n=new XP,i=new YP(e,{empty:n.empty,viewProps:t.viewProps});super({blade:t.blade,rackController:new TP({blade:t.blade,element:i.contentsElement,viewProps:t.viewProps}),view:i}),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const s=this.rackController.rack;s.emitter.on("add",this.onRackAdd_),s.emitter.on("remove",this.onRackRemove_),this.tab=n}add(e,t){this.rackController.rack.add(e,t)}remove(e){this.rackController.rack.remove(this.rackController.rack.children[e])}onRackAdd_(e){if(!e.root)return;const t=e.bladeController;ZT(this.view.itemsElement,t.itemController.view.element,e.index),t.itemController.viewProps.set("parent",this.viewProps),this.tab.add(t.props.value("selected"))}onRackRemove_(e){if(!e.root)return;const t=e.bladeController;JT(t.itemController.view.element),t.itemController.viewProps.set("parent",null),this.tab.remove(t.props.value("selected"))}}wP({id:"tab",type:"blade",accept(e){const t=zT(e,(e=>({pages:e.required.array(e.required.object({title:e.required.string})),view:e.required.constant("tab")})));return t&&0!==t.pages.length?{params:t}:null},controller(e){const t=new $P(e.document,{blade:e.blade,viewProps:e.viewProps});return e.params.pages.forEach((n=>{const i=new jP(e.document,{blade:PP(),itemProps:$C.fromObject({selected:!1,title:n.title}),props:$C.fromObject({selected:!1}),viewProps:VP.create()});t.add(i)})),t},api:e=>e.controller instanceof $P?new WP(e.controller,e.pool):e.controller instanceof jP?new qP(e.controller,e.pool):null});class ZP extends UT{get options(){return this.controller.valueController.props.get("options")}set options(e){this.controller.valueController.props.set("options",e)}}class JP{constructor(e){this.constraints=e}constrain(e){return this.constraints.reduce(((e,t)=>t.constrain(e)),e)}}function QP(e,t){if(e instanceof t)return e;if(e instanceof JP){const n=e.constraints.reduce(((e,n)=>e||(n instanceof t?n:null)),null);if(n)return n}return null}class eA{constructor(e){this.values=$C.fromObject({options:e})}constrain(e){const t=this.values.get("options");if(0===t.length)return e;return t.filter((t=>t.value===e)).length>0?e:t[0].value}}function tA(e){var t;const n=FT;return Array.isArray(e)?null===(t=zT({items:e},(e=>({items:e.required.array(e.required.object({text:e.required.string,value:e.required.raw}))}))))||void 0===t?void 0:t.items:"object"==typeof e?n.required.raw(e).value:void 0}function nA(e){if(Array.isArray(e))return e;const t=[];return Object.keys(e).forEach((n=>{t.push({text:n,value:e[n]})})),t}function iA(e){return UC(e)?null:new eA(nA(e))}const sA=sP("lst");class rA{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.element=e.createElement("div"),this.element.classList.add(sA()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("select");n.classList.add(sA("s")),t.viewProps.bindDisabled(n),this.element.appendChild(n),this.selectElement=n;const i=e.createElement("div");i.classList.add(sA("m")),i.appendChild($T(e,"dropdown")),this.element.appendChild(i),t.value.emitter.on("change",this.onValueChange_),this.value_=t.value,nP(this.props_,"options",(t=>{QT(this.selectElement),t.forEach((t=>{const n=e.createElement("option");n.textContent=t.text,this.selectElement.appendChild(n)})),this.update_()}))}update_(){const e=this.props_.get("options").map((e=>e.value));this.selectElement.selectedIndex=e.indexOf(this.value_.rawValue)}onValueChange_(){this.update_()}}class aA{constructor(e,t){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new rA(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(e){const t=e.currentTarget;this.value.rawValue=this.props.get("options")[t.selectedIndex].value}importProps(e){return HT(e,null,(e=>({options:e.required.custom(tA)})),(e=>(this.props.set("options",nA(e.options)),!0)))}exportProps(){return GT(null,{options:this.props.get("options")})}}const oA=sP("pop");class lA{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(oA()),t.viewProps.bindClassModifiers(this.element),tP(t.shows,dP(this.element,oA(void 0,"v")))}}class cA{constructor(e,t){this.shows=YC(!1),this.viewProps=t.viewProps,this.view=new lA(e,{shows:this.shows,viewProps:this.viewProps})}}const hA=sP("txt");class uA{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(hA()),t.viewProps.bindClassModifiers(this.element),this.props_=t.props,this.props_.emitter.on("change",this.onChange_);const n=e.createElement("input");n.classList.add(hA("i")),n.type="text",t.viewProps.bindDisabled(n),this.element.appendChild(n),this.inputElement=n,t.value.emitter.on("change",this.onChange_),this.value_=t.value,this.refresh()}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value_.rawValue)}onChange_(){this.refresh()}}class dA{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=t.parser,this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new uA(e,{props:t.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const t=e.currentTarget.value,n=this.parser_(t);UC(n)||(this.value.rawValue=n),this.view.refresh()}}function pA(e){return"false"!==e&&!!e}function mA(e){return function(e){return String(e)}(e)}const fA=wT(0);function vA(e){return fA(e)+"%"}function gA(e){return String(e)}function _A(e){return e}function wA({primary:e,secondary:t,forward:n,backward:i}){let s=!1;function r(e){s||(s=!0,e(),s=!1)}e.emitter.on("change",(i=>{r((()=>{t.setRawValue(n(e.rawValue,t.rawValue),i.options)}))})),t.emitter.on("change",(s=>{r((()=>{e.setRawValue(i(e.rawValue,t.rawValue),s.options)})),r((()=>{t.setRawValue(n(e.rawValue,t.rawValue),s.options)}))})),r((()=>{t.setRawValue(n(e.rawValue,t.rawValue),{forceEmit:!1,last:!0})}))}function bA(e,t){const n=e*(t.altKey?.1:1)*(t.shiftKey?10:1);return t.upKey?+n:t.downKey?-n:0}function yA(e){return{altKey:e.altKey,downKey:"ArrowDown"===e.key,shiftKey:e.shiftKey,upKey:"ArrowUp"===e.key}}function xA(e){return{altKey:e.altKey,downKey:"ArrowLeft"===e.key,shiftKey:e.shiftKey,upKey:"ArrowRight"===e.key}}function MA(e){return function(e){return"ArrowUp"===e||"ArrowDown"===e}(e)||"ArrowLeft"===e||"ArrowRight"===e}function EA(e,t){var n,i;const s=t.ownerDocument.defaultView,r=t.getBoundingClientRect();return{x:e.pageX-((null!==(n=s&&s.scrollX)&&void 0!==n?n:0)+r.left),y:e.pageY-((null!==(i=s&&s.scrollY)&&void 0!==i?i:0)+r.top)}}class SA{constructor(e){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=e,this.emitter=new WC,e.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),e.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),e.addEventListener("touchend",this.onTouchEnd_),e.addEventListener("mousedown",this.onMouseDown_)}computePosition_(e){const t=this.elem_.getBoundingClientRect();return{bounds:{width:t.width,height:t.height},point:e?{x:e.x,y:e.y}:null}}onMouseDown_(e){var t;e.preventDefault(),null===(t=e.currentTarget)||void 0===t||t.focus();const n=this.elem_.ownerDocument;n.addEventListener("mousemove",this.onDocumentMouseMove_),n.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(EA(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseMove_(e){this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(EA(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseUp_(e){const t=this.elem_.ownerDocument;t.removeEventListener("mousemove",this.onDocumentMouseMove_),t.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(EA(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onTouchStart_(e){e.preventDefault();const t=e.targetTouches.item(0),n=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-n.left,y:t.clientY-n.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchMove_(e){const t=e.targetTouches.item(0),n=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-n.left,y:t.clientY-n.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchEnd_(e){var t;const n=null!==(t=e.targetTouches.item(0))&&void 0!==t?t:this.lastTouch_,i=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(n?{x:n.clientX-i.left,y:n.clientY-i.top}:void 0),sender:this,shiftKey:e.shiftKey})}}const CA=sP("txt");class TA{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(CA(),CA(void 0,"num")),t.arrayPosition&&this.element.classList.add(CA(void 0,t.arrayPosition)),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("input");n.classList.add(CA("i")),n.type="text",t.viewProps.bindDisabled(n),this.element.appendChild(n),this.inputElement=n,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=t.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(CA()),this.inputElement.classList.add(CA("i"));const i=e.createElement("div");i.classList.add(CA("k")),this.element.appendChild(i),this.knobElement=i;const s=e.createElementNS(qT,"svg");s.classList.add(CA("g")),this.knobElement.appendChild(s);const r=e.createElementNS(qT,"path");r.classList.add(CA("gb")),s.appendChild(r),this.guideBodyElem_=r;const a=e.createElementNS(qT,"path");a.classList.add(CA("gh")),s.appendChild(a),this.guideHeadElem_=a;const o=e.createElement("div");o.classList.add(sP("tt")()),this.knobElement.appendChild(o),this.tooltipElem_=o,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.refresh()}onDraggingChange_(e){if(null===e.rawValue)return void this.element.classList.remove(CA(void 0,"drg"));this.element.classList.add(CA(void 0,"drg"));const t=e.rawValue/this.props_.get("pointerScale"),n=t+(t>0?-1:t<0?1:0),i=xT(-n,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${n+i},0 L${n},4 L${n+i},8`,`M ${t},-1 L${t},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${t},4`);const s=this.props_.get("formatter");this.tooltipElem_.textContent=s(this.value.rawValue),this.tooltipElem_.style.left=`${t}px`}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value.rawValue)}onChange_(){this.refresh()}}class PA{constructor(e,t){var n;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.parser_=t.parser,this.props=t.props,this.sliderProps_=null!==(n=t.sliderProps)&&void 0!==n?n:null,this.value=t.value,this.viewProps=t.viewProps,this.dragging_=YC(null),this.view=new TA(e,{arrayPosition:t.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const i=new SA(this.view.knobElement);i.emitter.on("down",this.onPointerDown_),i.emitter.on("move",this.onPointerMove_),i.emitter.on("up",this.onPointerUp_)}constrainValue_(e){var t,n;const i=null===(t=this.sliderProps_)||void 0===t?void 0:t.get("min"),s=null===(n=this.sliderProps_)||void 0===n?void 0:n.get("max");let r=e;return void 0!==i&&(r=Math.max(r,i)),void 0!==s&&(r=Math.min(r,s)),r}onInputChange_(e){const t=e.currentTarget.value,n=this.parser_(t);UC(n)||(this.value.rawValue=this.constrainValue_(n)),this.view.refresh()}onInputKeyDown_(e){const t=bA(this.props.get("keyScale"),yA(e));0!==t&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+t),{forceEmit:!1,last:!1})}onInputKeyUp_(e){0!==bA(this.props.get("keyScale"),yA(e))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(e){if(!e.point)return null;const t=e.point.x-e.bounds.width/2;return this.constrainValue_(this.originRawValue_+t*this.props.get("pointerScale"))}onPointerMove_(e){const t=this.computeDraggingValue_(e.data);null!==t&&(this.value.setRawValue(t,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(e){const t=this.computeDraggingValue_(e.data);null!==t&&(this.value.setRawValue(t,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}const AA=sP("sld");class LA{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(AA()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(AA("t")),t.viewProps.bindTabIndex(n),this.element.appendChild(n),this.trackElement=n;const i=e.createElement("div");i.classList.add(AA("k")),this.trackElement.appendChild(i),this.knobElement=i,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.update_()}update_(){const e=xT(bT(this.value.rawValue,this.props_.get("min"),this.props_.get("max"),0,100),0,100);this.knobElement.style.width=`${e}%`}onChange_(){this.update_()}}class RA{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.props=t.props,this.view=new LA(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new SA(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){e.point&&this.value.setRawValue(bT(xT(e.point.x,0,e.bounds.width),0,e.bounds.width,this.props.get("min"),this.props.get("max")),t)}onPointerDownOrMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=bA(this.props.get("keyScale"),xA(e));0!==t&&this.value.setRawValue(this.value.rawValue+t,{forceEmit:!1,last:!1})}onKeyUp_(e){0!==bA(this.props.get("keyScale"),xA(e))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const DA=sP("sldtxt");class IA{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(DA());const n=e.createElement("div");n.classList.add(DA("s")),this.sliderView_=t.sliderView,n.appendChild(this.sliderView_.element),this.element.appendChild(n);const i=e.createElement("div");i.classList.add(DA("t")),this.textView_=t.textView,i.appendChild(this.textView_.element),this.element.appendChild(i)}}class kA{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.sliderC_=new RA(e,{props:t.sliderProps,value:t.value,viewProps:this.viewProps}),this.textC_=new PA(e,{parser:t.parser,props:t.textProps,sliderProps:t.sliderProps,value:t.value,viewProps:t.viewProps}),this.view=new IA(e,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}importProps(e){return HT(e,null,(e=>({max:e.required.number,min:e.required.number})),(e=>{const t=this.sliderC_.props;return t.set("max",e.max),t.set("min",e.min),!0}))}exportProps(){const e=this.sliderC_.props;return GT(null,{max:e.get("max"),min:e.get("min")})}}const OA={containerUnitSize:"cnt-usz"};function NA(e){return`--${OA[e]}`}function UA(e){return LT(e)}function VA(e){if(BC(e))return zT(e,UA)}function BA(e,t){if(!e)return;const n=[],i=TT(e,t);i&&n.push(i);const s=PT(e);return s&&n.push(s),new JP(n)}function FA(e){if("inline"===e||"popup"===e)return e}function zA(e,t){e.write(t)}const HA=sP("ckb");class GA{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(HA()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("label");n.classList.add(HA("l")),this.element.appendChild(n);const i=e.createElement("input");i.classList.add(HA("i")),i.type="checkbox",n.appendChild(i),this.inputElement=i,t.viewProps.bindDisabled(this.inputElement);const s=e.createElement("div");s.classList.add(HA("w")),n.appendChild(s);const r=$T(e,"check");s.appendChild(r),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class jA{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new GA(e,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const t=e.currentTarget;this.value.rawValue=t.checked}}wP({id:"input-bool",type:"input",accept:(e,t)=>{if("boolean"!=typeof e)return null;const n=zT(t,(e=>({options:e.optional.custom(tA),readonly:e.optional.constant(!1)})));return n?{initialValue:e,params:n}:null},binding:{reader:e=>pA,constraint:e=>function(e){const t=[],n=iA(e.options);return n&&t.push(n),new JP(t)}(e.params),writer:e=>zA},controller:e=>{const t=e.document,n=e.value,i=e.constraint,s=i&&QP(i,eA);return s?new aA(t,{props:new $C({options:s.values.value("options")}),value:n,viewProps:e.viewProps}):new jA(t,{value:n,viewProps:e.viewProps})},api:e=>"boolean"!=typeof e.controller.value.rawValue?null:e.controller.valueController instanceof aA?new ZP(e.controller):null});const WA=sP("col");class qA{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(WA()),t.foldable.bindExpandedClass(this.element,WA(void 0,"expanded")),nP(t.foldable,"completed",dP(this.element,WA(void 0,"cpl")));const n=e.createElement("div");n.classList.add(WA("h")),this.element.appendChild(n);const i=e.createElement("div");i.classList.add(WA("s")),n.appendChild(i),this.swatchElement=i;const s=e.createElement("div");if(s.classList.add(WA("t")),n.appendChild(s),this.textElement=s,"inline"===t.pickerLayout){const t=e.createElement("div");t.classList.add(WA("p")),this.element.appendChild(t),this.pickerElement=t}else this.pickerElement=null}}function XA(e,t,n){const i=MT(e,360),s=xT(t/100,0,1),r=xT(n/100,0,1),a=r*s,o=a*(1-Math.abs(i/60%2-1)),l=r-a;let c,h,u;return[c,h,u]=i>=0&&i<60?[a,o,0]:i>=60&&i<120?[o,a,0]:i>=120&&i<180?[0,a,o]:i>=180&&i<240?[0,o,a]:i>=240&&i<300?[o,0,a]:[a,0,o],[255*(c+l),255*(h+l),255*(u+l)]}function KA(e){return[e[0],e[1],e[2]]}function YA(e,t){return[e[0],e[1],e[2],t]}const $A={hsl:{hsl:(e,t,n)=>[e,t,n],hsv:function(e,t,n){const i=n+t*(100-Math.abs(2*n-100))/200;return[e,0!==i?t*(100-Math.abs(2*n-100))/i:0,n+t*(100-Math.abs(2*n-100))/200]},rgb:function(e,t,n){const i=(e%360+360)%360,s=xT(t/100,0,1),r=xT(n/100,0,1),a=(1-Math.abs(2*r-1))*s,o=a*(1-Math.abs(i/60%2-1)),l=r-a/2;let c,h,u;return[c,h,u]=i>=0&&i<60?[a,o,0]:i>=60&&i<120?[o,a,0]:i>=120&&i<180?[0,a,o]:i>=180&&i<240?[0,o,a]:i>=240&&i<300?[o,0,a]:[a,0,o],[255*(c+l),255*(h+l),255*(u+l)]}},hsv:{hsl:function(e,t,n){const i=100-Math.abs(n*(200-t)/100-100);return[e,0!==i?t*n/i:0,n*(200-t)/200]},hsv:(e,t,n)=>[e,t,n],rgb:XA},rgb:{hsl:function(e,t,n){const i=xT(e/255,0,1),s=xT(t/255,0,1),r=xT(n/255,0,1),a=Math.max(i,s,r),o=Math.min(i,s,r),l=a-o;let c=0,h=0;const u=(o+a)/2;return 0!==l&&(h=l/(1-Math.abs(a+o-1)),c=i===a?(s-r)/l:s===a?2+(r-i)/l:4+(i-s)/l,c=c/6+(c<0?1:0)),[360*c,100*h,100*u]},hsv:function(e,t,n){const i=xT(e/255,0,1),s=xT(t/255,0,1),r=xT(n/255,0,1),a=Math.max(i,s,r),o=a-Math.min(i,s,r);let l;return l=0===o?0:a===i?((s-r)/o%6+6)%6*60:a===s?60*((r-i)/o+2):60*((i-s)/o+4),[l,100*(0===a?0:o/a),100*a]},rgb:(e,t,n)=>[e,t,n]}};function ZA(e,t){return["float"===t?1:"rgb"===e?255:360,"float"===t?1:"rgb"===e?255:100,"float"===t?1:"rgb"===e?255:100]}function JA(e,t,n){var i;const s=ZA(t,n);return["rgb"===t?xT(e[0],0,s[0]):(r=e[0],a=s[0],r===a?a:MT(r,a)),xT(e[1],0,s[1]),xT(e[2],0,s[2]),xT(null!==(i=e[3])&&void 0!==i?i:1,0,1)];var r,a}function QA(e,t,n,i){const s=ZA(t,n),r=ZA(t,i);return e.map(((e,t)=>e/s[t]*r[t]))}function eL(e,t,n){const i=QA(e,t.mode,t.type,"int");return QA($A[t.mode][n.mode](...i),n.mode,"int",n.type)}class tL{static black(){return new tL([0,0,0],"rgb")}constructor(e,t){this.type="int",this.mode=t,this.comps_=JA(e,t,this.type)}getComponents(e){return YA(eL(KA(this.comps_),{mode:this.mode,type:this.type},{mode:null!=e?e:this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const e=this.getComponents("rgb");return{r:e[0],g:e[1],b:e[2],a:e[3]}}}const nL=sP("colp");class iL{constructor(e,t){this.alphaViews_=null,this.element=e.createElement("div"),this.element.classList.add(nL()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(nL("hsv"));const i=e.createElement("div");i.classList.add(nL("sv")),this.svPaletteView_=t.svPaletteView,i.appendChild(this.svPaletteView_.element),n.appendChild(i);const s=e.createElement("div");s.classList.add(nL("h")),this.hPaletteView_=t.hPaletteView,s.appendChild(this.hPaletteView_.element),n.appendChild(s),this.element.appendChild(n);const r=e.createElement("div");if(r.classList.add(nL("rgb")),this.textsView_=t.textsView,r.appendChild(this.textsView_.element),this.element.appendChild(r),t.alphaViews){this.alphaViews_={palette:t.alphaViews.palette,text:t.alphaViews.text};const n=e.createElement("div");n.classList.add(nL("a"));const i=e.createElement("div");i.classList.add(nL("ap")),i.appendChild(this.alphaViews_.palette.element),n.appendChild(i);const s=e.createElement("div");s.classList.add(nL("at")),s.appendChild(this.alphaViews_.text.element),n.appendChild(s),this.element.appendChild(n)}}get allFocusableElements(){const e=[this.svPaletteView_.element,this.hPaletteView_.element,this.textsView_.modeSelectElement,...this.textsView_.inputViews.map((e=>e.inputElement))];return this.alphaViews_&&e.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),e}}function sL(e){return"int"===e?"int":"float"===e?"float":void 0}function rL(e){return zT(e,(e=>({color:e.optional.object({alpha:e.optional.boolean,type:e.optional.custom(sL)}),expanded:e.optional.boolean,picker:e.optional.custom(FA),readonly:e.optional.constant(!1)})))}function aL(e){return e?.1:1}function oL(e){var t;return null===(t=e.color)||void 0===t?void 0:t.type}class lL{constructor(e,t){this.type="float",this.mode=t,this.comps_=JA(e,t,this.type)}getComponents(e){return YA(eL(KA(this.comps_),{mode:this.mode,type:this.type},{mode:null!=e?e:this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const e=this.getComponents("rgb");return{r:e[0],g:e[1],b:e[2],a:e[3]}}}const cL={int:(e,t)=>new tL(e,t),float:(e,t)=>new lL(e,t)};function hL(e,t,n){return cL[n](e,t)}function uL(e,t){if(e.type===t)return e;if(function(e){return"int"===e.type}(e)&&"float"===t)return function(e){const t=e.getComponents(),n=ZA(e.mode,"int");return new lL([bT(t[0],0,n[0],0,1),bT(t[1],0,n[1],0,1),bT(t[2],0,n[2],0,1),t[3]],e.mode)}(e);if(function(e){return"float"===e.type}(e)&&"int"===t)return function(e){const t=e.getComponents(),n=ZA(e.mode,"int");return new tL([Math.round(bT(t[0],0,1,0,n[0])),Math.round(bT(t[1],0,1,0,n[1])),Math.round(bT(t[2],0,1,0,n[2])),t[3]],e.mode)}(e);throw GC.shouldNeverHappen()}function dL(e,t){const n=e.match(/^(.+)%$/);return n?Math.min(.01*parseFloat(n[1])*t,t):Math.min(parseFloat(e),t)}const pL={deg:e=>e,grad:e=>360*e/400,rad:e=>360*e/(2*Math.PI),turn:e=>360*e};function mL(e){const t=e.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!t)return parseFloat(e);const n=parseFloat(t[1]),i=t[2];return pL[i](n)}function fL(e){const t=e.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;const n=[dL(t[1],255),dL(t[2],255),dL(t[3],255)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])?null:n}function vL(e){const t=fL(e);return t?new tL(t,"rgb"):null}function gL(e){const t=e.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;const n=[dL(t[1],255),dL(t[2],255),dL(t[3],255),dL(t[4],1)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])||isNaN(n[3])?null:n}function _L(e){const t=gL(e);return t?new tL(t,"rgb"):null}function wL(e){const t=e.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;const n=[mL(t[1]),dL(t[2],100),dL(t[3],100)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])?null:n}function bL(e){const t=wL(e);return t?new tL(t,"hsl"):null}function yL(e){const t=e.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;const n=[mL(t[1]),dL(t[2],100),dL(t[3],100),dL(t[4],1)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])||isNaN(n[3])?null:n}function xL(e){const t=yL(e);return t?new tL(t,"hsl"):null}function ML(e){const t=e.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(t)return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)];const n=e.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return n?[parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16)]:null}function EL(e){const t=ML(e);return t?new tL(t,"rgb"):null}function SL(e){const t=e.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(t)return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16),bT(parseInt(t[4]+t[4],16),0,255,0,1)];const n=e.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return n?[parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16),bT(parseInt(n[4],16),0,255,0,1)]:null}function CL(e){const t=SL(e);return t?new tL(t,"rgb"):null}function TL(e){const t=e.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!t)return null;const n=[parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3])];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])?null:n}function PL(e){return t=>{const n=TL(t);return n?hL(n,"rgb",e):null}}function AL(e){const t=e.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!t)return null;const n=[parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3]),parseFloat(t[4])];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])||isNaN(n[3])?null:n}function LL(e){return t=>{const n=AL(t);return n?hL(n,"rgb",e):null}}const RL=[{parser:ML,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:SL,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:fL,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:gL,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:wL,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:yL,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:TL,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:AL,result:{alpha:!0,mode:"rgb",notation:"object"}}];function DL(e,t="int"){const n=function(e){return RL.reduce(((t,{parser:n,result:i})=>t||(n(e)?i:null)),null)}(e);return n?"hex"===n.notation&&"float"!==t?Object.assign(Object.assign({},n),{type:"int"}):"func"===n.notation?Object.assign(Object.assign({},n),{type:t}):null:null}function IL(e){const t=[EL,CL,vL,_L,bL,xL];"int"===e&&t.push(PL("int"),LL("int")),"float"===e&&t.push(PL("float"),LL("float"));const n=function(e){return t=>e.reduce(((e,n)=>null!==e?e:n(t)),null)}(t);return t=>{const i=n(t);return i?uL(i,e):null}}function kL(e){const t=IL("int");if("string"!=typeof e)return tL.black();const n=t(e);return null!=n?n:tL.black()}function OL(e){const t=xT(Math.floor(e),0,255).toString(16);return 1===t.length?`0${t}`:t}function NL(e,t="#"){return`${t}${KA(e.getComponents("rgb")).map(OL).join("")}`}function UL(e,t="#"){const n=e.getComponents("rgb");return`${t}${[n[0],n[1],n[2],255*n[3]].map(OL).join("")}`}function VL(e){const t=wT(0);return`rgb(${KA(uL(e,"int").getComponents("rgb")).map((e=>t(e))).join(", ")})`}function BL(e){const t=wT(2),n=wT(0);return`rgba(${uL(e,"int").getComponents("rgb").map(((e,i)=>(3===i?t:n)(e))).join(", ")})`}function FL(e,t){const n=wT("float"===t?2:0),i=["r","g","b"];return`{${KA(uL(e,t).getComponents("rgb")).map(((e,t)=>`${i[t]}: ${n(e)}`)).join(", ")}}`}function zL(e){return t=>FL(t,e)}function HL(e,t){const n=wT(2),i=wT("float"===t?2:0),s=["r","g","b","a"];return`{${uL(e,t).getComponents("rgb").map(((e,t)=>`${s[t]}: ${(3===t?n:i)(e)}`)).join(", ")}}`}function GL(e){return t=>HL(t,e)}const jL=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:NL},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:UL},{format:{alpha:!1,mode:"rgb",notation:"func",type:"int"},stringifier:VL},{format:{alpha:!0,mode:"rgb",notation:"func",type:"int"},stringifier:BL},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:function(e){const t=[wT(0),vA,vA];return`hsl(${KA(uL(e,"int").getComponents("hsl")).map(((e,n)=>t[n](e))).join(", ")})`}},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:function(e){const t=[wT(0),vA,vA,wT(2)];return`hsla(${uL(e,"int").getComponents("hsl").map(((e,n)=>t[n](e))).join(", ")})`}},...["int","float"].reduce(((e,t)=>[...e,{format:{alpha:!1,mode:"rgb",notation:"object",type:t},stringifier:zL(t)},{format:{alpha:!0,mode:"rgb",notation:"object",type:t},stringifier:GL(t)}]),[])];function WL(e){return jL.reduce(((t,n)=>{return t||(i=n.format,s=e,i.alpha===s.alpha&&i.mode===s.mode&&i.notation===s.notation&&i.type===s.type?n.stringifier:null);var i,s}),null)}const qL=sP("apl");class XL{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(qL()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const n=e.createElement("div");n.classList.add(qL("b")),this.element.appendChild(n);const i=e.createElement("div");i.classList.add(qL("c")),n.appendChild(i),this.colorElem_=i;const s=e.createElement("div");s.classList.add(qL("m")),this.element.appendChild(s),this.markerElem_=s;const r=e.createElement("div");r.classList.add(qL("p")),this.markerElem_.appendChild(r),this.previewElem_=r,this.update_()}update_(){const e=this.value.rawValue,t=e.getComponents("rgb"),n=new tL([t[0],t[1],t[2],0],"rgb"),i=new tL([t[0],t[1],t[2],255],"rgb"),s=["to right",BL(n),BL(i)];this.colorElem_.style.background=`linear-gradient(${s.join(",")})`,this.previewElem_.style.backgroundColor=BL(e);const r=bT(t[3],0,1,0,100);this.markerElem_.style.left=`${r}%`}onValueChange_(){this.update_()}}class KL{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new XL(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new SA(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const n=e.point.x/e.bounds.width,i=this.value.rawValue,[s,r,a]=i.getComponents("hsv");this.value.setRawValue(new tL([s,r,a,n],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=bA(aL(!0),xA(e));if(0===t)return;const n=this.value.rawValue,[i,s,r,a]=n.getComponents("hsv");this.value.setRawValue(new tL([i,s,r,a+t],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){0!==bA(aL(!0),xA(e))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const YL=sP("coltxt");class $L{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(YL()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(YL("m")),this.modeElem_=function(e){const t=e.createElement("select");return t.appendChild([{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"},{text:"HEX",value:"hex"}].reduce(((t,n)=>{const i=e.createElement("option");return i.textContent=n.text,i.value=n.value,t.appendChild(i),t}),e.createDocumentFragment())),t}(e),this.modeElem_.classList.add(YL("ms")),n.appendChild(this.modeSelectElement),t.viewProps.bindDisabled(this.modeElem_);const i=e.createElement("div");i.classList.add(YL("mm")),i.appendChild($T(e,"dropdown")),n.appendChild(i),this.element.appendChild(n);const s=e.createElement("div");s.classList.add(YL("w")),this.element.appendChild(s),this.inputsElem_=s,this.inputViews_=t.inputViews,this.applyInputViews_(),tP(t.mode,(e=>{this.modeElem_.value=e}))}get modeSelectElement(){return this.modeElem_}get inputViews(){return this.inputViews_}set inputViews(e){this.inputViews_=e,this.applyInputViews_()}applyInputViews_(){QT(this.inputsElem_);const e=this.element.ownerDocument;this.inputViews_.forEach((t=>{const n=e.createElement("div");n.classList.add(YL("c")),n.appendChild(t.element),this.inputsElem_.appendChild(n)}))}}function ZL(e,t,n){const i=ZA(e,t)[n];return new ZC({min:0,max:i})}function JL(e,t){const n={colorMode:t.colorMode,colorType:t.colorType,parser:gT,viewProps:t.viewProps};return[0,1,2].map((i=>{const s=function(e,t,n){return new PA(e,{arrayPosition:0===n?"fst":2===n?"lst":"mid",parser:t.parser,props:$C.fromObject({formatter:(i=t.colorType,wT("float"===i?2:0)),keyScale:aL(!1),pointerScale:"float"===t.colorType?.01:1}),value:YC(0,{constraint:ZL(t.colorMode,t.colorType,n)}),viewProps:t.viewProps});var i}(e,n,i);return wA({primary:t.value,secondary:s.value,forward:e=>uL(e,t.colorType).getComponents(t.colorMode)[i],backward(e,n){const s=t.colorMode,r=uL(e,t.colorType).getComponents(s);r[i]=n;return uL(hL(YA(KA(r),r[3]),s,t.colorType),"int")}}),s}))}class QL{constructor(e,t){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=t.colorType,this.value=t.value,this.viewProps=t.viewProps,this.colorMode=YC(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(e),this.view=new $L(e,{mode:this.colorMode,inputViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view],viewProps:this.viewProps}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(e){const t=this.colorMode.rawValue;return function(e){return"hex"!==e}(t)?JL(e,{colorMode:t,colorType:this.colorType_,value:this.value,viewProps:this.viewProps}):function(e,t){const n=new dA(e,{parser:IL("int"),props:$C.fromObject({formatter:NL}),value:YC(tL.black()),viewProps:t.viewProps});return wA({primary:t.value,secondary:n.value,forward:e=>new tL(KA(e.getComponents()),e.mode),backward:(e,t)=>new tL(YA(KA(t.getComponents(e.mode)),e.getComponents()[3]),e.mode)}),[n]}(e,{value:this.value,viewProps:this.viewProps})}onModeSelectChange_(e){const t=e.currentTarget;this.colorMode.rawValue=t.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.inputViews=this.ccs_.map((e=>e.view))}}const eR=sP("hpl");class tR{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(eR()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const n=e.createElement("div");n.classList.add(eR("c")),this.element.appendChild(n);const i=e.createElement("div");i.classList.add(eR("m")),this.element.appendChild(i),this.markerElem_=i,this.update_()}update_(){const e=this.value.rawValue,[t]=e.getComponents("hsv");this.markerElem_.style.backgroundColor=VL(new tL([t,100,100],"hsv"));const n=bT(t,0,360,0,100);this.markerElem_.style.left=`${n}%`}onValueChange_(){this.update_()}}class nR{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new tR(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new SA(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const n=bT(xT(e.point.x,0,e.bounds.width),0,e.bounds.width,0,360),i=this.value.rawValue,[,s,r,a]=i.getComponents("hsv");this.value.setRawValue(new tL([n,s,r,a],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=bA(aL(!1),xA(e));if(0===t)return;const n=this.value.rawValue,[i,s,r,a]=n.getComponents("hsv");this.value.setRawValue(new tL([i+t,s,r,a],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){0!==bA(aL(!1),xA(e))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const iR=sP("svp");class sR{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(iR()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const n=e.createElement("canvas");n.height=64,n.width=64,n.classList.add(iR("c")),this.element.appendChild(n),this.canvasElement=n;const i=e.createElement("div");i.classList.add(iR("m")),this.element.appendChild(i),this.markerElem_=i,this.update_()}update_(){const e=function(e){const t=e.ownerDocument.defaultView;return t&&"document"in t?e.getContext("2d",{willReadFrequently:!0}):null}(this.canvasElement);if(!e)return;const t=this.value.rawValue.getComponents("hsv"),n=this.canvasElement.width,i=this.canvasElement.height,s=e.getImageData(0,0,n,i),r=s.data;for(let e=0;e<i;e++)for(let s=0;s<n;s++){const a=bT(s,0,n,0,100),o=bT(e,0,i,100,0),l=XA(t[0],a,o),c=4*(e*n+s);r[c]=l[0],r[c+1]=l[1],r[c+2]=l[2],r[c+3]=255}e.putImageData(s,0,0);const a=bT(t[1],0,100,0,100);this.markerElem_.style.left=`${a}%`;const o=bT(t[2],0,100,100,0);this.markerElem_.style.top=`${o}%`}onValueChange_(){this.update_()}}class rR{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new sR(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new SA(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const n=bT(e.point.x,0,e.bounds.width,0,100),i=bT(e.point.y,0,e.bounds.height,100,0),[s,,,r]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new tL([s,n,i,r],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){MA(e.key)&&e.preventDefault();const[t,n,i,s]=this.value.rawValue.getComponents("hsv"),r=aL(!1),a=bA(r,xA(e)),o=bA(r,yA(e));0===a&&0===o||this.value.setRawValue(new tL([t,n+a,i+o,s],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){const t=aL(!1),n=bA(t,xA(e)),i=bA(t,yA(e));0===n&&0===i||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class aR{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.hPaletteC_=new nR(e,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new rR(e,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=t.supportsAlpha?{palette:new KL(e,{value:this.value,viewProps:this.viewProps}),text:new PA(e,{parser:gT,props:$C.fromObject({pointerScale:.01,keyScale:.1,formatter:wT(2)}),value:YC(0,{constraint:new ZC({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&wA({primary:this.value,secondary:this.alphaIcs_.text.value,forward:e=>e.getComponents()[3],backward:(e,t)=>{const n=e.getComponents();return n[3]=t,new tL(n,e.mode)}}),this.textsC_=new QL(e,{colorType:t.colorType,value:this.value,viewProps:this.viewProps}),this.view=new iL(e,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:t.supportsAlpha,svPaletteView:this.svPaletteC_.view,textsView:this.textsC_.view,viewProps:this.viewProps})}get textsController(){return this.textsC_}}const oR=sP("colsw");class lR{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.element=e.createElement("div"),this.element.classList.add(oR()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(oR("sw")),this.element.appendChild(n),this.swatchElem_=n;const i=e.createElement("button");i.classList.add(oR("b")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i,this.update_()}update_(){const e=this.value.rawValue;this.swatchElem_.style.backgroundColor=UL(e)}onValueChange_(){this.update_()}}class cR{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new lR(e,{value:this.value,viewProps:this.viewProps})}}class hR{constructor(e,t){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=AP.create(t.expanded),this.swatchC_=new cR(e,{value:this.value,viewProps:this.viewProps});const n=this.swatchC_.view.buttonElement;n.addEventListener("blur",this.onButtonBlur_),n.addEventListener("click",this.onButtonClick_),this.textC_=new dA(e,{parser:t.parser,props:$C.fromObject({formatter:t.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new qA(e,{foldable:this.foldable_,pickerLayout:t.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_="popup"===t.pickerLayout?new cA(e,{viewProps:this.viewProps}):null;const i=new aR(e,{colorType:t.colorType,supportsAlpha:t.supportsAlpha,value:this.value,viewProps:this.viewProps});i.view.allFocusableElements.forEach((e=>{e.addEventListener("blur",this.onPopupChildBlur_),e.addEventListener("keydown",this.onPopupChildKeydown_)})),this.pickerC_=i,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(i.view.element),wA({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:e=>e,backward:(e,t)=>t})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),RP(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,n=e.relatedTarget;n&&t.contains(n)||(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,n=eP(e);n&&t.contains(n)||n&&n===this.swatchC_.view.buttonElement&&!KT(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?"Escape"===e.key&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&"Escape"===e.key&&this.swatchC_.view.buttonElement.focus()}}function uR(e){return KA(e.getComponents("rgb")).reduce(((e,t)=>e<<8|255&Math.floor(t)),0)}function dR(e){return e.getComponents("rgb").reduce(((e,t,n)=>e<<8|255&Math.floor(3===n?255*t:t)),0)>>>0}function pR(e){return"number"!=typeof e?tL.black():new tL([(t=e)>>16&255,t>>8&255,255&t],"rgb");var t}function mR(e){return"number"!=typeof e?tL.black():new tL([(t=e)>>24&255,t>>16&255,t>>8&255,bT(255&t,0,255,0,1)],"rgb");var t}function fR(e,t){return"object"==typeof e&&!UC(e)&&(t in e&&"number"==typeof e[t])}function vR(e){return fR(e,"r")&&fR(e,"g")&&fR(e,"b")}function gR(e){return vR(e)&&fR(e,"a")}function _R(e){return vR(e)}function wR(e,t){if(e.mode!==t.mode)return!1;if(e.type!==t.type)return!1;const n=e.getComponents(),i=t.getComponents();for(let e=0;e<n.length;e++)if(n[e]!==i[e])return!1;return!0}function bR(e){return"a"in e?[e.r,e.g,e.b,e.a]:[e.r,e.g,e.b]}function yR(e,t){return(n,i)=>{e?function(e,t,n){const i=uL(t,n).toRgbaObject();e.writeProperty("r",i.r),e.writeProperty("g",i.g),e.writeProperty("b",i.b),e.writeProperty("a",i.a)}(n,i,t):function(e,t,n){const i=uL(t,n).toRgbaObject();e.writeProperty("r",i.r),e.writeProperty("g",i.g),e.writeProperty("b",i.b)}(n,i,t)}}function xR(e){return t=>{const n=function(e,t){if(!_R(e))return uL(tL.black(),t);if("int"===t){const t=bR(e);return new tL(t,"rgb")}if("float"===t){const t=bR(e);return new lL(t,"rgb")}return uL(tL.black(),"int")}(t,e);return uL(n,"int")}}function MR(e,t){return n=>e?HL(n,t):FL(n,t)}wP({id:"input-color-number",type:"input",accept:(e,t)=>{if("number"!=typeof e)return null;if(!function(e){return"color"in e||"color"===e.view}(t))return null;const n=rL(t);return n?{initialValue:e,params:Object.assign(Object.assign({},n),{supportsAlpha:(i=t,!!(null===(s=null==i?void 0:i.color)||void 0===s?void 0:s.alpha))})}:null;var i,s},binding:{reader:e=>e.params.supportsAlpha?mR:pR,equals:wR,writer:e=>function(e){const t=e?dR:uR;return(e,n)=>{zA(e,t(n))}}(e.params.supportsAlpha)},controller:e=>{var t,n,i;return new hR(e.document,{colorType:"int",expanded:null!==(t=e.params.expanded)&&void 0!==t&&t,formatter:(i=e.params.supportsAlpha,i?e=>UL(e,"0x"):e=>NL(e,"0x")),parser:IL("int"),pickerLayout:null!==(n=e.params.picker)&&void 0!==n?n:"popup",supportsAlpha:e.params.supportsAlpha,value:e.value,viewProps:e.viewProps})}}),wP({id:"input-color-object",type:"input",accept:(e,t)=>{var n;if(!_R(e))return null;const i=rL(t);return i?{initialValue:e,params:Object.assign(Object.assign({},i),{colorType:null!==(n=oL(t))&&void 0!==n?n:"int"})}:null},binding:{reader:e=>xR(e.params.colorType),equals:wR,writer:e=>yR(gR(e.initialValue),e.params.colorType)},controller:e=>{var t,n;const i=gR(e.initialValue);return new hR(e.document,{colorType:e.params.colorType,expanded:null!==(t=e.params.expanded)&&void 0!==t&&t,formatter:MR(i,e.params.colorType),parser:IL("int"),pickerLayout:null!==(n=e.params.picker)&&void 0!==n?n:"popup",supportsAlpha:i,value:e.value,viewProps:e.viewProps})}}),wP({id:"input-color-string",type:"input",accept:(e,t)=>{if("string"!=typeof e)return null;if("text"===t.view)return null;const n=DL(e,oL(t));if(!n)return null;const i=WL(n);if(!i)return null;const s=rL(t);return s?{initialValue:e,params:Object.assign(Object.assign({},s),{format:n,stringifier:i})}:null},binding:{reader:()=>kL,equals:wR,writer:e=>{const t=function(e){const t=WL(e);return t?(e,n)=>{zA(e,t(n))}:null}(e.params.format);if(!t)throw GC.notBindable();return t}},controller:e=>{var t,n;return new hR(e.document,{colorType:e.params.format.type,expanded:null!==(t=e.params.expanded)&&void 0!==t&&t,formatter:e.params.stringifier,parser:IL("int"),pickerLayout:null!==(n=e.params.picker)&&void 0!==n?n:"popup",supportsAlpha:e.params.format.alpha,value:e.value,viewProps:e.viewProps})}});class ER{constructor(e){this.components=e.components,this.asm_=e.assembly}constrain(e){const t=this.asm_.toComponents(e).map(((e,t)=>{var n,i;return null!==(i=null===(n=this.components[t])||void 0===n?void 0:n.constrain(e))&&void 0!==i?i:e}));return this.asm_.fromComponents(t)}}const SR=sP("pndtxt");class CR{constructor(e,t){this.textViews=t.textViews,this.element=e.createElement("div"),this.element.classList.add(SR()),this.textViews.forEach((t=>{const n=e.createElement("div");n.classList.add(SR("a")),n.appendChild(t.element),this.element.appendChild(n)}))}}class TR{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.acs_=t.axes.map(((n,i)=>function(e,t,n){return new PA(e,{arrayPosition:0===n?"fst":n===t.axes.length-1?"lst":"mid",parser:t.parser,props:t.axes[n].textProps,value:YC(0,{constraint:t.axes[n].constraint}),viewProps:t.viewProps})}(e,t,i))),this.acs_.forEach(((e,n)=>{wA({primary:this.value,secondary:e.value,forward:e=>t.assembly.toComponents(e)[n],backward:(e,i)=>{const s=t.assembly.toComponents(e);return s[n]=i,t.assembly.fromComponents(s)}})})),this.view=new CR(e,{textViews:this.acs_.map((e=>e.view))})}get textControllers(){return this.acs_}}class PR extends UT{get max(){return this.controller.valueController.sliderController.props.get("max")}set max(e){this.controller.valueController.sliderController.props.set("max",e)}get min(){return this.controller.valueController.sliderController.props.get("min")}set min(e){this.controller.valueController.sliderController.props.set("min",e)}}wP({id:"input-number",type:"input",accept:(e,t)=>{if("number"!=typeof e)return null;const n=zT(t,(e=>Object.assign(Object.assign({},LT(e)),{options:e.optional.custom(tA),readonly:e.optional.constant(!1)})));return n?{initialValue:e,params:n}:null},binding:{reader:e=>_T,constraint:e=>function(e,t){const n=[],i=TT(e,t);i&&n.push(i);const s=PT(e);s&&n.push(s);const r=iA(e.options);return r&&n.push(r),new JP(n)}(e.params,e.initialValue),writer:e=>zA},controller:e=>{const t=e.value,n=e.constraint,i=n&&QP(n,eA);if(i)return new aA(e.document,{props:new $C({options:i.values.value("options")}),value:t,viewProps:e.viewProps});const s=AT(e.params,t.rawValue),r=n&&QP(n,ZC);return r?new kA(e.document,Object.assign(Object.assign({},(a=Object.assign(Object.assign({},s),{keyScale:YC(s.keyScale),max:r.values.value("max"),min:r.values.value("min")}),{sliderProps:new $C({keyScale:a.keyScale,max:a.max,min:a.min}),textProps:new $C({formatter:YC(a.formatter),keyScale:a.keyScale,pointerScale:YC(a.pointerScale)})})),{parser:gT,value:t,viewProps:e.viewProps})):new PA(e.document,{parser:gT,props:$C.fromObject(s),value:t,viewProps:e.viewProps});var a},api:e=>"number"!=typeof e.controller.value.rawValue?null:e.controller.valueController instanceof kA?new PR(e.controller):e.controller.valueController instanceof aA?new ZP(e.controller):null});class AR{constructor(e=0,t=0){this.x=e,this.y=t}getComponents(){return[this.x,this.y]}static isObject(e){if(UC(e))return!1;const t=e.x,n=e.y;return"number"==typeof t&&"number"==typeof n}static equals(e,t){return e.x===t.x&&e.y===t.y}toObject(){return{x:this.x,y:this.y}}}const LR={toComponents:e=>e.getComponents(),fromComponents:e=>new AR(...e)},RR=sP("p2d");class DR{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(RR()),t.viewProps.bindClassModifiers(this.element),tP(t.expanded,dP(this.element,RR(void 0,"expanded")));const n=e.createElement("div");n.classList.add(RR("h")),this.element.appendChild(n);const i=e.createElement("button");i.classList.add(RR("b")),i.appendChild($T(e,"p2dpad")),t.viewProps.bindDisabled(i),n.appendChild(i),this.buttonElement=i;const s=e.createElement("div");if(s.classList.add(RR("t")),n.appendChild(s),this.textElement=s,"inline"===t.pickerLayout){const t=e.createElement("div");t.classList.add(RR("p")),this.element.appendChild(t),this.pickerElement=t}else this.pickerElement=null}}const IR=sP("p2dp");class kR{constructor(e,t){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onPropsChange_=this.onPropsChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onPropsChange_),this.element=e.createElement("div"),this.element.classList.add(IR()),"popup"===t.layout&&this.element.classList.add(IR(void 0,"p")),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(IR("p")),t.viewProps.bindTabIndex(n),this.element.appendChild(n),this.padElement=n;const i=e.createElementNS(qT,"svg");i.classList.add(IR("g")),this.padElement.appendChild(i),this.svgElem_=i;const s=e.createElementNS(qT,"line");s.classList.add(IR("ax")),s.setAttributeNS(null,"x1","0"),s.setAttributeNS(null,"y1","50%"),s.setAttributeNS(null,"x2","100%"),s.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(s);const r=e.createElementNS(qT,"line");r.classList.add(IR("ax")),r.setAttributeNS(null,"x1","50%"),r.setAttributeNS(null,"y1","0"),r.setAttributeNS(null,"x2","50%"),r.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(r);const a=e.createElementNS(qT,"line");a.classList.add(IR("l")),a.setAttributeNS(null,"x1","50%"),a.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(a),this.lineElem_=a;const o=e.createElement("div");o.classList.add(IR("m")),this.padElement.appendChild(o),this.markerElem_=o,t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[e,t]=this.value.rawValue.getComponents(),n=this.props_.get("max"),i=bT(e,-n,+n,0,100),s=bT(t,-n,+n,0,100),r=this.props_.get("invertsY")?100-s:s;this.lineElem_.setAttributeNS(null,"x2",`${i}%`),this.lineElem_.setAttributeNS(null,"y2",`${r}%`),this.markerElem_.style.left=`${i}%`,this.markerElem_.style.top=`${r}%`}onValueChange_(){this.update_()}onPropsChange_(){this.update_()}onFoldableChange_(){this.update_()}}function OR(e,t,n){return[bA(t[0],xA(e)),bA(t[1],yA(e))*(n?1:-1)]}class NR{constructor(e,t){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new kR(e,{layout:t.layout,props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new SA(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const n=this.props.get("max"),i=bT(e.point.x,0,e.bounds.width,-n,+n),s=bT(this.props.get("invertsY")?e.bounds.height-e.point.y:e.point.y,0,e.bounds.height,-n,+n);this.value.setRawValue(new AR(i,s),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onPadKeyDown_(e){MA(e.key)&&e.preventDefault();const[t,n]=OR(e,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));0===t&&0===n||this.value.setRawValue(new AR(this.value.rawValue.x+t,this.value.rawValue.y+n),{forceEmit:!1,last:!1})}onPadKeyUp_(e){const[t,n]=OR(e,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));0===t&&0===n||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class UR{constructor(e,t){var n,i;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=AP.create(t.expanded),this.popC_="popup"===t.pickerLayout?new cA(e,{viewProps:this.viewProps}):null;const s=new NR(e,{layout:t.pickerLayout,props:new $C({invertsY:YC(t.invertsY),max:YC(t.max),xKeyScale:t.axes[0].textProps.value("keyScale"),yKeyScale:t.axes[1].textProps.value("keyScale")}),value:this.value,viewProps:this.viewProps});s.view.allFocusableElements.forEach((e=>{e.addEventListener("blur",this.onPopupChildBlur_),e.addEventListener("keydown",this.onPopupChildKeydown_)})),this.pickerC_=s,this.textC_=new TR(e,{assembly:LR,axes:t.axes,parser:t.parser,value:this.value,viewProps:this.viewProps}),this.view=new DR(e,{expanded:this.foldable_.value("expanded"),pickerLayout:t.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),null===(n=this.view.buttonElement)||void 0===n||n.addEventListener("blur",this.onPadButtonBlur_),null===(i=this.view.buttonElement)||void 0===i||i.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),wA({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:e=>e,backward:(e,t)=>t})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),RP(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onPadButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,n=e.relatedTarget;n&&t.contains(n)||(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,n=eP(e);n&&t.contains(n)||n&&n===this.view.buttonElement&&!KT(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?"Escape"===e.key&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&"Escape"===e.key&&this.view.buttonElement.focus()}}function VR(e){return AR.isObject(e)?new AR(e.x,e.y):new AR}function BR(e,t){e.writeProperty("x",t.x),e.writeProperty("y",t.y)}function FR(e,t){var n,i;if(!UC(e.min)||!UC(e.max))return Math.max(Math.abs(null!==(n=e.min)&&void 0!==n?n:0),Math.abs(null!==(i=e.max)&&void 0!==i?i:0));const s=ST(e);return Math.max(10*Math.abs(s),10*Math.abs(t))}function zR(e,t){var n,i;const s=FR(zC(e,null!==(n=e.x)&&void 0!==n?n:{}),t.x),r=FR(zC(e,null!==(i=e.y)&&void 0!==i?i:{}),t.y);return Math.max(s,r)}function HR(e){if(!("y"in e))return!1;const t=e.y;return!!t&&("inverted"in t&&!!t.inverted)}wP({id:"input-point2d",type:"input",accept:(e,t)=>{if(!AR.isObject(e))return null;const n=zT(t,(e=>Object.assign(Object.assign({},UA(e)),{expanded:e.optional.boolean,picker:e.optional.custom(FA),readonly:e.optional.constant(!1),x:e.optional.custom(VA),y:e.optional.object(Object.assign(Object.assign({},UA(e)),{inverted:e.optional.boolean}))})));return n?{initialValue:e,params:n}:null},binding:{reader:()=>VR,constraint:e=>{return t=e.params,n=e.initialValue,new ER({assembly:LR,components:[BA(Object.assign(Object.assign({},t),t.x),n.x),BA(Object.assign(Object.assign({},t),t.y),n.y)]});var t,n},equals:AR.equals,writer:()=>BR},controller:e=>{var t,n;const i=e.document,s=e.value,r=e.constraint,a=[e.params.x,e.params.y];return new UR(i,{axes:s.rawValue.getComponents().map(((t,n)=>{var i;return RT({constraint:r.components[n],initialValue:t,params:zC(e.params,null!==(i=a[n])&&void 0!==i?i:{})})})),expanded:null!==(t=e.params.expanded)&&void 0!==t&&t,invertsY:HR(e.params),max:zR(e.params,s.rawValue),parser:gT,pickerLayout:null!==(n=e.params.picker)&&void 0!==n?n:"popup",value:s,viewProps:e.viewProps})}});class GR{constructor(e=0,t=0,n=0){this.x=e,this.y=t,this.z=n}getComponents(){return[this.x,this.y,this.z]}static isObject(e){if(UC(e))return!1;const t=e.x,n=e.y,i=e.z;return"number"==typeof t&&"number"==typeof n&&"number"==typeof i}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}const jR={toComponents:e=>e.getComponents(),fromComponents:e=>new GR(...e)};function WR(e){return GR.isObject(e)?new GR(e.x,e.y,e.z):new GR}function qR(e,t){e.writeProperty("x",t.x),e.writeProperty("y",t.y),e.writeProperty("z",t.z)}wP({id:"input-point3d",type:"input",accept:(e,t)=>{if(!GR.isObject(e))return null;const n=zT(t,(e=>Object.assign(Object.assign({},UA(e)),{readonly:e.optional.constant(!1),x:e.optional.custom(VA),y:e.optional.custom(VA),z:e.optional.custom(VA)})));return n?{initialValue:e,params:n}:null},binding:{reader:e=>WR,constraint:e=>{return t=e.params,n=e.initialValue,new ER({assembly:jR,components:[BA(Object.assign(Object.assign({},t),t.x),n.x),BA(Object.assign(Object.assign({},t),t.y),n.y),BA(Object.assign(Object.assign({},t),t.z),n.z)]});var t,n},equals:GR.equals,writer:e=>qR},controller:e=>{const t=e.value,n=e.constraint,i=[e.params.x,e.params.y,e.params.z];return new TR(e.document,{assembly:jR,axes:t.rawValue.getComponents().map(((t,s)=>{var r;return RT({constraint:n.components[s],initialValue:t,params:zC(e.params,null!==(r=i[s])&&void 0!==r?r:{})})})),parser:gT,value:t,viewProps:e.viewProps})}});class XR{constructor(e=0,t=0,n=0,i=0){this.x=e,this.y=t,this.z=n,this.w=i}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(e){if(UC(e))return!1;const t=e.x,n=e.y,i=e.z,s=e.w;return"number"==typeof t&&"number"==typeof n&&"number"==typeof i&&"number"==typeof s}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}const KR={toComponents:e=>e.getComponents(),fromComponents:e=>new XR(...e)};function YR(e){return XR.isObject(e)?new XR(e.x,e.y,e.z,e.w):new XR}function $R(e,t){e.writeProperty("x",t.x),e.writeProperty("y",t.y),e.writeProperty("z",t.z),e.writeProperty("w",t.w)}wP({id:"input-point4d",type:"input",accept:(e,t)=>{if(!XR.isObject(e))return null;const n=zT(t,(e=>Object.assign(Object.assign({},UA(e)),{readonly:e.optional.constant(!1),w:e.optional.custom(VA),x:e.optional.custom(VA),y:e.optional.custom(VA),z:e.optional.custom(VA)})));return n?{initialValue:e,params:n}:null},binding:{reader:e=>YR,constraint:e=>{return t=e.params,n=e.initialValue,new ER({assembly:KR,components:[BA(Object.assign(Object.assign({},t),t.x),n.x),BA(Object.assign(Object.assign({},t),t.y),n.y),BA(Object.assign(Object.assign({},t),t.z),n.z),BA(Object.assign(Object.assign({},t),t.w),n.w)]});var t,n},equals:XR.equals,writer:e=>$R},controller:e=>{const t=e.value,n=e.constraint,i=[e.params.x,e.params.y,e.params.z,e.params.w];return new TR(e.document,{assembly:KR,axes:t.rawValue.getComponents().map(((t,s)=>{var r;return RT({constraint:n.components[s],initialValue:t,params:zC(e.params,null!==(r=i[s])&&void 0!==r?r:{})})})),parser:gT,value:t,viewProps:e.viewProps})}}),wP({id:"input-string",type:"input",accept:(e,t)=>{if("string"!=typeof e)return null;const n=zT(t,(e=>({readonly:e.optional.constant(!1),options:e.optional.custom(tA)})));return n?{initialValue:e,params:n}:null},binding:{reader:e=>gA,constraint:e=>function(e){const t=[],n=iA(e.options);return n&&t.push(n),new JP(t)}(e.params),writer:e=>zA},controller:e=>{const t=e.document,n=e.value,i=e.constraint,s=i&&QP(i,eA);return s?new aA(t,{props:new $C({options:s.values.value("options")}),value:n,viewProps:e.viewProps}):new dA(t,{parser:e=>e,props:$C.fromObject({formatter:_A}),value:n,viewProps:e.viewProps})},api:e=>"string"!=typeof e.controller.value.rawValue?null:e.controller.valueController instanceof aA?new ZP(e.controller):null});const ZR={defaultInterval:200,defaultRows:3},JR=sP("mll");class QR{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(JR()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("textarea");n.classList.add(JR("i")),n.style.height=`calc(var(${NA("containerUnitSize")}) * ${t.rows})`,n.readOnly=!0,t.viewProps.bindDisabled(n),this.element.appendChild(n),this.textareaElem_=n,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.textareaElem_,t=e.scrollTop===e.scrollHeight-e.clientHeight,n=[];this.value.rawValue.forEach((e=>{void 0!==e&&n.push(this.formatter_(e))})),e.textContent=n.join("\n"),t&&(e.scrollTop=e.scrollHeight)}onValueUpdate_(){this.update_()}}class eD{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new QR(e,{formatter:t.formatter,rows:t.rows,value:this.value,viewProps:this.viewProps})}}const tD=sP("sgl");class nD{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(tD()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("input");n.classList.add(tD("i")),n.readOnly=!0,n.type="text",t.viewProps.bindDisabled(n),this.element.appendChild(n),this.inputElement=n,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.value.rawValue,t=e[e.length-1];this.inputElement.value=void 0!==t?this.formatter_(t):""}onValueUpdate_(){this.update_()}}class iD{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new nD(e,{formatter:t.formatter,value:this.value,viewProps:this.viewProps})}}wP({id:"monitor-bool",type:"monitor",accept:(e,t)=>{if("boolean"!=typeof e)return null;const n=zT(t,(e=>({readonly:e.required.constant(!0),rows:e.optional.number})));return n?{initialValue:e,params:n}:null},binding:{reader:e=>pA},controller:e=>{var t;return 1===e.value.rawValue.length?new iD(e.document,{formatter:mA,value:e.value,viewProps:e.viewProps}):new eD(e.document,{formatter:mA,rows:null!==(t=e.params.rows)&&void 0!==t?t:ZR.defaultRows,value:e.value,viewProps:e.viewProps})}});class sD extends UT{get max(){return this.controller.valueController.props.get("max")}set max(e){this.controller.valueController.props.set("max",e)}get min(){return this.controller.valueController.props.get("min")}set min(e){this.controller.valueController.props.set("min",e)}}const rD=sP("grl");class aD{constructor(e,t){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=e.createElement("div"),this.element.classList.add(rD()),t.viewProps.bindClassModifiers(this.element),this.formatter_=t.formatter,this.props_=t.props,this.cursor_=t.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const n=e.createElementNS(qT,"svg");n.classList.add(rD("g")),n.style.height=`calc(var(${NA("containerUnitSize")}) * ${t.rows})`,this.element.appendChild(n),this.svgElem_=n;const i=e.createElementNS(qT,"polyline");this.svgElem_.appendChild(i),this.lineElem_=i;const s=e.createElement("div");s.classList.add(rD("t"),sP("tt")()),this.element.appendChild(s),this.tooltipElem_=s,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const e=this.svgElem_.getBoundingClientRect(),t=this.value.rawValue.length-1,n=this.props_.get("min"),i=this.props_.get("max"),s=[];this.value.rawValue.forEach(((r,a)=>{if(void 0===r)return;const o=bT(a,0,t,0,e.width),l=bT(r,n,i,e.height,0);s.push([o,l].join(","))})),this.lineElem_.setAttributeNS(null,"points",s.join(" "));const r=this.tooltipElem_,a=this.value.rawValue[this.cursor_.rawValue];if(void 0===a)return void r.classList.remove(rD("t","a"));const o=bT(this.cursor_.rawValue,0,t,0,e.width),l=bT(a,n,i,e.height,0);r.style.left=`${o}px`,r.style.top=`${l}px`,r.textContent=`${this.formatter_(a)}`,r.classList.contains(rD("t","a"))||(r.classList.add(rD("t","a"),rD("t","in")),XT(r),r.classList.remove(rD("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class oD{constructor(e,t){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.cursor_=YC(-1),this.view=new aD(e,{cursor:this.cursor_,formatter:t.formatter,rows:t.rows,props:this.props,value:this.value,viewProps:this.viewProps}),KT(e)){const e=new SA(this.view.element);e.emitter.on("down",this.onGraphPointerDown_),e.emitter.on("move",this.onGraphPointerMove_),e.emitter.on("up",this.onGraphPointerUp_)}else this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_)}importProps(e){return HT(e,null,(e=>({max:e.required.number,min:e.required.number})),(e=>(this.props.set("max",e.max),this.props.set("min",e.min),!0)))}exportProps(){return GT(null,{max:this.props.get("max"),min:this.props.get("min")})}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(e){const t=this.view.element.getBoundingClientRect();this.cursor_.rawValue=Math.floor(bT(e.offsetX,0,t.width,0,this.value.rawValue.length))}onGraphPointerDown_(e){this.onGraphPointerMove_(e)}onGraphPointerMove_(e){e.data.point?this.cursor_.rawValue=Math.floor(bT(e.data.point.x,0,e.data.bounds.width,0,this.value.rawValue.length)):this.cursor_.rawValue=-1}onGraphPointerUp_(){this.cursor_.rawValue=-1}}function lD(e){return UC(e.format)?wT(2):e.format}function cD(e){return"graph"===e.view}function hD(e){const t=new Image;return t.crossOrigin="anonymous",t.src=e,t}wP({id:"monitor-number",type:"monitor",accept:(e,t)=>{if("number"!=typeof e)return null;const n=zT(t,(e=>({format:e.optional.function,max:e.optional.number,min:e.optional.number,readonly:e.required.constant(!0),rows:e.optional.number,view:e.optional.string})));return n?{initialValue:e,params:n}:null},binding:{defaultBufferSize:e=>cD(e)?64:1,reader:e=>_T},controller:e=>cD(e.params)?function(e){var t,n,i;return new oD(e.document,{formatter:lD(e.params),rows:null!==(t=e.params.rows)&&void 0!==t?t:ZR.defaultRows,props:$C.fromObject({max:null!==(n=e.params.max)&&void 0!==n?n:100,min:null!==(i=e.params.min)&&void 0!==i?i:0}),value:e.value,viewProps:e.viewProps})}(e):function(e){var t;return 1===e.value.rawValue.length?new iD(e.document,{formatter:lD(e.params),value:e.value,viewProps:e.viewProps}):new eD(e.document,{formatter:lD(e.params),rows:null!==(t=e.params.rows)&&void 0!==t?t:ZR.defaultRows,value:e.value,viewProps:e.viewProps})}(e),api:e=>e.controller.valueController instanceof oD?new sD(e.controller):null}),wP({id:"monitor-string",type:"monitor",accept:(e,t)=>{if("string"!=typeof e)return null;const n=zT(t,(e=>({multiline:e.optional.boolean,readonly:e.required.constant(!0),rows:e.optional.number})));return n?{initialValue:e,params:n}:null},binding:{reader:e=>gA},controller:e=>{var t;const n=e.value;return n.rawValue.length>1||e.params.multiline?new eD(e.document,{formatter:_A,rows:null!==(t=e.params.rows)&&void 0!==t?t:ZR.defaultRows,value:n,viewProps:e.viewProps}):new iD(e.document,{formatter:_A,value:n,viewProps:e.viewProps})}});const uD=sP("img");class dD{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(uD()),t.viewProps.bindClassModifiers(this.element),this.input=e.createElement("input"),this.input.classList.add(uD("input")),this.input.setAttribute("type","file"),this.input.setAttribute("accept",t.extensions.join(",")),this.image_=e.createElement("img"),this.image_.id="tpimg_"+Math.random().toString(36).slice(2),this.image_.classList.add(uD("image")),this.image_.classList.add(uD(`image_${t.imageFit}`)),this.image_.crossOrigin="anonymous",this.image_.onclick=e=>{t.clickCallback?t.clickCallback(e,this.input):this.input.click()},this.element.classList.add(uD("area_root")),this.element.appendChild(this.image_),this.element.appendChild(this.input)}changeImage(e){this.image_.src=e}changeDraggingState(e){const t=this.element;e?null==t||t.classList.add(uD("area_dragging")):null==t||t.classList.remove(uD("area_dragging"))}}let pD=null;class mD{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new dD(e,{viewProps:this.viewProps,extensions:t.extensions,imageFit:t.imageFit,clickCallback:t.clickCallback}),this.onFile=this.onFile.bind(this),this.onDrop=this.onDrop.bind(this),this.onDragStart=this.onDragStart.bind(this),this.onDragOver=this.onDragOver.bind(this),this.onDragLeave=this.onDragLeave.bind(this),this.view.input.addEventListener("change",this.onFile),this.view.element.addEventListener("drop",this.onDrop),this.view.element.addEventListener("dragstart",this.onDragStart),this.view.element.addEventListener("dragover",this.onDragOver),this.view.element.addEventListener("dragleave",this.onDragLeave),this.viewProps.handleDispose((()=>{this.view.input.removeEventListener("change",this.onFile),this.view.element.removeEventListener("drop",this.onDrop),this.view.element.removeEventListener("dragstart",this.onDragStart),this.view.element.removeEventListener("dragover",this.onDragOver),this.view.element.removeEventListener("dragleave",this.onDragLeave)})),this.value.emitter.on("change",(()=>this.handleValueChange())),this.handleValueChange()}onFile(e){const t=(null==e?void 0:e.target).files;if(!t||!t.length)return;const n=t[0];this.setValue(n)}onDrop(e){e.preventDefault();try{const{dataTransfer:t}=e,n=null==t?void 0:t.files[0];if(n)this.setValue(n);else{const e=null==t?void 0:t.getData("img-id");if(e){const t=document.getElementById(e);this.setValue(t)}else{const e=null==t?void 0:t.getData("url");if(!e)throw new Error("No url");this.setValue(e)}}}catch(e){console.error("Could not parse the dropped image",e)}finally{this.view.changeDraggingState(!1)}}onDragStart(e){var t,n;null===(t=e.dataTransfer)||void 0===t||t.setData("img-id",this.view.image_.id),null===(n=e.dataTransfer)||void 0===n||n.setDragImage(this.view.image_,0,0)}onDragOver(e){e.preventDefault(),this.view.changeDraggingState(!0)}onDragLeave(){this.view.changeDraggingState(!1)}handleImage(e){e instanceof HTMLImageElement?this.updateImage(e.src):"string"!=typeof e&&e?this.setValue(e):("placeholder"!==e&&e||(e=this.handlePlaceholderImage().src),this.updateImage(e))}updateImage(e){this.view.changeImage(e)}setValue(e){if(e instanceof HTMLImageElement)this.value.setRawValue(e);else if(e instanceof File){const t=URL.createObjectURL(e)+"#"+e.name;e.src=t;const n=hD(t);this.value.setRawValue(n||e)}else e?this.value.setRawValue(hD(e)):this.value.setRawValue(this.handlePlaceholderImage())}handleValueChange(){this.handleImage(this.value.rawValue)}handlePlaceholderImage(){return pD||(pD=function(){const e=new Blob(['\n\t<svg width="320" height="50" xmlns="http://www.w3.org/2000/svg">\n  <style>\n    text {\n      font-family: "Menlo", monospace;\n      font-size: 12px;\n\t\t\tfill: gray;\n    }\n  </style>\n  <text x="50%" y="55%" text-anchor="middle">\n    No Image\n  </text>\n</svg>'],{type:"image/svg+xml"}),t=new Image;return t.src=URL.createObjectURL(e),t}()),pD}}const fD=[".jpg",".png",".gif"],vD=wP({id:"input-image",type:"input",accept(e,t){if(!(e instanceof HTMLImageElement||"string"==typeof e))return null;const n=zT(t,(e=>({view:e.required.constant("input-image"),acceptUrl:e.optional.boolean,clickCallback:e.optional.function,imageFit:e.optional.custom((e=>"contain"===e||"cover"===e?e:void 0)),extensions:e.optional.array(e.required.string)})));return n?{initialValue:e,params:n}:null},binding:{reader:e=>e=>void 0!==e.src?""===e.src?"placeholder":e.src:e,writer:e=>(e,t)=>{e.write(t)}},controller(e){var t,n;return new mD(e.document,{value:e.value,imageFit:null!==(t=e.params.imageFit)&&void 0!==t?t:"cover",clickCallback:e.params.clickCallback,viewProps:e.viewProps,extensions:null!==(n=e.params.extensions)&&void 0!==n?n:fD})}}),gD="input-image",_D=".tp-imgv{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-imgv{background-color:var(--in-bg);border-radius:var(--bld-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--cnt-usz);line-height:var(--cnt-usz);min-width:0;width:100%}.tp-imgv:hover{background-color:var(--in-bg-h)}.tp-imgv:focus{background-color:var(--in-bg-f)}.tp-imgv:active{background-color:var(--in-bg-a)}.tp-imgv:disabled{opacity:.5}:root{--tp-plugin-image-dragging-color: hsla(230, 100%, 66%, 1)}.tp-imgv{cursor:pointer;display:inline-flex;height:auto !important;max-height:calc(var(--cnt-usz)*3);border-radius:4px;position:relative}.tp-imgv.tp-v-disabled{opacity:.5}.tp-imgv_input{width:0;height:0;pointer-events:none;visibility:hidden}.tp-imgv_image{width:100%;height:-moz-max-content;height:max-content;max-height:calc(var(--cnt-usz)*3);border:0}.tp-imgv_image_contain{-o-object-fit:contain;object-fit:contain}.tp-imgv_image_cover{-o-object-fit:cover;object-fit:cover}.tp-imgv_area_root{transition:opacity .16s ease-in-out}.tp-imgv_area_dragging{border:2px dashed var(--tp-plugin-image-dragging-color);border-radius:4px;opacity:.6}",wD=[vD];function bD(e){return null==e}function yD(e){return null!==e&&"object"==typeof e}function xD(e){return null!==e&&"object"==typeof e}function MD(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function ED(e,t){return Array.from(new Set([...Object.keys(e),...Object.keys(t)])).reduce(((n,i)=>{const s=e[i],r=t[i];return xD(s)&&xD(r)?Object.assign(Object.assign({},n),{[i]:ED(s,r)}):Object.assign(Object.assign({},n),{[i]:i in t?r:s})}),{})}const SD={alreadydisposed:()=>"View has been already disposed",invalidparams:e=>`Invalid parameters for '${e.name}'`,nomatchingcontroller:e=>`No matching controller for '${e.key}'`,nomatchingview:e=>`No matching view for '${JSON.stringify(e.params)}'`,notbindable:()=>"Value is not bindable",notcompatible:e=>`Not compatible with  plugin '${e.id}'`,propertynotfound:e=>`Property '${e.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class CD{static alreadyDisposed(){return new CD({type:"alreadydisposed"})}static notBindable(){return new CD({type:"notbindable"})}static notCompatible(e,t){return new CD({type:"notcompatible",context:{id:`${e}.${t}`}})}static propertyNotFound(e){return new CD({type:"propertynotfound",context:{name:e}})}static shouldNeverHappen(){return new CD({type:"shouldneverhappen"})}constructor(e){var t;this.message=null!==(t=SD[e.type](e.context))&&void 0!==t?t:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=e.type}toString(){return this.message}}class TD{constructor(e,t){this.obj_=e,this.key=t}static isBindable(e){return null!==e&&("object"==typeof e||"function"==typeof e)}read(){return this.obj_[this.key]}write(e){this.obj_[this.key]=e}writeProperty(e,t){const n=this.read();if(!TD.isBindable(n))throw CD.notBindable();if(!(e in n))throw CD.propertyNotFound(e);n[e]=t}}class PD{constructor(){this.observers_={}}on(e,t){let n=this.observers_[e];return n||(n=this.observers_[e]=[]),n.push({handler:t}),this}off(e,t){const n=this.observers_[e];return n&&(this.observers_[e]=n.filter((e=>e.handler!==t))),this}emit(e,t){const n=this.observers_[e];n&&n.forEach((e=>{e.handler(t)}))}}class AD{constructor(e,t){var n;this.constraint_=null==t?void 0:t.constraint,this.equals_=null!==(n=null==t?void 0:t.equals)&&void 0!==n?n:(e,t)=>e===t,this.emitter=new PD,this.rawValue_=e}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const n=null!=t?t:{forceEmit:!1,last:!0},i=this.constraint_?this.constraint_.constrain(e):e,s=this.rawValue_;(!this.equals_(s,i)||n.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=i,this.emitter.emit("change",{options:n,previousRawValue:s,rawValue:i,sender:this}))}}class LD{constructor(e){this.emitter=new PD,this.value_=e}get rawValue(){return this.value_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const n=null!=t?t:{forceEmit:!1,last:!0},i=this.value_;(i!==e||n.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.value_=e,this.emitter.emit("change",{options:n,previousRawValue:i,rawValue:this.value_,sender:this}))}}class RD{constructor(e){this.emitter=new PD,this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.value_=e,this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_)}get rawValue(){return this.value_.rawValue}onValueBeforeChange_(e){this.emitter.emit("beforechange",Object.assign(Object.assign({},e),{sender:this}))}onValueChange_(e){this.emitter.emit("change",Object.assign(Object.assign({},e),{sender:this}))}}function DD(e,t){const n=null==t?void 0:t.constraint,i=null==t?void 0:t.equals;return n||i?new AD(e,t):new LD(e)}class ID{constructor(e){this.emitter=new PD,this.valMap_=e;for(const e in this.valMap_){this.valMap_[e].emitter.on("change",(()=>{this.emitter.emit("change",{key:e,sender:this})}))}}static createCore(e){return Object.keys(e).reduce(((t,n)=>Object.assign(t,{[n]:DD(e[n])})),{})}static fromObject(e){const t=this.createCore(e);return new ID(t)}get(e){return this.valMap_[e].rawValue}set(e,t){this.valMap_[e].rawValue=t}value(e){return this.valMap_[e]}}class kD{constructor(e){this.values=ID.fromObject({max:e.max,min:e.min})}constrain(e){const t=this.values.get("max"),n=this.values.get("min");return Math.min(Math.max(e,n),t)}}class OD{constructor(e){this.values=ID.fromObject({max:e.max,min:e.min})}constrain(e){const t=this.values.get("max"),n=this.values.get("min");let i=e;return bD(n)||(i=Math.max(i,n)),bD(t)||(i=Math.min(i,t)),i}}class ND{constructor(e,t=0){this.step=e,this.origin=t}constrain(e){const t=this.origin%this.step;return t+Math.round((e-t)/this.step)*this.step}}class UD{constructor(e){this.text=e}evaluate(){return Number(this.text)}toString(){return this.text}}const VD={"**":(e,t)=>Math.pow(e,t),"*":(e,t)=>e*t,"/":(e,t)=>e/t,"%":(e,t)=>e%t,"+":(e,t)=>e+t,"-":(e,t)=>e-t,"<<":(e,t)=>e<<t,">>":(e,t)=>e>>t,">>>":(e,t)=>e>>>t,"&":(e,t)=>e&t,"^":(e,t)=>e^t,"|":(e,t)=>e|t};class BD{constructor(e,t,n){this.left=t,this.operator=e,this.right=n}evaluate(){const e=VD[this.operator];if(!e)throw new Error(`unexpected binary operator: '${this.operator}`);return e(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const FD={"+":e=>e,"-":e=>-e,"~":e=>~e};class zD{constructor(e,t){this.operator=e,this.expression=t}evaluate(){const e=FD[this.operator];if(!e)throw new Error(`unexpected unary operator: '${this.operator}`);return e(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function HD(e){return(t,n)=>{for(let i=0;i<e.length;i++){const s=e[i](t,n);if(""!==s)return s}return""}}function GD(e,t){var n;const i=e.substr(t).match(/^\s+/);return null!==(n=i&&i[0])&&void 0!==n?n:""}function jD(e,t){var n;const i=e.substr(t).match(/^[0-9]+/);return null!==(n=i&&i[0])&&void 0!==n?n:""}function WD(e,t){const n=e.substr(t,1);if(t+=1,"e"!==n.toLowerCase())return"";const i=function(e,t){const n=jD(e,t);if(""!==n)return n;const i=e.substr(t,1);if("-"!==i&&"+"!==i)return"";const s=jD(e,t+=1);return""===s?"":i+s}(e,t);return""===i?"":n+i}function qD(e,t){const n=e.substr(t,1);if("0"===n)return n;const i=function(e,t){const n=e.substr(t,1);return n.match(/^[1-9]$/)?n:""}(e,t);return t+=i.length,""===i?"":i+jD(e,t)}const XD=HD([function(e,t){const n=qD(e,t);if(t+=n.length,""===n)return"";const i=e.substr(t,1);if(t+=i.length,"."!==i)return"";const s=jD(e,t);return n+i+s+WD(e,t+=s.length)},function(e,t){const n=e.substr(t,1);if(t+=n.length,"."!==n)return"";const i=jD(e,t);return t+=i.length,""===i?"":n+i+WD(e,t)},function(e,t){const n=qD(e,t);return t+=n.length,""===n?"":n+WD(e,t)}]);const KD=HD([function(e,t){const n=e.substr(t,2);if(t+=n.length,"0b"!==n.toLowerCase())return"";const i=function(e,t){var n;const i=e.substr(t).match(/^[01]+/);return null!==(n=i&&i[0])&&void 0!==n?n:""}(e,t);return""===i?"":n+i},function(e,t){const n=e.substr(t,2);if(t+=n.length,"0o"!==n.toLowerCase())return"";const i=function(e,t){var n;const i=e.substr(t).match(/^[0-7]+/);return null!==(n=i&&i[0])&&void 0!==n?n:""}(e,t);return""===i?"":n+i},function(e,t){const n=e.substr(t,2);if(t+=n.length,"0x"!==n.toLowerCase())return"";const i=function(e,t){var n;const i=e.substr(t).match(/^[0-9a-f]+/i);return null!==(n=i&&i[0])&&void 0!==n?n:""}(e,t);return""===i?"":n+i}]),YD=HD([KD,XD]);function $D(e,t){var n;return null!==(n=function(e,t){const n=YD(e,t);return t+=n.length,""===n?null:{evaluable:new UD(n),cursor:t}}(e,t))&&void 0!==n?n:function(e,t){const n=e.substr(t,1);if(t+=n.length,"("!==n)return null;const i=QD(e,t);if(!i)return null;t=i.cursor,t+=GD(e,t).length;const s=e.substr(t,1);return t+=s.length,")"!==s?null:{evaluable:i.evaluable,cursor:t}}(e,t)}function ZD(e,t,n){n+=GD(t,n).length;const i=e.filter((e=>t.startsWith(e,n)))[0];return i?(n+=i.length,{cursor:n+=GD(t,n).length,operator:i}):null}const JD=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce(((e,t)=>function(e,t){return(n,i)=>{const s=e(n,i);if(!s)return null;i=s.cursor;let r=s.evaluable;for(;;){const s=ZD(t,n,i);if(!s)break;i=s.cursor;const a=e(n,i);if(!a)return null;i=a.cursor,r=new BD(s.operator,r,a.evaluable)}return r?{cursor:i,evaluable:r}:null}}(e,t)),(function e(t,n){const i=$D(t,n);if(i)return i;const s=t.substr(n,1);if(n+=s.length,"+"!==s&&"-"!==s&&"~"!==s)return null;const r=e(t,n);return r?{cursor:n=r.cursor,evaluable:new zD(s,r.evaluable)}:null}));function QD(e,t){return t+=GD(e,t).length,JD(e,t)}function eI(e){var t;const n=function(e){const t=QD(e,0);return t?t.cursor+GD(e,t.cursor).length!==e.length?null:t.evaluable:null}(e);return null!==(t=null==n?void 0:n.evaluate())&&void 0!==t?t:null}function tI(e){if("number"==typeof e)return e;if("string"==typeof e){const t=eI(e);if(!bD(t))return t}return 0}function nI(e){return t=>t.toFixed(Math.max(Math.min(e,20),0))}function iI(e,t,n,i,s){return i+(e-t)/(n-t)*(s-i)}function sI(e){return String(e.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function rI(e,t,n){return Math.min(Math.max(e,t),n)}function aI(e,t){return(e%t+t)%t}function oI(e,t){return bD(e.step)?Math.max(sI(t),2):sI(e.step)}function lI(e){var t;return null!==(t=e.step)&&void 0!==t?t:1}function cI(e,t){var n;const i=Math.abs(null!==(n=e.step)&&void 0!==n?n:t);return 0===i?.1:Math.pow(10,Math.floor(Math.log10(i))-1)}function hI(e,t){return bD(e.step)?null:new ND(e.step,t)}function uI(e){return bD(e.max)||bD(e.min)?bD(e.max)&&bD(e.min)?null:new OD({max:e.max,min:e.min}):new kD({max:e.max,min:e.min})}function dI(e,t){var n,i,s;return{formatter:null!==(n=e.format)&&void 0!==n?n:nI(oI(e,t)),keyScale:null!==(i=e.keyScale)&&void 0!==i?i:lI(e),pointerScale:null!==(s=e.pointerScale)&&void 0!==s?s:cI(e,t)}}function pI(e){return{format:e.optional.function,keyScale:e.optional.number,max:e.optional.number,min:e.optional.number,pointerScale:e.optional.number,step:e.optional.number}}function mI(e){return{constraint:e.constraint,textProps:ID.fromObject(dI(e.params,e.initialValue))}}class fI{constructor(e){this.controller=e}get element(){return this.controller.view.element}get disabled(){return this.controller.viewProps.get("disabled")}set disabled(e){this.controller.viewProps.set("disabled",e)}get hidden(){return this.controller.viewProps.get("hidden")}set hidden(e){this.controller.viewProps.set("hidden",e)}dispose(){this.controller.viewProps.set("disposed",!0)}importState(e){return this.controller.importState(e)}exportState(){return this.controller.exportState()}}class vI{constructor(e){this.target=e}}class gI extends vI{constructor(e,t,n){super(e),this.value=t,this.last=null==n||n}}class _I extends vI{constructor(e,t){super(e),this.expanded=t}}class wI extends vI{constructor(e,t){super(e),this.index=t}}class bI extends fI{constructor(e){super(e),this.onValueChange_=this.onValueChange_.bind(this),this.emitter_=new PD,this.controller.value.emitter.on("change",this.onValueChange_)}get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get key(){return this.controller.value.binding.target.key}get tag(){return this.controller.tag}set tag(e){this.controller.tag=e}on(e,t){const n=t.bind(this);return this.emitter_.on(e,(e=>{n(e)})),this}refresh(){this.controller.value.fetch()}onValueChange_(e){const t=this.controller.value;this.emitter_.emit("change",new gI(this,t.binding.target.read(),e.options.last))}}function yI(e){return t=>n=>{if(!t&&void 0===n)return{succeeded:!1,value:void 0};if(t&&void 0===n)return{succeeded:!0,value:void 0};const i=e(n);return void 0!==i?{succeeded:!0,value:i}:{succeeded:!1,value:void 0}}}function xI(e){return{custom:t=>yI(t)(e),boolean:yI((e=>"boolean"==typeof e?e:void 0))(e),number:yI((e=>"number"==typeof e?e:void 0))(e),string:yI((e=>"string"==typeof e?e:void 0))(e),function:yI((e=>"function"==typeof e?e:void 0))(e),constant:t=>yI((e=>e===t?t:void 0))(e),raw:yI((e=>e))(e),object:t=>yI((e=>{var n;if(null!==(n=e)&&"object"==typeof n)return function(e,t){const n=Object.keys(t).reduce(((n,i)=>{if(void 0===n)return;const s=(0,t[i])(e[i]);return s.succeeded?Object.assign(Object.assign({},n),{[i]:s.value}):void 0}),{});return n}(e,t)}))(e),array:t=>yI((e=>{var n;if(Array.isArray(e))return n=t,e.reduce(((e,t)=>{if(void 0===e)return;const i=n(t);return i.succeeded&&void 0!==i.value?[...e,i.value]:void 0}),[])}))(e)}}const MI={optional:xI(!0),required:xI(!1)};function EI(e,t){const n=t(MI),i=MI.required.object(n)(e);return i.succeeded?i.value:void 0}function SI(e,t,n,i){if(t&&!t(e))return!1;const s=EI(e,n);return!!s&&i(s)}function CI(e,t){var n;return ED(null!==(n=null==e?void 0:e())&&void 0!==n?n:{},t)}function TI(e){return"value"in e}function PI(e){if(!yD(e)||!("binding"in e))return!1;const t=e.binding;return!!yD(n=t)&&"target"in n;var n}const AI="http://www.w3.org/2000/svg";function LI(e){e.offsetHeight}function RI(e){return void 0!==e.ontouchstart}const DI={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function II(e,t){const n=e.createElementNS(AI,"svg");return n.innerHTML=DI[t],n}function kI(e,t,n){e.insertBefore(t,e.children[n])}function OI(e){e.parentElement&&e.parentElement.removeChild(e)}function NI(e){for(;e.children.length>0;)e.removeChild(e.children[0])}function UI(e){return e.relatedTarget?e.relatedTarget:"explicitOriginalTarget"in e?e.explicitOriginalTarget:null}function VI(e,t){e.emitter.on("change",(e=>{t(e.rawValue)})),t(e.rawValue)}function BI(e,t,n){VI(e.value(t),n)}const FI="tp";function zI(e){return(t,n)=>[FI,"-",e,"v",t?`_${t}`:"",n?`-${n}`:""].join("")}const HI=zI("lbl");class GI{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(HI()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(HI("l")),BI(t.props,"label",(t=>{bD(t)?this.element.classList.add(HI(void 0,"nol")):(this.element.classList.remove(HI(void 0,"nol")),function(e){for(;e.childNodes.length>0;)e.removeChild(e.childNodes[0])}(n),n.appendChild(function(e,t){const n=e.createDocumentFragment();return t.split("\n").map((t=>e.createTextNode(t))).forEach(((t,i)=>{i>0&&n.appendChild(e.createElement("br")),n.appendChild(t)})),n}(e,t)))})),this.element.appendChild(n),this.labelElement=n;const i=e.createElement("div");i.classList.add(HI("v")),this.element.appendChild(i),this.valueElement=i}}class jI{constructor(e,t){this.props=t.props,this.valueController=t.valueController,this.viewProps=t.valueController.viewProps,this.view=new GI(e,{props:t.props,viewProps:this.viewProps}),this.view.valueElement.appendChild(this.valueController.view.element)}importProps(e){return SI(e,null,(e=>({label:e.optional.string})),(e=>(this.props.set("label",e.label),!0)))}exportProps(){return CI(null,{label:this.props.get("label")})}}const WI=zI(""),qI={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class XI{constructor(e){this.parent_=null,this.blade=e.blade,this.view=e.view,this.viewProps=e.viewProps;const t=this.view.element;this.blade.value("positions").emitter.on("change",(()=>{["veryfirst","first","last","verylast"].forEach((e=>{t.classList.remove(WI(void 0,qI[e]))})),this.blade.get("positions").forEach((e=>{t.classList.add(WI(void 0,qI[e]))}))})),this.viewProps.handleDispose((()=>{OI(t)}))}get parent(){return this.parent_}set parent(e){this.parent_=e,this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null)}importState(e){return SI(e,null,(e=>({disabled:e.required.boolean,hidden:e.required.boolean})),(e=>(this.viewProps.importState(e),!0)))}exportState(){return CI(null,Object.assign({},this.viewProps.exportState()))}}class KI extends fI{get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get title(){var e;return null!==(e=this.controller.buttonController.props.get("title"))&&void 0!==e?e:""}set title(e){this.controller.buttonController.props.set("title",e)}on(e,t){const n=t.bind(this);return this.controller.buttonController.emitter.on(e,(()=>{n(new vI(this))})),this}}function YI(e,t){return n=>{!function(e,t,n){n?e.classList.add(t):e.classList.remove(t)}(e,t,n)}}function $I(e,t){VI(e,(e=>{t.textContent=null!=e?e:""}))}const ZI=zI("btn");class JI{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(ZI()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("button");n.classList.add(ZI("b")),t.viewProps.bindDisabled(n),this.element.appendChild(n),this.buttonElement=n;const i=e.createElement("div");i.classList.add(ZI("t")),$I(t.props.value("title"),i),this.buttonElement.appendChild(i)}}class QI{constructor(e,t){this.emitter=new PD,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new JI(e,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}importProps(e){return SI(e,null,(e=>({title:e.optional.string})),(e=>(this.props.set("title",e.title),!0)))}exportProps(){return CI(null,{title:this.props.get("title")})}onClick_(){this.emitter.emit("click",{sender:this})}}class ek extends XI{constructor(e,t){const n=new QI(e,{props:t.buttonProps,viewProps:t.viewProps}),i=new jI(e,{blade:t.blade,props:t.labelProps,valueController:n});super({blade:t.blade,view:i.view,viewProps:t.viewProps}),this.buttonController=n,this.labelController=i}importState(e){return SI(e,(e=>super.importState(e)&&this.buttonController.importProps(e)&&this.labelController.importProps(e)),(()=>({})),(()=>!0))}exportState(){return CI((()=>super.exportState()),Object.assign(Object.assign({},this.buttonController.exportProps()),this.labelController.exportProps()))}}const tk=new class{constructor(e){const[t,n]=e.split("-"),i=t.split(".");this.major=parseInt(i[0],10),this.minor=parseInt(i[1],10),this.patch=parseInt(i[2],10),this.prerelease=null!=n?n:null}toString(){const e=[this.major,this.minor,this.patch].join(".");return null!==this.prerelease?[e,this.prerelease].join("-"):e}}("2.0.1");function nk(e){return Object.assign({core:tk},e)}nk({id:"button",type:"blade",accept(e){const t=EI(e,(e=>({title:e.required.string,view:e.required.constant("button"),label:e.optional.string})));return t?{params:t}:null},controller:e=>new ek(e.document,{blade:e.blade,buttonProps:ID.fromObject({title:e.params.title}),labelProps:ID.fromObject({label:e.params.label}),viewProps:e.viewProps}),api:e=>e.controller instanceof ek?new KI(e.controller):null});class ik{constructor(e,t){this.onRackValueChange_=this.onRackValueChange_.bind(this),this.controller_=e,this.emitter_=new PD,this.pool_=t;this.controller_.rack.emitter.on("valuechange",this.onRackValueChange_)}get children(){return this.controller_.rack.children.map((e=>this.pool_.createApi(e)))}addBinding(e,t,n){const i=null!=n?n:{},s=this.controller_.element.ownerDocument,r=this.pool_.createBinding(s,function(e,t){if(!TD.isBindable(e))throw CD.notBindable();return new TD(e,t)}(e,t),i),a=this.pool_.createBindingApi(r);return this.add(a,i.index)}addFolder(e){return function(e,t){return e.addBlade(Object.assign(Object.assign({},t),{view:"folder"}))}(this,e)}addButton(e){return function(e,t){return e.addBlade(Object.assign(Object.assign({},t),{view:"button"}))}(this,e)}addTab(e){return function(e,t){return e.addBlade(Object.assign(Object.assign({},t),{view:"tab"}))}(this,e)}add(e,t){const n=e.controller;return this.controller_.rack.add(n,t),e}remove(e){this.controller_.rack.remove(e.controller)}addBlade(e){const t=this.controller_.element.ownerDocument,n=this.pool_.createBlade(t,e),i=this.pool_.createApi(n);return this.add(i,e.index)}on(e,t){const n=t.bind(this);return this.emitter_.on(e,(e=>{n(e)})),this}refresh(){this.children.forEach((e=>{var t;yD(t=e)&&"refresh"in t&&"function"==typeof t.refresh&&e.refresh()}))}onRackValueChange_(e){const t=e.bladeController,n=this.pool_.createApi(t),i=PI(t.value)?t.value.binding:null;this.emitter_.emit("change",new gI(n,i?i.target.read():t.value.rawValue,e.options.last))}}class sk extends fI{constructor(e,t){super(e),this.rackApi_=new ik(e.rackController,t)}refresh(){this.rackApi_.refresh()}}class rk extends XI{constructor(e){super({blade:e.blade,view:e.view,viewProps:e.rackController.viewProps}),this.rackController=e.rackController}importState(e){return SI(e,(e=>super.importState(e)),(e=>({children:e.required.array(e.required.raw)})),(e=>this.rackController.rack.children.every(((t,n)=>t.importState(e.children[n])))))}exportState(){return CI((()=>super.exportState()),{children:this.rackController.rack.children.map((e=>e.exportState()))})}}function ak(e){return"rackController"in e}class ok{constructor(e){this.emitter=new PD,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=e}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(e){for(const t of this.allItems())if(e(t))return t;return null}includes(e){return this.cache_.has(e)}add(e,t){if(this.includes(e))throw CD.shouldNeverHappen();const n=void 0!==t?t:this.items_.length;this.items_.splice(n,0,e),this.cache_.add(e);const i=this.extract_(e);i&&(i.emitter.on("add",this.onSubListAdd_),i.emitter.on("remove",this.onSubListRemove_),i.allItems().forEach((e=>{this.cache_.add(e)}))),this.emitter.emit("add",{index:n,item:e,root:this,target:this})}remove(e){const t=this.items_.indexOf(e);if(t<0)return;this.items_.splice(t,1),this.cache_.delete(e);const n=this.extract_(e);n&&(n.allItems().forEach((e=>{this.cache_.delete(e)})),n.emitter.off("add",this.onSubListAdd_),n.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:t,item:e,root:this,target:this})}onSubListAdd_(e){this.cache_.add(e.item),this.emitter.emit("add",{index:e.index,item:e.item,root:this,target:e.target})}onSubListRemove_(e){this.cache_.delete(e.item),this.emitter.emit("remove",{index:e.index,item:e.item,root:this,target:e.target})}}function lk(e){return ak(e)?e.rackController.rack.bcSet_:null}class ck{constructor(e){var t,n;this.emitter=new PD,this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onRackLayout_=this.onRackLayout_.bind(this),this.onRackValueChange_=this.onRackValueChange_.bind(this),this.blade_=null!==(t=e.blade)&&void 0!==t?t:null,null===(n=this.blade_)||void 0===n||n.value("positions").emitter.on("change",this.onBladePositionsChange_),this.viewProps=e.viewProps,this.bcSet_=new ok(lk),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(e,t){var n;null===(n=e.parent)||void 0===n||n.remove(e),e.parent=this,this.bcSet_.add(e,t)}remove(e){e.parent=null,this.bcSet_.remove(e)}find(e){return this.bcSet_.allItems().filter(e)}onSetAdd_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("add",{bladeController:e.item,index:e.index,root:t,sender:this}),!t)return;const n=e.item;if(n.viewProps.emitter.on("change",this.onChildViewPropsChange_),n.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),n.viewProps.handleDispose(this.onChildDispose_),TI(n))n.value.emitter.on("change",this.onChildValueChange_);else if(ak(n)){const e=n.rackController.rack;if(e){const t=e.emitter;t.on("layout",this.onRackLayout_),t.on("valuechange",this.onRackValueChange_)}}}onSetRemove_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("remove",{bladeController:e.item,root:t,sender:this}),!t)return;const n=e.item;if(TI(n))n.value.emitter.off("change",this.onChildValueChange_);else if(ak(n)){const e=n.rackController.rack;if(e){const t=e.emitter;t.off("layout",this.onRackLayout_),t.off("valuechange",this.onRackValueChange_)}}}updatePositions_(){const e=this.bcSet_.items.filter((e=>!e.viewProps.get("hidden"))),t=e[0],n=e[e.length-1];this.bcSet_.items.forEach((e=>{const i=[];e===t&&(i.push("first"),this.blade_&&!this.blade_.get("positions").includes("veryfirst")||i.push("veryfirst")),e===n&&(i.push("last"),this.blade_&&!this.blade_.get("positions").includes("verylast")||i.push("verylast")),e.blade.set("positions",i)}))}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter((e=>e.viewProps.get("disposed"))).forEach((e=>{this.bcSet_.remove(e)}))}onChildValueChange_(e){const t=function(e,t){for(let n=0;n<e.length;n++){const i=e[n];if(TI(i)&&i.value===t)return i}return null}(this.find(TI),e.sender);if(!t)throw CD.alreadyDisposed();this.emitter.emit("valuechange",{bladeController:t,options:e.options,sender:this})}onRackLayout_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onRackValueChange_(e){this.emitter.emit("valuechange",{bladeController:e.bladeController,options:e.options,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class hk{constructor(e){this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.element=e.element,this.viewProps=e.viewProps;const t=new ck({blade:e.root?void 0:e.blade,viewProps:e.viewProps});t.emitter.on("add",this.onRackAdd_),t.emitter.on("remove",this.onRackRemove_),this.rack=t,this.viewProps.handleDispose((()=>{for(let e=this.rack.children.length-1;e>=0;e--){this.rack.children[e].viewProps.set("disposed",!0)}}))}onRackAdd_(e){e.root&&kI(this.element,e.bladeController.view.element,e.index)}onRackRemove_(e){e.root&&OI(e.bladeController.view.element)}}function uk(){return new ID({positions:DD([],{equals:MD})})}class dk extends ID{constructor(e){super(e)}static create(e){const t={completed:!0,expanded:e,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},n=ID.createCore(t);return new dk(n)}get styleExpanded(){var e;return null!==(e=this.get("temporaryExpanded"))&&void 0!==e?e:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const e=this.get("expandedHeight");return this.get("shouldFixHeight")&&!bD(e)?`${e}px`:"auto"}bindExpandedClass(e,t){const n=()=>{this.styleExpanded?e.classList.add(t):e.classList.remove(t)};BI(this,"expanded",n),BI(this,"temporaryExpanded",n)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function pk(e,t){t.style.height=e.styleHeight}function mk(e,t){e.value("expanded").emitter.on("beforechange",(()=>{if(e.set("completed",!1),bD(e.get("expandedHeight"))){const n=function(e,t){let n=0;return function(e,t){const n=e.style.transition;e.style.transition="none",t(),e.style.transition=n}(t,(()=>{e.set("expandedHeight",null),e.set("temporaryExpanded",!0),LI(t),n=t.clientHeight,e.set("temporaryExpanded",null),LI(t)})),n}(e,t);n>0&&e.set("expandedHeight",n)}e.set("shouldFixHeight",!0),LI(t)})),e.emitter.on("change",(()=>{pk(e,t)})),pk(e,t),t.addEventListener("transitionend",(t=>{"height"===t.propertyName&&e.cleanUpTransition()}))}class fk extends sk{constructor(e,t){super(e,t),this.emitter_=new PD,this.controller.foldable.value("expanded").emitter.on("change",(e=>{this.emitter_.emit("fold",new _I(this,e.sender.rawValue))})),this.rackApi_.on("change",(e=>{this.emitter_.emit("change",e)}))}get expanded(){return this.controller.foldable.get("expanded")}set expanded(e){this.controller.foldable.set("expanded",e)}get title(){return this.controller.props.get("title")}set title(e){this.controller.props.set("title",e)}get children(){return this.rackApi_.children}addBinding(e,t,n){return this.rackApi_.addBinding(e,t,n)}addFolder(e){return this.rackApi_.addFolder(e)}addButton(e){return this.rackApi_.addButton(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){return this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBlade(e){return this.rackApi_.addBlade(e)}on(e,t){const n=t.bind(this);return this.emitter_.on(e,(e=>{n(e)})),this}}const vk=zI("cnt");class gk{constructor(e,t){var n;this.className_=zI(null!==(n=t.viewName)&&void 0!==n?n:"fld"),this.element=e.createElement("div"),this.element.classList.add(this.className_(),vk()),t.viewProps.bindClassModifiers(this.element),this.foldable_=t.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),BI(this.foldable_,"completed",YI(this.element,this.className_(void 0,"cpl")));const i=e.createElement("button");i.classList.add(this.className_("b")),BI(t.props,"title",(e=>{bD(e)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))})),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const s=e.createElement("div");s.classList.add(this.className_("i")),this.element.appendChild(s);const r=e.createElement("div");r.classList.add(this.className_("t")),$I(t.props.value("title"),r),this.buttonElement.appendChild(r),this.titleElement=r;const a=e.createElement("div");a.classList.add(this.className_("m")),this.buttonElement.appendChild(a);const o=e.createElement("div");o.classList.add(this.className_("c")),this.element.appendChild(o),this.containerElement=o}}class _k extends rk{constructor(e,t){var n;const i=dk.create(null===(n=t.expanded)||void 0===n||n),s=new gk(e,{foldable:i,props:t.props,viewName:t.root?"rot":void 0,viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:new hk({blade:t.blade,element:s.containerElement,root:t.root,viewProps:t.viewProps}),view:s})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=t.props,this.foldable=i,mk(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",(()=>{this.foldable.cleanUpTransition()})),this.rackController.rack.emitter.on("remove",(()=>{this.foldable.cleanUpTransition()})),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}importState(e){return SI(e,(e=>super.importState(e)),(e=>({expanded:e.required.boolean,title:e.optional.string})),(e=>(this.foldable.set("expanded",e.expanded),this.props.set("title",e.title),!0)))}exportState(){return CI((()=>super.exportState()),{expanded:this.foldable.get("expanded"),title:this.props.get("title")})}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}nk({id:"folder",type:"blade",accept(e){const t=EI(e,(e=>({title:e.required.string,view:e.required.constant("folder"),expanded:e.optional.boolean})));return t?{params:t}:null},controller:e=>new _k(e.document,{blade:e.blade,expanded:e.params.expanded,props:ID.fromObject({title:e.params.title}),viewProps:e.viewProps}),api:e=>e.controller instanceof _k?new fk(e.controller,e.pool):null});const wk=zI("");function bk(e,t){return YI(e,wk(void 0,t))}class yk extends ID{constructor(e){var t,n;super(e),this.onDisabledChange_=this.onDisabledChange_.bind(this),this.onParentChange_=this.onParentChange_.bind(this),this.onParentGlobalDisabledChange_=this.onParentGlobalDisabledChange_.bind(this),[this.globalDisabled_,this.setGlobalDisabled_]=(n=DD(this.getGlobalDisabled_()),[new RD(n),(e,t)=>{n.setRawValue(e,t)}]),this.value("disabled").emitter.on("change",this.onDisabledChange_),this.value("parent").emitter.on("change",this.onParentChange_),null===(t=this.get("parent"))||void 0===t||t.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_)}static create(e){var t,n,i;const s=null!=e?e:{};return new yk(ID.createCore({disabled:null!==(t=s.disabled)&&void 0!==t&&t,disposed:!1,hidden:null!==(n=s.hidden)&&void 0!==n&&n,parent:null!==(i=s.parent)&&void 0!==i?i:null}))}get globalDisabled(){return this.globalDisabled_}bindClassModifiers(e){VI(this.globalDisabled_,bk(e,"disabled")),BI(this,"hidden",bk(e,"hidden"))}bindDisabled(e){VI(this.globalDisabled_,(t=>{e.disabled=t}))}bindTabIndex(e){VI(this.globalDisabled_,(t=>{e.tabIndex=t?-1:0}))}handleDispose(e){this.value("disposed").emitter.on("change",(t=>{t&&e()}))}importState(e){this.set("disabled",e.disabled),this.set("hidden",e.hidden)}exportState(){return{disabled:this.get("disabled"),hidden:this.get("hidden")}}getGlobalDisabled_(){const e=this.get("parent");return!!e&&e.globalDisabled.rawValue||this.get("disabled")}updateGlobalDisabled_(){this.setGlobalDisabled_(this.getGlobalDisabled_())}onDisabledChange_(){this.updateGlobalDisabled_()}onParentGlobalDisabledChange_(){this.updateGlobalDisabled_()}onParentChange_(e){var t;const n=e.previousRawValue;null==n||n.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),null===(t=this.get("parent"))||void 0===t||t.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}}const xk=zI("tbp");class Mk{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(xk()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(xk("c")),this.element.appendChild(n),this.containerElement=n}}const Ek=zI("tbi");class Sk{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Ek()),t.viewProps.bindClassModifiers(this.element),BI(t.props,"selected",(e=>{e?this.element.classList.add(Ek(void 0,"sel")):this.element.classList.remove(Ek(void 0,"sel"))}));const n=e.createElement("button");n.classList.add(Ek("b")),t.viewProps.bindDisabled(n),this.element.appendChild(n),this.buttonElement=n;const i=e.createElement("div");i.classList.add(Ek("t")),$I(t.props.value("title"),i),this.buttonElement.appendChild(i),this.titleElement=i}}class Ck{constructor(e,t){this.emitter=new PD,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new Sk(e,{props:t.props,viewProps:t.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class Tk extends rk{constructor(e,t){const n=new Mk(e,{viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:new hk({blade:t.blade,element:n.containerElement,viewProps:t.viewProps}),view:n})),this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new Ck(e,{props:t.itemProps,viewProps:yk.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.props=t.props,BI(this.props,"selected",(e=>{this.itemController.props.set("selected",e),this.viewProps.set("hidden",!e)}))}get itemController(){return this.ic_}importState(e){return SI(e,(e=>super.importState(e)),(e=>({selected:e.required.boolean,title:e.required.string})),(e=>(this.ic_.props.set("selected",e.selected),this.ic_.props.set("title",e.title),!0)))}exportState(){return CI((()=>super.exportState()),{selected:this.ic_.props.get("selected"),title:this.ic_.props.get("title")})}onItemClick_(){this.props.set("selected",!0)}}class Pk extends sk{constructor(e,t){super(e,t),this.emitter_=new PD,this.onSelect_=this.onSelect_.bind(this),this.pool_=t,this.rackApi_.on("change",(e=>{this.emitter_.emit("change",e)})),this.controller.tab.selectedIndex.emitter.on("change",this.onSelect_)}get pages(){return this.rackApi_.children}addPage(e){const t=this.controller.view.element.ownerDocument,n=new Tk(t,{blade:uk(),itemProps:ID.fromObject({selected:!1,title:e.title}),props:ID.fromObject({selected:!1}),viewProps:yk.create()}),i=this.pool_.createApi(n);return this.rackApi_.add(i,e.index)}removePage(e){this.rackApi_.remove(this.rackApi_.children[e])}on(e,t){const n=t.bind(this);return this.emitter_.on(e,(e=>{n(e)})),this}onSelect_(e){this.emitter_.emit("select",new wI(this,e.rawValue))}}class Ak extends sk{get title(){var e;return null!==(e=this.controller.itemController.props.get("title"))&&void 0!==e?e:""}set title(e){this.controller.itemController.props.set("title",e)}get selected(){return this.controller.props.get("selected")}set selected(e){this.controller.props.set("selected",e)}get children(){return this.rackApi_.children}addButton(e){return this.rackApi_.addButton(e)}addFolder(e){return this.rackApi_.addFolder(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBinding(e,t,n){return this.rackApi_.addBinding(e,t,n)}addBlade(e){return this.rackApi_.addBlade(e)}}class Lk{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=DD(!0),this.selectedIndex=DD(-1),this.items_=[]}add(e,t){const n=null!=t?t:this.items_.length;this.items_.splice(n,0,e),e.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(e){const t=this.items_.indexOf(e);t<0||(this.items_.splice(t,1),e.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(0===this.items_.length)return this.selectedIndex.rawValue=-1,void(this.empty.rawValue=!0);const e=this.items_.findIndex((e=>e.rawValue));e<0?(this.items_.forEach(((e,t)=>{e.rawValue=0===t})),this.selectedIndex.rawValue=0):(this.items_.forEach(((t,n)=>{t.rawValue=n===e})),this.selectedIndex.rawValue=e),this.empty.rawValue=!1}onItemSelectedChange_(e){if(e.rawValue){const t=this.items_.findIndex((t=>t===e.sender));this.items_.forEach(((e,n)=>{e.rawValue=n===t})),this.selectedIndex.rawValue=t}else this.keepSelection_()}}const Rk=zI("tab");class Dk{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Rk(),vk()),t.viewProps.bindClassModifiers(this.element),VI(t.empty,YI(this.element,Rk(void 0,"nop")));const n=e.createElement("div");n.classList.add(Rk("t")),this.element.appendChild(n),this.itemsElement=n;const i=e.createElement("div");i.classList.add(Rk("i")),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(Rk("c")),this.element.appendChild(s),this.contentsElement=s}}class Ik extends rk{constructor(e,t){const n=new Lk,i=new Dk(e,{empty:n.empty,viewProps:t.viewProps});super({blade:t.blade,rackController:new hk({blade:t.blade,element:i.contentsElement,viewProps:t.viewProps}),view:i}),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const s=this.rackController.rack;s.emitter.on("add",this.onRackAdd_),s.emitter.on("remove",this.onRackRemove_),this.tab=n}add(e,t){this.rackController.rack.add(e,t)}remove(e){this.rackController.rack.remove(this.rackController.rack.children[e])}onRackAdd_(e){if(!e.root)return;const t=e.bladeController;kI(this.view.itemsElement,t.itemController.view.element,e.index),t.itemController.viewProps.set("parent",this.viewProps),this.tab.add(t.props.value("selected"))}onRackRemove_(e){if(!e.root)return;const t=e.bladeController;OI(t.itemController.view.element),t.itemController.viewProps.set("parent",null),this.tab.remove(t.props.value("selected"))}}nk({id:"tab",type:"blade",accept(e){const t=EI(e,(e=>({pages:e.required.array(e.required.object({title:e.required.string})),view:e.required.constant("tab")})));return t&&0!==t.pages.length?{params:t}:null},controller(e){const t=new Ik(e.document,{blade:e.blade,viewProps:e.viewProps});return e.params.pages.forEach((n=>{const i=new Tk(e.document,{blade:uk(),itemProps:ID.fromObject({selected:!1,title:n.title}),props:ID.fromObject({selected:!1}),viewProps:yk.create()});t.add(i)})),t},api:e=>e.controller instanceof Ik?new Pk(e.controller,e.pool):e.controller instanceof Tk?new Ak(e.controller,e.pool):null});class kk extends bI{get options(){return this.controller.valueController.props.get("options")}set options(e){this.controller.valueController.props.set("options",e)}}class Ok{constructor(e){this.constraints=e}constrain(e){return this.constraints.reduce(((e,t)=>t.constrain(e)),e)}}function Nk(e,t){if(e instanceof t)return e;if(e instanceof Ok){const n=e.constraints.reduce(((e,n)=>e||(n instanceof t?n:null)),null);if(n)return n}return null}class Uk{constructor(e){this.values=ID.fromObject({options:e})}constrain(e){const t=this.values.get("options");if(0===t.length)return e;return t.filter((t=>t.value===e)).length>0?e:t[0].value}}function Vk(e){var t;const n=MI;return Array.isArray(e)?null===(t=EI({items:e},(e=>({items:e.required.array(e.required.object({text:e.required.string,value:e.required.raw}))}))))||void 0===t?void 0:t.items:"object"==typeof e?n.required.raw(e).value:void 0}function Bk(e){if(Array.isArray(e))return e;const t=[];return Object.keys(e).forEach((n=>{t.push({text:n,value:e[n]})})),t}function Fk(e){return bD(e)?null:new Uk(Bk(e))}const zk=zI("lst");class Hk{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.element=e.createElement("div"),this.element.classList.add(zk()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("select");n.classList.add(zk("s")),t.viewProps.bindDisabled(n),this.element.appendChild(n),this.selectElement=n;const i=e.createElement("div");i.classList.add(zk("m")),i.appendChild(II(e,"dropdown")),this.element.appendChild(i),t.value.emitter.on("change",this.onValueChange_),this.value_=t.value,BI(this.props_,"options",(t=>{NI(this.selectElement),t.forEach((t=>{const n=e.createElement("option");n.textContent=t.text,this.selectElement.appendChild(n)})),this.update_()}))}update_(){const e=this.props_.get("options").map((e=>e.value));this.selectElement.selectedIndex=e.indexOf(this.value_.rawValue)}onValueChange_(){this.update_()}}class Gk{constructor(e,t){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new Hk(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(e){const t=e.currentTarget;this.value.rawValue=this.props.get("options")[t.selectedIndex].value}importProps(e){return SI(e,null,(e=>({options:e.required.custom(Vk)})),(e=>(this.props.set("options",Bk(e.options)),!0)))}exportProps(){return CI(null,{options:this.props.get("options")})}}const jk=zI("pop");class Wk{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(jk()),t.viewProps.bindClassModifiers(this.element),VI(t.shows,YI(this.element,jk(void 0,"v")))}}class qk{constructor(e,t){this.shows=DD(!1),this.viewProps=t.viewProps,this.view=new Wk(e,{shows:this.shows,viewProps:this.viewProps})}}const Xk=zI("txt");class Kk{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(Xk()),t.viewProps.bindClassModifiers(this.element),this.props_=t.props,this.props_.emitter.on("change",this.onChange_);const n=e.createElement("input");n.classList.add(Xk("i")),n.type="text",t.viewProps.bindDisabled(n),this.element.appendChild(n),this.inputElement=n,t.value.emitter.on("change",this.onChange_),this.value_=t.value,this.refresh()}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value_.rawValue)}onChange_(){this.refresh()}}class Yk{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=t.parser,this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new Kk(e,{props:t.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const t=e.currentTarget.value,n=this.parser_(t);bD(n)||(this.value.rawValue=n),this.view.refresh()}}function $k(e){return"false"!==e&&!!e}function Zk(e){return function(e){return String(e)}(e)}const Jk=nI(0);function Qk(e){return Jk(e)+"%"}function eO(e){return String(e)}function tO(e){return e}function nO({primary:e,secondary:t,forward:n,backward:i}){let s=!1;function r(e){s||(s=!0,e(),s=!1)}e.emitter.on("change",(i=>{r((()=>{t.setRawValue(n(e.rawValue,t.rawValue),i.options)}))})),t.emitter.on("change",(s=>{r((()=>{e.setRawValue(i(e.rawValue,t.rawValue),s.options)})),r((()=>{t.setRawValue(n(e.rawValue,t.rawValue),s.options)}))})),r((()=>{t.setRawValue(n(e.rawValue,t.rawValue),{forceEmit:!1,last:!0})}))}function iO(e,t){const n=e*(t.altKey?.1:1)*(t.shiftKey?10:1);return t.upKey?+n:t.downKey?-n:0}function sO(e){return{altKey:e.altKey,downKey:"ArrowDown"===e.key,shiftKey:e.shiftKey,upKey:"ArrowUp"===e.key}}function rO(e){return{altKey:e.altKey,downKey:"ArrowLeft"===e.key,shiftKey:e.shiftKey,upKey:"ArrowRight"===e.key}}function aO(e){return function(e){return"ArrowUp"===e||"ArrowDown"===e}(e)||"ArrowLeft"===e||"ArrowRight"===e}function oO(e,t){var n,i;const s=t.ownerDocument.defaultView,r=t.getBoundingClientRect();return{x:e.pageX-((null!==(n=s&&s.scrollX)&&void 0!==n?n:0)+r.left),y:e.pageY-((null!==(i=s&&s.scrollY)&&void 0!==i?i:0)+r.top)}}class lO{constructor(e){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=e,this.emitter=new PD,e.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),e.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),e.addEventListener("touchend",this.onTouchEnd_),e.addEventListener("mousedown",this.onMouseDown_)}computePosition_(e){const t=this.elem_.getBoundingClientRect();return{bounds:{width:t.width,height:t.height},point:e?{x:e.x,y:e.y}:null}}onMouseDown_(e){var t;e.preventDefault(),null===(t=e.currentTarget)||void 0===t||t.focus();const n=this.elem_.ownerDocument;n.addEventListener("mousemove",this.onDocumentMouseMove_),n.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(oO(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseMove_(e){this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(oO(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseUp_(e){const t=this.elem_.ownerDocument;t.removeEventListener("mousemove",this.onDocumentMouseMove_),t.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(oO(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onTouchStart_(e){e.preventDefault();const t=e.targetTouches.item(0),n=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-n.left,y:t.clientY-n.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchMove_(e){const t=e.targetTouches.item(0),n=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-n.left,y:t.clientY-n.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchEnd_(e){var t;const n=null!==(t=e.targetTouches.item(0))&&void 0!==t?t:this.lastTouch_,i=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(n?{x:n.clientX-i.left,y:n.clientY-i.top}:void 0),sender:this,shiftKey:e.shiftKey})}}const cO=zI("txt");class hO{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(cO(),cO(void 0,"num")),t.arrayPosition&&this.element.classList.add(cO(void 0,t.arrayPosition)),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("input");n.classList.add(cO("i")),n.type="text",t.viewProps.bindDisabled(n),this.element.appendChild(n),this.inputElement=n,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=t.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(cO()),this.inputElement.classList.add(cO("i"));const i=e.createElement("div");i.classList.add(cO("k")),this.element.appendChild(i),this.knobElement=i;const s=e.createElementNS(AI,"svg");s.classList.add(cO("g")),this.knobElement.appendChild(s);const r=e.createElementNS(AI,"path");r.classList.add(cO("gb")),s.appendChild(r),this.guideBodyElem_=r;const a=e.createElementNS(AI,"path");a.classList.add(cO("gh")),s.appendChild(a),this.guideHeadElem_=a;const o=e.createElement("div");o.classList.add(zI("tt")()),this.knobElement.appendChild(o),this.tooltipElem_=o,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.refresh()}onDraggingChange_(e){if(null===e.rawValue)return void this.element.classList.remove(cO(void 0,"drg"));this.element.classList.add(cO(void 0,"drg"));const t=e.rawValue/this.props_.get("pointerScale"),n=t+(t>0?-1:t<0?1:0),i=rI(-n,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${n+i},0 L${n},4 L${n+i},8`,`M ${t},-1 L${t},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${t},4`);const s=this.props_.get("formatter");this.tooltipElem_.textContent=s(this.value.rawValue),this.tooltipElem_.style.left=`${t}px`}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value.rawValue)}onChange_(){this.refresh()}}class uO{constructor(e,t){var n;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.parser_=t.parser,this.props=t.props,this.sliderProps_=null!==(n=t.sliderProps)&&void 0!==n?n:null,this.value=t.value,this.viewProps=t.viewProps,this.dragging_=DD(null),this.view=new hO(e,{arrayPosition:t.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const i=new lO(this.view.knobElement);i.emitter.on("down",this.onPointerDown_),i.emitter.on("move",this.onPointerMove_),i.emitter.on("up",this.onPointerUp_)}constrainValue_(e){var t,n;const i=null===(t=this.sliderProps_)||void 0===t?void 0:t.get("min"),s=null===(n=this.sliderProps_)||void 0===n?void 0:n.get("max");let r=e;return void 0!==i&&(r=Math.max(r,i)),void 0!==s&&(r=Math.min(r,s)),r}onInputChange_(e){const t=e.currentTarget.value,n=this.parser_(t);bD(n)||(this.value.rawValue=this.constrainValue_(n)),this.view.refresh()}onInputKeyDown_(e){const t=iO(this.props.get("keyScale"),sO(e));0!==t&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+t),{forceEmit:!1,last:!1})}onInputKeyUp_(e){0!==iO(this.props.get("keyScale"),sO(e))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(e){if(!e.point)return null;const t=e.point.x-e.bounds.width/2;return this.constrainValue_(this.originRawValue_+t*this.props.get("pointerScale"))}onPointerMove_(e){const t=this.computeDraggingValue_(e.data);null!==t&&(this.value.setRawValue(t,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(e){const t=this.computeDraggingValue_(e.data);null!==t&&(this.value.setRawValue(t,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}const dO=zI("sld");class pO{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(dO()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(dO("t")),t.viewProps.bindTabIndex(n),this.element.appendChild(n),this.trackElement=n;const i=e.createElement("div");i.classList.add(dO("k")),this.trackElement.appendChild(i),this.knobElement=i,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.update_()}update_(){const e=rI(iI(this.value.rawValue,this.props_.get("min"),this.props_.get("max"),0,100),0,100);this.knobElement.style.width=`${e}%`}onChange_(){this.update_()}}class mO{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.props=t.props,this.view=new pO(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new lO(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){e.point&&this.value.setRawValue(iI(rI(e.point.x,0,e.bounds.width),0,e.bounds.width,this.props.get("min"),this.props.get("max")),t)}onPointerDownOrMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=iO(this.props.get("keyScale"),rO(e));0!==t&&this.value.setRawValue(this.value.rawValue+t,{forceEmit:!1,last:!1})}onKeyUp_(e){0!==iO(this.props.get("keyScale"),rO(e))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const fO=zI("sldtxt");class vO{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(fO());const n=e.createElement("div");n.classList.add(fO("s")),this.sliderView_=t.sliderView,n.appendChild(this.sliderView_.element),this.element.appendChild(n);const i=e.createElement("div");i.classList.add(fO("t")),this.textView_=t.textView,i.appendChild(this.textView_.element),this.element.appendChild(i)}}class gO{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.sliderC_=new mO(e,{props:t.sliderProps,value:t.value,viewProps:this.viewProps}),this.textC_=new uO(e,{parser:t.parser,props:t.textProps,sliderProps:t.sliderProps,value:t.value,viewProps:t.viewProps}),this.view=new vO(e,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}importProps(e){return SI(e,null,(e=>({max:e.required.number,min:e.required.number})),(e=>{const t=this.sliderC_.props;return t.set("max",e.max),t.set("min",e.min),!0}))}exportProps(){const e=this.sliderC_.props;return CI(null,{max:e.get("max"),min:e.get("min")})}}const _O={containerUnitSize:"cnt-usz"};function wO(e){return`--${_O[e]}`}function bO(e){return pI(e)}function yO(e){if(xD(e))return EI(e,bO)}function xO(e,t){if(!e)return;const n=[],i=hI(e,t);i&&n.push(i);const s=uI(e);return s&&n.push(s),new Ok(n)}function MO(e){if("inline"===e||"popup"===e)return e}function EO(e,t){e.write(t)}const SO=zI("ckb");class CO{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(SO()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("label");n.classList.add(SO("l")),this.element.appendChild(n);const i=e.createElement("input");i.classList.add(SO("i")),i.type="checkbox",n.appendChild(i),this.inputElement=i,t.viewProps.bindDisabled(this.inputElement);const s=e.createElement("div");s.classList.add(SO("w")),n.appendChild(s);const r=II(e,"check");s.appendChild(r),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class TO{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new CO(e,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const t=e.currentTarget;this.value.rawValue=t.checked}}nk({id:"input-bool",type:"input",accept:(e,t)=>{if("boolean"!=typeof e)return null;const n=EI(t,(e=>({options:e.optional.custom(Vk),readonly:e.optional.constant(!1)})));return n?{initialValue:e,params:n}:null},binding:{reader:e=>$k,constraint:e=>function(e){const t=[],n=Fk(e.options);return n&&t.push(n),new Ok(t)}(e.params),writer:e=>EO},controller:e=>{const t=e.document,n=e.value,i=e.constraint,s=i&&Nk(i,Uk);return s?new Gk(t,{props:new ID({options:s.values.value("options")}),value:n,viewProps:e.viewProps}):new TO(t,{value:n,viewProps:e.viewProps})},api:e=>"boolean"!=typeof e.controller.value.rawValue?null:e.controller.valueController instanceof Gk?new kk(e.controller):null});const PO=zI("col");class AO{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(PO()),t.foldable.bindExpandedClass(this.element,PO(void 0,"expanded")),BI(t.foldable,"completed",YI(this.element,PO(void 0,"cpl")));const n=e.createElement("div");n.classList.add(PO("h")),this.element.appendChild(n);const i=e.createElement("div");i.classList.add(PO("s")),n.appendChild(i),this.swatchElement=i;const s=e.createElement("div");if(s.classList.add(PO("t")),n.appendChild(s),this.textElement=s,"inline"===t.pickerLayout){const t=e.createElement("div");t.classList.add(PO("p")),this.element.appendChild(t),this.pickerElement=t}else this.pickerElement=null}}function LO(e,t,n){const i=aI(e,360),s=rI(t/100,0,1),r=rI(n/100,0,1),a=r*s,o=a*(1-Math.abs(i/60%2-1)),l=r-a;let c,h,u;return[c,h,u]=i>=0&&i<60?[a,o,0]:i>=60&&i<120?[o,a,0]:i>=120&&i<180?[0,a,o]:i>=180&&i<240?[0,o,a]:i>=240&&i<300?[o,0,a]:[a,0,o],[255*(c+l),255*(h+l),255*(u+l)]}function RO(e){return[e[0],e[1],e[2]]}function DO(e,t){return[e[0],e[1],e[2],t]}const IO={hsl:{hsl:(e,t,n)=>[e,t,n],hsv:function(e,t,n){const i=n+t*(100-Math.abs(2*n-100))/200;return[e,0!==i?t*(100-Math.abs(2*n-100))/i:0,n+t*(100-Math.abs(2*n-100))/200]},rgb:function(e,t,n){const i=(e%360+360)%360,s=rI(t/100,0,1),r=rI(n/100,0,1),a=(1-Math.abs(2*r-1))*s,o=a*(1-Math.abs(i/60%2-1)),l=r-a/2;let c,h,u;return[c,h,u]=i>=0&&i<60?[a,o,0]:i>=60&&i<120?[o,a,0]:i>=120&&i<180?[0,a,o]:i>=180&&i<240?[0,o,a]:i>=240&&i<300?[o,0,a]:[a,0,o],[255*(c+l),255*(h+l),255*(u+l)]}},hsv:{hsl:function(e,t,n){const i=100-Math.abs(n*(200-t)/100-100);return[e,0!==i?t*n/i:0,n*(200-t)/200]},hsv:(e,t,n)=>[e,t,n],rgb:LO},rgb:{hsl:function(e,t,n){const i=rI(e/255,0,1),s=rI(t/255,0,1),r=rI(n/255,0,1),a=Math.max(i,s,r),o=Math.min(i,s,r),l=a-o;let c=0,h=0;const u=(o+a)/2;return 0!==l&&(h=l/(1-Math.abs(a+o-1)),c=i===a?(s-r)/l:s===a?2+(r-i)/l:4+(i-s)/l,c=c/6+(c<0?1:0)),[360*c,100*h,100*u]},hsv:function(e,t,n){const i=rI(e/255,0,1),s=rI(t/255,0,1),r=rI(n/255,0,1),a=Math.max(i,s,r),o=a-Math.min(i,s,r);let l;return l=0===o?0:a===i?((s-r)/o%6+6)%6*60:a===s?60*((r-i)/o+2):60*((i-s)/o+4),[l,100*(0===a?0:o/a),100*a]},rgb:(e,t,n)=>[e,t,n]}};function kO(e,t){return["float"===t?1:"rgb"===e?255:360,"float"===t?1:"rgb"===e?255:100,"float"===t?1:"rgb"===e?255:100]}function OO(e,t,n){var i;const s=kO(t,n);return["rgb"===t?rI(e[0],0,s[0]):(r=e[0],a=s[0],r===a?a:aI(r,a)),rI(e[1],0,s[1]),rI(e[2],0,s[2]),rI(null!==(i=e[3])&&void 0!==i?i:1,0,1)];var r,a}function NO(e,t,n,i){const s=kO(t,n),r=kO(t,i);return e.map(((e,t)=>e/s[t]*r[t]))}function UO(e,t,n){const i=NO(e,t.mode,t.type,"int");return NO(IO[t.mode][n.mode](...i),n.mode,"int",n.type)}class VO{static black(){return new VO([0,0,0],"rgb")}constructor(e,t){this.type="int",this.mode=t,this.comps_=OO(e,t,this.type)}getComponents(e){return DO(UO(RO(this.comps_),{mode:this.mode,type:this.type},{mode:null!=e?e:this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const e=this.getComponents("rgb");return{r:e[0],g:e[1],b:e[2],a:e[3]}}}const BO=zI("colp");class FO{constructor(e,t){this.alphaViews_=null,this.element=e.createElement("div"),this.element.classList.add(BO()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(BO("hsv"));const i=e.createElement("div");i.classList.add(BO("sv")),this.svPaletteView_=t.svPaletteView,i.appendChild(this.svPaletteView_.element),n.appendChild(i);const s=e.createElement("div");s.classList.add(BO("h")),this.hPaletteView_=t.hPaletteView,s.appendChild(this.hPaletteView_.element),n.appendChild(s),this.element.appendChild(n);const r=e.createElement("div");if(r.classList.add(BO("rgb")),this.textsView_=t.textsView,r.appendChild(this.textsView_.element),this.element.appendChild(r),t.alphaViews){this.alphaViews_={palette:t.alphaViews.palette,text:t.alphaViews.text};const n=e.createElement("div");n.classList.add(BO("a"));const i=e.createElement("div");i.classList.add(BO("ap")),i.appendChild(this.alphaViews_.palette.element),n.appendChild(i);const s=e.createElement("div");s.classList.add(BO("at")),s.appendChild(this.alphaViews_.text.element),n.appendChild(s),this.element.appendChild(n)}}get allFocusableElements(){const e=[this.svPaletteView_.element,this.hPaletteView_.element,this.textsView_.modeSelectElement,...this.textsView_.inputViews.map((e=>e.inputElement))];return this.alphaViews_&&e.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),e}}function zO(e){return"int"===e?"int":"float"===e?"float":void 0}function HO(e){return EI(e,(e=>({color:e.optional.object({alpha:e.optional.boolean,type:e.optional.custom(zO)}),expanded:e.optional.boolean,picker:e.optional.custom(MO),readonly:e.optional.constant(!1)})))}function GO(e){return e?.1:1}function jO(e){var t;return null===(t=e.color)||void 0===t?void 0:t.type}class WO{constructor(e,t){this.type="float",this.mode=t,this.comps_=OO(e,t,this.type)}getComponents(e){return DO(UO(RO(this.comps_),{mode:this.mode,type:this.type},{mode:null!=e?e:this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const e=this.getComponents("rgb");return{r:e[0],g:e[1],b:e[2],a:e[3]}}}const qO={int:(e,t)=>new VO(e,t),float:(e,t)=>new WO(e,t)};function XO(e,t,n){return qO[n](e,t)}function KO(e,t){if(e.type===t)return e;if(function(e){return"int"===e.type}(e)&&"float"===t)return function(e){const t=e.getComponents(),n=kO(e.mode,"int");return new WO([iI(t[0],0,n[0],0,1),iI(t[1],0,n[1],0,1),iI(t[2],0,n[2],0,1),t[3]],e.mode)}(e);if(function(e){return"float"===e.type}(e)&&"int"===t)return function(e){const t=e.getComponents(),n=kO(e.mode,"int");return new VO([Math.round(iI(t[0],0,1,0,n[0])),Math.round(iI(t[1],0,1,0,n[1])),Math.round(iI(t[2],0,1,0,n[2])),t[3]],e.mode)}(e);throw CD.shouldNeverHappen()}function YO(e,t){const n=e.match(/^(.+)%$/);return n?Math.min(.01*parseFloat(n[1])*t,t):Math.min(parseFloat(e),t)}const $O={deg:e=>e,grad:e=>360*e/400,rad:e=>360*e/(2*Math.PI),turn:e=>360*e};function ZO(e){const t=e.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!t)return parseFloat(e);const n=parseFloat(t[1]),i=t[2];return $O[i](n)}function JO(e){const t=e.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;const n=[YO(t[1],255),YO(t[2],255),YO(t[3],255)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])?null:n}function QO(e){const t=JO(e);return t?new VO(t,"rgb"):null}function eN(e){const t=e.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;const n=[YO(t[1],255),YO(t[2],255),YO(t[3],255),YO(t[4],1)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])||isNaN(n[3])?null:n}function tN(e){const t=eN(e);return t?new VO(t,"rgb"):null}function nN(e){const t=e.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;const n=[ZO(t[1]),YO(t[2],100),YO(t[3],100)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])?null:n}function iN(e){const t=nN(e);return t?new VO(t,"hsl"):null}function sN(e){const t=e.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;const n=[ZO(t[1]),YO(t[2],100),YO(t[3],100),YO(t[4],1)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])||isNaN(n[3])?null:n}function rN(e){const t=sN(e);return t?new VO(t,"hsl"):null}function aN(e){const t=e.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(t)return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)];const n=e.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return n?[parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16)]:null}function oN(e){const t=aN(e);return t?new VO(t,"rgb"):null}function lN(e){const t=e.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(t)return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16),iI(parseInt(t[4]+t[4],16),0,255,0,1)];const n=e.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return n?[parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16),iI(parseInt(n[4],16),0,255,0,1)]:null}function cN(e){const t=lN(e);return t?new VO(t,"rgb"):null}function hN(e){const t=e.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!t)return null;const n=[parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3])];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])?null:n}function uN(e){return t=>{const n=hN(t);return n?XO(n,"rgb",e):null}}function dN(e){const t=e.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!t)return null;const n=[parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3]),parseFloat(t[4])];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])||isNaN(n[3])?null:n}function pN(e){return t=>{const n=dN(t);return n?XO(n,"rgb",e):null}}const mN=[{parser:aN,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:lN,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:JO,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:eN,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:nN,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:sN,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:hN,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:dN,result:{alpha:!0,mode:"rgb",notation:"object"}}];function fN(e,t="int"){const n=function(e){return mN.reduce(((t,{parser:n,result:i})=>t||(n(e)?i:null)),null)}(e);return n?"hex"===n.notation&&"float"!==t?Object.assign(Object.assign({},n),{type:"int"}):"func"===n.notation?Object.assign(Object.assign({},n),{type:t}):null:null}function vN(e){const t=[oN,cN,QO,tN,iN,rN];"int"===e&&t.push(uN("int"),pN("int")),"float"===e&&t.push(uN("float"),pN("float"));const n=function(e){return t=>e.reduce(((e,n)=>null!==e?e:n(t)),null)}(t);return t=>{const i=n(t);return i?KO(i,e):null}}function gN(e){const t=vN("int");if("string"!=typeof e)return VO.black();const n=t(e);return null!=n?n:VO.black()}function _N(e){const t=rI(Math.floor(e),0,255).toString(16);return 1===t.length?`0${t}`:t}function wN(e,t="#"){return`${t}${RO(e.getComponents("rgb")).map(_N).join("")}`}function bN(e,t="#"){const n=e.getComponents("rgb");return`${t}${[n[0],n[1],n[2],255*n[3]].map(_N).join("")}`}function yN(e){const t=nI(0);return`rgb(${RO(KO(e,"int").getComponents("rgb")).map((e=>t(e))).join(", ")})`}function xN(e){const t=nI(2),n=nI(0);return`rgba(${KO(e,"int").getComponents("rgb").map(((e,i)=>(3===i?t:n)(e))).join(", ")})`}function MN(e,t){const n=nI("float"===t?2:0),i=["r","g","b"];return`{${RO(KO(e,t).getComponents("rgb")).map(((e,t)=>`${i[t]}: ${n(e)}`)).join(", ")}}`}function EN(e){return t=>MN(t,e)}function SN(e,t){const n=nI(2),i=nI("float"===t?2:0),s=["r","g","b","a"];return`{${KO(e,t).getComponents("rgb").map(((e,t)=>`${s[t]}: ${(3===t?n:i)(e)}`)).join(", ")}}`}function CN(e){return t=>SN(t,e)}const TN=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:wN},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:bN},{format:{alpha:!1,mode:"rgb",notation:"func",type:"int"},stringifier:yN},{format:{alpha:!0,mode:"rgb",notation:"func",type:"int"},stringifier:xN},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:function(e){const t=[nI(0),Qk,Qk];return`hsl(${RO(KO(e,"int").getComponents("hsl")).map(((e,n)=>t[n](e))).join(", ")})`}},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:function(e){const t=[nI(0),Qk,Qk,nI(2)];return`hsla(${KO(e,"int").getComponents("hsl").map(((e,n)=>t[n](e))).join(", ")})`}},...["int","float"].reduce(((e,t)=>[...e,{format:{alpha:!1,mode:"rgb",notation:"object",type:t},stringifier:EN(t)},{format:{alpha:!0,mode:"rgb",notation:"object",type:t},stringifier:CN(t)}]),[])];function PN(e){return TN.reduce(((t,n)=>{return t||(i=n.format,s=e,i.alpha===s.alpha&&i.mode===s.mode&&i.notation===s.notation&&i.type===s.type?n.stringifier:null);var i,s}),null)}const AN=zI("apl");class LN{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(AN()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const n=e.createElement("div");n.classList.add(AN("b")),this.element.appendChild(n);const i=e.createElement("div");i.classList.add(AN("c")),n.appendChild(i),this.colorElem_=i;const s=e.createElement("div");s.classList.add(AN("m")),this.element.appendChild(s),this.markerElem_=s;const r=e.createElement("div");r.classList.add(AN("p")),this.markerElem_.appendChild(r),this.previewElem_=r,this.update_()}update_(){const e=this.value.rawValue,t=e.getComponents("rgb"),n=new VO([t[0],t[1],t[2],0],"rgb"),i=new VO([t[0],t[1],t[2],255],"rgb"),s=["to right",xN(n),xN(i)];this.colorElem_.style.background=`linear-gradient(${s.join(",")})`,this.previewElem_.style.backgroundColor=xN(e);const r=iI(t[3],0,1,0,100);this.markerElem_.style.left=`${r}%`}onValueChange_(){this.update_()}}class RN{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new LN(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new lO(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const n=e.point.x/e.bounds.width,i=this.value.rawValue,[s,r,a]=i.getComponents("hsv");this.value.setRawValue(new VO([s,r,a,n],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=iO(GO(!0),rO(e));if(0===t)return;const n=this.value.rawValue,[i,s,r,a]=n.getComponents("hsv");this.value.setRawValue(new VO([i,s,r,a+t],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){0!==iO(GO(!0),rO(e))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const DN=zI("coltxt");class IN{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(DN()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(DN("m")),this.modeElem_=function(e){const t=e.createElement("select");return t.appendChild([{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"},{text:"HEX",value:"hex"}].reduce(((t,n)=>{const i=e.createElement("option");return i.textContent=n.text,i.value=n.value,t.appendChild(i),t}),e.createDocumentFragment())),t}(e),this.modeElem_.classList.add(DN("ms")),n.appendChild(this.modeSelectElement),t.viewProps.bindDisabled(this.modeElem_);const i=e.createElement("div");i.classList.add(DN("mm")),i.appendChild(II(e,"dropdown")),n.appendChild(i),this.element.appendChild(n);const s=e.createElement("div");s.classList.add(DN("w")),this.element.appendChild(s),this.inputsElem_=s,this.inputViews_=t.inputViews,this.applyInputViews_(),VI(t.mode,(e=>{this.modeElem_.value=e}))}get modeSelectElement(){return this.modeElem_}get inputViews(){return this.inputViews_}set inputViews(e){this.inputViews_=e,this.applyInputViews_()}applyInputViews_(){NI(this.inputsElem_);const e=this.element.ownerDocument;this.inputViews_.forEach((t=>{const n=e.createElement("div");n.classList.add(DN("c")),n.appendChild(t.element),this.inputsElem_.appendChild(n)}))}}function kN(e,t,n){const i=kO(e,t)[n];return new kD({min:0,max:i})}function ON(e,t){const n={colorMode:t.colorMode,colorType:t.colorType,parser:eI,viewProps:t.viewProps};return[0,1,2].map((i=>{const s=function(e,t,n){return new uO(e,{arrayPosition:0===n?"fst":2===n?"lst":"mid",parser:t.parser,props:ID.fromObject({formatter:(i=t.colorType,nI("float"===i?2:0)),keyScale:GO(!1),pointerScale:"float"===t.colorType?.01:1}),value:DD(0,{constraint:kN(t.colorMode,t.colorType,n)}),viewProps:t.viewProps});var i}(e,n,i);return nO({primary:t.value,secondary:s.value,forward:e=>KO(e,t.colorType).getComponents(t.colorMode)[i],backward(e,n){const s=t.colorMode,r=KO(e,t.colorType).getComponents(s);r[i]=n;return KO(XO(DO(RO(r),r[3]),s,t.colorType),"int")}}),s}))}class NN{constructor(e,t){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=t.colorType,this.value=t.value,this.viewProps=t.viewProps,this.colorMode=DD(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(e),this.view=new IN(e,{mode:this.colorMode,inputViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view],viewProps:this.viewProps}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(e){const t=this.colorMode.rawValue;return function(e){return"hex"!==e}(t)?ON(e,{colorMode:t,colorType:this.colorType_,value:this.value,viewProps:this.viewProps}):function(e,t){const n=new Yk(e,{parser:vN("int"),props:ID.fromObject({formatter:wN}),value:DD(VO.black()),viewProps:t.viewProps});return nO({primary:t.value,secondary:n.value,forward:e=>new VO(RO(e.getComponents()),e.mode),backward:(e,t)=>new VO(DO(RO(t.getComponents(e.mode)),e.getComponents()[3]),e.mode)}),[n]}(e,{value:this.value,viewProps:this.viewProps})}onModeSelectChange_(e){const t=e.currentTarget;this.colorMode.rawValue=t.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.inputViews=this.ccs_.map((e=>e.view))}}const UN=zI("hpl");class VN{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(UN()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const n=e.createElement("div");n.classList.add(UN("c")),this.element.appendChild(n);const i=e.createElement("div");i.classList.add(UN("m")),this.element.appendChild(i),this.markerElem_=i,this.update_()}update_(){const e=this.value.rawValue,[t]=e.getComponents("hsv");this.markerElem_.style.backgroundColor=yN(new VO([t,100,100],"hsv"));const n=iI(t,0,360,0,100);this.markerElem_.style.left=`${n}%`}onValueChange_(){this.update_()}}class BN{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new VN(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new lO(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const n=iI(rI(e.point.x,0,e.bounds.width),0,e.bounds.width,0,360),i=this.value.rawValue,[,s,r,a]=i.getComponents("hsv");this.value.setRawValue(new VO([n,s,r,a],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=iO(GO(!1),rO(e));if(0===t)return;const n=this.value.rawValue,[i,s,r,a]=n.getComponents("hsv");this.value.setRawValue(new VO([i+t,s,r,a],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){0!==iO(GO(!1),rO(e))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const FN=zI("svp");class zN{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(FN()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const n=e.createElement("canvas");n.height=64,n.width=64,n.classList.add(FN("c")),this.element.appendChild(n),this.canvasElement=n;const i=e.createElement("div");i.classList.add(FN("m")),this.element.appendChild(i),this.markerElem_=i,this.update_()}update_(){const e=function(e){const t=e.ownerDocument.defaultView;return t&&"document"in t?e.getContext("2d",{willReadFrequently:!0}):null}(this.canvasElement);if(!e)return;const t=this.value.rawValue.getComponents("hsv"),n=this.canvasElement.width,i=this.canvasElement.height,s=e.getImageData(0,0,n,i),r=s.data;for(let e=0;e<i;e++)for(let s=0;s<n;s++){const a=iI(s,0,n,0,100),o=iI(e,0,i,100,0),l=LO(t[0],a,o),c=4*(e*n+s);r[c]=l[0],r[c+1]=l[1],r[c+2]=l[2],r[c+3]=255}e.putImageData(s,0,0);const a=iI(t[1],0,100,0,100);this.markerElem_.style.left=`${a}%`;const o=iI(t[2],0,100,100,0);this.markerElem_.style.top=`${o}%`}onValueChange_(){this.update_()}}class HN{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new zN(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new lO(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const n=iI(e.point.x,0,e.bounds.width,0,100),i=iI(e.point.y,0,e.bounds.height,100,0),[s,,,r]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new VO([s,n,i,r],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){aO(e.key)&&e.preventDefault();const[t,n,i,s]=this.value.rawValue.getComponents("hsv"),r=GO(!1),a=iO(r,rO(e)),o=iO(r,sO(e));0===a&&0===o||this.value.setRawValue(new VO([t,n+a,i+o,s],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){const t=GO(!1),n=iO(t,rO(e)),i=iO(t,sO(e));0===n&&0===i||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class GN{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.hPaletteC_=new BN(e,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new HN(e,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=t.supportsAlpha?{palette:new RN(e,{value:this.value,viewProps:this.viewProps}),text:new uO(e,{parser:eI,props:ID.fromObject({pointerScale:.01,keyScale:.1,formatter:nI(2)}),value:DD(0,{constraint:new kD({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&nO({primary:this.value,secondary:this.alphaIcs_.text.value,forward:e=>e.getComponents()[3],backward:(e,t)=>{const n=e.getComponents();return n[3]=t,new VO(n,e.mode)}}),this.textsC_=new NN(e,{colorType:t.colorType,value:this.value,viewProps:this.viewProps}),this.view=new FO(e,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:t.supportsAlpha,svPaletteView:this.svPaletteC_.view,textsView:this.textsC_.view,viewProps:this.viewProps})}get textsController(){return this.textsC_}}const jN=zI("colsw");class WN{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.element=e.createElement("div"),this.element.classList.add(jN()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(jN("sw")),this.element.appendChild(n),this.swatchElem_=n;const i=e.createElement("button");i.classList.add(jN("b")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i,this.update_()}update_(){const e=this.value.rawValue;this.swatchElem_.style.backgroundColor=bN(e)}onValueChange_(){this.update_()}}class qN{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new WN(e,{value:this.value,viewProps:this.viewProps})}}class XN{constructor(e,t){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=dk.create(t.expanded),this.swatchC_=new qN(e,{value:this.value,viewProps:this.viewProps});const n=this.swatchC_.view.buttonElement;n.addEventListener("blur",this.onButtonBlur_),n.addEventListener("click",this.onButtonClick_),this.textC_=new Yk(e,{parser:t.parser,props:ID.fromObject({formatter:t.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new AO(e,{foldable:this.foldable_,pickerLayout:t.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_="popup"===t.pickerLayout?new qk(e,{viewProps:this.viewProps}):null;const i=new GN(e,{colorType:t.colorType,supportsAlpha:t.supportsAlpha,value:this.value,viewProps:this.viewProps});i.view.allFocusableElements.forEach((e=>{e.addEventListener("blur",this.onPopupChildBlur_),e.addEventListener("keydown",this.onPopupChildKeydown_)})),this.pickerC_=i,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(i.view.element),nO({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:e=>e,backward:(e,t)=>t})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),mk(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,n=e.relatedTarget;n&&t.contains(n)||(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,n=UI(e);n&&t.contains(n)||n&&n===this.swatchC_.view.buttonElement&&!RI(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?"Escape"===e.key&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&"Escape"===e.key&&this.swatchC_.view.buttonElement.focus()}}function KN(e){return RO(e.getComponents("rgb")).reduce(((e,t)=>e<<8|255&Math.floor(t)),0)}function YN(e){return e.getComponents("rgb").reduce(((e,t,n)=>e<<8|255&Math.floor(3===n?255*t:t)),0)>>>0}function $N(e){return"number"!=typeof e?VO.black():new VO([(t=e)>>16&255,t>>8&255,255&t],"rgb");var t}function ZN(e){return"number"!=typeof e?VO.black():new VO([(t=e)>>24&255,t>>16&255,t>>8&255,iI(255&t,0,255,0,1)],"rgb");var t}function JN(e,t){return"object"==typeof e&&!bD(e)&&(t in e&&"number"==typeof e[t])}function QN(e){return JN(e,"r")&&JN(e,"g")&&JN(e,"b")}function eU(e){return QN(e)&&JN(e,"a")}function tU(e){return QN(e)}function nU(e,t){if(e.mode!==t.mode)return!1;if(e.type!==t.type)return!1;const n=e.getComponents(),i=t.getComponents();for(let e=0;e<n.length;e++)if(n[e]!==i[e])return!1;return!0}function iU(e){return"a"in e?[e.r,e.g,e.b,e.a]:[e.r,e.g,e.b]}function sU(e,t){return(n,i)=>{e?function(e,t,n){const i=KO(t,n).toRgbaObject();e.writeProperty("r",i.r),e.writeProperty("g",i.g),e.writeProperty("b",i.b),e.writeProperty("a",i.a)}(n,i,t):function(e,t,n){const i=KO(t,n).toRgbaObject();e.writeProperty("r",i.r),e.writeProperty("g",i.g),e.writeProperty("b",i.b)}(n,i,t)}}function rU(e){return t=>{const n=function(e,t){if(!tU(e))return KO(VO.black(),t);if("int"===t){const t=iU(e);return new VO(t,"rgb")}if("float"===t){const t=iU(e);return new WO(t,"rgb")}return KO(VO.black(),"int")}(t,e);return KO(n,"int")}}function aU(e,t){return n=>e?SN(n,t):MN(n,t)}nk({id:"input-color-number",type:"input",accept:(e,t)=>{if("number"!=typeof e)return null;if(!function(e){return"color"in e||"color"===e.view}(t))return null;const n=HO(t);return n?{initialValue:e,params:Object.assign(Object.assign({},n),{supportsAlpha:(i=t,!!(null===(s=null==i?void 0:i.color)||void 0===s?void 0:s.alpha))})}:null;var i,s},binding:{reader:e=>e.params.supportsAlpha?ZN:$N,equals:nU,writer:e=>function(e){const t=e?YN:KN;return(e,n)=>{EO(e,t(n))}}(e.params.supportsAlpha)},controller:e=>{var t,n,i;return new XN(e.document,{colorType:"int",expanded:null!==(t=e.params.expanded)&&void 0!==t&&t,formatter:(i=e.params.supportsAlpha,i?e=>bN(e,"0x"):e=>wN(e,"0x")),parser:vN("int"),pickerLayout:null!==(n=e.params.picker)&&void 0!==n?n:"popup",supportsAlpha:e.params.supportsAlpha,value:e.value,viewProps:e.viewProps})}}),nk({id:"input-color-object",type:"input",accept:(e,t)=>{var n;if(!tU(e))return null;const i=HO(t);return i?{initialValue:e,params:Object.assign(Object.assign({},i),{colorType:null!==(n=jO(t))&&void 0!==n?n:"int"})}:null},binding:{reader:e=>rU(e.params.colorType),equals:nU,writer:e=>sU(eU(e.initialValue),e.params.colorType)},controller:e=>{var t,n;const i=eU(e.initialValue);return new XN(e.document,{colorType:e.params.colorType,expanded:null!==(t=e.params.expanded)&&void 0!==t&&t,formatter:aU(i,e.params.colorType),parser:vN("int"),pickerLayout:null!==(n=e.params.picker)&&void 0!==n?n:"popup",supportsAlpha:i,value:e.value,viewProps:e.viewProps})}}),nk({id:"input-color-string",type:"input",accept:(e,t)=>{if("string"!=typeof e)return null;if("text"===t.view)return null;const n=fN(e,jO(t));if(!n)return null;const i=PN(n);if(!i)return null;const s=HO(t);return s?{initialValue:e,params:Object.assign(Object.assign({},s),{format:n,stringifier:i})}:null},binding:{reader:()=>gN,equals:nU,writer:e=>{const t=function(e){const t=PN(e);return t?(e,n)=>{EO(e,t(n))}:null}(e.params.format);if(!t)throw CD.notBindable();return t}},controller:e=>{var t,n;return new XN(e.document,{colorType:e.params.format.type,expanded:null!==(t=e.params.expanded)&&void 0!==t&&t,formatter:e.params.stringifier,parser:vN("int"),pickerLayout:null!==(n=e.params.picker)&&void 0!==n?n:"popup",supportsAlpha:e.params.format.alpha,value:e.value,viewProps:e.viewProps})}});class oU{constructor(e){this.components=e.components,this.asm_=e.assembly}constrain(e){const t=this.asm_.toComponents(e).map(((e,t)=>{var n,i;return null!==(i=null===(n=this.components[t])||void 0===n?void 0:n.constrain(e))&&void 0!==i?i:e}));return this.asm_.fromComponents(t)}}const lU=zI("pndtxt");class cU{constructor(e,t){this.textViews=t.textViews,this.element=e.createElement("div"),this.element.classList.add(lU()),this.textViews.forEach((t=>{const n=e.createElement("div");n.classList.add(lU("a")),n.appendChild(t.element),this.element.appendChild(n)}))}}class hU{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.acs_=t.axes.map(((n,i)=>function(e,t,n){return new uO(e,{arrayPosition:0===n?"fst":n===t.axes.length-1?"lst":"mid",parser:t.parser,props:t.axes[n].textProps,value:DD(0,{constraint:t.axes[n].constraint}),viewProps:t.viewProps})}(e,t,i))),this.acs_.forEach(((e,n)=>{nO({primary:this.value,secondary:e.value,forward:e=>t.assembly.toComponents(e)[n],backward:(e,i)=>{const s=t.assembly.toComponents(e);return s[n]=i,t.assembly.fromComponents(s)}})})),this.view=new cU(e,{textViews:this.acs_.map((e=>e.view))})}get textControllers(){return this.acs_}}class uU extends bI{get max(){return this.controller.valueController.sliderController.props.get("max")}set max(e){this.controller.valueController.sliderController.props.set("max",e)}get min(){return this.controller.valueController.sliderController.props.get("min")}set min(e){this.controller.valueController.sliderController.props.set("min",e)}}nk({id:"input-number",type:"input",accept:(e,t)=>{if("number"!=typeof e)return null;const n=EI(t,(e=>Object.assign(Object.assign({},pI(e)),{options:e.optional.custom(Vk),readonly:e.optional.constant(!1)})));return n?{initialValue:e,params:n}:null},binding:{reader:e=>tI,constraint:e=>function(e,t){const n=[],i=hI(e,t);i&&n.push(i);const s=uI(e);s&&n.push(s);const r=Fk(e.options);return r&&n.push(r),new Ok(n)}(e.params,e.initialValue),writer:e=>EO},controller:e=>{const t=e.value,n=e.constraint,i=n&&Nk(n,Uk);if(i)return new Gk(e.document,{props:new ID({options:i.values.value("options")}),value:t,viewProps:e.viewProps});const s=dI(e.params,t.rawValue),r=n&&Nk(n,kD);return r?new gO(e.document,Object.assign(Object.assign({},(a=Object.assign(Object.assign({},s),{keyScale:DD(s.keyScale),max:r.values.value("max"),min:r.values.value("min")}),{sliderProps:new ID({keyScale:a.keyScale,max:a.max,min:a.min}),textProps:new ID({formatter:DD(a.formatter),keyScale:a.keyScale,pointerScale:DD(a.pointerScale)})})),{parser:eI,value:t,viewProps:e.viewProps})):new uO(e.document,{parser:eI,props:ID.fromObject(s),value:t,viewProps:e.viewProps});var a},api:e=>"number"!=typeof e.controller.value.rawValue?null:e.controller.valueController instanceof gO?new uU(e.controller):e.controller.valueController instanceof Gk?new kk(e.controller):null});class dU{constructor(e=0,t=0){this.x=e,this.y=t}getComponents(){return[this.x,this.y]}static isObject(e){if(bD(e))return!1;const t=e.x,n=e.y;return"number"==typeof t&&"number"==typeof n}static equals(e,t){return e.x===t.x&&e.y===t.y}toObject(){return{x:this.x,y:this.y}}}const pU={toComponents:e=>e.getComponents(),fromComponents:e=>new dU(...e)},mU=zI("p2d");class fU{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(mU()),t.viewProps.bindClassModifiers(this.element),VI(t.expanded,YI(this.element,mU(void 0,"expanded")));const n=e.createElement("div");n.classList.add(mU("h")),this.element.appendChild(n);const i=e.createElement("button");i.classList.add(mU("b")),i.appendChild(II(e,"p2dpad")),t.viewProps.bindDisabled(i),n.appendChild(i),this.buttonElement=i;const s=e.createElement("div");if(s.classList.add(mU("t")),n.appendChild(s),this.textElement=s,"inline"===t.pickerLayout){const t=e.createElement("div");t.classList.add(mU("p")),this.element.appendChild(t),this.pickerElement=t}else this.pickerElement=null}}const vU=zI("p2dp");class gU{constructor(e,t){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onPropsChange_=this.onPropsChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onPropsChange_),this.element=e.createElement("div"),this.element.classList.add(vU()),"popup"===t.layout&&this.element.classList.add(vU(void 0,"p")),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(vU("p")),t.viewProps.bindTabIndex(n),this.element.appendChild(n),this.padElement=n;const i=e.createElementNS(AI,"svg");i.classList.add(vU("g")),this.padElement.appendChild(i),this.svgElem_=i;const s=e.createElementNS(AI,"line");s.classList.add(vU("ax")),s.setAttributeNS(null,"x1","0"),s.setAttributeNS(null,"y1","50%"),s.setAttributeNS(null,"x2","100%"),s.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(s);const r=e.createElementNS(AI,"line");r.classList.add(vU("ax")),r.setAttributeNS(null,"x1","50%"),r.setAttributeNS(null,"y1","0"),r.setAttributeNS(null,"x2","50%"),r.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(r);const a=e.createElementNS(AI,"line");a.classList.add(vU("l")),a.setAttributeNS(null,"x1","50%"),a.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(a),this.lineElem_=a;const o=e.createElement("div");o.classList.add(vU("m")),this.padElement.appendChild(o),this.markerElem_=o,t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[e,t]=this.value.rawValue.getComponents(),n=this.props_.get("max"),i=iI(e,-n,+n,0,100),s=iI(t,-n,+n,0,100),r=this.props_.get("invertsY")?100-s:s;this.lineElem_.setAttributeNS(null,"x2",`${i}%`),this.lineElem_.setAttributeNS(null,"y2",`${r}%`),this.markerElem_.style.left=`${i}%`,this.markerElem_.style.top=`${r}%`}onValueChange_(){this.update_()}onPropsChange_(){this.update_()}onFoldableChange_(){this.update_()}}function _U(e,t,n){return[iO(t[0],rO(e)),iO(t[1],sO(e))*(n?1:-1)]}class wU{constructor(e,t){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new gU(e,{layout:t.layout,props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new lO(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const n=this.props.get("max"),i=iI(e.point.x,0,e.bounds.width,-n,+n),s=iI(this.props.get("invertsY")?e.bounds.height-e.point.y:e.point.y,0,e.bounds.height,-n,+n);this.value.setRawValue(new dU(i,s),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onPadKeyDown_(e){aO(e.key)&&e.preventDefault();const[t,n]=_U(e,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));0===t&&0===n||this.value.setRawValue(new dU(this.value.rawValue.x+t,this.value.rawValue.y+n),{forceEmit:!1,last:!1})}onPadKeyUp_(e){const[t,n]=_U(e,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));0===t&&0===n||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class bU{constructor(e,t){var n,i;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=dk.create(t.expanded),this.popC_="popup"===t.pickerLayout?new qk(e,{viewProps:this.viewProps}):null;const s=new wU(e,{layout:t.pickerLayout,props:new ID({invertsY:DD(t.invertsY),max:DD(t.max),xKeyScale:t.axes[0].textProps.value("keyScale"),yKeyScale:t.axes[1].textProps.value("keyScale")}),value:this.value,viewProps:this.viewProps});s.view.allFocusableElements.forEach((e=>{e.addEventListener("blur",this.onPopupChildBlur_),e.addEventListener("keydown",this.onPopupChildKeydown_)})),this.pickerC_=s,this.textC_=new hU(e,{assembly:pU,axes:t.axes,parser:t.parser,value:this.value,viewProps:this.viewProps}),this.view=new fU(e,{expanded:this.foldable_.value("expanded"),pickerLayout:t.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),null===(n=this.view.buttonElement)||void 0===n||n.addEventListener("blur",this.onPadButtonBlur_),null===(i=this.view.buttonElement)||void 0===i||i.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),nO({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:e=>e,backward:(e,t)=>t})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),mk(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onPadButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,n=e.relatedTarget;n&&t.contains(n)||(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,n=UI(e);n&&t.contains(n)||n&&n===this.view.buttonElement&&!RI(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?"Escape"===e.key&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&"Escape"===e.key&&this.view.buttonElement.focus()}}function yU(e){return dU.isObject(e)?new dU(e.x,e.y):new dU}function xU(e,t){e.writeProperty("x",t.x),e.writeProperty("y",t.y)}function MU(e,t){var n,i;if(!bD(e.min)||!bD(e.max))return Math.max(Math.abs(null!==(n=e.min)&&void 0!==n?n:0),Math.abs(null!==(i=e.max)&&void 0!==i?i:0));const s=lI(e);return Math.max(10*Math.abs(s),10*Math.abs(t))}function EU(e,t){var n,i;const s=MU(ED(e,null!==(n=e.x)&&void 0!==n?n:{}),t.x),r=MU(ED(e,null!==(i=e.y)&&void 0!==i?i:{}),t.y);return Math.max(s,r)}function SU(e){if(!("y"in e))return!1;const t=e.y;return!!t&&("inverted"in t&&!!t.inverted)}nk({id:"input-point2d",type:"input",accept:(e,t)=>{if(!dU.isObject(e))return null;const n=EI(t,(e=>Object.assign(Object.assign({},bO(e)),{expanded:e.optional.boolean,picker:e.optional.custom(MO),readonly:e.optional.constant(!1),x:e.optional.custom(yO),y:e.optional.object(Object.assign(Object.assign({},bO(e)),{inverted:e.optional.boolean}))})));return n?{initialValue:e,params:n}:null},binding:{reader:()=>yU,constraint:e=>{return t=e.params,n=e.initialValue,new oU({assembly:pU,components:[xO(Object.assign(Object.assign({},t),t.x),n.x),xO(Object.assign(Object.assign({},t),t.y),n.y)]});var t,n},equals:dU.equals,writer:()=>xU},controller:e=>{var t,n;const i=e.document,s=e.value,r=e.constraint,a=[e.params.x,e.params.y];return new bU(i,{axes:s.rawValue.getComponents().map(((t,n)=>{var i;return mI({constraint:r.components[n],initialValue:t,params:ED(e.params,null!==(i=a[n])&&void 0!==i?i:{})})})),expanded:null!==(t=e.params.expanded)&&void 0!==t&&t,invertsY:SU(e.params),max:EU(e.params,s.rawValue),parser:eI,pickerLayout:null!==(n=e.params.picker)&&void 0!==n?n:"popup",value:s,viewProps:e.viewProps})}});class CU{constructor(e=0,t=0,n=0){this.x=e,this.y=t,this.z=n}getComponents(){return[this.x,this.y,this.z]}static isObject(e){if(bD(e))return!1;const t=e.x,n=e.y,i=e.z;return"number"==typeof t&&"number"==typeof n&&"number"==typeof i}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}const TU={toComponents:e=>e.getComponents(),fromComponents:e=>new CU(...e)};function PU(e){return CU.isObject(e)?new CU(e.x,e.y,e.z):new CU}function AU(e,t){e.writeProperty("x",t.x),e.writeProperty("y",t.y),e.writeProperty("z",t.z)}nk({id:"input-point3d",type:"input",accept:(e,t)=>{if(!CU.isObject(e))return null;const n=EI(t,(e=>Object.assign(Object.assign({},bO(e)),{readonly:e.optional.constant(!1),x:e.optional.custom(yO),y:e.optional.custom(yO),z:e.optional.custom(yO)})));return n?{initialValue:e,params:n}:null},binding:{reader:e=>PU,constraint:e=>{return t=e.params,n=e.initialValue,new oU({assembly:TU,components:[xO(Object.assign(Object.assign({},t),t.x),n.x),xO(Object.assign(Object.assign({},t),t.y),n.y),xO(Object.assign(Object.assign({},t),t.z),n.z)]});var t,n},equals:CU.equals,writer:e=>AU},controller:e=>{const t=e.value,n=e.constraint,i=[e.params.x,e.params.y,e.params.z];return new hU(e.document,{assembly:TU,axes:t.rawValue.getComponents().map(((t,s)=>{var r;return mI({constraint:n.components[s],initialValue:t,params:ED(e.params,null!==(r=i[s])&&void 0!==r?r:{})})})),parser:eI,value:t,viewProps:e.viewProps})}});class LU{constructor(e=0,t=0,n=0,i=0){this.x=e,this.y=t,this.z=n,this.w=i}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(e){if(bD(e))return!1;const t=e.x,n=e.y,i=e.z,s=e.w;return"number"==typeof t&&"number"==typeof n&&"number"==typeof i&&"number"==typeof s}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}const RU={toComponents:e=>e.getComponents(),fromComponents:e=>new LU(...e)};function DU(e){return LU.isObject(e)?new LU(e.x,e.y,e.z,e.w):new LU}function IU(e,t){e.writeProperty("x",t.x),e.writeProperty("y",t.y),e.writeProperty("z",t.z),e.writeProperty("w",t.w)}nk({id:"input-point4d",type:"input",accept:(e,t)=>{if(!LU.isObject(e))return null;const n=EI(t,(e=>Object.assign(Object.assign({},bO(e)),{readonly:e.optional.constant(!1),w:e.optional.custom(yO),x:e.optional.custom(yO),y:e.optional.custom(yO),z:e.optional.custom(yO)})));return n?{initialValue:e,params:n}:null},binding:{reader:e=>DU,constraint:e=>{return t=e.params,n=e.initialValue,new oU({assembly:RU,components:[xO(Object.assign(Object.assign({},t),t.x),n.x),xO(Object.assign(Object.assign({},t),t.y),n.y),xO(Object.assign(Object.assign({},t),t.z),n.z),xO(Object.assign(Object.assign({},t),t.w),n.w)]});var t,n},equals:LU.equals,writer:e=>IU},controller:e=>{const t=e.value,n=e.constraint,i=[e.params.x,e.params.y,e.params.z,e.params.w];return new hU(e.document,{assembly:RU,axes:t.rawValue.getComponents().map(((t,s)=>{var r;return mI({constraint:n.components[s],initialValue:t,params:ED(e.params,null!==(r=i[s])&&void 0!==r?r:{})})})),parser:eI,value:t,viewProps:e.viewProps})}}),nk({id:"input-string",type:"input",accept:(e,t)=>{if("string"!=typeof e)return null;const n=EI(t,(e=>({readonly:e.optional.constant(!1),options:e.optional.custom(Vk)})));return n?{initialValue:e,params:n}:null},binding:{reader:e=>eO,constraint:e=>function(e){const t=[],n=Fk(e.options);return n&&t.push(n),new Ok(t)}(e.params),writer:e=>EO},controller:e=>{const t=e.document,n=e.value,i=e.constraint,s=i&&Nk(i,Uk);return s?new Gk(t,{props:new ID({options:s.values.value("options")}),value:n,viewProps:e.viewProps}):new Yk(t,{parser:e=>e,props:ID.fromObject({formatter:tO}),value:n,viewProps:e.viewProps})},api:e=>"string"!=typeof e.controller.value.rawValue?null:e.controller.valueController instanceof Gk?new kk(e.controller):null});const kU={defaultInterval:200,defaultRows:3},OU=zI("mll");class NU{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(OU()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("textarea");n.classList.add(OU("i")),n.style.height=`calc(var(${wO("containerUnitSize")}) * ${t.rows})`,n.readOnly=!0,t.viewProps.bindDisabled(n),this.element.appendChild(n),this.textareaElem_=n,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.textareaElem_,t=e.scrollTop===e.scrollHeight-e.clientHeight,n=[];this.value.rawValue.forEach((e=>{void 0!==e&&n.push(this.formatter_(e))})),e.textContent=n.join("\n"),t&&(e.scrollTop=e.scrollHeight)}onValueUpdate_(){this.update_()}}class UU{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new NU(e,{formatter:t.formatter,rows:t.rows,value:this.value,viewProps:this.viewProps})}}const VU=zI("sgl");class BU{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(VU()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("input");n.classList.add(VU("i")),n.readOnly=!0,n.type="text",t.viewProps.bindDisabled(n),this.element.appendChild(n),this.inputElement=n,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.value.rawValue,t=e[e.length-1];this.inputElement.value=void 0!==t?this.formatter_(t):""}onValueUpdate_(){this.update_()}}class FU{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new BU(e,{formatter:t.formatter,value:this.value,viewProps:this.viewProps})}}nk({id:"monitor-bool",type:"monitor",accept:(e,t)=>{if("boolean"!=typeof e)return null;const n=EI(t,(e=>({readonly:e.required.constant(!0),rows:e.optional.number})));return n?{initialValue:e,params:n}:null},binding:{reader:e=>$k},controller:e=>{var t;return 1===e.value.rawValue.length?new FU(e.document,{formatter:Zk,value:e.value,viewProps:e.viewProps}):new UU(e.document,{formatter:Zk,rows:null!==(t=e.params.rows)&&void 0!==t?t:kU.defaultRows,value:e.value,viewProps:e.viewProps})}});class zU extends bI{get max(){return this.controller.valueController.props.get("max")}set max(e){this.controller.valueController.props.set("max",e)}get min(){return this.controller.valueController.props.get("min")}set min(e){this.controller.valueController.props.set("min",e)}}const HU=zI("grl");class GU{constructor(e,t){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=e.createElement("div"),this.element.classList.add(HU()),t.viewProps.bindClassModifiers(this.element),this.formatter_=t.formatter,this.props_=t.props,this.cursor_=t.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const n=e.createElementNS(AI,"svg");n.classList.add(HU("g")),n.style.height=`calc(var(${wO("containerUnitSize")}) * ${t.rows})`,this.element.appendChild(n),this.svgElem_=n;const i=e.createElementNS(AI,"polyline");this.svgElem_.appendChild(i),this.lineElem_=i;const s=e.createElement("div");s.classList.add(HU("t"),zI("tt")()),this.element.appendChild(s),this.tooltipElem_=s,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const e=this.svgElem_.getBoundingClientRect(),t=this.value.rawValue.length-1,n=this.props_.get("min"),i=this.props_.get("max"),s=[];this.value.rawValue.forEach(((r,a)=>{if(void 0===r)return;const o=iI(a,0,t,0,e.width),l=iI(r,n,i,e.height,0);s.push([o,l].join(","))})),this.lineElem_.setAttributeNS(null,"points",s.join(" "));const r=this.tooltipElem_,a=this.value.rawValue[this.cursor_.rawValue];if(void 0===a)return void r.classList.remove(HU("t","a"));const o=iI(this.cursor_.rawValue,0,t,0,e.width),l=iI(a,n,i,e.height,0);r.style.left=`${o}px`,r.style.top=`${l}px`,r.textContent=`${this.formatter_(a)}`,r.classList.contains(HU("t","a"))||(r.classList.add(HU("t","a"),HU("t","in")),LI(r),r.classList.remove(HU("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class jU{constructor(e,t){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.cursor_=DD(-1),this.view=new GU(e,{cursor:this.cursor_,formatter:t.formatter,rows:t.rows,props:this.props,value:this.value,viewProps:this.viewProps}),RI(e)){const e=new lO(this.view.element);e.emitter.on("down",this.onGraphPointerDown_),e.emitter.on("move",this.onGraphPointerMove_),e.emitter.on("up",this.onGraphPointerUp_)}else this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_)}importProps(e){return SI(e,null,(e=>({max:e.required.number,min:e.required.number})),(e=>(this.props.set("max",e.max),this.props.set("min",e.min),!0)))}exportProps(){return CI(null,{max:this.props.get("max"),min:this.props.get("min")})}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(e){const t=this.view.element.getBoundingClientRect();this.cursor_.rawValue=Math.floor(iI(e.offsetX,0,t.width,0,this.value.rawValue.length))}onGraphPointerDown_(e){this.onGraphPointerMove_(e)}onGraphPointerMove_(e){e.data.point?this.cursor_.rawValue=Math.floor(iI(e.data.point.x,0,e.data.bounds.width,0,this.value.rawValue.length)):this.cursor_.rawValue=-1}onGraphPointerUp_(){this.cursor_.rawValue=-1}}function WU(e){return bD(e.format)?nI(2):e.format}function qU(e){return"graph"===e.view}nk({id:"monitor-number",type:"monitor",accept:(e,t)=>{if("number"!=typeof e)return null;const n=EI(t,(e=>({format:e.optional.function,max:e.optional.number,min:e.optional.number,readonly:e.required.constant(!0),rows:e.optional.number,view:e.optional.string})));return n?{initialValue:e,params:n}:null},binding:{defaultBufferSize:e=>qU(e)?64:1,reader:e=>tI},controller:e=>qU(e.params)?function(e){var t,n,i;return new jU(e.document,{formatter:WU(e.params),rows:null!==(t=e.params.rows)&&void 0!==t?t:kU.defaultRows,props:ID.fromObject({max:null!==(n=e.params.max)&&void 0!==n?n:100,min:null!==(i=e.params.min)&&void 0!==i?i:0}),value:e.value,viewProps:e.viewProps})}(e):function(e){var t;return 1===e.value.rawValue.length?new FU(e.document,{formatter:WU(e.params),value:e.value,viewProps:e.viewProps}):new UU(e.document,{formatter:WU(e.params),rows:null!==(t=e.params.rows)&&void 0!==t?t:kU.defaultRows,value:e.value,viewProps:e.viewProps})}(e),api:e=>e.controller.valueController instanceof jU?new zU(e.controller):null}),nk({id:"monitor-string",type:"monitor",accept:(e,t)=>{if("string"!=typeof e)return null;const n=EI(t,(e=>({multiline:e.optional.boolean,readonly:e.required.constant(!0),rows:e.optional.number})));return n?{initialValue:e,params:n}:null},binding:{reader:e=>eO},controller:e=>{var t;const n=e.value;return n.rawValue.length>1||e.params.multiline?new UU(e.document,{formatter:tO,rows:null!==(t=e.params.rows)&&void 0!==t?t:kU.defaultRows,value:n,viewProps:e.viewProps}):new FU(e.document,{formatter:tO,value:n,viewProps:e.viewProps})}});class XU{multiply(e){return this.format(this.quat.multiply(e.quat))}premultiply(e){return this.format(e.multiply(this))}slerp(e,t){return this.format(this.quat.slerp(e.quat,t))}}function KU(e,t,n){return Math.min(Math.max(e,t),n)}function YU(e,t){return e-function(e,t){return Math.floor(e/t)*t}(e,t)}function $U(e){return YU(e+Math.PI,2*Math.PI)-Math.PI}class ZU extends XU{static fromQuaternion(e,t,n){const i=e.toMat3(),[s,r,a,o]="XYZ"===t?[0,1,2,1]:"XZY"===t?[0,2,1,-1]:"YXZ"===t?[1,0,2,-1]:"YZX"===t?[1,2,0,1]:"ZXY"===t?[2,0,1,1]:[2,1,0,-1],l=[0,0,0],c=i[a+3*s];return l[r]=-o*Math.asin(KU(c,-1,1)),Math.abs(c)<.999999?(l[s]=o*Math.atan2(i[a+3*r],i[4*a]),l[a]=o*Math.atan2(i[r+3*s],i[4*s])):l[s]=o*Math.atan2(-i[r+3*a],i[4*r]),Math.abs(l[s])+Math.abs(l[a])>Math.PI&&(l[s]=$U(l[s]+Math.PI),l[r]=$U(Math.PI-l[r]),l[a]=$U(l[a]+Math.PI)),new ZU(...l,t).reunit(n)}constructor(e,t,n,i,s){super(),this.x=null!=e?e:0,this.y=null!=t?t:0,this.z=null!=n?n:0,this.order=null!=i?i:"XYZ",this.unit=null!=s?s:"rad"}get quat(){return JU.fromEuler(this)}getComponents(){return[this.x,this.y,this.z]}toEuler(e,t){return this.reorder(e).reunit(t)}format(e){return e instanceof ZU?e.reorder(this.order):e.toEuler(this.order,this.unit)}reorder(e){return e===this.order?this:this.quat.toEuler(e,this.unit)}reunit(e){const t={deg:Math.PI/180,rad:1,turn:2*Math.PI}[this.unit]*{deg:180/Math.PI,rad:1,turn:.5/Math.PI}[e];return new ZU(t*this.x,t*this.y,t*this.z,this.order,e)}}class JU extends XU{static fromAxisAngle(e,t){const n=t/2,i=Math.sin(n);return new JU(e.x*i,e.y*i,e.z*i,Math.cos(n))}static fromEuler(e){const t=e.reunit("rad"),[n,i,s,r]="XYZ"===t.order?[0,1,2,1]:"XZY"===t.order?[0,2,1,-1]:"YXZ"===t.order?[1,0,2,-1]:"YZX"===t.order?[1,2,0,1]:"ZXY"===t.order?[2,0,1,1]:[2,1,0,-1],a=t.getComponents(),o=.5*a[n],l=.5*r*a[i],c=.5*a[s],h=Math.cos(o),u=Math.cos(l),d=Math.cos(c),p=Math.sin(o),m=Math.sin(l),f=Math.sin(c),v=[0,0,0,d*u*h+f*m*p];return v[n]=d*u*p-f*m*h,v[i]=r*(d*m*h+f*u*p),v[s]=f*u*h-d*m*p,new JU(...v)}static lookRotation(e,t){const{normal:n,tangent:i,binormal:s}=e.orthoNormalize(t),r=s.x,a=i.x,o=n.x,l=s.y,c=i.y,h=n.y,u=s.z,d=i.z,p=n.z,m=r+c+p;if(m>0){const e=.5/Math.sqrt(m+1);return new JU((d-h)*e,(o-u)*e,(l-a)*e,.25/e)}if(r>c&&r>p){const e=2*Math.sqrt(1+r-c-p);return new JU(.25*e,(a+l)/e,(o+u)/e,(d-h)/e)}if(c>p){const e=2*Math.sqrt(1+c-r-p);return new JU((a+l)/e,.25*e,(h+d)/e,(o-u)/e)}{const e=2*Math.sqrt(1+p-r-c);return new JU((o+u)/e,(h+d)/e,.25*e,(l-a)/e)}}constructor(e,t,n,i){super(),this.x=null!=e?e:0,this.y=null!=t?t:0,this.z=null!=n?n:0,this.w=null!=i?i:1}get quat(){return this}getComponents(){return[this.x,this.y,this.z,this.w]}toEuler(e,t){return ZU.fromQuaternion(this,e,t)}get lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}get length(){return Math.sqrt(this.lengthSq)}get normalized(){const e=this.length;return 0===e?new JU:new JU(this.x/e,this.y/e,this.z/e,this.w/e)}get negated(){return new JU(-this.x,-this.y,-this.z,-this.w)}get ban360s(){return this.w<0?this.negated:this}multiply(e){const t=e.quat;return new JU(this.w*t.x+this.x*t.w+this.y*t.z-this.z*t.y,this.w*t.y-this.x*t.z+this.y*t.w+this.z*t.x,this.w*t.z+this.x*t.y-this.y*t.x+this.z*t.w,this.w*t.w-this.x*t.x-this.y*t.y-this.z*t.z)}format(e){return e.quat}slerp(e,t){let n=e.quat;if(0===t)return this;if(1===t)return n;const i=this.ban360s;n=n.ban360s;let s=i.w*n.w+i.x*n.x+i.y*n.y+i.z*n.z;if(s<0&&(n=n.negated,s=-s),s>=1)return i;const r=1-s*s;if(r<=Number.EPSILON){const e=1-t;return new JU(e*i.x+t*n.x,e*i.y+t*n.y,e*i.z+t*n.z,e*i.w+t*n.w).normalized}const a=Math.sqrt(r),o=Math.atan2(a,s),l=Math.sin((1-t)*o)/a,c=Math.sin(t*o)/a;return new JU(i.x*l+n.x*c,i.y*l+n.y*c,i.z*l+n.z*c,i.w*l+n.w*c)}toMat3(){const{x:e,y:t,z:n,w:i}=this;return[1-2*t*t-2*n*n,2*e*t+2*n*i,2*e*n-2*t*i,2*e*t-2*n*i,1-2*e*e-2*n*n,2*t*n+2*e*i,2*e*n+2*t*i,2*t*n-2*e*i,1-2*e*e-2*t*t]}}class QU{constructor(){this.offset=[0,0,-5],this.fov=30,this.aspect=1,this.viewport=[0,0,1,1]}project(e){const t=.5*(this.viewport[0]+this.viewport[2]),n=.5*(this.viewport[1]+this.viewport[3]),i=this.viewport[2]-this.viewport[0],s=this.viewport[3]-this.viewport[1],r=1/Math.tan(this.fov*Math.PI/360),a=-(e.z+this.offset[2]);return[t+(e.x+this.offset[0])/a*r*i*.5/this.aspect,n-(e.y+this.offset[1])/a*r*s*.5]}}class eV{constructor(e,t,n){this.element=e.createElementNS(AI,"path"),this.vertices=t,this.projector=n}setRotation(e){let t="";return this.vertices.forEach(((n,i)=>{const s=n.applyQuaternion(e),[r,a]=this.projector.project(s);t+=`${0===i?"M":"L"}${r} ${a}`})),this.element.setAttributeNS(null,"d",t),this}}class tV{constructor(e,t,n){this.x=null!=e?e:0,this.y=null!=t?t:0,this.z=null!=n?n:0}getComponents(){return[this.x,this.y,this.z]}get lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}get length(){return Math.sqrt(this.lengthSq)}get normalized(){const e=this.length;return 0===e?new tV:new tV(this.x/e,this.y/e,this.z/e)}get negated(){return new tV(-this.x,-this.y,-this.z)}add(e){return new tV(this.x+e.x,this.y+e.y,this.z+e.z)}sub(e){return new tV(this.x-e.x,this.y-e.y,this.z-e.z)}scale(e){return new tV(this.x*e,this.y*e,this.z*e)}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}cross(e){return new tV(this.y*e.z-this.z*e.y,this.z*e.x-this.x*e.z,this.x*e.y-this.y*e.x)}orthoNormalize(e){const t=this.normalized;e=e.normalized;let n=t.dot(e);1===n&&(e=Math.abs(t.y)>Math.abs(t.z)?new tV(0,0,1):new tV(0,1,0),n=t.dot(e));const i=(e=e.sub(t.scale(n)).normalized).cross(t);return{normal:t,tangent:e,binormal:i}}applyQuaternion(e){const t=e.w*this.x+e.y*this.z-e.z*this.y,n=e.w*this.y+e.z*this.x-e.x*this.z,i=e.w*this.z+e.x*this.y-e.y*this.x,s=-e.x*this.x-e.y*this.y-e.z*this.z;return new tV(t*e.w+s*-e.x+n*-e.z-i*-e.y,n*e.w+s*-e.y+i*-e.x-t*-e.z,i*e.w+s*-e.z+t*-e.y-n*-e.x)}}function nV(e,t){const n=t.z>0?new JU(0,0,0,1):new JU(0,0,1,0);return Math.abs(e.z)>.9999?n:JU.lookRotation(e,t)}function iV(e,t,n,i,s,r=1){const a=[];for(let o=0;o<n;o++){const l=e+t*o/(n-1),c=new tV;c[i]=r*Math.cos(l),c[s]=r*Math.sin(l),a.push(c)}return a}const sV=zI("rotationgizmo"),rV=new tV(0,0,0),aV=new tV(1,0,0),oV=new tV(0,1,0),lV=new tV(0,0,1),cV=new tV(0,0,-1),hV=new tV(.7,0,0),uV=new tV(0,.7,0),dV=new tV(0,0,.7),pV=new tV(-.7,0,0),mV=new tV(0,-.7,0),fV=new tV(0,0,-.7),vV=new JU(0,0,0,1);function gV(e,t,n){const i=e.createElementNS(AI,"g"),s=e.createElementNS(AI,"circle");s.classList.add(sV(t)),s.setAttributeNS(null,"cx","0"),s.setAttributeNS(null,"cy","0"),s.setAttributeNS(null,"r","8"),i.appendChild(s);const r=e.createElementNS(AI,"text");return r.classList.add(sV("labeltext")),r.setAttributeNS(null,"y","4"),r.setAttributeNS(null,"text-anchor","middle"),r.setAttributeNS(null,"font-size","10"),r.textContent=n,i.appendChild(r),i}class _V{get xArcBElement(){return this.xArcBC_.element}get yArcBElement(){return this.yArcBC_.element}get zArcBElement(){return this.zArcBC_.element}get xArcFElement(){return this.xArcFC_.element}get yArcFElement(){return this.yArcFC_.element}get zArcFElement(){return this.zArcFC_.element}get rArcElement(){return this.rArcC_.element}constructor(e,t){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.onModeChange_=this.onModeChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(sV()),"popup"===t.pickerLayout&&this.element.classList.add(sV(void 0,"p"));const n=e.createElement("div");n.classList.add(sV("p")),t.viewProps.bindTabIndex(n),this.element.appendChild(n),this.padElement=n;const i=e.createElementNS(AI,"svg");i.classList.add(sV("g")),this.padElement.appendChild(i),this.svgElem_=i,this.projector_=new QU,this.projector_.viewport=[0,0,136,136];const s=iV(0,Math.PI,33,"x","y"),r=iV(0,2*Math.PI,65,"x","y",1.1);this.xArcB_=new eV(e,s,this.projector_),this.xArcB_.element.classList.add(sV("arcx")),this.svgElem_.appendChild(this.xArcB_.element),this.yArcB_=new eV(e,s,this.projector_),this.yArcB_.element.classList.add(sV("arcy")),this.svgElem_.appendChild(this.yArcB_.element),this.zArcB_=new eV(e,s,this.projector_),this.zArcB_.element.classList.add(sV("arcz")),this.svgElem_.appendChild(this.zArcB_.element),this.xArcBC_=new eV(e,s,this.projector_),this.xArcBC_.element.classList.add(sV("arcc")),this.svgElem_.appendChild(this.xArcBC_.element),this.yArcBC_=new eV(e,s,this.projector_),this.yArcBC_.element.classList.add(sV("arcc")),this.svgElem_.appendChild(this.yArcBC_.element),this.zArcBC_=new eV(e,s,this.projector_),this.zArcBC_.element.classList.add(sV("arcc")),this.svgElem_.appendChild(this.zArcBC_.element);const a=e.createElementNS(AI,"g");i.classList.add(sV("axes")),this.svgElem_.appendChild(a),this.axesElem_=a,this.xAxis_=new eV(e,[rV,hV],this.projector_),this.xAxis_.element.classList.add(sV("axisx")),this.axesElem_.appendChild(this.xAxis_.element),this.yAxis_=new eV(e,[rV,uV],this.projector_),this.yAxis_.element.classList.add(sV("axisy")),this.axesElem_.appendChild(this.yAxis_.element),this.zAxis_=new eV(e,[rV,dV],this.projector_),this.zAxis_.element.classList.add(sV("axisz")),this.axesElem_.appendChild(this.zAxis_.element),this.xnAxis_=new eV(e,[rV,pV],this.projector_),this.xnAxis_.element.classList.add(sV("axisn")),this.axesElem_.appendChild(this.xnAxis_.element),this.ynAxis_=new eV(e,[rV,mV],this.projector_),this.ynAxis_.element.classList.add(sV("axisn")),this.axesElem_.appendChild(this.ynAxis_.element),this.znAxis_=new eV(e,[rV,fV],this.projector_),this.znAxis_.element.classList.add(sV("axisn")),this.axesElem_.appendChild(this.znAxis_.element),this.xArcF_=new eV(e,s,this.projector_),this.xArcF_.element.classList.add(sV("arcx")),this.svgElem_.appendChild(this.xArcF_.element),this.yArcF_=new eV(e,s,this.projector_),this.yArcF_.element.classList.add(sV("arcy")),this.svgElem_.appendChild(this.yArcF_.element),this.zArcF_=new eV(e,s,this.projector_),this.zArcF_.element.classList.add(sV("arcz")),this.svgElem_.appendChild(this.zArcF_.element),this.xArcFC_=new eV(e,s,this.projector_),this.xArcFC_.element.classList.add(sV("arcc")),this.svgElem_.appendChild(this.xArcFC_.element),this.yArcFC_=new eV(e,s,this.projector_),this.yArcFC_.element.classList.add(sV("arcc")),this.svgElem_.appendChild(this.yArcFC_.element),this.zArcFC_=new eV(e,s,this.projector_),this.zArcFC_.element.classList.add(sV("arcc")),this.svgElem_.appendChild(this.zArcFC_.element),this.rArc_=new eV(e,r,this.projector_),this.rArc_.element.classList.add(sV("arcr")),this.rArc_.setRotation(vV),this.svgElem_.appendChild(this.rArc_.element),this.rArcC_=new eV(e,r,this.projector_),this.rArcC_.element.classList.add(sV("arcc")),this.rArcC_.setRotation(vV),this.svgElem_.appendChild(this.rArcC_.element);const o=e.createElementNS(AI,"g");i.classList.add(sV("labels")),this.svgElem_.appendChild(o),this.labelsElem_=o,this.xLabel=gV(e,"labelcirclex","X"),this.labelsElem_.appendChild(this.xLabel),this.yLabel=gV(e,"labelcircley","Y"),this.labelsElem_.appendChild(this.yLabel),this.zLabel=gV(e,"labelcirclez","Z"),this.labelsElem_.appendChild(this.zLabel),this.xnLabel=gV(e,"labelcirclen","-X"),this.labelsElem_.appendChild(this.xnLabel),this.ynLabel=gV(e,"labelcirclen","-Y"),this.labelsElem_.appendChild(this.ynLabel),this.znLabel=gV(e,"labelcirclen","-Z"),this.labelsElem_.appendChild(this.znLabel);const l=()=>{this.xArcB_.element.classList.add(sV("arcx_hover")),this.xArcF_.element.classList.add(sV("arcx_hover"))},c=()=>{this.xArcB_.element.classList.remove(sV("arcx_hover")),this.xArcF_.element.classList.remove(sV("arcx_hover"))};this.xArcBC_.element.addEventListener("mouseenter",l),this.xArcBC_.element.addEventListener("mouseleave",c),this.xArcFC_.element.addEventListener("mouseenter",l),this.xArcFC_.element.addEventListener("mouseleave",c);const h=()=>{this.yArcB_.element.classList.add(sV("arcy_hover")),this.yArcF_.element.classList.add(sV("arcy_hover"))},u=()=>{this.yArcB_.element.classList.remove(sV("arcy_hover")),this.yArcF_.element.classList.remove(sV("arcy_hover"))};this.yArcBC_.element.addEventListener("mouseenter",h),this.yArcBC_.element.addEventListener("mouseleave",u),this.yArcFC_.element.addEventListener("mouseenter",h),this.yArcFC_.element.addEventListener("mouseleave",u);const d=()=>{this.zArcB_.element.classList.add(sV("arcz_hover")),this.zArcF_.element.classList.add(sV("arcz_hover"))},p=()=>{this.zArcB_.element.classList.remove(sV("arcz_hover")),this.zArcF_.element.classList.remove(sV("arcz_hover"))};this.zArcBC_.element.addEventListener("mouseenter",d),this.zArcBC_.element.addEventListener("mouseleave",p),this.zArcFC_.element.addEventListener("mouseenter",d),this.zArcFC_.element.addEventListener("mouseleave",p);this.rArcC_.element.addEventListener("mouseenter",(()=>{this.rArc_.element.classList.add(sV("arcr_hover"))})),this.rArcC_.element.addEventListener("mouseleave",(()=>{this.rArc_.element.classList.remove(sV("arcr_hover"))})),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,t.mode.emitter.on("change",this.onModeChange_),this.mode_=t.mode,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const e=this.value.rawValue.quat.normalized;this.xAxis_.setRotation(e),this.yAxis_.setRotation(e),this.zAxis_.setRotation(e),this.xnAxis_.setRotation(e),this.ynAxis_.setRotation(e),this.znAxis_.setRotation(e);const t=aV.applyQuaternion(e),n=oV.applyQuaternion(e),i=lV.applyQuaternion(e),s=t.negated,r=n.negated,a=i.negated;[{el:this.xAxis_.element,v:t},{el:this.yAxis_.element,v:n},{el:this.zAxis_.element,v:i},{el:this.xnAxis_.element,v:s},{el:this.ynAxis_.element,v:r},{el:this.znAxis_.element,v:a}].map((({el:e,v:t})=>(this.axesElem_.removeChild(e),{el:e,v:t}))).sort(((e,t)=>e.v.z-t.v.z)).forEach((({el:e})=>{this.axesElem_.appendChild(e)})),this.xArcB_.setRotation(nV(t,cV)),this.yArcB_.setRotation(nV(n,cV)),this.zArcB_.setRotation(nV(i,cV)),this.xArcBC_.setRotation(nV(t,cV)),this.yArcBC_.setRotation(nV(n,cV)),this.zArcBC_.setRotation(nV(i,cV)),this.xArcF_.setRotation(nV(t,lV)),this.yArcF_.setRotation(nV(n,lV)),this.zArcF_.setRotation(nV(i,lV)),this.xArcFC_.setRotation(nV(t,lV)),this.yArcFC_.setRotation(nV(n,lV)),this.zArcFC_.setRotation(nV(i,lV)),[{el:this.xLabel,v:hV},{el:this.yLabel,v:uV},{el:this.zLabel,v:dV},{el:this.xnLabel,v:pV},{el:this.ynLabel,v:mV},{el:this.znLabel,v:fV}].forEach((({el:t,v:n})=>{const[i,s]=this.projector_.project(n.applyQuaternion(e));t.setAttributeNS(null,"transform",`translate( ${i}, ${s} )`)})),[{el:this.xLabel,v:t},{el:this.yLabel,v:n},{el:this.zLabel,v:i},{el:this.xnLabel,v:s},{el:this.ynLabel,v:r},{el:this.znLabel,v:a}].map((({el:e,v:t})=>(this.labelsElem_.removeChild(e),{el:e,v:t}))).sort(((e,t)=>e.v.z-t.v.z)).forEach((({el:e})=>{this.labelsElem_.appendChild(e)}))}onValueChange_(){this.update_()}onFoldableChange_(){this.update_()}onModeChange_(){const e=this.mode_.rawValue,t="angle-x"===e?"add":"remove",n="angle-y"===e?"add":"remove",i="angle-z"===e?"add":"remove",s="angle-r"===e?"add":"remove";this.xArcB_.element.classList[t](sV("arcx_active")),this.yArcB_.element.classList[n](sV("arcy_active")),this.zArcB_.element.classList[i](sV("arcz_active")),this.xArcF_.element.classList[t](sV("arcx_active")),this.yArcF_.element.classList[n](sV("arcy_active")),this.zArcF_.element.classList[i](sV("arcz_active")),this.rArc_.element.classList[s](sV("arcr_active"))}}function wV(e){return KU(e,0,1)}const bV=1/Math.sqrt(2),yV=new tV(1,0,0),xV=new tV(0,1,0),MV=new tV(0,0,1),EV=new JU(0,0,0,1),SV=new JU(bV,0,0,bV),CV=new JU(0,-bV,0,bV),TV=new JU(-bV,0,0,bV),PV=new JU(0,bV,0,bV),AV=new JU(0,1,0,0);class LV{constructor(e,t){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.mode_=DD("free"),this.view=new _V(e,{value:this.value,mode:this.mode_,viewProps:this.viewProps,pickerLayout:t.pickerLayout}),this.ptHandler_=new lO(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_);const n=new lO(this.view.xArcBElement);n.emitter.on("down",(()=>this.changeModeIfNotAuto_("angle-x"))),n.emitter.on("up",(()=>this.changeModeIfNotAuto_("free")));const i=new lO(this.view.xArcFElement);i.emitter.on("down",(()=>this.changeModeIfNotAuto_("angle-x"))),i.emitter.on("up",(()=>this.changeModeIfNotAuto_("free")));const s=new lO(this.view.yArcBElement);s.emitter.on("down",(()=>this.changeModeIfNotAuto_("angle-y"))),s.emitter.on("up",(()=>this.changeModeIfNotAuto_("free")));const r=new lO(this.view.yArcFElement);r.emitter.on("down",(()=>this.changeModeIfNotAuto_("angle-y"))),r.emitter.on("up",(()=>this.changeModeIfNotAuto_("free")));const a=new lO(this.view.zArcBElement);a.emitter.on("down",(()=>this.changeModeIfNotAuto_("angle-z"))),a.emitter.on("up",(()=>this.changeModeIfNotAuto_("free")));const o=new lO(this.view.zArcFElement);o.emitter.on("down",(()=>this.changeModeIfNotAuto_("angle-z"))),o.emitter.on("up",(()=>this.changeModeIfNotAuto_("free")));const l=new lO(this.view.rArcElement);l.emitter.on("down",(()=>this.changeModeIfNotAuto_("angle-r"))),l.emitter.on("up",(()=>this.changeModeIfNotAuto_("free"))),[{el:this.view.xLabel,q:CV},{el:this.view.yLabel,q:SV},{el:this.view.zLabel,q:EV},{el:this.view.xnLabel,q:PV},{el:this.view.ynLabel,q:TV},{el:this.view.znLabel,q:AV}].forEach((({el:e,q:t})=>{new lO(e).emitter.on("down",(()=>this.autoRotate_(t)))})),this.px_=null,this.py_=null,this.angleState_=null}handlePointerEvent_(e){if(!e.point)return;const t=this.mode_.rawValue,n=e.point.x,i=e.point.y;if("auto"===t);else if("free"===t){if(null!=this.px_&&null!=this.py_){const e=n-this.px_,t=i-this.py_,s=Math.sqrt(e*e+t*t);if(0===s)return;const r=new tV(t/s,e/s,0),a=JU.fromAxisAngle(r,s/68);this.value.rawValue=this.value.rawValue.premultiply(a)}this.px_=n,this.py_=i}else if("angle-r"===t){const t=e.bounds.width/2,s=e.bounds.height/2,r=Math.atan2(i-s,n-t);if(null==this.angleState_){const e=new tV(0,0,1);this.angleState_={initialRotation:this.value.rawValue,initialAngle:r,axis:e,reverseAngle:!0}}else{const{initialRotation:e,initialAngle:t,axis:n}=this.angleState_,i=-$U(r-t),s=JU.fromAxisAngle(n,i);this.value.rawValue=e.premultiply(s)}}else{const s=e.bounds.width/2,r=e.bounds.height/2,a=Math.atan2(i-r,n-s);if(null==this.angleState_){const e="angle-x"===t?yV:"angle-y"===t?xV:MV,n=e.applyQuaternion(this.value.rawValue.quat).z>0;this.angleState_={initialRotation:this.value.rawValue,initialAngle:a,axis:e,reverseAngle:n}}else{const{initialRotation:e,initialAngle:t,axis:n,reverseAngle:i}=this.angleState_;let s=$U(a-t);s=i?-s:s;const r=JU.fromAxisAngle(n,s);this.value.rawValue=e.multiply(r)}}}onPointerDown_(e){this.handlePointerEvent_(e.data)}onPointerMove_(e){this.handlePointerEvent_(e.data)}onPointerUp_(){this.px_=null,this.py_=null,this.angleState_=null}onPadKeyDown_(e){aO(e.key)&&e.preventDefault();const t=iO(1,rO(e)),n=iO(1,sO(e));if(0!==t||0!==n){const e=new tV(-n,t,0),i=JU.fromAxisAngle(e,Math.PI/16);this.value.rawValue=this.value.rawValue.premultiply(i)}}changeModeIfNotAuto_(e){"auto"!==this.mode_.rawValue&&(this.mode_.rawValue=e)}autoRotate_(e){this.mode_.rawValue="auto";const t=this.value.rawValue,n=Date.now(),i=()=>{const s=Date.now(),r=function(e){if(e<=0)return 0;if(e>=1)return 1;const t=1-e;return wV(1-t*(t*(t*(t*(t*(t*(-6*t+7)))))))}(wV((s-n-(a=0))/(300-a)));var a;this.value.rawValue=t.slerp(e,r),1!==r?requestAnimationFrame(i):this.mode_.rawValue="free"};requestAnimationFrame(i)}}const RV=zI("rotationswatch"),DV=new tV(1,0,0),IV=new tV(0,1,0),kV=new tV(0,0,1),OV=new JU(0,0,0,1);class NV{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.element=e.createElement("div"),this.element.classList.add(RV()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("button");n.classList.add(RV("b")),t.viewProps.bindDisabled(n),this.element.appendChild(n),this.buttonElement=n;const i=e.createElementNS(AI,"svg");i.classList.add(RV("g")),n.appendChild(i),this.svgElem_=i,this.projector_=new QU,this.projector_.viewport=[0,0,20,20];const s=iV(0,Math.PI,33,"x","y"),r=iV(0,2*Math.PI,65,"x","y");this.rArc_=new eV(e,r,this.projector_),this.rArc_.element.classList.add(RV("arcr")),i.appendChild(this.rArc_.element),this.rArc_.setRotation(OV),this.xArc_=new eV(e,s,this.projector_),this.xArc_.element.classList.add(RV("arc")),i.appendChild(this.xArc_.element),this.yArc_=new eV(e,s,this.projector_),this.yArc_.element.classList.add(RV("arc")),i.appendChild(this.yArc_.element),this.zArc_=new eV(e,s,this.projector_),this.zArc_.element.classList.add(RV("arc")),i.appendChild(this.zArc_.element),this.update_()}update_(){const e=this.value.rawValue.quat.normalized,t=DV.applyQuaternion(e),n=IV.applyQuaternion(e),i=kV.applyQuaternion(e);this.xArc_.setRotation(nV(t,kV)),this.yArc_.setRotation(nV(n,kV)),this.zArc_.setRotation(nV(i,kV))}onValueChange_(){this.update_()}}class UV{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new NV(e,{value:this.value,viewProps:this.viewProps})}}const VV=zI("rotation");class BV{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(VV()),t.foldable.bindExpandedClass(this.element,VV(void 0,"expanded")),BI(t.foldable,"completed",YI(this.element,VV(void 0,"cpl"))),"quaternion"===t.rotationMode&&this.element.classList.add(VV("quat"));const n=e.createElement("div");n.classList.add(VV("h")),this.element.appendChild(n);const i=e.createElement("div");i.classList.add(VV("s")),n.appendChild(i),this.swatchElement=i;const s=e.createElement("div");if(s.classList.add(VV("t")),n.appendChild(s),this.textElement=s,"inline"===t.pickerLayout){const t=e.createElement("div");t.classList.add(VV("g")),this.element.appendChild(t),this.pickerElement=t}else this.pickerElement=null}}class FV{constructor(e,t){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=dk.create(t.expanded),this.swatchC_=new UV(e,{value:this.value,viewProps:this.viewProps});const n=this.swatchC_.view.buttonElement;n.addEventListener("blur",this.onButtonBlur_),n.addEventListener("click",this.onButtonClick_),this.textC_=new hU(e,{assembly:t.assembly,axes:t.axes,parser:t.parser,value:this.value,viewProps:this.viewProps}),this.view=new BV(e,{rotationMode:t.rotationMode,foldable:this.foldable_,pickerLayout:t.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_="popup"===t.pickerLayout?new qk(e,{viewProps:this.viewProps}):null;const i=new LV(e,{value:this.value,viewProps:this.viewProps,pickerLayout:t.pickerLayout});i.view.allFocusableElements.forEach((e=>{e.addEventListener("blur",this.onPopupChildBlur_),e.addEventListener("keydown",this.onPopupChildKeydown_)})),this.gizmoC_=i,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(i.view.element),nO({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:e=>e,backward:(e,t)=>t})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.gizmoC_.view.element),mk(this.foldable_,this.view.pickerElement))}onButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,n=e.relatedTarget;n&&t.contains(n)||(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.gizmoC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,n=UI(e);n&&t.contains(n)||n&&n===this.swatchC_.view.buttonElement&&!RI(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?"Escape"===e.key&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&"Escape"===e.key&&this.swatchC_.view.buttonElement.focus()}}function zV(e,t){const n=Math.pow(.1,e);return{baseStep:n,constraint:t,textProps:ID.fromObject({formatter:nI(e),keyScale:n,pointerScale:n})}}function HV(e){if(!e)return;const t=[];return bD(e.step)||t.push(new ND(e.step)),bD(e.max)&&bD(e.min)||t.push(new OD({max:e.max,min:e.min})),new Ok(t)}function GV(e,t){return{toComponents:e=>e.getComponents(),fromComponents:n=>new ZU(n[0],n[1],n[2],e,t)}}function jV(e,t,n){return"number"==typeof(null==e?void 0:e.x)&&"number"==typeof(null==e?void 0:e.y)&&"number"==typeof(null==e?void 0:e.z)?new ZU(e.x,e.y,e.z,t,n):new ZU(0,0,0,t,n)}function WV(e){switch(e){case"XYZ":case"XZY":case"YXZ":case"YZX":case"ZXY":case"ZYX":return e;default:return}}function qV(e){switch(e){case"rad":case"deg":case"turn":return e;default:return}}const XV=nk({id:"rotation",type:"input",accept(e,t){var n,i;const s=EI(t,(e=>({view:e.required.constant("rotation"),label:e.optional.string,picker:e.optional.custom(MO),expanded:e.optional.boolean,rotationMode:e.required.constant("euler"),x:e.optional.custom(yO),y:e.optional.custom(yO),z:e.optional.custom(yO),order:e.optional.custom(WV),unit:e.optional.custom(qV)})));return s?{initialValue:jV(e,null!==(n=s.order)&&void 0!==n?n:"XYZ",null!==(i=s.unit)&&void 0!==i?i:"rad"),params:s}:null},binding:{reader:({params:e})=>t=>{var n,i;return jV(t,null!==(n=e.order)&&void 0!==n?n:"XYZ",null!==(i=e.unit)&&void 0!==i?i:"rad")},constraint({params:e}){var t,n;return new oU({assembly:GV(null!==(t=e.order)&&void 0!==t?t:"XYZ",null!==(n=e.unit)&&void 0!==n?n:"rad"),components:[HV("x"in e?e.x:void 0),HV("y"in e?e.y:void 0),HV("z"in e?e.z:void 0)]})},writer:e=>(e,t)=>{e.writeProperty("x",t.x),e.writeProperty("y",t.y),e.writeProperty("z",t.z)}},controller({document:e,value:t,constraint:n,params:i,viewProps:s}){var r,a;if(!(n instanceof oU))throw CD.shouldNeverHappen();const o="expanded"in i?i.expanded:void 0,l="picker"in i?i.picker:void 0,c=null!==(r=i.unit)&&void 0!==r?r:"rad",h={rad:2,deg:0,turn:2}[c];return new FV(e,{axes:[zV(h,n.components[0]),zV(h,n.components[1]),zV(h,n.components[2])],assembly:GV(null!==(a=i.order)&&void 0!==a?a:"XYZ",c),rotationMode:"euler",expanded:null!=o&&o,parser:eI,pickerLayout:null!=l?l:"popup",value:t,viewProps:s})}}),KV={toComponents:e=>[e.x,e.y,e.z,e.w],fromComponents:e=>new JU(e[0],e[1],e[2],e[3])};function YV(e){return{baseStep:.01,constraint:e,textProps:ID.fromObject({formatter:e=>Math.abs(e)<.995?e.toFixed(2).replace("0.","."):e.toFixed(1),keyScale:.01,pointerScale:.01})}}function $V(e){return"number"==typeof(null==e?void 0:e.x)&&"number"==typeof(null==e?void 0:e.y)&&"number"==typeof(null==e?void 0:e.z)&&"number"==typeof(null==e?void 0:e.w)?new JU(e.x,e.y,e.z,e.w):new JU(0,0,0,1)}const ZV=nk({id:"rotation",type:"input",accept(e,t){const n=EI(t,(e=>({view:e.required.constant("rotation"),label:e.optional.string,picker:e.optional.custom(MO),expanded:e.optional.boolean,rotationMode:e.optional.constant("quaternion"),x:e.optional.custom(yO),y:e.optional.custom(yO),z:e.optional.custom(yO),w:e.optional.custom(yO)})));return n?{initialValue:$V(e),params:n}:null},binding:{reader:e=>e=>$V(e),constraint:({params:e})=>new oU({assembly:KV,components:[HV("x"in e?e.x:void 0),HV("y"in e?e.y:void 0),HV("z"in e?e.z:void 0),HV("w"in e?e.w:void 0)]}),writer:e=>(e,t)=>{e.writeProperty("x",t.x),e.writeProperty("y",t.y),e.writeProperty("z",t.z),e.writeProperty("w",t.w)}},controller({document:e,value:t,constraint:n,params:i,viewProps:s}){if(!(n instanceof oU))throw CD.shouldNeverHappen();const r="expanded"in i?i.expanded:void 0,a="picker"in i?i.picker:void 0;return new FV(e,{axes:[YV(n.components[0]),YV(n.components[1]),YV(n.components[2]),YV(n.components[3])],assembly:KV,rotationMode:"quaternion",expanded:null!=r&&r,parser:eI,pickerLayout:null!=a?a:"popup",value:t,viewProps:s})}}),JV="rotation",QV=".tp-rotationgizmov_p,.tp-rotationswatchv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-rotationswatchv_b{background-color:var(--btn-bg);border-radius:var(--bld-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--cnt-usz);line-height:var(--cnt-usz);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-rotationswatchv_b:hover{background-color:var(--btn-bg-h)}.tp-rotationswatchv_b:focus{background-color:var(--btn-bg-f)}.tp-rotationswatchv_b:active{background-color:var(--btn-bg-a)}.tp-rotationswatchv_b:disabled{opacity:.5}.tp-rotationgizmov_p{background-color:var(--in-bg);border-radius:var(--bld-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--cnt-usz);line-height:var(--cnt-usz);min-width:0;width:100%}.tp-rotationgizmov_p:hover{background-color:var(--in-bg-h)}.tp-rotationgizmov_p:focus{background-color:var(--in-bg-f)}.tp-rotationgizmov_p:active{background-color:var(--in-bg-a)}.tp-rotationgizmov_p:disabled{opacity:.5}.tp-rotationv{position:relative}.tp-rotationv_quat .tp-txtv_i{padding-left:0}.tp-rotationv_root{background-color:var(--mo-bg);width:100%;height:calc(2*var(--cnt-usz))}.tp-rotationv_h{display:flex}.tp-rotationv_s{flex-grow:0;flex-shrink:0;width:var(--cnt-usz);margin-right:4px}.tp-rotationv_g{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-rotationv.tp-rotationv-expanded .tp-rotationv_g{margin-top:var(--cnt-usp);opacity:1}.tp-rotationv .tp-popv{left:calc(-1*var(--cnt-hp));right:calc(-1*var(--cnt-hp));top:var(--cnt-usz)}.tp-rotationswatchv path{stroke-linecap:round;stroke-linejoin:round}.tp-rotationswatchv_b{height:var(--cnt-usz);margin-right:4px;position:relative;width:var(--cnt-usz)}.tp-rotationswatchv_arc{fill:none;stroke:var(--btn-bg);stroke-width:1px}.tp-rotationswatchv_arcr{fill:var(--btn-fg);stroke:var(--btn-bg);stroke-width:1px}.tp-rotationgizmov{padding-left:calc(var(--cnt-usz) + 4px)}.tp-rotationgizmov path{stroke-linecap:round;stroke-linejoin:round}.tp-rotationgizmov_p{cursor:move;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-rotationgizmov_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-rotationgizmov_axisx{stroke:#eb103f;stroke-width:2px}.tp-rotationgizmov_axisy{stroke:#4eeb10;stroke-width:2px}.tp-rotationgizmov_axisz{stroke:#1068eb;stroke-width:2px}.tp-rotationgizmov_axisn{stroke:var(--in-fg);stroke-width:2px}.tp-rotationgizmov_arcx{fill:none;stroke:var(--in-fg)}.tp-rotationgizmov_arcx.tp-rotationgizmov_arcx_hover{stroke:#eb103f}.tp-rotationgizmov_arcx.tp-rotationgizmov_arcx_active{stroke:#eb103f;stroke-width:2px}.tp-rotationgizmov_arcy{fill:none;stroke:var(--in-fg)}.tp-rotationgizmov_arcy.tp-rotationgizmov_arcy_hover{stroke:#4eeb10}.tp-rotationgizmov_arcy.tp-rotationgizmov_arcy_active{stroke:#4eeb10;stroke-width:2px}.tp-rotationgizmov_arcz{fill:none;stroke:var(--in-fg)}.tp-rotationgizmov_arcz.tp-rotationgizmov_arcz_hover{stroke:#1068eb}.tp-rotationgizmov_arcz.tp-rotationgizmov_arcz_active{stroke:#1068eb;stroke-width:2px}.tp-rotationgizmov_arcr{fill:none;stroke:var(--in-fg)}.tp-rotationgizmov_arcr.tp-rotationgizmov_arcr_hover{stroke:#ebd510}.tp-rotationgizmov_arcr.tp-rotationgizmov_arcr_active{stroke:#ebd510;stroke-width:2px}.tp-rotationgizmov_arcc{fill:none;stroke:rgba(0,0,0,0);stroke-width:5px;pointer-events:auto}.tp-rotationgizmov_labelcirclex{fill:#eb103f;cursor:pointer;pointer-events:auto}.tp-rotationgizmov_labelcirclex:hover{opacity:.7}.tp-rotationgizmov_labelcircley{fill:#4eeb10;cursor:pointer;pointer-events:auto}.tp-rotationgizmov_labelcircley:hover{opacity:.7}.tp-rotationgizmov_labelcirclez{fill:#1068eb;cursor:pointer;pointer-events:auto}.tp-rotationgizmov_labelcirclez:hover{opacity:.7}.tp-rotationgizmov_labelcirclen{fill:var(--in-fg);cursor:pointer;pointer-events:auto}.tp-rotationgizmov_labelcirclen:hover{opacity:.7}.tp-rotationgizmov_labeltext{fill:var(--btn-fg);stroke:var(--btn-fg);stroke-width:1px}.tp-rotationgizmov_p:focus .tp-rotationgizmov_m{background-color:var(--in-fg);border-width:0}",eB=[XV,ZV],tB=(e,t)=>{let n=new ha(e.geometry.parameters.width,e.geometry.parameters.height,t,t);e.geometry.dispose(),e.geometry=n},nB=(e,t,n)=>e*(1-n)+t*n;function iB(){const e=new Xw.Pane;e.containerElem_.style.left="20px",e.containerElem_.style.top="20px",e.containerElem_.style.position="fixed",e.registerPlugin(n),ov(e.containerElem_,e.containerElem_);const t=e.addBlade({view:"fpsgraph",label:"FPS"});return t.controller.view.element.style.border="2px solid #99aaff",t.controller.view.element.style.marginLeft="5px",t.controller.view.element.style.marginRight="5px",t.controller.view.element.style.borderRadius="5px",t}function sB(){const e=new Xw.Pane({title:"Debug Panel",expanded:!1});e.registerPlugin(n),e.registerPlugin(i),e.registerPlugin(a);const t=e.containerElem_;t.style.width="350px",t.style.position="fixed",t.style.left=innerWidth-400+"px",t.style.top="30px";let s=!1;const r=document.createElement("button");return r.addEventListener("dblclick",(()=>(t.style.left=s?innerWidth-400+"px":"20px")&&(s=!s))),r.classList.add("dragger"),t.appendChild(r),ov(t,r),e}function rB(e,t=200,n="Copied Successfully",i="none",s="rgb(102 196 61)"){const r=200===t||-1===t;e.style.pointerEvents=i,e.parentElement.style.backgroundColor=r?s:"red",e.textContent=r?n:"Failed To Copy",-1!=t&&setTimeout((()=>rB(e,-1,"Save To Clipboard","initial","#99aaff")),1500)}function aB(e){var t=e.style.transform.split(/\w+\(|\);?/);return t[1]&&t[1].length?(t=t[1].split(/,\s?/g)).map((e=>parseFloat(e.replace("px","")))):[]}var oB=[];const lB=(e,t,n,i,{attributes:s,camera:r,renderer:a,width:o,height:l,scene:h,geometry:u,opts:d,effect:p=0}={})=>{let m,f=e.getBoundingClientRect().width,v=e.getBoundingClientRect().height,g=e.getBoundingClientRect().left;const _=new Zn,w=new Zn,b=[e.getAttribute("src")&&e.getAttribute("src")];let y=[e.getAttribute("src")&&(new xd).load(b[0])];const x=[];if(e.getAttribute("src"))if("video"===e.nodeName.toLowerCase()){const z=document.createElement("video");z.crossOrigin="anonymous",z.src=b[0],z.muted=!0,z.loop=!0,z.preload=!0,z.play(),x[0]=z}else{const H=new Image;H.crossOrigin="anonymous",H.src=b[0],x[0]=H}var M=new hB;if("img"!==e.nodeName.toLowerCase()){n=n.replace("!isMulti;",d.gooey&&!0==!d.slideStyle?"       \n        vec2 pos=vec2(vuv.x,vuv.y/aspect);\n        vec2 mouse=vec2(mousei.x,(mousei.y)/aspect);\n        vec2 interpole=mix(vec2(0),vec2(gooeyBall,gooeyHeight),uIntercept);\n        float noise=(snoise(vec3(pos*gooeyScale,time*gooeySpeed))+1.)/2.;\n        float val=noise*interpole.y;\n        float u=1.0-smoothstep(interpole.x,.0,distance(mouse,pos));\n        float mouseMetaball=clamp(1.-u,0.,1.);\n        val+=mouseMetaball;\n        float alpha=smoothstep(discard_threshold-antialias_threshold,discard_threshold,val);\n        gl_FragColor=vec4(mix(gl_FragColor,texture2D(uTexture[1],uv2),alpha));":"float c = (sin((uv.x*7.0*snoise(vec3(uv,1.0)))+(time))/15.0*snoise(vec3(uv,1.0)))+.01;\n      float blend=uScroll-uSection;float blend2=1.-blend;vec4 imageA=texture2D(uTexture[0],vec2(uv.x,uv.y-(((texture2D(uTexture[0],uv).r*displaceAmount)*blend)*2.)))*blend2;vec4 imageB=texture2D(uTexture[1],vec2(uv.x,uv.y+(((texture2D(uTexture[1],uv).r*displaceAmount)*blend2)*2.)))*blend;\n      gl_FragColor =scrollType == 0.0? mix(texture2D(uTexture[1], uv), texture2D(uTexture[0], uv), step((uScroll)-uSection, sin(c) + uv.y)):imageA.bbra*blend+imageA*blend2+imageB.bbra*blend2+imageB*blend;");for(let G=0;G<e.children.length;G++)if(b[G]=e.children[G].getAttribute("src"),y[G]=(new xd).load(b[G]),G>0&&(e.children[G].style.display="none"),"video"===e.children[G].nodeName.toLowerCase()){const j=document.createElement("video");j.crossOrigin="anonymous",j.src=b[G],j.muted=!0,j.loop=!0,j.preload=!0,j.play(),x[G]=j}else{const W=new Image;W.crossOrigin="anonymous",W.src=b[G],x[G]=W}}Object.assign(i,{zindex:{value:0},aspect:{value:f/v},ignoreShapeAspect:{value:!0},squareShape:{value:!1},shapePosition:{value:new Zn(0,0)},shapeScale:{value:new Zn(1,1)},shapeEdgeSoftness:{value:0},shapeRadius:{value:0},scrollSnapping:{value:!1},currentScroll:{value:0},scrollLerp:{value:.07},damping:{value:7},scrollSpeed:{value:6},touchSpeed:{value:6},gooey:{value:!!d.gooey},infiniteGooey:{value:!1},growSize:{value:4},durationOut:{value:1},durationIn:{value:1.5},time:{value:0},displaceAmount:{value:.5},mousei:{value:new Zn},mouse:{value:_},masker:{value:!1},maskVal:{value:1},scrollType:{value:0},uIntercept:{value:0},geoVertex:{value:i.geoVertex?i.geoVertex.value:1},gooeyBackgroundEffect:{value:!0},onMouse:{value:0},uSection:{value:0},isMulti:{value:!("img"===e.nodeName.toLowerCase())},uScroll:{value:0},gooeySpeed:{value:.2},gooeyBall:{value:.2},discard_threshold:{value:.5},antialias_threshold:{value:.002},gooeyHeight:{value:.5},gooeyScale:{value:10},uTexture:{value:"img"===e.nodeName.toLowerCase()?y:[y[0],y[1]]},shapeScaleAll:1});const E="vec3 mod289(vec3 x){return x-floor(x*(1./289.))*289.;}vec4 mod289(vec4 x){return x-floor(x*(1./289.))*289.;}vec4 permute(vec4 x){return mod289(((x*34.)+1.)*x);}vec4 taylorInvSqrt(vec4 r){return 1.79284291400159-.85373472095314*r;}float snoise(vec3 v){const vec2 C=vec2(1./6.,1./3.);const vec4 D=vec4(0.,.5,1.,2.);vec3 i=floor(v+dot(v,C.yyy));vec3 x0=v-i+dot(i,C.xxx);vec3 g=step(x0.yzx,x0.xyz);vec3 l=1.-g;vec3 i1=min(g.xyz,l.zxy);vec3 i2=max(g.xyz,l.zxy);vec3 x1=x0-i1+C.xxx;vec3 x2=x0-i2+C.yyy;vec3 x3=x0-D.yyy;i=mod289(i);vec4 p=permute(permute(permute(i.z+vec4(0.,i1.z,i2.z,1.))+i.y+vec4(0.,i1.y,i2.y,1.))+i.x+vec4(0.,i1.x,i2.x,1.));float n_=.142857142857;vec3 ns=n_*D.wyz-D.xzx;vec4 j=p-49.*floor(p*ns.z*ns.z);vec4 x_=floor(j*ns.z);vec4 y_=floor(j-7.*x_);vec4 x=x_*ns.x+ns.yyyy;vec4 y=y_*ns.x+ns.yyyy;vec4 h=1.-abs(x)-abs(y);vec4 b0=vec4(x.xy,y.xy);vec4 b1=vec4(x.zw,y.zw);vec4 s0=floor(b0)*2.+1.;vec4 s1=floor(b1)*2.+1.;vec4 sh=-step(h,vec4(0.));vec4 a0=b0.xzyw+s0.xzyw*sh.xxyy;vec4 a1=b1.xzyw+s1.xzyw*sh.zzww;vec3 p0=vec3(a0.xy,h.x);vec3 p1=vec3(a0.zw,h.y);vec3 p2=vec3(a1.xy,h.z);vec3 p3=vec3(a1.zw,h.w);vec4 norm=taylorInvSqrt(vec4(dot(p0,p0),dot(p1,p1),dot(p2,p2),dot(p3,p3)));p0*=norm.x;p1*=norm.y;p2*=norm.z;p3*=norm.w;vec4 m=max(.6-vec4(dot(x0,x0),dot(x1,x1),dot(x2,x2),dot(x3,x3)),0.);m=m*m;return 42.*dot(m*m,vec4(dot(p0,x0),dot(p1,x1),dot(p2,x2),dot(p3,x3)));}",S=new Kr({transparent:!0,vertexShader:t.replace("#define SNOISEHOLDER",E),fragmentShader:n.replace("#define SNOISEHOLDER",E).replace("#define SHAPEMODIFIER","\n  uniform float shapeRadius,shapeEdgeSoftness;\n  uniform vec2  shapePosition,shapeScale; \n  uniform bool ignoreShapeAspect,squareShape ;\n  void roundedBoxSDF() {\n    float shapeRadius=shapeRadius*shapeScale.x;\n    vec2  shapeScale=shapeScale/2.0;\n    vec2  shapePosition=shapePosition*.67;\n    shapeRadius=shapeRadius/(squareShape?2.*aspect:2.);\n    float asc=ignoreShapeAspect?aspect:1.0; \n    float distance = length(max(abs((vec2(vuv.x,vuv.y/asc))-vec2(shapePosition.x,shapePosition.y/asc)*1.5-vec2(.5,.5/asc)) - vec2(shapeScale.x/(squareShape?aspect:1.0),shapeScale.y/asc) + shapeRadius, 0.0)) - shapeRadius;\n    float smoothedAlpha = 1.0-smoothstep(0.0, shapeEdgeSoftness/10., distance);    \n    gl_FragColor = vec4(gl_FragColor.xyz, smoothedAlpha);}\n  "),uniforms:i}),C=new zr(u,S);C.scale.set(f,v),tB(C,i.geoVertex.value),C.visible=!1,h.add(C);var T=null;const P=e=>{(e=JSON.parse(JSON.stringify(e))).color&&(e.color.value=new Ys(e.color.value)),e.blendImage&&(e.blendImage.value=lv(e.imageUrl)),Object.assign(i,e),document.querySelector("._canvas_container").style.zIndex=i.zindex.value};if(d.preset&&fetch(d.preset).then((e=>e.json())).then((e=>P(e))),d.config&&P(d.config),d.debug&&!oB[p]){const q=sB();var A=[];oB[p]=!0,!0===d.gooey&&A.push({title:"Gooey"}),A.push({title:"Controls"}),A.push({title:"Shape"});const X=q.addTab({pages:A});function K(){const e=X.pages[0],t=e.addFolder({title:"InfiniteGooey",expanded:!1});t.addBinding(i.infiniteGooey,"value",{label:"Enable"}),t.addBinding(i.growSize,"value",{step:.001,min:1,max:15,label:"Grow Size"}),t.addBinding(i.durationOut,"value",{step:.001,min:.1,max:5,label:"Duration OUT"}),t.addBinding(i.durationIn,"value",{step:.001,min:.1,max:5,label:"Duration IN"}),e.addBinding(i.gooeyBackgroundEffect,"value",{label:"Gooey Inside Distortion"}),e.addBinding(i.gooeySpeed,"value",{step:.001,min:0,max:10,label:"Speed"}),e.addBinding(i.gooeyBall,"value",{step:.001,min:0,max:2,label:"Gooey Ball"}),e.addBinding(i.discard_threshold,"value",{step:.001,min:0,max:.1,label:"Noise Threshold"}),e.addBinding(i.gooeyHeight,"value",{step:.001,min:0,max:2,label:"Noise height"}),e.addBinding(i.gooeyScale,"value",{step:.001,min:0,max:100,label:"Noise Scale"})}function Y(e){const t=X.pages[e+1];T=X.pages[e];const n=t.addFolder({title:"Zoom Effect",expanded:!1});n.addBinding(i.masker,"value",{label:"Hover Zoom"}),n.addBinding(i.maskVal,"value",{label:"Level",step:.01,min:1});const s=t.addBinding(i.squareShape,"value",{label:"Square Shape"}).on("change",(e=>r.hidden=e.value)),r=t.addBinding(i.ignoreShapeAspect,"value",{label:"Ignore Shape Aspect"}).on("change",(e=>s.hidden=!e.value));t.addBinding(i.shapeRadius,"value",{label:"Radius",step:.001,min:0,max:1}),t.addBinding(i.shapeEdgeSoftness,"value",{label:"Smoothness",step:.001,min:0,max:5}),t.addBinding(i.shapePosition,"value",{label:"Position",step:.001,x:{inverted:!0,min:-1,max:1,step:.01},y:{inverted:!0,min:-1,max:1,step:.01}}),t.addBinding(i.shapeScale,"value",{label:"Scale",x:{inverted:!0,min:0,step:.001},y:{inverted:!0,min:0,max:1,step:.001}}),t.addBinding(i,"shapeScaleAll",{label:"Scale XY",step:.01}).on("change",(e=>i.shapeScaleAll.value.set(e.value,e.value))),T.addButton({title:"Save To Clipboard"}).on("click",(e=>{const{uScroll:t,isMulti:n,uSection:s,time:r,resolution:a,uTexture:o,mouse:l,mousem:c,mousei:h,uIntercept:u,...d}=i,p=e.native.target;ev(av(d)).then(rB(p),(()=>rB(p,400)))}));const a=T.addFolder({title:"Scroll Settings",expanded:!1});a.addBinding(i.scrollSnapping,"value",{label:"Scroll Snapping"}),a.addBlade({view:"list",label:"Scroll Style",options:[{text:"Wave",value:0},{text:"Morph",value:1}],value:0}).on("change",(e=>i.scrollType.value=e.value)),a.addBinding(i.scrollSpeed,"value",{label:"Scroll Speed",step:.01,min:.01,max:100}),a.addBinding(i.touchSpeed,"value",{label:"Touch Speed",step:.01,min:.01,max:100}),a.addBinding(i.damping,"value",{label:"Damping",step:.001,min:1,max:9}),T.addBinding(i.zindex,"value",{label:"Canvas Z-Index",step:1}).on("change",(()=>{document.querySelector("._canvas_container").style.zIndex=i.zindex.value})),T.addBlade({view:"list",label:"On Mouse Hover",options:[{text:"Nothing",value:0},{text:"Activate Effect",value:1},{text:"Deactivate Effect",value:2}],value:0}).on("change",(e=>i.onMouse.value=e.value)),T=T.addFolder({title:"Effect Controls"})}!0===d.gooey?(K(),Y(1)):Y(0)}const L=new Up;let R=new Zn(.5,.5);d.fps&&(m=iB());let D=!1;const I=e=>{L.setFromCamera(new Zn(e.clientX/window.innerWidth*2-1,-e.clientY/window.innerHeight*2+1),r);const t=L.intersectObject(C);t.length>0?(R=t[0].uv,_.x=2*t[0].uv.x-1,_.y=2*-t[0].uv.y-1,D||(D=!0)):D&&(D=!1)};document.addEventListener("mousemove",I),document.addEventListener("wheel",I);let k=!1,O=0;function N(e){return e%b.length}d.slideStyle&&"function"==typeof d.slideStyle&&d.slideStyle((e=>i.currentScroll.value=e),(e=>i.scrollLerp.value=e)),d.setUniforms&&"function"==typeof d.setUniforms&&d.setUniforms(i);const U=i.gooeyBall.value;e.addEventListener("mousedown",(e=>{0==e.button&&!k&&i.infiniteGooey.value&&d.gooey&&!d.slideStyle&&c().to(i.gooeyBall,{value:i.growSize.value,duration:i.durationOut.value,ease:Ww.easeInOut,onStart:()=>{k=!0},onComplete:()=>{O++,i.gooeyBall.value=0,k=!1,i.uTexture.value=[y[N(O)],y[N(O+1)]],c().to(i.gooeyBall,{value:U,ease:Ww.easeInOut,duration:i.durationIn.value})}})})),document.addEventListener("mousemove",(e=>{const t=window.innerWidth/2,n=window.innerHeight/2,i=(event.clientX-t)/t,s=(event.clientY-n)/n;w.x=i/300,w.y=s/300}));const V=()=>{o=innerWidth,l=innerHeight,a.setSize(o,l),a.setPixelRatio(Math.min(window.devicePixelRatio,2)),r.fov=2*Math.atan(l/2/10)*(180/Math.PI),r.aspect=o/l,r.updateProjectionMatrix(),g=e.getBoundingClientRect().left,f=e.getBoundingClientRect().width,v=e.getBoundingClientRect().height,C.scale.set(e.getBoundingClientRect().width,e.getBoundingClientRect().height);const t=new Ai;(new Di).setFromObject(C).getSize(t),function(e,t,n=[]){return Promise.all(e.map(((e,i)=>new Promise(((s,r)=>{if("video"===e.nodeName.toLowerCase())e.onloadedmetadata=()=>{n[i]&&n[i].dispose();var t=new sh(e);t.minFilter=Ee,t.magFilter=Ee,s(t)};else{function a(){const r=e.width,a=e.height;let o,l,c=0,h=0;r/a>t?(o=a*t,l=a,c=(r-o)/2):(o=r,l=r/t,h=(a-l)/2);const u=document.createElement("canvas");u.width=o,u.height=l;u.getContext("2d").drawImage(e,c,h,o,l,0,0,o,l),n[i]&&n[i].dispose();const d=new wi(u);d.needsUpdate=!0,s(d)}B&&a(),e.onload=()=>{a(),B=!0},e.onerror=e=>{r(e)}}})))))}(x,t.x/t.y,y).then((e=>{e.minFilter=Ee,e.magFilter=Ee,C.material.uniforms.uTexture.value=e,y=e,C.visible=!0})).catch((e=>{console.error("Error loading image:",e)})),i.aspect.value=f/v};let B=!1;V(),setTimeout(window.dispatchEvent(new Event("resize")),0),addEventListener("resize",V);const F=new ap;return s.uniforms.push(i),s.meshes.push(C),{material:S,gui:T,animate:function t(){d.fps&&m.begin(),C.position.y=-e.getBoundingClientRect().top+l/2-e.getBoundingClientRect().height/2,C.position.x=e.getBoundingClientRect().left-o/2+e.getBoundingClientRect().width/2,d.slideStyle||1!=d.gooey&&(()=>{if("img"!==e.nodeName.toLowerCase()&&!d.slideStyle){M.update(),M.dampen=.9+pv(i.damping.value||7,0,9)/100,M.speed=Math.abs(i.scrollSpeed.value||6),M.touchSpeed=Math.abs(i.touchSpeed.value||6);let e=Math.floor((M.scrollPos+.5*v)/v)*v;i.scrollSnapping.value&&M.snap(e);let{scrollPos:t}=M;t<0&&(t=0),t>0&&t<v*(y.length-1)&&(i.currentScroll.value=t/v)}})(),a.render(h,r),Object.assign(i,{time:{value:F.getElapsedTime()},mouse:{value:_},mousem:{value:w}}),i.mousei.value.x=$n.lerp(i.mousei.value.x,R.x,.07),i.mousei.value.y=$n.lerp(i.mousei.value.y,R.y,.07),d.gooey&&!d.slideStyle||(e=>{if(i.currentScroll.value>=0){i.uScroll.value=$n.lerp(i.uScroll.value,i.currentScroll.value,e),i.uSection.value=Math.floor(i.uScroll.value);var t=i.uSection.value;y.length>t&&(y.length>t+1?i.uTexture.value=[y[t],y[t+1]]:i.uTexture.value=[y[y.length-1],y[y.length-1]])}})(i.scrollLerp.value),k||(i.uIntercept.value=$n.lerp(i.uIntercept.value,D?1:0,.07)),g=e.getBoundingClientRect().left,f=e.getBoundingClientRect().width,v=e.getBoundingClientRect().height,C.scale.set(e.getBoundingClientRect().width,e.getBoundingClientRect().height),C.material.uniforms.time.value=F.getElapsedTime(),aB(e)[2]&&(C.position.z=aB(e)[2]),d.fps&&m.end(),requestAnimationFrame(t)},elemMesh:C,uniforms:C.material.uniforms}};function cB({isDebug:e,gui:t,i:n,materialsDebug:i,solidView:s,scene:r,clock:a,solid_debugObj:o,opts:l}){const c=()=>o.ogMaterial[u.obj];var h,u={obj:0},d={material:0,color:"#141111",colorIsChanged:!1,transparent:!1,side:0,depthTest:!0,depthWrite:!0,flatShading:!1,visible:!0,wireframe:!1,opacity:1,matcap:"",map:"",alphaMap:"",aoMap:"",aoMapIntensity:1,bumpMap:"",bumpScale:1,displacementMap:"",displacementScale:1,displacementBias:0,normalMap:"",roughness:1,metalness:0,emissive:"#000000",emissiveIsChanged:!1,emissiveIntensity:1,clearcoat:0,clearcoatRoughness:0,ior:1.5,thickness:0,transmission:0,reflectivity:.5,iridescence:0,iridescenceIOR:1.3,sheenColor:"#000000",sheenColorIsChanged:!1,sheen:0,sheenRoughness:1};const p={...d};var m=[];function f(e){e.addButton({title:"Save To Clipboard"}).on("click",(e=>{const t=e.native.target;ev(av(m)).then(rB(t),(()=>rB(t,400)))}));const t=[];s.forEach(((e,n)=>t.push({text:"Object "+(n+1),value:n})&&!l.materialConfig&&m.push({}))),s.length>1&&e.addBlade({options:t,value:0,view:"list",label:"Objects"}).on("change",(t=>{u.obj=t.value,function(e){Object.assign(d,p),Object.assign(d,l.materialConfig[u.obj]),e.refresh()}(e)})),e.addBlade({view:"list",label:"Material Type",options:[{text:"Default",value:1},{text:"Basic",value:2},{text:"Matcap",value:3},{text:"Physical",value:4}],value:1}).on("change",(e=>{v(e.value),d.material=e.value,m[u.obj].material=e.value}));const n=e.addTab({pages:[{title:"Material"},{title:"Physical"},{title:"Maps"}]}),i=n.pages[0],r=n.pages[1],a=n.pages[2];i.addBinding(d,"color",{label:"Color"}).on("change",(e=>w((t=>{t.color.set(e.value),d.colorIsChanged=!0,m[u.obj].color=d.color,m[u.obj].colorIsChanged=!0})))),i.addBinding(d,"flatShading",{label:"flatShading"}).on("change",(()=>w((e=>{e.flatShading=d.flatShading,m[u.obj].flatShading=d.flatShading})))),i.addBinding(d,"wireframe",{label:"Wireframe"}).on("change",(()=>w((e=>{e.wireframe=d.wireframe,m[u.obj].wireframe=d.wireframe})))),i.addBinding(d,"visible",{label:"Visible"}).on("change",(()=>w((e=>{e.visible=d.visible,m[u.obj].visible=d.visible})))),i.addBinding(d,"transparent",{label:"Transparent"}).on("change",(()=>w((e=>{e.transparent=d.transparent,m[u.obj].transparent=d.transparent})))),i.addBinding(d,"opacity",{label:"Opacity",step:.01,min:0,max:1}).on("change",(()=>w((e=>{void 0!==e.opacity&&(e.opacity=d.opacity),m[u.obj].opacity=d.opacity})))),i.addBinding(d,"depthTest",{label:"Depth Test"}).on("change",(()=>w((e=>{e.depthTest=d.depthTest,m[u.obj].depthTest=d.depthTest})))),i.addBinding(d,"depthWrite",{label:"Depth Write"}).on("change",(()=>w((e=>{e.depthWrite=d.depthWrite,m[u.obj].depthWrite=d.depthWrite})))),i.addBinding(d,"metalness",{label:"Metalness",step:.01,min:0,max:2}).on("change",(()=>w((e=>{void 0!==e.metalness&&(e.metalness=d.metalness),m[u.obj].metalness=d.metalness})))),i.addBinding(d,"roughness",{label:"Roughness",step:.01,min:0,max:1}).on("change",(()=>w((e=>{void 0!==e.roughness&&(e.roughness=d.roughness),m[u.obj].roughness=d.roughness})))),i.addBinding(d,"emissive",{label:"Emissive"}).on("change",(e=>w((t=>{t.emissive.set(e),d.emissiveIsChanged=!0,m[u.obj].emissiveIsChanged=d.emissiveIsChanged,m[u.obj].emissive=d.emissive})))),i.addBinding(d,"emissiveIntensity",{label:"Emissive Intensity",step:.01}).on("change",(()=>w((e=>{void 0!==e.emissiveIntensity&&(e.emissiveIntensity=d.emissiveIntensity),m[u.obj].emissiveIntensity=d.emissiveIntensity})))),i.addBlade({view:"list",label:"Side",options:[{text:"Front Side",value:0},{text:"Back Side",value:1},{text:"Double Side",value:2}],value:0}).on("change",(e=>w((t=>{t.side=e.value,d.side=e.value,m[u.obj].side=d.side})))),r.addBinding(d,"clearcoat",{label:"Clearcoat",step:.01,min:0,max:1}).on("change",(()=>w((e=>{void 0!==e.clearcoat&&(e.clearcoat=d.clearcoat),m[u.obj].clearcoat=d.clearcoat})))),r.addBinding(d,"clearcoatRoughness",{label:"ClearcoatRoughness",step:.01,min:0,max:1}).on("change",(()=>w((e=>{void 0!==e.clearcoatRoughness&&(e.clearcoatRoughness=d.clearcoatRoughness),m[u.obj].clearcoatRoughness=d.clearcoatRoughness})))),r.addBinding(d,"ior",{label:"IOR",step:.01,min:0,max:5}).on("change",(()=>w((e=>{void 0!==e.ior&&(e.ior=d.ior),m[u.obj].ior=d.ior})))),r.addBinding(d,"thickness",{label:"Thickness",step:.01,min:0,max:5}).on("change",(()=>w((e=>{void 0!==e.thickness&&(e.thickness=d.thickness),m[u.obj].thickness=d.thickness})))),r.addBinding(d,"transmission",{label:"Transmission",step:.01,min:0,max:1}).on("change",(()=>w((e=>{void 0!==e.transmission&&(e.transmission=d.transmission),m[u.obj].transmission=d.transmission})))),r.addBinding(d,"reflectivity",{label:"Reflectivity",step:.01,min:0,max:1}).on("change",(()=>w((e=>{void 0!==e.reflectivity&&(e.reflectivity=d.reflectivity),m[u.obj].reflectivity=d.reflectivity})))),r.addBinding(d,"iridescence",{label:"Iridescence",step:.01,min:0,max:1}).on("change",(()=>w((e=>{void 0!==e.iridescence&&(e.iridescence=d.iridescence),m[u.obj].iridescence=d.iridescence})))),r.addBinding(d,"iridescenceIOR",{label:"IridescenceIOR",step:.01,min:0,max:5}).on("change",(()=>w((e=>{void 0!==e.iridescenceIOR&&(e.iridescenceIOR=d.iridescenceIOR),m[u.obj].iridescenceIOR=d.iridescenceIOR})))),r.addBinding(d,"sheenColor",{label:"Sheen Color"}).on("change",(e=>w((t=>{t.sheenColor&&t.sheenColor.set(e),d.sheenColorIsChanged=!0,m[u.obj].sheenColor=d.sheenColor,m[u.obj].sheenColorIsChanged=d.sheenColorIsChanged})))),r.addBinding(d,"sheen",{label:"Sheen",step:.01,min:0,max:2}).on("change",(()=>w((e=>{void 0!==e.sheen&&(e.sheen=d.sheen),m[u.obj].sheen=d.sheen})))),r.addBinding(d,"sheenRoughness",{label:"Sheen Roughness",step:.01,min:0,max:1}).on("change",(()=>w((e=>{void 0!==e.sheenRoughness&&(e.sheenRoughness=d.sheenRoughness),m[u.obj].sheenRoughness=d.sheenRoughness})))),a.addBinding(d,"map",{label:"Color Map"}).on("change",(e=>w((t=>{void 0!==t.map&&(t.map=d.map.length>0?hv.load(d.map):null),d.map=e.value,m[u.obj].map=d.map})))),a.addBinding(d,"matcap",{label:"Matcap"}).on("change",(e=>w((t=>{void 0!==t.matcap&&(t.matcap=d.matcap.length>0?hv.load(d.matcap):null),d.matcap=e.value,m[u.obj].matcap=d.matcap})))),a.addBinding(d,"alphaMap",{label:"Alpha Map"}).on("change",(e=>w((t=>{void 0!==t.alphaMap&&(t.alphaMap=d.alphaMap.length>0?hv.load(d.alphaMap):null),d.alphaMap=e.value,m[u.obj].alphaMap=d.alphaMap})))),a.addBinding(d,"aoMap",{label:"AO Map"}).on("change",(e=>w((t=>{void 0!==t.aoMap&&(t.aoMap=d.aoMap.length>0?hv.load(d.aoMap):null),d.aoMap=e.value,m[u.obj].aoMap=d.aoMap})))),a.addBinding(d,"aoMapIntensity",{label:"AO Map Intensity"}).on("change",(e=>w((e=>{void 0!==e.aoMapIntensity&&(e.aoMapIntensity=d.aoMapIntensity),m[u.obj].aoMapIntensity=d.aoMapIntensity})))),a.addBinding(d,"bumpMap",{label:"Bump Map"}).on("change",(e=>w((t=>{void 0!==t.bumpMap&&(t.bumpMap=d.bumpMap.length>0?hv.load(d.bumpMap):null),d.bumpMap=e.value,m[u.obj].bumpMap=d.bumpMap})))),a.addBinding(d,"bumpScale",{label:"Bump Scale"}).on("change",(e=>w((e=>{void 0!==e.bumpScale&&(e.bumpScale=d.bumpScale),m[u.obj].bumpScale=d.bumpScale})))),a.addBinding(d,"displacementMap",{label:"Displacement  Map"}).on("change",(e=>w((t=>{void 0!==t.displacementMap&&(t.displacementMap=d.displacementMap.length>0?hv.load(d.displacementMap):null),d.displacementMap=e.value,m[u.obj].displacementMap=d.displacementMap})))),a.addBinding(d,"displacementScale",{label:"Displacement Scale"}).on("change",(e=>w((e=>{void 0!==e.displacementScale&&(e.displacementScale=d.displacementScale),m[u.obj].displacementScale=d.displacementScale})))),a.addBinding(d,"displacementBias",{label:"Displacement Bias",step:0}).on("change",(e=>w((e=>{void 0!==e.displacementBias&&(e.displacementBias=d.displacementBias),m[u.obj].displacementBias=d.displacementBias})))),a.addBinding(d,"normalMap",{label:"Normal Map"}).on("change",(e=>w((t=>{void 0!==t.normalMap&&(t.normalMap=d.normalMap.length>0?hv.load(d.normalMap):null),d.normalMap=e.value,m[u.obj].normalMap=d.normalMap}))))}function v(e){switch(e){case 2:h=new Zs,_();break;case 3:h=new zu,_();break;case 4:h=new Nu,_();break;default:!function(){var e=0;r[u.obj].traverse((t=>{t instanceof zr&&(t.material=c()[e],g(t.material),e++)})),a.start()}()}}function g(e){Object.keys(d).forEach((t=>{void 0!==e[t]&&("string"==typeof d[t]&&(t.toLowerCase().includes("map")||t.toLowerCase().includes("matcap"))?e[t]=""!=d[t]?loader.load(d.map):e[t]:"true"==String(d[t])||"false"==String(d[t])?e[t]=d[t]:String(d[t]).includes("#")?e[t].set(d[t+"IsChanged"]?d[t]:e[t]):d[t]&&(e[t]=d[t]))})),e.onBeforeCompile=function(t){Object.assign(t.uniforms,{time:{value:0},opacity:{value:d.opacity},iResolution:{value:new Zn(innerWidth,innerHeight)},spread_scale:{value:0},spread_center:{value:new Ai(0)},spread_softness:{value:0}}),t.vertexShader=t.vertexShader.replace("#include <common>","\n              #include <common>\n  \n              uniform float time;\n              varying vec2 vuv;\n              varying vec3 mPoz;\n        \n              mat2 get2dRotateMatrix(float _angle)\n              {\n                  return mat2(cos(_angle), - sin(_angle), sin(_angle), cos(_angle));\n              }\n          "),t.vertexShader=t.vertexShader.replace("#include <begin_vertex>","\n              #include <begin_vertex>\n  \n              float angle = (sin(position.y + time))*.10;\n              mat2 rotateMatrix = get2dRotateMatrix(angle);\n  \n              // transformed.xz = rotateMatrix * transformed.xz;\n              // mPoz=transformed.xyz;\n          ");t.fragmentShader=`      uniform float time,spread_softness;\n        uniform vec2 iResolution;\n        varying vec2 vuv;\n        varying vec3 mPoz;\n    \n        \n        vec2 mod289(vec2 x) { return x - floor(x * (1.0 / 289.0)) * 289.0;}vec3 mod289(vec3 x) { return x - floor(x * (1.0 / 289.0)) * 289.0;}vec4 mod289(vec4 x) { return x - floor(x * (1.0 / 289.0)) * 289.0;}vec3 permute(vec3 x) { return mod289(((x * 34.0) + 1.0) * x);}vec4 permute(vec4 x) { return mod289(((x * 34.0) + 1.0) * x);}float random(vec2 st) {    return fract(sin(dot(st.xy, vec2(12.9898, 78.233))) * 43758.5453123);}float noise(vec2 n) {    const vec2 d = vec2(0.0, 1.0);    vec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));    return mix(mix(random(b), random(b + d.yx), f.x), mix(random(b + d.xy), random(b + d.yy), f.x), f.y);}float snoise(vec2 v) {    vec4 C = vec4(0.211324865405187, 0.366025403784439, -0.577350269189626, 0.024390243902439);    vec2 i = floor(v + dot(v, C.yy));    vec2 x0 = v - i + dot(i, C.xx);    vec2 i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);    vec4 x12 = x0.xyxy + C.xxzz;    x12.xy -= i1;    i = mod289(i);    vec3 p = permute(permute(i.y + vec3(0.0, i1.y, 1.0)) + i.x + vec3(0.0, i1.x, 1.0));    vec3 m = max(0.5 - vec3(dot(x0, x0), dot(x12.xy, x12.xy), dot(x12.zw, x12.zw)), 0.0);    m = m * m;    m = m * m;    vec3 x = 2.0 * fract(p * C.www) - 1.0;    vec3 h = abs(x) - 0.5;    vec3 ox = floor(x + 0.5);    vec3 a0 = x - ox;    m *= 1.79284291400159 - 0.85373472095314 * (a0 * a0 + h * h);    vec3 g;    g.x = a0.x * x0.x + h.x * x0.y;    g.yz = a0.yz * x12.xz + h.yz * x12.yw;    return 130.0 * dot(m, g);}float fbm(vec2 uv, int oct) {    vec2 pos = uv;    float amp = 1.0, val = 0.0;    for (int i = 0; i < oct; i++) {        val += amp * snoise(pos);        pos *= 2.0;        amp *= 0.5;    }    return val;}float snoise(vec3 v) {    vec2 C = vec2(1.0 / 6.0, 1.0 / 3.0);    vec4 D = vec4(0.0, 0.5, 1.0, 2.0);    vec3 i = floor(v + dot(v, C.yyy));    vec3 x0 = v - i + dot(i, C.xxx);    vec3 g = step(x0.yzx, x0.xyz);    vec3 l = 1.0 - g;    vec3 i1 = min(g.xyz, l.zxy), i2 = max(g.xyz, l.zxy);    vec3 x1 = x0 - i1 + C.xxx, x2 = x0 - i2 + C.yyy, x3 = x0 - D.yyy;    i = mod289(i);    vec4 p = permute(permute(permute(i.z + vec4(0.0, i1.z, i2.z, 1.0)) + i.y + vec4(0.0, i1.y, i2.y, 1.0)) + i.x + vec4(0.0, i1.x, i2.x, 1.0));    float n_ = 0.142857142857;    vec3 ns = n_ * D.wyz - D.xzx;    vec4 j = p - 49.0 * floor(p * ns.z * ns.z);    vec4 x_ = floor(j * ns.z);    vec4 y_ = floor(j - 7.0 * x_);    vec4 x = x_ * ns.x + ns.yyyy;    vec4 y = y_ * ns.x + ns.yyyy;    vec4 h = 1.0 - abs(x) - abs(y);    vec4 b0 = vec4(x.xy, y.xy);    vec4 b1 = vec4(x.zw, y.zw);    vec4 s0 = floor(b0) * 2.0 + 1.0, s1 = floor(b1) * 2.0 + 1.0;    vec4 sh = -step(h, vec4(0, 0, 0, 0));    vec4 a0 = b0.xzyw + s0.xzyw * sh.xxyy, a1 = b1.xzyw + s1.xzyw * sh.zzww;    vec3 p0 = vec3(a0.xy, h.x), p1 = vec3(a0.zw, h.y), p2 = vec3(a1.xy, h.z), p3 = vec3(a1.zw, h.w);    vec4 norm = 1.79284291400159 - 0.85373472095314 * vec4(dot(p0, p0), dot(p1, p1), dot(p2, p2), dot(p3, p3));    p0 *= norm.x;    p1 *= norm.y;    p2 *= norm.z;    p3 *= norm.w;    vec4 m = max(0.6 - vec4(dot(x0, x0), dot(x1, x1), dot(x2, x2), dot(x3, x3)), 0.0);    m = m * m;    return 42.0 * dot(m * m, vec4(dot(p0, x0), dot(p1, x1), dot(p2, x2), dot(p3, x3)));}float fbm(vec2 uv, int oct, float time) {    vec2 pos = uv;    float amp = 1.0;    float val = 0.0;    for (int i = 0; i < oct; i++) {        val += amp * snoise(vec3(pos, time));        pos *= 2.0;        amp *= 0.5;    }    return val;}\n        \n        vec4 BandW(vec4 color) {\n          float average = (color.r + color.g + color.b) / 3.0;\n          return vec4(average);\n        }\n        float inkdrop(vec2 p, float scale) {\n          float t = scale;\n          float noise1 = snoise(vec3(p * vec2(2.0), t));\n          float noise2 = 0.5 + 0.5 * fbm(p * vec2(5.0), 5, t);\n          float noise3 = 0.5 + 0.5 * fbm(p * vec2(3.0), 3, t);\n          float n = noise1 * 0.1 + noise2 * 0.05 + noise3 * 0.025;\n          float r = length(mPoz-vec3(0,0,0));\n          float res = 0.0;\n          float aaVal = max(spread_softness,.0001);\n          res = 1.0 - smoothstep(t - aaVal, t, r - n * pow(t, 0.75));\n          return res;\n        }\n        ${t.fragmentShader.replace("#include <dithering_fragment>","#include <dithering_fragment>\n    \n          float ink = inkdrop(vuv, time/5.0);\n          \n          vec3 col = mix(BandW(gl_FragColor).rgb, gl_FragColor.rgb, ink);\n    \n          // gl_FragColor= vec4(col, opacity);\n          \n          ")}\n        `,e.userData.shader=t}}function _(){g(h);var e=0;r[u.obj].traverse((t=>{if(t instanceof zr){t.material=h.clone();for(const n in t.material)n in c()[e]&&"function"!=typeof c()[e][n]&&"uuid"!=n&&"name"!=n&&"type"!=n&&"userData"!=n&&"defines"!=n&&(t.material[n]=c()[e][n]);g(t.material),e++}})),a.start()}function w(e){r[u.obj].traverse((t=>{t instanceof zr&&(e(t.material,i[u.obj]),t.material.needsUpdate=!0)}))}return l.materialConfig&&(u.obj=n,m=l.materialConfig,Object.assign(d,l.materialConfig[n])),v(d.material),l.debug&&e&&nv((()=>t.page)).then((()=>f(t.page))),w}class hB{constructor(){this.acceleration=0,this.maxAcceleration=5,this.maxSpeed=20,this.velocity=0,this.dampen=.97,this.speed=8,this.touchSpeed=8,this.scrollPos=0,this.velocityThreshold=1,this.snapToTarget=!1,this.mouseDown=!1,this.lastDelta=0,document.addEventListener("touchstart",(e=>e.preventDefault()),{passive:!1}),window.addEventListener("touchend",(()=>this.Delta=0)),window.addEventListener("touchmove",(e=>{let t=this.lastDelta-e.targetTouches[0].clientY;this.accelerate(Math.sign(t)*this.touchSpeed),this.lastDelta=e.targetTouches[0].clientY})),window.addEventListener("wheel",(e=>{this.accelerate(Math.sign(e.deltaY)*this.speed)})),window.addEventListener("mousemove",(e=>{if(this.mouseDown){let t=this.lastDelta-e.clientY;this.accelerate(Math.sign(t)*this.touchSpeed*.4),this.lastDelta=e.clientY}})),window.addEventListener("mouseup",(()=>{this.lastDelta=0,this.mouseDown=!1}))}accelerate(e){this.acceleration<this.maxAcceleration&&(this.acceleration+=e)}update(){this.velocity+=this.acceleration,Math.abs(this.velocity)>this.velocityThreshold?(this.velocity*=this.dampen,this.scrollPos+=this.velocity,this.scrollPos=this.scrollPos>=0?this.scrollPos:0):this.velocity=0,Math.abs(this.velocity)>this.maxSpeed&&(this.velocity=Math.sign(this.velocity)*this.maxSpeed),this.acceleration=0}snap(e,t=100,n=1.5){Math.abs(e-this.scrollPos)<t&&(this.velocity*=this.dampen),Math.abs(this.velocity)<this.velocityThreshold+n&&(this.scrollPos+=.1*(e-this.scrollPos))}project(e=1){if(1===e)return this.scrollPos+this.velocity*this.dampen;for(var t=this.scrollPos,n=this.velocity,i=0;i<e;i++)t+=n*=this.dampen;return t}}var uB=null,dB=null;function pB(e={}){uB=document.createElement("div"),dB=document.createElement("div"),uB.classList.add("mousefollower"),dB.classList.add("mousefollower"),dB.id="behindmouse";var t=0,n=0;addEventListener("mousemove",(function(i){e.skew&&(n=c().utils.clamp(15,35,i.clientX-t),t=i.clientX,c().to(".mousefollower",{width:n+"px",ease:e.ease||Ww.easeOut,duration:e.duration||1})),c().to(".mousefollower",{top:i.clientY,left:i.clientX,duration:e.duration||1,ease:e.ease||Ww.easeOut})})),addEventListener("mouseenter",(function(){c().to(".mousefollower",{opacity:1})})),addEventListener("mouseleave",(function(){c().to(".mousefollower",{opacity:0,duration:e.duration||1,ease:e.ease||Ww.easeOut})})),document.body.appendChild(dB),document.body.appendChild(uB)}function mB(e="img",t={}){document.querySelectorAll(e).forEach((function(e){var n=e.parentNode,i=document.createElement("div");if(t.mouseFollower){var s=document.createElement("div");s.style.width=c().utils.clamp(50,70,.3*e.getBoundingClientRect().width)+"px",s.style.height=c().utils.clamp(50,70,.3*e.getBoundingClientRect().width)+"px",s.textContent=t.text||"View More",s.classList.add("circle"),i.addEventListener("mousemove",(function(e){i.appendChild(s),c().to(s,{top:e.clientY-i.getBoundingClientRect().y,left:e.clientX-i.getBoundingClientRect().x,ease:Ww.easeOut,duration:2})})),i.addEventListener("mouseleave",(function(){c().to(s,{opacity:0,ease:Ww.easeOut,duration:.8})}))}i.classList.add("mask"),n.replaceChild(i,e),i.appendChild(e),i.addEventListener("mouseenter",(function(){c().to(uB,{opacity:0,ease:c().EasePower1}),c().to(dB,{opacity:0,ease:c().EasePower1}),c().to(s,{opacity:1,ease:Ww.easeOut,duration:.8})})),i.addEventListener("mousemove",(function(n){c().to(e,{scale:t.scale||e.getBoundingClientRect().width<450?1.05:1.025,ease:t.ease||Ww.easeOut,duration:t.duration||.7})})),i.addEventListener("mouseleave",(function(){c().to(uB,{opacity:1,ease:Gw}),c().to(dB,{opacity:1,ease:Gw}),c().to(this.childNodes[0],{scale:1,ease:t.ease||Ww.easeOut,duration:t.duration||1})}))}))}function fB(e,t={}){document.querySelectorAll(e).forEach((function(e){e.addEventListener("mousemove",(function(n){var i=e.getBoundingClientRect(),s=c().utils.mapRange(0,i.width,0,1,n.clientX-i.left),r=c().utils.mapRange(0,i.height,0,1,n.clientY-i.top);c().to(".mousefollower",{scale:4,ease:jw,duration:.5}),c().to(e,{x:nB(-20,20,s),y:nB(-20,20,r),duration:t.duration||1,ease:t.ease||Ww.easeOut})})),e.addEventListener("mouseleave",(function(n){c().to(".mousefollower",{scale:1,ease:jw,duration:.5}),c().to(e,{x:0,y:0,duration:t.duration||1,ease:t.ease||Ww.easeOut})}))}))}function vB(e,t={}){var n=document.querySelectorAll(e);switch(n.forEach((function(e){e.textContent=e.textContent.trim().replaceAll(" ",""),e.classList.add("sheryelem");var t="";e.textContent.split("").forEach((function(e){t+=`<span>${e}</span>`})),e.innerHTML=t})),t.style||1){case 1:n.forEach((function(e){c().from(e.childNodes,{scrollTrigger:{trigger:e,start:"top 80%"},y:t.y||10,stagger:t.delay||.1,opacity:0,duration:t.duration||2,ease:t.ease||Ww.easeOut})}));break;case 2:n.forEach((function(e,n){var i=e.childNodes.length-1;for(n=0;n<e.childNodes.length/2;n++)e.childNodes[n].dataset.delay=n;for(n=Math.floor(e.childNodes.length/2);n<e.childNodes.length;n++)e.childNodes[n].dataset.delay=i-n;e.childNodes.forEach((function(e){c().from(e,{y:20,delay:e.dataset.delay*(t.multiplier||.1),opacity:0,ease:t.ease||Ww.easeOut})}))}));break;default:console.warn("SheryJS : no such style available for text, mentioned in textanimate()")}}function gB(e,t){function n(e){return e%(t.images?t.images.length:t.videos.length)}var i=document.body,s=document.createElement("div");s.classList.add("just-a-white-blend-screen"),s.classList.add("movercirc");var r=document.createElement("div"),a=null;if(document.body.click(),t.images){var o=document.createElement("img");a=o}else if(t.videos){var l=document.createElement("video");l.preload=!0,l.autoplay=!0,l.muted=!0,a=l}r.appendChild(a),i.appendChild(s),i.appendChild(r),r.classList.add("movercirc"),document.querySelectorAll(e).forEach((function(e,i){var s,o=0,l=0;e.classList.add("hovercircle"),e.addEventListener("mouseenter",(function(e){a.setAttribute("src",t.images?t.images[n(i)]:t.videos[n(i)])})),e.addEventListener("mousemove",(function(e){var t=c().utils.pipe(c().utils.clamp(-1,1),c().utils.mapRange(-1,1,.8,1.2)),n=(t(e.clientX-o),t(e.clientY-l));o=e.clientX,l=e.clientY,clearTimeout(s),s=setTimeout((function(){c().to(".movercirc",{transform:"translate(-50%,-50%)"})}),500),c().to(".movercirc",{left:e.clientX,top:e.clientY,width:"20vw",height:"20vw",transform:`translate(-50%,-50%) scale(${n})`,ease:qw,duration:.4,opacity:1}),r.classList.add("blend")})),e.addEventListener("mouseleave",(function(e){c().to(".movercirc",{width:"0",height:"0",ease:jw,duration:.4,opacity:0}),r.classList.remove("blend")}))}))}var _B,wB,bB,yB=null;function xB(e="img",t={}){let n=innerWidth,i=innerHeight;const s=new ha(1,1,1,1);null==_B&&(_B=new Xl,(wB=new $r(70,n/i,.01,1e3)).fov=2*Math.atan(i/2/10)*(180/Math.PI),wB.position.set(0,0,10),(bB=new Gl({antialias:!0,alpha:!0})).setSize(n,i),bB.setPixelRatio(Math.min(window.devicePixelRatio,2)),(yB=document.createElement("div")).classList.add("_canvas_container"),yB.appendChild(bB.domElement),document.body.appendChild(yB));const r={geometry:s,scene:_B,camera:wB,renderer:bB,uniforms:[],meshes:[]},a={camera:wB,attributes:r,renderer:bB,width:n,height:i,scene:_B,geometry:s,opts:t};document.querySelectorAll(e).forEach((function(e){switch(e.style.opacity="0",t.style||1){case 1:var{gui:n,uniforms:i,animate:s}=lB(e,Tf(),Af(),{speed:{value:2},wobbliness:{value:.7}},{...a,effect:1});n&&(n.addBinding(i.speed,"value",{step:.001,min:0,max:30,label:"Speed"}),n.addBinding(i.wobbliness,"value",{step:.001,min:-1,max:1,label:"Wobbliness"})),s();break;case 2:var{gui:n,uniforms:i,animate:s}=lB(e,Rf(),If(),{resolutionXY:{value:100},distortion:{value:!0},mode:{value:22},mousemove:{value:0},modeA:{value:1},modeN:{value:0},speed:{value:1},frequency:{value:50},angle:{value:28.65},waveFactor:{value:1.4},color:{value:new Ys(.33,.66,1)},pixelStrength:{value:3},quality:{value:5},contrast:{value:1},brightness:{value:1},colorExposer:{value:.182},strength:{value:.2},exposer:{value:.08},blender:{value:0},imageUrl:"https://images.unsplash.com/photo-1707421940727-ebfb88cd6aa0?q=80&w=2532&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",blendImage:{value:null}},{...a,effect:2});if(n){n.addBinding(i.distortion,"value",{label:"Distortion Effect"}),n.addBlade({view:"list",label:"Blend Mode",options:[{text:"Add",value:1},{text:"Subtract",value:2},{text:"Multiply",value:3},{text:"Divide",value:4},{text:"Screen",value:5},{text:"Overlay",value:6},{text:"Soft Light",value:7},{text:"Hard Light",value:8},{text:"Normal",value:9},{text:"Square Root",value:10},{text:"Color Dodge",value:11},{text:"Color Burn",value:12},{text:"Difference",value:13},{text:"Darken Only",value:14},{text:"Lighten Only",value:15},{text:"Linear Light",value:16},{text:"Color (Hue)",value:17},{text:"Color (Saturation)",value:18},{text:"Luminosity",value:19},{text:"Multiply (2x)",value:20},{text:"Multiply (4x)",value:21},{text:"Multiply (10x)",value:22},{text:"Divide (Reverse)",value:23},{text:"Divide (Forward)",value:24},{text:"Subtract (Darker)",value:25},{text:"Subtract (Lighter)",value:26},{text:"Exclusion",value:27},{text:"Pin Light",value:28},{text:"Hard Mix",value:29},{text:"Default",value:30},{text:"Vivid Light",value:31},{text:"Linear Burn",value:32},{text:"Linear Dodge",value:33},{text:"Overlay (Soft)",value:34},{text:"Sine Wave",value:35},{text:"Power",value:36},{text:"Logarithm",value:37},{text:"Reflect",value:38},{text:"Pinch",value:39},{text:"Swirl",value:40},{text:"Linear Light (2x)",value:41},{text:"Linear Light (4x)",value:42},{text:"Linear Light (6x)",value:43},{text:"Linear Light (8x)",value:44},{text:"Linear Light (10x)",value:45},{text:"Vivid Light (2x)",value:46},{text:"Vivid Light (4x)",value:47},{text:"Vivid Light (6x)",value:48},{text:"Vivid Light (8x)",value:49},{text:"Vivid Light (10x)",value:50}],value:22}).on("change",(e=>{i.mode.value=e.value})),n.addBlade({view:"buttongrid",size:[3,1],cells:(e,t)=>({title:[["Color","UV","Image"]][t][e]}),label:"Blend Type"}).on("click",(n=>{switch(i.blender.value=n.index[0],n.index[0]){case 0:e.hidden=!1,t.hidden=!0;break;case 2:e.hidden=!0,t.hidden=!1;break;default:e.hidden=!0,t.hidden=!0}}));const e=n.addBinding(i.color,"value",{label:"Blend Color",picker:"inline",color:{type:"float"}}),t=n.addBinding(i,"imageUrl",{view:"input-image",label:"Blend Image",hidden:!0}).on("change",(e=>e.value.onload=()=>{i.imageUrl=cv(e.value),i.blendImage.value=hv.load(i.imageUrl)}));i.blendImage.value=hv.load(i.imageUrl),n.addBinding(i.distortion,"value",{label:"Distortion Effect"}),n.addBlade({view:"buttongrid",size:[4,1],cells:(e,t)=>({title:[["off","M1","M2","M3"]][t][e]}),label:"Mouse Effect Mode"}).on("click",(e=>i.mousemove.value=e.index[0])),n.addBlade({view:"buttongrid",size:[4,1],cells:(e,t)=>({title:[["Sin","Cos","Tan","Atan"]][t][e]}),label:"Style Mode A"}).on("click",(e=>i.modeA.value=e.index[0])),n.addBlade({view:"buttongrid",size:[4,1],cells:(e,t)=>({title:[["Sin","Cos","Tan","Atan"]][t][e]}),label:"Style Mode N"}).on("click",(e=>i.modeN.value=e.index[0]));const s=n.addFolder({expanded:!1,title:"Wave Controls"});s.addBinding(i.speed,"value",{label:"Speed",step:.01}),s.addBinding(i.frequency,"value",{label:"Frequency",step:.1}),s.addBinding(i.resolutionXY,"value",{label:"Resolution",step:.1}),s.addBinding(i.pixelStrength,"value",{label:"Pixel Strength",step:.1}),s.addBinding(i.angle,"value",{label:"Angle",step:.1,min:0,max:360}),s.addBinding(i.waveFactor,"value",{label:"Wave Factor",step:.01,min:-3,max:3}),s.addBinding(i.quality,"value",{label:"Quality",step:.01,min:0,max:10}),s.addBinding(i.strength,"value",{label:"Viscosity Strength",step:.01});const r=n.addFolder({expanded:!1,title:"Color & Blend Controls"});r.addBinding(i.contrast,"value",{label:"Contrast",step:.01}),r.addBinding(i.brightness,"value",{label:"Brightness",step:.01}),r.addBinding(i.colorExposer,"value",{label:"Color Exposer",step:.01}),r.addBinding(i.exposer,"value",{label:"Exposer",step:.01})}s();break;case 3:var{gui:n,elemMesh:r,uniforms:i,animate:s}=lB(e,Of(),Uf(),{uFrequencyX:{value:12},uFrequencyY:{value:12},uFrequencyZ:{value:10},geoVertex:{value:32}},{...a,effect:3});n&&(n.addBinding(i.geoVertex,"value",{label:"VertexCount",step:1,min:1}).on("change",(()=>tB(r,i.geoVertex.value))),n.addBinding(i.uFrequencyX,"value",{label:"FrequencyX",step:.01,min:0,max:100}),n.addBinding(i.uFrequencyY,"value",{label:"FrequencyY",step:.01,min:0,max:100}),n.addBinding(i.uFrequencyZ,"value",{label:"FrequencyZ",step:.01,min:0,max:100})),s();break;case 4:var{gui:n,elemMesh:r,uniforms:i,animate:s}=lB(e,Bf(),zf(),{colorDepthFactor:{value:1},uColor:{value:!1},uSpeed:{value:.6},uAmplitude:{value:1.5},uFrequency:{value:3.5},geoVertex:{value:32}},{...a,effect:4});t.config&&Object.keys(t.config).forEach((e=>i[e].value=t.config[e].value)),n&&(n.addBinding(i.uColor,"value",{label:"Color Depth"}),n.addBinding(i.colorDepthFactor,"value",{label:"Color Depth Factor",step:.001,min:0,max:1}),n.addBinding(i.geoVertex,"value",{label:"VertexCount",step:1}).on("change",(()=>tB(r,i.geoVertex.value))),n.addBinding(i.uSpeed,"value",{label:"Speed",step:.01}),n.addBinding(i.uAmplitude,"value",{label:"Amplitude",step:.01}),n.addBinding(i.uFrequency,"value",{label:"Frequency",step:.01})),s();break;case 5:var{gui:n,uniforms:i,animate:s}=lB(e,Gf(),Wf(),{speed:{value:2},wobbliness:{value:.7}},{...a,effect:5});n&&(n.addBinding(i.speed,"value",{step:.001,min:0,max:30,label:"Speed"}),n.addBinding(i.wobbliness,"value",{step:.001,min:-1,max:1,label:"Wobbliness"})),s();break;case 6:var{gui:n,uniforms:i,animate:s}=lB(e,Xf(),Yf(),{noiseDetail:{value:7.44,range:[0,100]},distortionAmount:{value:2.98,range:[0,10]},scale:{value:36.36,range:[0,100]},speed:{value:.79,range:[0,1]}},{...a,effect:6});n&&(n.addBinding(i.speed,"value",{label:"Speed",step:.01}),n.addBinding(i.scale,"value",{label:"Scale",step:.01,min:0,max:100}),n.addBinding(i.distortionAmount,"value",{label:"Distortion Amount",step:.01,min:0,max:10}),n.addBinding(i.noiseDetail,"value",{label:"Noise Detail",step:.01,min:0,max:100})),s();break;case 7:var{gui:n,elemMesh:r,uniforms:i,animate:s}=lB(e,Zf(),Qf(),{geoVertex:{value:64},invert:{value:!1},isTexture:{value:!1},autorotate:{value:!0},color:{value:new Ys(.8,.8,.8)},smoothness:{value:1.44},styling:{value:.82},clustering:{value:5},gapping:{value:.63},rotation:{value:60},density:{value:1},scale:{value:15},showColor:{value:!0},showBump:{value:!0},pattern:{value:5.58},blender:{value:0},imageUrl:"https://images.unsplash.com/photo-1707421940727-ebfb88cd6aa0?q=80&w=2532&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",blendImage:{value:null}},{...a,effect:7});if(n){n.addBlade({view:"buttongrid",size:[3,1],cells:(e,t)=>({title:[["Color","Bump","Invert"]][t][e]}),label:"Effect Mode"}).on("click",(n=>{switch(n.index[0]){case 0:e.hidden=i.showColor.value,0==i.blender.value?t.hidden=i.showColor.value:2==i.blender.value&&(s.hidden=i.showColor.value),i.showColor.value=!i.showColor.value;break;case 1:i.showBump.value=!i.showBump.value;break;case 2:i.invert.value=!i.invert.value}}));const e=n.addBlade({view:"buttongrid",size:[3,1],cells:(e,t)=>({title:[["Color","UV","Image"]][t][e]}),label:"Background Type"}).on("click",(e=>{switch(i.blender.value=e.index[0],e.index[0]){case 0:t.hidden=!1,s.hidden=!0;break;case 2:t.hidden=!0,s.hidden=!1;break;default:t.hidden=!0,s.hidden=!0}})),t=n.addBinding(i.color,"value",{label:"Background Color",picker:"inline",color:{type:"float"}}),s=n.addBinding(i,"imageUrl",{view:"input-image",label:"Background Image",hidden:!0}).on("change",(e=>e.value.onload=()=>{i.imageUrl=cv(e.value),i.blendImage.value=hv.load(i.imageUrl)}));i.blendImage.value=hv.load(i.imageUrl),n.addBinding(i.geoVertex,"value",{label:"VertexCount",step:1}).on("change",(()=>tB(r,i.geoVertex.value))),n.addBinding(i.scale,"value",{label:"Scale",step:.01,min:-50,max:50}),n.addBinding(i.pattern,"value",{label:"Pattern",step:.01,min:-50,max:50}),n.addBinding(i.density,"value",{label:"Shift",step:2,min:-1,max:1}),n.addBinding(i.clustering,"value",{label:"Clustering",step:.01,min:0,max:5}),n.addBinding(i.gapping,"value",{label:"Gapping & Displacement",step:.01,min:0,max:10}),n.addBinding(i.smoothness,"value",{label:"Smoothness",step:.01,min:0,max:3}),n.addBinding(i.styling,"value",{label:"Styling",step:.01,min:-3,max:3})}s()}})),t.setAttribute&&"function"==typeof t.setAttribute&&t.setAttribute(r)}var MB,EB,SB,CB,TB,PB=null,AB=[];async function LB(e="solid-view",t={}){let n=innerWidth,i=innerHeight;const s=new ap;var r,a,o={};null==EB&&(EB=new Xl,(SB=new $r(35,n/i,.01,1e3)).position.set(0,0,6),CB=new Gl({antialias:!0,alpha:!0}),EB.visible=!1,CB.setSize(n,i),CB.setPixelRatio(Math.min(window.devicePixelRatio,2)),(PB=document.createElement("div")).classList.add("_canvas_container"),PB.appendChild(CB.domElement),document.body.appendChild(PB));const l=t.fps&&iB(),h=new Vd(4210752,.5);EB.add(h);const u=new Cm,d=new Ef;d.setDecoderConfig({type:"js"}),d.setDecoderPath("https://www.gstatic.com/draco/v1/decoders/"),u.setDRACOLoader(d);const p={scene:EB,camera:SB,renderer:CB,rotation:[],position:[],scale:[],elem:[],visible:[],model:[],material:[]},m={};let f=[];const v={ambientLight:"#404040",ambientIntensity:.5,objectsDistance:{value:4,range:[0,20]},cameraLook:new Ai,cameraRotation:new Ai,zindex:{value:-99,range:[-99,99]},cameraZoom:1,solids:[],solidNo:0,solidPosition_XY:new Zn,solidPosition_Z:.001,solidRotation:new Ai,solidScale:new bi(1,1,1,1),position:[],rotation:[],scale:[],scene_texture:"https://dl.polyhaven.org/file/ph-assets/HDRIs/hdr/1k/quattro_canti_1k.hdr",scene_background:!1,ogMaterial:[]};let g={rect:[],scale:[]};const _=document.querySelectorAll(e);let w=0;(async function(){if(t.solidConfig){const e=JSON.parse(JSON.stringify(t.solidConfig));return Object.assign(v,e),e.scale[0]&&v.solidScale.copy(e.scale[0]),e.rotation[0]&&v.solidRotation.set(e.rotation[0]._x,e.rotation[0]._y,e.rotation[0]._z),e.position[0]&&(v.solidPosition_XY.x=e.position[0].x,v.solidPosition_XY.y=e.position[0].y,v.solidPosition_Z=v.position[0].x),h.color.set(e.ambientLight),h.intensity=e.ambientIntensity,SB.zoom=e.cameraZoom,SB.updateProjectionMatrix(),e}return!1})().then((e=>{x(v.scene_texture,v.scene_background),_.forEach((async function(n,i){var r=n.getBoundingClientRect();c().set(n,{x:0,y:0,z:1e-4}),g.rect[i]=[r.x,r.y],g.scale[i]=[0,0];const a=new Ol;v.solids.push({text:"Object-"+(i+1),value:i}),AB.push((()=>function(e,t,n){var i=e.getBoundingClientRect();const s=new Ai;(new Di).setFromObject(t).getSize(s),g.rect[n][0]!=i.x||(g.rect[n][1],i.y),g.rect[n][0]!=i.z&&C(e,t,n,i);E&&(C(e,t,n,i),E=!1);S(g.scale[n][0])==S(sv(s.x,SB))&&S(g.scale[n][1])==S(sv(s.y,SB))||(c().set(e,{width:sv(s.x,SB),height:sv(s.y,SB)}),g.scale[n]=[sv(s.x,SB),sv(s.y,SB)])}(n,a,i))),e&&(e.position[w]&&c().set(n,{x:e.position[w].x,y:e.position[w].y,z:e.position[w].z}),e.rotation[w]&&a.rotation.set(e.rotation[w]._x,e.rotation[w]._y,e.rotation[w]._z),e.scale[w]&&a.scale.set(e.scale[w].x,e.scale[w].y,e.scale[w].z)),u.load(n.dataset.source,(e=>{const r=(new Di).setFromObject(e.scene).getCenter(new Ai);e.scene.position.x+=e.scene.position.x-r.x,e.scene.position.y+=e.scene.position.y-r.y,e.scene.position.z+=e.scene.position.z-r.z,t.scale&&(t.scale[0]?a.scale.set(t.scale[0],t.scale[1],t.scale[2]):a.scale.set(t.scale,t.scale,t.scale)),t.position&&a.position.set(t.position[0],t.position[1],t.position[2]),t.rotation&&a.rotation.set(t.rotation[0],t.rotation[1],t.rotation[2]),a.add(e.scene),1==_.length?(p.elem=n,p.model=a,p.rotation=a.rotation,p.position=a.position,p.scale=a.scale,p.visible=a.visible):(p.elem[i]=n,p.model[i]=a,p.rotation[i]=a.rotation,p.position[i]=a.position,p.scale[i]=a.scale,p.visible[i]=a.visible);var l=[];e.scene.traverse((e=>e instanceof zr&&l.push(e.material.clone()))),v.ogMaterial[i]=l,f[i]=e.scene;const c=cB({isDebug:0==i,materialsDebug:m,solidView:_,gui:o,i,scene:f,attributes:p,solid_debugObj:v,clock:s,opts:t});1==_.length?p.material=c:p.material[i]=c})),EB.add(a),w++}))}));const b=()=>{t.fps&&l.begin();const e=s.getElapsedTime();AB.forEach((e=>e())),nv(y).then((()=>{1==_.length&&0!=p.model.length?p.model.traverse((function(t){if(t.isMesh){const n=t.material.userData.shader;n&&(n.uniforms.time.value=e)}})):p.model.forEach(((t,n)=>{t.traverse((function(t){if(t.isMesh){const n=t.material.userData.shader;n&&(n.uniforms.time.value=e)}}))}))})),CB.render(EB,SB),t.fps&&l.end(),window.requestAnimationFrame(b)};function y(){return p.model.length==_.length||p.model&&p.model.isObject3D}function x(){v.scene_texture.length>0&&(TB&&TB.dispose(),(new xf).load(v.scene_texture,(e=>{TB=e,e.mapping=pe,EB.environment=e,EB.background=v.scene_background?e:null,EB.visible=!0,s.start()})))}function M(e){const t=getComputedStyle(e).transform;if(!t.startsWith("matrix3d("))return{x:0,y:0,z:0};const n=t.slice(9,-1).split(",").map(Number);return new Ai(n[12],n[13],n[14])}nv(y).then((()=>{t.setAttribute&&"function"==typeof t.setAttribute&&t.setAttribute(p),t.debug&&!MB&&function(){MB=!0;const e=sB();r=e.addTab({pages:[{title:"Scene"},{title:"Material"}]}),o.page=r.pages[1],(a=r.pages[0]).addButton({title:"Save To Clipboard"}).on("click",(e=>{const{ogMaterial:t,solidScale:n,solidRotation:i,solidPosition:s,solidNo:r,solids:a,...o}=v,l=e.native.target;ev(av(o)).then(rB(l),(()=>rB(l,400)))})),a.addBinding(v,"scene_texture",{label:"Environment Map"}).on("change",x),a.addBinding(v,"scene_background",{label:"Environment Background"}).on("change",x),a.addBinding(v,"ambientLight",{label:"Ambient Light"}).on("change",(()=>{h.color.set(v.ambientLight)})),a.addBinding(v,"ambientIntensity",{label:"Ambient Intensity",min:0,max:100,step:.01}).on("change",(()=>{h.intensity=v.ambientIntensity}));const t=a.addFolder({title:"Camera",expanded:!1});t.addBinding(v,"cameraZoom",{label:"Camera Zoom",min:.1,max:10,step:.01}).on("change",(()=>{SB.zoom=v.cameraZoom,SB.updateProjectionMatrix()}));const n=t.addTab({pages:[{title:"Rotation"},{title:"Look"}]});n.pages[0].addBinding(v,"cameraRotation",{view:"rotation",rotationMode:"euler",order:"XYZ"}).on("change",(()=>SB.rotation.set(v.cameraRotation.x,v.cameraRotation.y,v.cameraRotation.z))),n.pages[1].addBinding(v,"cameraLook",{step:.01}).on("change",(()=>SB.lookAt(new Ai(v.cameraLook.x,v.cameraLook.y,v.cameraLook.z))));const i=a.addFolder({title:"3D Object",expanded:!1});_.length>1&&i.addBlade({view:"list",label:"Objects",options:v.solids,value:0}).on("change",(e=>{v.solidNo=e.value;const t=e.value;v.scale[t]?v.solidScale.copy(v.scale[t]):v.solidScale.set(1,1,1,1),v.position[t]?(v.solidPosition_XY.x=v.position[t].x,v.solidPosition_XY.y=v.position[t].y,v.solidPosition_Z=v.position[t].x):(v.solidPosition_XY.x=0,v.solidPosition_XY.y=0,v.solidPosition_Z=1e-5),v.rotation[t]?v.solidRotation.set(v.rotation[t]._x,v.rotation[t]._y,v.rotation[t]._z):v.solidRotation.set(0),a.refresh()}));const s=i.addTab({pages:[{title:"Position"},{title:"Rotation"},{title:"Scale"}]}),l=Math.max(innerWidth/1.5,innerHeight/1.5);s.pages[0].addBinding(v,"solidPosition_Z",{step:5,min:-1500,max:1500}).on("change",(()=>T((e=>e&&c().set(e,{z:v.solidPosition_Z})),0))),s.pages[0].addBinding(v,"solidPosition_XY",{step:5,expanded:!0,picker:"inline",min:-l,max:l}).on("change",(()=>T((e=>e&&c().set(e,{x:v.solidPosition_XY.x,y:v.solidPosition_XY.y,z:v.solidPosition_Z})),0))),s.pages[1].addBinding(v,"solidRotation",{picker:"inline",view:"rotation",rotationMode:"euler",expanded:!0,order:"XYZ",unit:"rad",step:.1}).on("change",(()=>T((e=>{e&&e.rotation.set(v.solidRotation.x,v.solidRotation.y,v.solidRotation.z)}),1))),s.pages[2].addBinding(v,"solidScale",{step:.1}).on("change",(()=>T((e=>e&&e.scale.set(v.solidScale.x*v.solidScale.w,v.solidScale.y*v.solidScale.w,v.solidScale.z*v.solidScale.w)),2)))}(),b()}));var E=!0;function S(e){return Math.round(1e4*e)/1e4}function C(e,n,i,s){g.rect[i]=[s.x,s.y];var r=(s.left+s.right)/2/window.innerWidth*2-1,a=-(s.top+s.bottom)/2/window.innerHeight*2+1,o=new Ai(r,a,.5);o.unproject(SB);var l=o.sub(SB.position).normalize(),c=-SB.position.z/l.z,h=SB.position.clone().add(l.multiplyScalar(c));n.position.x=$n.lerp(n.position.x,h.x,t.lerp||1),n.position.y=$n.lerp(n.position.y,h.y,t.lerp||1),n.position.z=$n.lerp(n.position.z,iv(M(e).z,SB),t.lerp||1)}function T(e,t){if(t+1){const n=1==_.length?0==t?p.elem:p.model:0==t?p.elem[v.solidNo]:p.model[v.solidNo];switch(e(n),t){case 0:const e=M(n);v.position[v.solidNo]=new Ai(e.x,e.y,e.z);break;case 1:v.rotation[v.solidNo]=n.rotation;break;case 2:v.scale[v.solidNo]=n.scale}}}const P=()=>{n=window.innerWidth,i=window.innerHeight,SB.aspect=n/i,SB.updateProjectionMatrix(),CB.setSize(n,i),CB.setPixelRatio(Math.min(window.devicePixelRatio,2))};return window.addEventListener("resize",P),P(),await nv((()=>0!=p.rotation.length)),p}function RB(e={damping:.07,speed:1}){var t=!1,n=0,i=0;function s(){i=$n.lerp(i,n,e.damping),i=Math.max(0,Math.min(i,document.documentElement.scrollHeight-window.innerHeight)),window.scrollTo(0,i),Math.abs(n-i)>1?requestAnimationFrame(s):t=!1}window.addEventListener("wheel",(function(r){r.preventDefault();var a=r.deltaY||r.detail||r.wheelDelta;n+=a*e.speed,n=Math.max(0,Math.min(n,document.documentElement.scrollHeight-window.innerHeight)),t||(t=!0,requestAnimationFrame(s)),window.addEventListener("scroll",(()=>{t||(i=scrollY)}))}),{passive:!1})}const DB=o})(),r})()));